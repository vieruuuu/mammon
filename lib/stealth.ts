
import { decode } from "std/encoding/base64.ts";

export default decode(`KCh7X3V0aWxzRm5zOl91dGlsc0ZucyxfbWFpbkZ1bmN0aW9uOl9tYWluRnVuY3Rpb24sX2FyZ3M6X2FyZ3N9KT0+e2NvbnN0IHV0aWxzPU9iamVjdC5mcm9tRW50cmllcyhPYmplY3QuZW50cmllcyhfdXRpbHNGbnMpLm1hcCgoKFtrZXksdmFsdWVdKT0+W2tleSxldmFsKHZhbHVlKV0pKSk7dXRpbHMuaW5pdCgpLGV2YWwoX21haW5GdW5jdGlvbikodXRpbHMsLi4uX2FyZ3MpfSkoe191dGlsc0Zuczp7aW5pdDoiKCkgPT4ge1xuICB1dGlscy5wcmVsb2FkQ2FjaGUoKVxufSIsc3RyaXBQcm94eUZyb21FcnJvcnM6IihoYW5kbGVyID0ge30pID0+IHtcbiAgY29uc3QgbmV3SGFuZGxlciA9IHtcbiAgICBzZXRQcm90b3R5cGVPZjogZnVuY3Rpb24gKHRhcmdldCwgcHJvdG8pIHtcbiAgICAgIGlmIChwcm90byA9PT0gbnVsbClcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNvbnZlcnQgb2JqZWN0IHRvIHByaW1pdGl2ZSB2YWx1ZScpXG4gICAgICBpZiAoT2JqZWN0LmdldFByb3RvdHlwZU9mKHRhcmdldCkgPT09IE9iamVjdC5nZXRQcm90b3R5cGVPZihwcm90bykpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignQ3ljbGljIF9fcHJvdG9fXyB2YWx1ZScpXG4gICAgICB9XG4gICAgICByZXR1cm4gUmVmbGVjdC5zZXRQcm90b3R5cGVPZih0YXJnZXQsIHByb3RvKVxuICAgIH1cbiAgfVxuICAvLyBXZSB3cmFwIGVhY2ggdHJhcCBpbiB0aGUgaGFuZGxlciBpbiBhIHRyeS9jYXRjaCBhbmQgbW9kaWZ5IHRoZSBlcnJvciBzdGFjayBpZiB0aGV5IHRocm93XG4gIGNvbnN0IHRyYXBzID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoaGFuZGxlcilcbiAgdHJhcHMuZm9yRWFjaCh0cmFwID0+IHtcbiAgICBuZXdIYW5kbGVyW3RyYXBdID0gZnVuY3Rpb24gKCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gRm9yd2FyZCB0aGUgY2FsbCB0byB0aGUgZGVmaW5lZCBwcm94eSBoYW5kbGVyXG4gICAgICAgIHJldHVybiBoYW5kbGVyW3RyYXBdLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyB8fCBbXSlcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAvLyBTdGFjayB0cmFjZXMgZGlmZmVyIHBlciBicm93c2VyLCB3ZSBvbmx5IHN1cHBvcnQgY2hyb21pdW0gYmFzZWQgb25lcyBjdXJyZW50bHlcbiAgICAgICAgaWYgKCFlcnIgfHwgIWVyci5zdGFjayB8fCAhZXJyLnN0YWNrLmluY2x1ZGVzKGBhdCBgKSkge1xuICAgICAgICAgIHRocm93IGVyclxuICAgICAgICB9XG5cbiAgICAgICAgLy8gV2hlbiBzb21ldGhpbmcgdGhyb3dzIHdpdGhpbiBvbmUgb2Ygb3VyIHRyYXBzIHRoZSBQcm94eSB3aWxsIHNob3cgdXAgaW4gZXJyb3Igc3RhY2tzXG4gICAgICAgIC8vIEFuIGVhcmxpZXIgaW1wbGVtZW50YXRpb24gb2YgdGhpcyBjb2RlIHdvdWxkIHNpbXBseSBzdHJpcCBsaW5lcyB3aXRoIGEgYmxhY2tsaXN0LFxuICAgICAgICAvLyBidXQgaXQgbWFrZXMgc2Vuc2UgdG8gYmUgbW9yZSBzdXJnaWNhbCBoZXJlIGFuZCBvbmx5IHJlbW92ZSBsaW5lcyByZWxhdGVkIHRvIG91ciBQcm94eS5cbiAgICAgICAgLy8gV2UgdHJ5IHRvIHVzZSBhIGtub3duIFwiYW5jaG9yXCIgbGluZSBmb3IgdGhhdCBhbmQgc3RyaXAgaXQgd2l0aCBldmVyeXRoaW5nIGFib3ZlIGl0LlxuICAgICAgICAvLyBJZiB0aGUgYW5jaG9yIGxpbmUgY2Fubm90IGJlIGZvdW5kIGZvciBzb21lIHJlYXNvbiB3ZSBmYWxsIGJhY2sgdG8gb3VyIGJsYWNrbGlzdCBhcHByb2FjaC5cblxuICAgICAgICBjb25zdCBzdHJpcFdpdGhCbGFja2xpc3QgPSAoc3RhY2ssIHN0cmlwRmlyc3RMaW5lID0gdHJ1ZSkgPT4ge1xuICAgICAgICAgIGNvbnN0IGJsYWNrbGlzdCA9IFtcbiAgICAgICAgICAgIGBhdCBSZWZsZWN0LiR7dHJhcH0gYCwgLy8gZS5nLiBSZWZsZWN0LmdldCBvciBSZWZsZWN0LmFwcGx5XG4gICAgICAgICAgICBgYXQgT2JqZWN0LiR7dHJhcH0gYCwgLy8gZS5nLiBPYmplY3QuZ2V0IG9yIE9iamVjdC5hcHBseVxuICAgICAgICAgICAgYGF0IE9iamVjdC5uZXdIYW5kbGVyLjxjb21wdXRlZD4gW2FzICR7dHJhcH1dIGAgLy8gY2F1c2VkIGJ5IHRoaXMgdmVyeSB3cmFwcGVyIDotKVxuICAgICAgICAgIF1cbiAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgZXJyLnN0YWNrXG4gICAgICAgICAgICAgIC5zcGxpdCgnXFxuJylcbiAgICAgICAgICAgICAgLy8gQWx3YXlzIHJlbW92ZSB0aGUgZmlyc3QgKGZpbGUpIGxpbmUgaW4gdGhlIHN0YWNrIChndWFyYW50ZWVkIHRvIGJlIG91ciBwcm94eSlcbiAgICAgICAgICAgICAgLmZpbHRlcigobGluZSwgaW5kZXgpID0+ICEoaW5kZXggPT09IDEgJiYgc3RyaXBGaXJzdExpbmUpKVxuICAgICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgbGluZSBzdGFydHMgd2l0aCBvbmUgb2Ygb3VyIGJsYWNrbGlzdGVkIHN0cmluZ3NcbiAgICAgICAgICAgICAgLmZpbHRlcihsaW5lID0+ICFibGFja2xpc3Quc29tZShibCA9PiBsaW5lLnRyaW0oKS5zdGFydHNXaXRoKGJsKSkpXG4gICAgICAgICAgICAgIC5qb2luKCdcXG4nKVxuICAgICAgICAgIClcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHN0cmlwV2l0aEFuY2hvciA9IChzdGFjaywgYW5jaG9yKSA9PiB7XG4gICAgICAgICAgY29uc3Qgc3RhY2tBcnIgPSBzdGFjay5zcGxpdCgnXFxuJylcbiAgICAgICAgICBhbmNob3IgPSBhbmNob3IgfHwgYGF0IE9iamVjdC5uZXdIYW5kbGVyLjxjb21wdXRlZD4gW2FzICR7dHJhcH1dIGAgLy8gS25vd24gZmlyc3QgUHJveHkgbGluZSBpbiBjaHJvbWl1bVxuICAgICAgICAgIGNvbnN0IGFuY2hvckluZGV4ID0gc3RhY2tBcnIuZmluZEluZGV4KGxpbmUgPT5cbiAgICAgICAgICAgIGxpbmUudHJpbSgpLnN0YXJ0c1dpdGgoYW5jaG9yKVxuICAgICAgICAgIClcbiAgICAgICAgICBpZiAoYW5jaG9ySW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2UgLy8gNDA0LCBhbmNob3Igbm90IGZvdW5kXG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIFN0cmlwIGV2ZXJ5dGhpbmcgZnJvbSB0aGUgdG9wIHVudGlsIHdlIHJlYWNoIHRoZSBhbmNob3IgbGluZVxuICAgICAgICAgIC8vIE5vdGU6IFdlJ3JlIGtlZXBpbmcgdGhlIDFzdCBsaW5lICh6ZXJvIGluZGV4KSBhcyBpdCdzIHVucmVsYXRlZCAoZS5nLiBgVHlwZUVycm9yYClcbiAgICAgICAgICBzdGFja0Fyci5zcGxpY2UoMSwgYW5jaG9ySW5kZXgpXG4gICAgICAgICAgcmV0dXJuIHN0YWNrQXJyLmpvaW4oJ1xcbicpXG4gICAgICAgIH1cblxuICAgICAgICAvLyBTcGVjaWFsIGNhc2VzIGR1ZSB0byBvdXIgbmVzdGVkIHRvU3RyaW5nIHByb3hpZXNcbiAgICAgICAgZXJyLnN0YWNrID0gZXJyLnN0YWNrLnJlcGxhY2UoXG4gICAgICAgICAgJ2F0IE9iamVjdC50b1N0cmluZyAoJyxcbiAgICAgICAgICAnYXQgRnVuY3Rpb24udG9TdHJpbmcgKCdcbiAgICAgICAgKVxuICAgICAgICBpZiAoKGVyci5zdGFjayB8fCAnJykuaW5jbHVkZXMoJ2F0IEZ1bmN0aW9uLnRvU3RyaW5nICgnKSkge1xuICAgICAgICAgIGVyci5zdGFjayA9IHN0cmlwV2l0aEJsYWNrbGlzdChlcnIuc3RhY2ssIGZhbHNlKVxuICAgICAgICAgIHRocm93IGVyclxuICAgICAgICB9XG5cbiAgICAgICAgLy8gVHJ5IHVzaW5nIHRoZSBhbmNob3IgbWV0aG9kLCBmYWxsYmFjayB0byBibGFja2xpc3QgaWYgbmVjZXNzYXJ5XG4gICAgICAgIGVyci5zdGFjayA9IHN0cmlwV2l0aEFuY2hvcihlcnIuc3RhY2spIHx8IHN0cmlwV2l0aEJsYWNrbGlzdChlcnIuc3RhY2spXG5cbiAgICAgICAgdGhyb3cgZXJyIC8vIFJlLXRocm93IG91ciBub3cgc2FuaXRpemVkIGVycm9yXG4gICAgICB9XG4gICAgfVxuICB9KVxuICByZXR1cm4gbmV3SGFuZGxlclxufSIsc3RyaXBFcnJvcldpdGhBbmNob3I6IihlcnIsIGFuY2hvcikgPT4ge1xuICBjb25zdCBzdGFja0FyciA9IGVyci5zdGFjay5zcGxpdCgnXFxuJylcbiAgY29uc3QgYW5jaG9ySW5kZXggPSBzdGFja0Fyci5maW5kSW5kZXgobGluZSA9PiBsaW5lLnRyaW0oKS5zdGFydHNXaXRoKGFuY2hvcikpXG4gIGlmIChhbmNob3JJbmRleCA9PT0gLTEpIHtcbiAgICByZXR1cm4gZXJyIC8vIDQwNCwgYW5jaG9yIG5vdCBmb3VuZFxuICB9XG4gIC8vIFN0cmlwIGV2ZXJ5dGhpbmcgZnJvbSB0aGUgdG9wIHVudGlsIHdlIHJlYWNoIHRoZSBhbmNob3IgbGluZSAocmVtb3ZlIGFuY2hvciBsaW5lIGFzIHdlbGwpXG4gIC8vIE5vdGU6IFdlJ3JlIGtlZXBpbmcgdGhlIDFzdCBsaW5lICh6ZXJvIGluZGV4KSBhcyBpdCdzIHVucmVsYXRlZCAoZS5nLiBgVHlwZUVycm9yYClcbiAgc3RhY2tBcnIuc3BsaWNlKDEsIGFuY2hvckluZGV4KVxuICBlcnIuc3RhY2sgPSBzdGFja0Fyci5qb2luKCdcXG4nKVxuICByZXR1cm4gZXJyXG59IixyZXBsYWNlUHJvcGVydHk6IihvYmosIHByb3BOYW1lLCBkZXNjcmlwdG9yT3ZlcnJpZGVzID0ge30pID0+IHtcbiAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIHByb3BOYW1lLCB7XG4gICAgLy8gQ29weSBvdmVyIHRoZSBleGlzdGluZyBkZXNjcmlwdG9ycyAod3JpdGFibGUsIGVudW1lcmFibGUsIGNvbmZpZ3VyYWJsZSwgZXRjKVxuICAgIC4uLihPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwgcHJvcE5hbWUpIHx8IHt9KSxcbiAgICAvLyBBZGQgb3VyIG92ZXJyaWRlcyAoZS5nLiB2YWx1ZSwgZ2V0KCkpXG4gICAgLi4uZGVzY3JpcHRvck92ZXJyaWRlc1xuICB9KVxufSIscHJlbG9hZENhY2hlOiIoKSA9PiB7XG4gIGlmICh1dGlscy5jYWNoZSkge1xuICAgIHJldHVyblxuICB9XG4gIHV0aWxzLmNhY2hlID0ge1xuICAgIC8vIFVzZWQgaW4gb3VyIHByb3hpZXNcbiAgICBSZWZsZWN0OiB7XG4gICAgICBnZXQ6IFJlZmxlY3QuZ2V0LmJpbmQoUmVmbGVjdCksXG4gICAgICBhcHBseTogUmVmbGVjdC5hcHBseS5iaW5kKFJlZmxlY3QpXG4gICAgfSxcbiAgICAvLyBVc2VkIGluIGBtYWtlTmF0aXZlU3RyaW5nYFxuICAgIG5hdGl2ZVRvU3RyaW5nU3RyOiBGdW5jdGlvbi50b1N0cmluZyArICcnIC8vID0+IGBmdW5jdGlvbiB0b1N0cmluZygpIHsgW25hdGl2ZSBjb2RlXSB9YFxuICB9XG59IixtYWtlTmF0aXZlU3RyaW5nOiIobmFtZSA9ICcnKSA9PiB7XG4gIHJldHVybiB1dGlscy5jYWNoZS5uYXRpdmVUb1N0cmluZ1N0ci5yZXBsYWNlKCd0b1N0cmluZycsIG5hbWUgfHwgJycpXG59IixwYXRjaFRvU3RyaW5nOiIob2JqLCBzdHIgPSAnJykgPT4ge1xuICBjb25zdCBoYW5kbGVyID0ge1xuICAgIGFwcGx5OiBmdW5jdGlvbiAodGFyZ2V0LCBjdHgpIHtcbiAgICAgIC8vIFRoaXMgZml4ZXMgZS5nLiBgSFRNTE1lZGlhRWxlbWVudC5wcm90b3R5cGUuY2FuUGxheVR5cGUudG9TdHJpbmcgKyBcIlwiYFxuICAgICAgaWYgKGN0eCA9PT0gRnVuY3Rpb24ucHJvdG90eXBlLnRvU3RyaW5nKSB7XG4gICAgICAgIHJldHVybiB1dGlscy5tYWtlTmF0aXZlU3RyaW5nKCd0b1N0cmluZycpXG4gICAgICB9XG4gICAgICAvLyBgdG9TdHJpbmdgIHRhcmdldGVkIGF0IG91ciBwcm94aWVkIE9iamVjdCBkZXRlY3RlZFxuICAgICAgaWYgKGN0eCA9PT0gb2JqKSB7XG4gICAgICAgIC8vIFdlIGVpdGhlciByZXR1cm4gdGhlIG9wdGlvbmFsIHN0cmluZyB2ZXJiYXRpbSBvciBkZXJpdmUgdGhlIG1vc3QgZGVzaXJlZCByZXN1bHQgYXV0b21hdGljYWxseVxuICAgICAgICByZXR1cm4gc3RyIHx8IHV0aWxzLm1ha2VOYXRpdmVTdHJpbmcob2JqLm5hbWUpXG4gICAgICB9XG4gICAgICAvLyBDaGVjayBpZiB0aGUgdG9TdHJpbmcgcHJvdHlwZSBvZiB0aGUgY29udGV4dCBpcyB0aGUgc2FtZSBhcyB0aGUgZ2xvYmFsIHByb3RvdHlwZSxcbiAgICAgIC8vIGlmIG5vdCBpbmRpY2F0ZXMgdGhhdCB3ZSBhcmUgZG9pbmcgYSBjaGVjayBhY3Jvc3MgZGlmZmVyZW50IHdpbmRvd3MuLCBlLmcuIHRoZSBpZnJhbWVXaXRoZGlyZWN0YCB0ZXN0IGNhc2VcbiAgICAgIGNvbnN0IGhhc1NhbWVQcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihcbiAgICAgICAgRnVuY3Rpb24ucHJvdG90eXBlLnRvU3RyaW5nXG4gICAgICApLmlzUHJvdG90eXBlT2YoY3R4LnRvU3RyaW5nKSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXByb3RvdHlwZS1idWlsdGluc1xuICAgICAgaWYgKCFoYXNTYW1lUHJvdG8pIHtcbiAgICAgICAgLy8gUGFzcyB0aGUgY2FsbCBvbiB0byB0aGUgbG9jYWwgRnVuY3Rpb24ucHJvdG90eXBlLnRvU3RyaW5nIGluc3RlYWRcbiAgICAgICAgcmV0dXJuIGN0eC50b1N0cmluZygpXG4gICAgICB9XG4gICAgICByZXR1cm4gdGFyZ2V0LmNhbGwoY3R4KVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHRvU3RyaW5nUHJveHkgPSBuZXcgUHJveHkoXG4gICAgRnVuY3Rpb24ucHJvdG90eXBlLnRvU3RyaW5nLFxuICAgIHV0aWxzLnN0cmlwUHJveHlGcm9tRXJyb3JzKGhhbmRsZXIpXG4gIClcbiAgdXRpbHMucmVwbGFjZVByb3BlcnR5KEZ1bmN0aW9uLnByb3RvdHlwZSwgJ3RvU3RyaW5nJywge1xuICAgIHZhbHVlOiB0b1N0cmluZ1Byb3h5XG4gIH0pXG59IixwYXRjaFRvU3RyaW5nTmVzdGVkOiIob2JqID0ge30pID0+IHtcbiAgcmV0dXJuIHV0aWxzLmV4ZWNSZWN1cnNpdmVseShvYmosIFsnZnVuY3Rpb24nXSwgdXRpbHMucGF0Y2hUb1N0cmluZylcbn0iLHJlZGlyZWN0VG9TdHJpbmc6Iihwcm94eU9iaiwgb3JpZ2luYWxPYmopID0+IHtcbiAgY29uc3QgaGFuZGxlciA9IHtcbiAgICBhcHBseTogZnVuY3Rpb24gKHRhcmdldCwgY3R4KSB7XG4gICAgICAvLyBUaGlzIGZpeGVzIGUuZy4gYEhUTUxNZWRpYUVsZW1lbnQucHJvdG90eXBlLmNhblBsYXlUeXBlLnRvU3RyaW5nICsgXCJcImBcbiAgICAgIGlmIChjdHggPT09IEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZykge1xuICAgICAgICByZXR1cm4gdXRpbHMubWFrZU5hdGl2ZVN0cmluZygndG9TdHJpbmcnKVxuICAgICAgfVxuXG4gICAgICAvLyBgdG9TdHJpbmdgIHRhcmdldGVkIGF0IG91ciBwcm94aWVkIE9iamVjdCBkZXRlY3RlZFxuICAgICAgaWYgKGN0eCA9PT0gcHJveHlPYmopIHtcbiAgICAgICAgY29uc3QgZmFsbGJhY2sgPSAoKSA9PlxuICAgICAgICAgIG9yaWdpbmFsT2JqICYmIG9yaWdpbmFsT2JqLm5hbWVcbiAgICAgICAgICAgID8gdXRpbHMubWFrZU5hdGl2ZVN0cmluZyhvcmlnaW5hbE9iai5uYW1lKVxuICAgICAgICAgICAgOiB1dGlscy5tYWtlTmF0aXZlU3RyaW5nKHByb3h5T2JqLm5hbWUpXG5cbiAgICAgICAgLy8gUmV0dXJuIHRoZSB0b1N0cmluZyByZXByZXNlbnRhdGlvbiBvZiBvdXIgb3JpZ2luYWwgb2JqZWN0IGlmIHBvc3NpYmxlXG4gICAgICAgIHJldHVybiBvcmlnaW5hbE9iaiArICcnIHx8IGZhbGxiYWNrKClcbiAgICAgIH1cblxuICAgICAgaWYgKHR5cGVvZiBjdHggPT09ICd1bmRlZmluZWQnIHx8IGN0eCA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gdGFyZ2V0LmNhbGwoY3R4KVxuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiB0aGUgdG9TdHJpbmcgcHJvdHlwZSBvZiB0aGUgY29udGV4dCBpcyB0aGUgc2FtZSBhcyB0aGUgZ2xvYmFsIHByb3RvdHlwZSxcbiAgICAgIC8vIGlmIG5vdCBpbmRpY2F0ZXMgdGhhdCB3ZSBhcmUgZG9pbmcgYSBjaGVjayBhY3Jvc3MgZGlmZmVyZW50IHdpbmRvd3MuLCBlLmcuIHRoZSBpZnJhbWVXaXRoZGlyZWN0YCB0ZXN0IGNhc2VcbiAgICAgIGNvbnN0IGhhc1NhbWVQcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihcbiAgICAgICAgRnVuY3Rpb24ucHJvdG90eXBlLnRvU3RyaW5nXG4gICAgICApLmlzUHJvdG90eXBlT2YoY3R4LnRvU3RyaW5nKSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXByb3RvdHlwZS1idWlsdGluc1xuICAgICAgaWYgKCFoYXNTYW1lUHJvdG8pIHtcbiAgICAgICAgLy8gUGFzcyB0aGUgY2FsbCBvbiB0byB0aGUgbG9jYWwgRnVuY3Rpb24ucHJvdG90eXBlLnRvU3RyaW5nIGluc3RlYWRcbiAgICAgICAgcmV0dXJuIGN0eC50b1N0cmluZygpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0YXJnZXQuY2FsbChjdHgpXG4gICAgfVxuICB9XG5cbiAgY29uc3QgdG9TdHJpbmdQcm94eSA9IG5ldyBQcm94eShcbiAgICBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcsXG4gICAgdXRpbHMuc3RyaXBQcm94eUZyb21FcnJvcnMoaGFuZGxlcilcbiAgKVxuICB1dGlscy5yZXBsYWNlUHJvcGVydHkoRnVuY3Rpb24ucHJvdG90eXBlLCAndG9TdHJpbmcnLCB7XG4gICAgdmFsdWU6IHRvU3RyaW5nUHJveHlcbiAgfSlcbn0iLHJlcGxhY2VXaXRoUHJveHk6IihvYmosIHByb3BOYW1lLCBoYW5kbGVyKSA9PiB7XG4gIGNvbnN0IG9yaWdpbmFsT2JqID0gb2JqW3Byb3BOYW1lXVxuICBjb25zdCBwcm94eU9iaiA9IG5ldyBQcm94eShvYmpbcHJvcE5hbWVdLCB1dGlscy5zdHJpcFByb3h5RnJvbUVycm9ycyhoYW5kbGVyKSlcblxuICB1dGlscy5yZXBsYWNlUHJvcGVydHkob2JqLCBwcm9wTmFtZSwgeyB2YWx1ZTogcHJveHlPYmogfSlcbiAgdXRpbHMucmVkaXJlY3RUb1N0cmluZyhwcm94eU9iaiwgb3JpZ2luYWxPYmopXG5cbiAgcmV0dXJuIHRydWVcbn0iLHJlcGxhY2VHZXR0ZXJXaXRoUHJveHk6IihvYmosIHByb3BOYW1lLCBoYW5kbGVyKSA9PiB7XG4gIGNvbnN0IGZuID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIHByb3BOYW1lKS5nZXRcbiAgY29uc3QgZm5TdHIgPSBmbi50b1N0cmluZygpIC8vIHNwZWNpYWwgZ2V0dGVyIGZ1bmN0aW9uIHN0cmluZ1xuICBjb25zdCBwcm94eU9iaiA9IG5ldyBQcm94eShmbiwgdXRpbHMuc3RyaXBQcm94eUZyb21FcnJvcnMoaGFuZGxlcikpXG5cbiAgdXRpbHMucmVwbGFjZVByb3BlcnR5KG9iaiwgcHJvcE5hbWUsIHsgZ2V0OiBwcm94eU9iaiB9KVxuICB1dGlscy5wYXRjaFRvU3RyaW5nKHByb3h5T2JqLCBmblN0cilcblxuICByZXR1cm4gdHJ1ZVxufSIsbW9ja1dpdGhQcm94eToiKG9iaiwgcHJvcE5hbWUsIHBzZXVkb1RhcmdldCwgaGFuZGxlcikgPT4ge1xuICBjb25zdCBwcm94eU9iaiA9IG5ldyBQcm94eShwc2V1ZG9UYXJnZXQsIHV0aWxzLnN0cmlwUHJveHlGcm9tRXJyb3JzKGhhbmRsZXIpKVxuXG4gIHV0aWxzLnJlcGxhY2VQcm9wZXJ0eShvYmosIHByb3BOYW1lLCB7IHZhbHVlOiBwcm94eU9iaiB9KVxuICB1dGlscy5wYXRjaFRvU3RyaW5nKHByb3h5T2JqKVxuXG4gIHJldHVybiB0cnVlXG59IixjcmVhdGVQcm94eToiKHBzZXVkb1RhcmdldCwgaGFuZGxlcikgPT4ge1xuICBjb25zdCBwcm94eU9iaiA9IG5ldyBQcm94eShwc2V1ZG9UYXJnZXQsIHV0aWxzLnN0cmlwUHJveHlGcm9tRXJyb3JzKGhhbmRsZXIpKVxuICB1dGlscy5wYXRjaFRvU3RyaW5nKHByb3h5T2JqKVxuXG4gIHJldHVybiBwcm94eU9ialxufSIsc3BsaXRPYmpQYXRoOiJvYmpQYXRoID0+ICh7XG4gIC8vIFJlbW92ZSBsYXN0IGRvdCBlbnRyeSAocHJvcGVydHkpID09PiBgSFRNTE1lZGlhRWxlbWVudC5wcm90b3R5cGVgXG4gIG9iak5hbWU6IG9ialBhdGguc3BsaXQoJy4nKS5zbGljZSgwLCAtMSkuam9pbignLicpLFxuICAvLyBFeHRyYWN0IGxhc3QgZG90IGVudHJ5ID09PiBgY2FuUGxheVR5cGVgXG4gIHByb3BOYW1lOiBvYmpQYXRoLnNwbGl0KCcuJykuc2xpY2UoLTEpWzBdXG59KSIscmVwbGFjZU9ialBhdGhXaXRoUHJveHk6IihvYmpQYXRoLCBoYW5kbGVyKSA9PiB7XG4gIGNvbnN0IHsgb2JqTmFtZSwgcHJvcE5hbWUgfSA9IHV0aWxzLnNwbGl0T2JqUGF0aChvYmpQYXRoKVxuICBjb25zdCBvYmogPSBldmFsKG9iak5hbWUpIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tZXZhbFxuICByZXR1cm4gdXRpbHMucmVwbGFjZVdpdGhQcm94eShvYmosIHByb3BOYW1lLCBoYW5kbGVyKVxufSIsZXhlY1JlY3Vyc2l2ZWx5OiIob2JqID0ge30sIHR5cGVGaWx0ZXIgPSBbXSwgZm4pID0+IHtcbiAgZnVuY3Rpb24gcmVjdXJzZShvYmopIHtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBvYmopIHtcbiAgICAgIGlmIChvYmpba2V5XSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNvbnRpbnVlXG4gICAgICB9XG4gICAgICBpZiAob2JqW2tleV0gJiYgdHlwZW9mIG9ialtrZXldID09PSAnb2JqZWN0Jykge1xuICAgICAgICByZWN1cnNlKG9ialtrZXldKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKG9ialtrZXldICYmIHR5cGVGaWx0ZXIuaW5jbHVkZXModHlwZW9mIG9ialtrZXldKSkge1xuICAgICAgICAgIGZuLmNhbGwodGhpcywgb2JqW2tleV0pXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmVjdXJzZShvYmopXG4gIHJldHVybiBvYmpcbn0iLHN0cmluZ2lmeUZuczoiKGZuT2JqID0geyBoZWxsbzogKCkgPT4gJ3dvcmxkJyB9KSA9PiB7XG4gIC8vIE9iamVjdC5mcm9tRW50cmllcygpIHBvbnlmaWxsIChpbiA2IGxpbmVzKSAtIHN1cHBvcnRlZCBvbmx5IGluIE5vZGUgdjEyKywgbW9kZXJuIGJyb3dzZXJzIGFyZSBmaW5lXG4gIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9mZXJvc3MvZnJvbWVudHJpZXNcbiAgZnVuY3Rpb24gZnJvbUVudHJpZXMoaXRlcmFibGUpIHtcbiAgICByZXR1cm4gWy4uLml0ZXJhYmxlXS5yZWR1Y2UoKG9iaiwgW2tleSwgdmFsXSkgPT4ge1xuICAgICAgb2JqW2tleV0gPSB2YWxcbiAgICAgIHJldHVybiBvYmpcbiAgICB9LCB7fSlcbiAgfVxuICByZXR1cm4gKE9iamVjdC5mcm9tRW50cmllcyB8fCBmcm9tRW50cmllcykoXG4gICAgT2JqZWN0LmVudHJpZXMoZm5PYmopXG4gICAgICAuZmlsdGVyKChba2V5LCB2YWx1ZV0pID0+IHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJylcbiAgICAgIC5tYXAoKFtrZXksIHZhbHVlXSkgPT4gW2tleSwgdmFsdWUudG9TdHJpbmcoKV0pIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tZXZhbFxuICApXG59IixtYXRlcmlhbGl6ZUZuczoiKGZuU3RyT2JqID0geyBoZWxsbzogXCIoKSA9PiAnd29ybGQnXCIgfSkgPT4ge1xuICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgIE9iamVjdC5lbnRyaWVzKGZuU3RyT2JqKS5tYXAoKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgaWYgKHZhbHVlLnN0YXJ0c1dpdGgoJ2Z1bmN0aW9uJykpIHtcbiAgICAgICAgLy8gc29tZSB0cmlja2VyeSBpcyBuZWVkZWQgdG8gbWFrZSBvbGRzY2hvb2wgZnVuY3Rpb25zIHdvcmsgOi0pXG4gICAgICAgIHJldHVybiBba2V5LCBldmFsKGAoKSA9PiAke3ZhbHVlfWApKCldIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tZXZhbFxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gYXJyb3cgZnVuY3Rpb25zIGp1c3Qgd29ya1xuICAgICAgICByZXR1cm4gW2tleSwgZXZhbCh2YWx1ZSldIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tZXZhbFxuICAgICAgfVxuICAgIH0pXG4gIClcbn0iLG1ha2VIYW5kbGVyOiIoKSA9PiAoe1xuICAvLyBVc2VkIGJ5IHNpbXBsZSBgbmF2aWdhdG9yYCBnZXR0ZXIgZXZhc2lvbnNcbiAgZ2V0dGVyVmFsdWU6IHZhbHVlID0+ICh7XG4gICAgYXBwbHkodGFyZ2V0LCBjdHgsIGFyZ3MpIHtcbiAgICAgIC8vIExldCdzIGZldGNoIHRoZSB2YWx1ZSBmaXJzdCwgdG8gdHJpZ2dlciBhbmQgZXNjYWxhdGUgcG90ZW50aWFsIGVycm9yc1xuICAgICAgLy8gSWxsZWdhbCBpbnZvY2F0aW9ucyBsaWtlIGBuYXZpZ2F0b3IuX19wcm90b19fLnZlbmRvcmAgd2lsbCB0aHJvdyBoZXJlXG4gICAgICB1dGlscy5jYWNoZS5SZWZsZWN0LmFwcGx5KC4uLmFyZ3VtZW50cylcbiAgICAgIHJldHVybiB2YWx1ZVxuICAgIH1cbiAgfSlcbn0pIn0sX21haW5GdW5jdGlvbjondXRpbHMgPT4ge1xuICAgICAgaWYgKCF3aW5kb3cuY2hyb21lKSB7XG4gICAgICAgIC8vIFVzZSB0aGUgZXhhY3QgcHJvcGVydHkgZGVzY3JpcHRvciBmb3VuZCBpbiBoZWFkZnVsIENocm9tZVxuICAgICAgICAvLyBmZXRjaCBpdCB2aWEgYE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iod2luZG93LCBcJ2Nocm9tZVwnKWBcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdywgXCdjaHJvbWVcJywge1xuICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgICAgY29uZmlndXJhYmxlOiBmYWxzZSwgLy8gbm90ZSFcbiAgICAgICAgICB2YWx1ZToge30gLy8gV2VcJ2xsIGV4dGVuZCB0aGF0IGxhdGVyXG4gICAgICAgIH0pXG4gICAgICB9XG5cbiAgICAgIC8vIFRoYXQgbWVhbnMgd2VcJ3JlIHJ1bm5pbmcgaGVhZGZ1bCBhbmQgZG9uXCd0IG5lZWQgdG8gbW9jayBhbnl0aGluZ1xuICAgICAgaWYgKFwnYXBwXCcgaW4gd2luZG93LmNocm9tZSkge1xuICAgICAgICByZXR1cm4gLy8gTm90aGluZyB0byBkbyBoZXJlXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG1ha2VFcnJvciA9IHtcbiAgICAgICAgRXJyb3JJbkludm9jYXRpb246IGZuID0+IHtcbiAgICAgICAgICBjb25zdCBlcnIgPSBuZXcgVHlwZUVycm9yKGBFcnJvciBpbiBpbnZvY2F0aW9uIG9mIGFwcC4ke2ZufSgpYClcbiAgICAgICAgICByZXR1cm4gdXRpbHMuc3RyaXBFcnJvcldpdGhBbmNob3IoXG4gICAgICAgICAgICBlcnIsXG4gICAgICAgICAgICBgYXQgJHtmbn0gKGV2YWwgYXQgPGFub255bW91cz5gXG4gICAgICAgICAgKVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFRoZXJlXCdzIGEgc29tZSBzdGF0aWMgZGF0YSBpbiB0aGF0IHByb3BlcnR5IHdoaWNoIGRvZXNuXCd0IHNlZW0gdG8gY2hhbmdlLFxuICAgICAgLy8gd2Ugc2hvdWxkIHBlcmlvZGljYWxseSBjaGVjayBmb3IgdXBkYXRlczogYEpTT04uc3RyaW5naWZ5KHdpbmRvdy5hcHAsIG51bGwsIDIpYFxuICAgICAgY29uc3QgU1RBVElDX0RBVEEgPSBKU09OLnBhcnNlKFxuICAgICAgICBgXG57XG4gICJpc0luc3RhbGxlZCI6IGZhbHNlLFxuICAiSW5zdGFsbFN0YXRlIjoge1xuICAgICJESVNBQkxFRCI6ICJkaXNhYmxlZCIsXG4gICAgIklOU1RBTExFRCI6ICJpbnN0YWxsZWQiLFxuICAgICJOT1RfSU5TVEFMTEVEIjogIm5vdF9pbnN0YWxsZWQiXG4gIH0sXG4gICJSdW5uaW5nU3RhdGUiOiB7XG4gICAgIkNBTk5PVF9SVU4iOiAiY2Fubm90X3J1biIsXG4gICAgIlJFQURZX1RPX1JVTiI6ICJyZWFkeV90b19ydW4iLFxuICAgICJSVU5OSU5HIjogInJ1bm5pbmciXG4gIH1cbn1cbiAgICAgICAgYC50cmltKClcbiAgICAgIClcblxuICAgICAgd2luZG93LmNocm9tZS5hcHAgPSB7XG4gICAgICAgIC4uLlNUQVRJQ19EQVRBLFxuXG4gICAgICAgIGdldCBpc0luc3RhbGxlZCgpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgfSxcblxuICAgICAgICBnZXREZXRhaWxzOiBmdW5jdGlvbiBnZXREZXRhaWxzKCkge1xuICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aHJvdyBtYWtlRXJyb3IuRXJyb3JJbkludm9jYXRpb24oYGdldERldGFpbHNgKVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgICB9LFxuICAgICAgICBnZXRJc0luc3RhbGxlZDogZnVuY3Rpb24gZ2V0RGV0YWlscygpIHtcbiAgICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhyb3cgbWFrZUVycm9yLkVycm9ySW5JbnZvY2F0aW9uKGBnZXRJc0luc3RhbGxlZGApXG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICB9LFxuICAgICAgICBydW5uaW5nU3RhdGU6IGZ1bmN0aW9uIGdldERldGFpbHMoKSB7XG4gICAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRocm93IG1ha2VFcnJvci5FcnJvckluSW52b2NhdGlvbihgcnVubmluZ1N0YXRlYClcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIFwnY2Fubm90X3J1blwnXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHV0aWxzLnBhdGNoVG9TdHJpbmdOZXN0ZWQod2luZG93LmNocm9tZS5hcHApXG4gICAgfScsX2FyZ3M6W119KSwoKHtfdXRpbHNGbnM6X3V0aWxzRm5zLF9tYWluRnVuY3Rpb246X21haW5GdW5jdGlvbixfYXJnczpfYXJnc30pPT57Y29uc3QgdXRpbHM9T2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5lbnRyaWVzKF91dGlsc0ZucykubWFwKCgoW2tleSx2YWx1ZV0pPT5ba2V5LGV2YWwodmFsdWUpXSkpKTt1dGlscy5pbml0KCksZXZhbChfbWFpbkZ1bmN0aW9uKSh1dGlscywuLi5fYXJncyl9KSh7X3V0aWxzRm5zOntpbml0OiIoKSA9PiB7XG4gIHV0aWxzLnByZWxvYWRDYWNoZSgpXG59IixzdHJpcFByb3h5RnJvbUVycm9yczoiKGhhbmRsZXIgPSB7fSkgPT4ge1xuICBjb25zdCBuZXdIYW5kbGVyID0ge1xuICAgIHNldFByb3RvdHlwZU9mOiBmdW5jdGlvbiAodGFyZ2V0LCBwcm90bykge1xuICAgICAgaWYgKHByb3RvID09PSBudWxsKVxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY29udmVydCBvYmplY3QgdG8gcHJpbWl0aXZlIHZhbHVlJylcbiAgICAgIGlmIChPYmplY3QuZ2V0UHJvdG90eXBlT2YodGFyZ2V0KSA9PT0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHByb3RvKSkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdDeWNsaWMgX19wcm90b19fIHZhbHVlJylcbiAgICAgIH1cbiAgICAgIHJldHVybiBSZWZsZWN0LnNldFByb3RvdHlwZU9mKHRhcmdldCwgcHJvdG8pXG4gICAgfVxuICB9XG4gIC8vIFdlIHdyYXAgZWFjaCB0cmFwIGluIHRoZSBoYW5kbGVyIGluIGEgdHJ5L2NhdGNoIGFuZCBtb2RpZnkgdGhlIGVycm9yIHN0YWNrIGlmIHRoZXkgdGhyb3dcbiAgY29uc3QgdHJhcHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhoYW5kbGVyKVxuICB0cmFwcy5mb3JFYWNoKHRyYXAgPT4ge1xuICAgIG5ld0hhbmRsZXJbdHJhcF0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyBGb3J3YXJkIHRoZSBjYWxsIHRvIHRoZSBkZWZpbmVkIHByb3h5IGhhbmRsZXJcbiAgICAgICAgcmV0dXJuIGhhbmRsZXJbdHJhcF0uYXBwbHkodGhpcywgYXJndW1lbnRzIHx8IFtdKVxuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIC8vIFN0YWNrIHRyYWNlcyBkaWZmZXIgcGVyIGJyb3dzZXIsIHdlIG9ubHkgc3VwcG9ydCBjaHJvbWl1bSBiYXNlZCBvbmVzIGN1cnJlbnRseVxuICAgICAgICBpZiAoIWVyciB8fCAhZXJyLnN0YWNrIHx8ICFlcnIuc3RhY2suaW5jbHVkZXMoYGF0IGApKSB7XG4gICAgICAgICAgdGhyb3cgZXJyXG4gICAgICAgIH1cblxuICAgICAgICAvLyBXaGVuIHNvbWV0aGluZyB0aHJvd3Mgd2l0aGluIG9uZSBvZiBvdXIgdHJhcHMgdGhlIFByb3h5IHdpbGwgc2hvdyB1cCBpbiBlcnJvciBzdGFja3NcbiAgICAgICAgLy8gQW4gZWFybGllciBpbXBsZW1lbnRhdGlvbiBvZiB0aGlzIGNvZGUgd291bGQgc2ltcGx5IHN0cmlwIGxpbmVzIHdpdGggYSBibGFja2xpc3QsXG4gICAgICAgIC8vIGJ1dCBpdCBtYWtlcyBzZW5zZSB0byBiZSBtb3JlIHN1cmdpY2FsIGhlcmUgYW5kIG9ubHkgcmVtb3ZlIGxpbmVzIHJlbGF0ZWQgdG8gb3VyIFByb3h5LlxuICAgICAgICAvLyBXZSB0cnkgdG8gdXNlIGEga25vd24gXCJhbmNob3JcIiBsaW5lIGZvciB0aGF0IGFuZCBzdHJpcCBpdCB3aXRoIGV2ZXJ5dGhpbmcgYWJvdmUgaXQuXG4gICAgICAgIC8vIElmIHRoZSBhbmNob3IgbGluZSBjYW5ub3QgYmUgZm91bmQgZm9yIHNvbWUgcmVhc29uIHdlIGZhbGwgYmFjayB0byBvdXIgYmxhY2tsaXN0IGFwcHJvYWNoLlxuXG4gICAgICAgIGNvbnN0IHN0cmlwV2l0aEJsYWNrbGlzdCA9IChzdGFjaywgc3RyaXBGaXJzdExpbmUgPSB0cnVlKSA9PiB7XG4gICAgICAgICAgY29uc3QgYmxhY2tsaXN0ID0gW1xuICAgICAgICAgICAgYGF0IFJlZmxlY3QuJHt0cmFwfSBgLCAvLyBlLmcuIFJlZmxlY3QuZ2V0IG9yIFJlZmxlY3QuYXBwbHlcbiAgICAgICAgICAgIGBhdCBPYmplY3QuJHt0cmFwfSBgLCAvLyBlLmcuIE9iamVjdC5nZXQgb3IgT2JqZWN0LmFwcGx5XG4gICAgICAgICAgICBgYXQgT2JqZWN0Lm5ld0hhbmRsZXIuPGNvbXB1dGVkPiBbYXMgJHt0cmFwfV0gYCAvLyBjYXVzZWQgYnkgdGhpcyB2ZXJ5IHdyYXBwZXIgOi0pXG4gICAgICAgICAgXVxuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICBlcnIuc3RhY2tcbiAgICAgICAgICAgICAgLnNwbGl0KCdcXG4nKVxuICAgICAgICAgICAgICAvLyBBbHdheXMgcmVtb3ZlIHRoZSBmaXJzdCAoZmlsZSkgbGluZSBpbiB0aGUgc3RhY2sgKGd1YXJhbnRlZWQgdG8gYmUgb3VyIHByb3h5KVxuICAgICAgICAgICAgICAuZmlsdGVyKChsaW5lLCBpbmRleCkgPT4gIShpbmRleCA9PT0gMSAmJiBzdHJpcEZpcnN0TGluZSkpXG4gICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBsaW5lIHN0YXJ0cyB3aXRoIG9uZSBvZiBvdXIgYmxhY2tsaXN0ZWQgc3RyaW5nc1xuICAgICAgICAgICAgICAuZmlsdGVyKGxpbmUgPT4gIWJsYWNrbGlzdC5zb21lKGJsID0+IGxpbmUudHJpbSgpLnN0YXJ0c1dpdGgoYmwpKSlcbiAgICAgICAgICAgICAgLmpvaW4oJ1xcbicpXG4gICAgICAgICAgKVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc3RyaXBXaXRoQW5jaG9yID0gKHN0YWNrLCBhbmNob3IpID0+IHtcbiAgICAgICAgICBjb25zdCBzdGFja0FyciA9IHN0YWNrLnNwbGl0KCdcXG4nKVxuICAgICAgICAgIGFuY2hvciA9IGFuY2hvciB8fCBgYXQgT2JqZWN0Lm5ld0hhbmRsZXIuPGNvbXB1dGVkPiBbYXMgJHt0cmFwfV0gYCAvLyBLbm93biBmaXJzdCBQcm94eSBsaW5lIGluIGNocm9taXVtXG4gICAgICAgICAgY29uc3QgYW5jaG9ySW5kZXggPSBzdGFja0Fyci5maW5kSW5kZXgobGluZSA9PlxuICAgICAgICAgICAgbGluZS50cmltKCkuc3RhcnRzV2l0aChhbmNob3IpXG4gICAgICAgICAgKVxuICAgICAgICAgIGlmIChhbmNob3JJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZSAvLyA0MDQsIGFuY2hvciBub3QgZm91bmRcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gU3RyaXAgZXZlcnl0aGluZyBmcm9tIHRoZSB0b3AgdW50aWwgd2UgcmVhY2ggdGhlIGFuY2hvciBsaW5lXG4gICAgICAgICAgLy8gTm90ZTogV2UncmUga2VlcGluZyB0aGUgMXN0IGxpbmUgKHplcm8gaW5kZXgpIGFzIGl0J3MgdW5yZWxhdGVkIChlLmcuIGBUeXBlRXJyb3JgKVxuICAgICAgICAgIHN0YWNrQXJyLnNwbGljZSgxLCBhbmNob3JJbmRleClcbiAgICAgICAgICByZXR1cm4gc3RhY2tBcnIuam9pbignXFxuJylcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNwZWNpYWwgY2FzZXMgZHVlIHRvIG91ciBuZXN0ZWQgdG9TdHJpbmcgcHJveGllc1xuICAgICAgICBlcnIuc3RhY2sgPSBlcnIuc3RhY2sucmVwbGFjZShcbiAgICAgICAgICAnYXQgT2JqZWN0LnRvU3RyaW5nICgnLFxuICAgICAgICAgICdhdCBGdW5jdGlvbi50b1N0cmluZyAoJ1xuICAgICAgICApXG4gICAgICAgIGlmICgoZXJyLnN0YWNrIHx8ICcnKS5pbmNsdWRlcygnYXQgRnVuY3Rpb24udG9TdHJpbmcgKCcpKSB7XG4gICAgICAgICAgZXJyLnN0YWNrID0gc3RyaXBXaXRoQmxhY2tsaXN0KGVyci5zdGFjaywgZmFsc2UpXG4gICAgICAgICAgdGhyb3cgZXJyXG4gICAgICAgIH1cblxuICAgICAgICAvLyBUcnkgdXNpbmcgdGhlIGFuY2hvciBtZXRob2QsIGZhbGxiYWNrIHRvIGJsYWNrbGlzdCBpZiBuZWNlc3NhcnlcbiAgICAgICAgZXJyLnN0YWNrID0gc3RyaXBXaXRoQW5jaG9yKGVyci5zdGFjaykgfHwgc3RyaXBXaXRoQmxhY2tsaXN0KGVyci5zdGFjaylcblxuICAgICAgICB0aHJvdyBlcnIgLy8gUmUtdGhyb3cgb3VyIG5vdyBzYW5pdGl6ZWQgZXJyb3JcbiAgICAgIH1cbiAgICB9XG4gIH0pXG4gIHJldHVybiBuZXdIYW5kbGVyXG59IixzdHJpcEVycm9yV2l0aEFuY2hvcjoiKGVyciwgYW5jaG9yKSA9PiB7XG4gIGNvbnN0IHN0YWNrQXJyID0gZXJyLnN0YWNrLnNwbGl0KCdcXG4nKVxuICBjb25zdCBhbmNob3JJbmRleCA9IHN0YWNrQXJyLmZpbmRJbmRleChsaW5lID0+IGxpbmUudHJpbSgpLnN0YXJ0c1dpdGgoYW5jaG9yKSlcbiAgaWYgKGFuY2hvckluZGV4ID09PSAtMSkge1xuICAgIHJldHVybiBlcnIgLy8gNDA0LCBhbmNob3Igbm90IGZvdW5kXG4gIH1cbiAgLy8gU3RyaXAgZXZlcnl0aGluZyBmcm9tIHRoZSB0b3AgdW50aWwgd2UgcmVhY2ggdGhlIGFuY2hvciBsaW5lIChyZW1vdmUgYW5jaG9yIGxpbmUgYXMgd2VsbClcbiAgLy8gTm90ZTogV2UncmUga2VlcGluZyB0aGUgMXN0IGxpbmUgKHplcm8gaW5kZXgpIGFzIGl0J3MgdW5yZWxhdGVkIChlLmcuIGBUeXBlRXJyb3JgKVxuICBzdGFja0Fyci5zcGxpY2UoMSwgYW5jaG9ySW5kZXgpXG4gIGVyci5zdGFjayA9IHN0YWNrQXJyLmpvaW4oJ1xcbicpXG4gIHJldHVybiBlcnJcbn0iLHJlcGxhY2VQcm9wZXJ0eToiKG9iaiwgcHJvcE5hbWUsIGRlc2NyaXB0b3JPdmVycmlkZXMgPSB7fSkgPT4ge1xuICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwgcHJvcE5hbWUsIHtcbiAgICAvLyBDb3B5IG92ZXIgdGhlIGV4aXN0aW5nIGRlc2NyaXB0b3JzICh3cml0YWJsZSwgZW51bWVyYWJsZSwgY29uZmlndXJhYmxlLCBldGMpXG4gICAgLi4uKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBwcm9wTmFtZSkgfHwge30pLFxuICAgIC8vIEFkZCBvdXIgb3ZlcnJpZGVzIChlLmcuIHZhbHVlLCBnZXQoKSlcbiAgICAuLi5kZXNjcmlwdG9yT3ZlcnJpZGVzXG4gIH0pXG59IixwcmVsb2FkQ2FjaGU6IigpID0+IHtcbiAgaWYgKHV0aWxzLmNhY2hlKSB7XG4gICAgcmV0dXJuXG4gIH1cbiAgdXRpbHMuY2FjaGUgPSB7XG4gICAgLy8gVXNlZCBpbiBvdXIgcHJveGllc1xuICAgIFJlZmxlY3Q6IHtcbiAgICAgIGdldDogUmVmbGVjdC5nZXQuYmluZChSZWZsZWN0KSxcbiAgICAgIGFwcGx5OiBSZWZsZWN0LmFwcGx5LmJpbmQoUmVmbGVjdClcbiAgICB9LFxuICAgIC8vIFVzZWQgaW4gYG1ha2VOYXRpdmVTdHJpbmdgXG4gICAgbmF0aXZlVG9TdHJpbmdTdHI6IEZ1bmN0aW9uLnRvU3RyaW5nICsgJycgLy8gPT4gYGZ1bmN0aW9uIHRvU3RyaW5nKCkgeyBbbmF0aXZlIGNvZGVdIH1gXG4gIH1cbn0iLG1ha2VOYXRpdmVTdHJpbmc6IihuYW1lID0gJycpID0+IHtcbiAgcmV0dXJuIHV0aWxzLmNhY2hlLm5hdGl2ZVRvU3RyaW5nU3RyLnJlcGxhY2UoJ3RvU3RyaW5nJywgbmFtZSB8fCAnJylcbn0iLHBhdGNoVG9TdHJpbmc6IihvYmosIHN0ciA9ICcnKSA9PiB7XG4gIGNvbnN0IGhhbmRsZXIgPSB7XG4gICAgYXBwbHk6IGZ1bmN0aW9uICh0YXJnZXQsIGN0eCkge1xuICAgICAgLy8gVGhpcyBmaXhlcyBlLmcuIGBIVE1MTWVkaWFFbGVtZW50LnByb3RvdHlwZS5jYW5QbGF5VHlwZS50b1N0cmluZyArIFwiXCJgXG4gICAgICBpZiAoY3R4ID09PSBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHV0aWxzLm1ha2VOYXRpdmVTdHJpbmcoJ3RvU3RyaW5nJylcbiAgICAgIH1cbiAgICAgIC8vIGB0b1N0cmluZ2AgdGFyZ2V0ZWQgYXQgb3VyIHByb3hpZWQgT2JqZWN0IGRldGVjdGVkXG4gICAgICBpZiAoY3R4ID09PSBvYmopIHtcbiAgICAgICAgLy8gV2UgZWl0aGVyIHJldHVybiB0aGUgb3B0aW9uYWwgc3RyaW5nIHZlcmJhdGltIG9yIGRlcml2ZSB0aGUgbW9zdCBkZXNpcmVkIHJlc3VsdCBhdXRvbWF0aWNhbGx5XG4gICAgICAgIHJldHVybiBzdHIgfHwgdXRpbHMubWFrZU5hdGl2ZVN0cmluZyhvYmoubmFtZSlcbiAgICAgIH1cbiAgICAgIC8vIENoZWNrIGlmIHRoZSB0b1N0cmluZyBwcm90eXBlIG9mIHRoZSBjb250ZXh0IGlzIHRoZSBzYW1lIGFzIHRoZSBnbG9iYWwgcHJvdG90eXBlLFxuICAgICAgLy8gaWYgbm90IGluZGljYXRlcyB0aGF0IHdlIGFyZSBkb2luZyBhIGNoZWNrIGFjcm9zcyBkaWZmZXJlbnQgd2luZG93cy4sIGUuZy4gdGhlIGlmcmFtZVdpdGhkaXJlY3RgIHRlc3QgY2FzZVxuICAgICAgY29uc3QgaGFzU2FtZVByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKFxuICAgICAgICBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmdcbiAgICAgICkuaXNQcm90b3R5cGVPZihjdHgudG9TdHJpbmcpIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcHJvdG90eXBlLWJ1aWx0aW5zXG4gICAgICBpZiAoIWhhc1NhbWVQcm90bykge1xuICAgICAgICAvLyBQYXNzIHRoZSBjYWxsIG9uIHRvIHRoZSBsb2NhbCBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcgaW5zdGVhZFxuICAgICAgICByZXR1cm4gY3R4LnRvU3RyaW5nKClcbiAgICAgIH1cbiAgICAgIHJldHVybiB0YXJnZXQuY2FsbChjdHgpXG4gICAgfVxuICB9XG5cbiAgY29uc3QgdG9TdHJpbmdQcm94eSA9IG5ldyBQcm94eShcbiAgICBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcsXG4gICAgdXRpbHMuc3RyaXBQcm94eUZyb21FcnJvcnMoaGFuZGxlcilcbiAgKVxuICB1dGlscy5yZXBsYWNlUHJvcGVydHkoRnVuY3Rpb24ucHJvdG90eXBlLCAndG9TdHJpbmcnLCB7XG4gICAgdmFsdWU6IHRvU3RyaW5nUHJveHlcbiAgfSlcbn0iLHBhdGNoVG9TdHJpbmdOZXN0ZWQ6IihvYmogPSB7fSkgPT4ge1xuICByZXR1cm4gdXRpbHMuZXhlY1JlY3Vyc2l2ZWx5KG9iaiwgWydmdW5jdGlvbiddLCB1dGlscy5wYXRjaFRvU3RyaW5nKVxufSIscmVkaXJlY3RUb1N0cmluZzoiKHByb3h5T2JqLCBvcmlnaW5hbE9iaikgPT4ge1xuICBjb25zdCBoYW5kbGVyID0ge1xuICAgIGFwcGx5OiBmdW5jdGlvbiAodGFyZ2V0LCBjdHgpIHtcbiAgICAgIC8vIFRoaXMgZml4ZXMgZS5nLiBgSFRNTE1lZGlhRWxlbWVudC5wcm90b3R5cGUuY2FuUGxheVR5cGUudG9TdHJpbmcgKyBcIlwiYFxuICAgICAgaWYgKGN0eCA9PT0gRnVuY3Rpb24ucHJvdG90eXBlLnRvU3RyaW5nKSB7XG4gICAgICAgIHJldHVybiB1dGlscy5tYWtlTmF0aXZlU3RyaW5nKCd0b1N0cmluZycpXG4gICAgICB9XG5cbiAgICAgIC8vIGB0b1N0cmluZ2AgdGFyZ2V0ZWQgYXQgb3VyIHByb3hpZWQgT2JqZWN0IGRldGVjdGVkXG4gICAgICBpZiAoY3R4ID09PSBwcm94eU9iaikge1xuICAgICAgICBjb25zdCBmYWxsYmFjayA9ICgpID0+XG4gICAgICAgICAgb3JpZ2luYWxPYmogJiYgb3JpZ2luYWxPYmoubmFtZVxuICAgICAgICAgICAgPyB1dGlscy5tYWtlTmF0aXZlU3RyaW5nKG9yaWdpbmFsT2JqLm5hbWUpXG4gICAgICAgICAgICA6IHV0aWxzLm1ha2VOYXRpdmVTdHJpbmcocHJveHlPYmoubmFtZSlcblxuICAgICAgICAvLyBSZXR1cm4gdGhlIHRvU3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIG91ciBvcmlnaW5hbCBvYmplY3QgaWYgcG9zc2libGVcbiAgICAgICAgcmV0dXJuIG9yaWdpbmFsT2JqICsgJycgfHwgZmFsbGJhY2soKVxuICAgICAgfVxuXG4gICAgICBpZiAodHlwZW9mIGN0eCA9PT0gJ3VuZGVmaW5lZCcgfHwgY3R4ID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiB0YXJnZXQuY2FsbChjdHgpXG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIHRoZSB0b1N0cmluZyBwcm90eXBlIG9mIHRoZSBjb250ZXh0IGlzIHRoZSBzYW1lIGFzIHRoZSBnbG9iYWwgcHJvdG90eXBlLFxuICAgICAgLy8gaWYgbm90IGluZGljYXRlcyB0aGF0IHdlIGFyZSBkb2luZyBhIGNoZWNrIGFjcm9zcyBkaWZmZXJlbnQgd2luZG93cy4sIGUuZy4gdGhlIGlmcmFtZVdpdGhkaXJlY3RgIHRlc3QgY2FzZVxuICAgICAgY29uc3QgaGFzU2FtZVByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKFxuICAgICAgICBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmdcbiAgICAgICkuaXNQcm90b3R5cGVPZihjdHgudG9TdHJpbmcpIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcHJvdG90eXBlLWJ1aWx0aW5zXG4gICAgICBpZiAoIWhhc1NhbWVQcm90bykge1xuICAgICAgICAvLyBQYXNzIHRoZSBjYWxsIG9uIHRvIHRoZSBsb2NhbCBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcgaW5zdGVhZFxuICAgICAgICByZXR1cm4gY3R4LnRvU3RyaW5nKClcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRhcmdldC5jYWxsKGN0eClcbiAgICB9XG4gIH1cblxuICBjb25zdCB0b1N0cmluZ1Byb3h5ID0gbmV3IFByb3h5KFxuICAgIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZyxcbiAgICB1dGlscy5zdHJpcFByb3h5RnJvbUVycm9ycyhoYW5kbGVyKVxuICApXG4gIHV0aWxzLnJlcGxhY2VQcm9wZXJ0eShGdW5jdGlvbi5wcm90b3R5cGUsICd0b1N0cmluZycsIHtcbiAgICB2YWx1ZTogdG9TdHJpbmdQcm94eVxuICB9KVxufSIscmVwbGFjZVdpdGhQcm94eToiKG9iaiwgcHJvcE5hbWUsIGhhbmRsZXIpID0+IHtcbiAgY29uc3Qgb3JpZ2luYWxPYmogPSBvYmpbcHJvcE5hbWVdXG4gIGNvbnN0IHByb3h5T2JqID0gbmV3IFByb3h5KG9ialtwcm9wTmFtZV0sIHV0aWxzLnN0cmlwUHJveHlGcm9tRXJyb3JzKGhhbmRsZXIpKVxuXG4gIHV0aWxzLnJlcGxhY2VQcm9wZXJ0eShvYmosIHByb3BOYW1lLCB7IHZhbHVlOiBwcm94eU9iaiB9KVxuICB1dGlscy5yZWRpcmVjdFRvU3RyaW5nKHByb3h5T2JqLCBvcmlnaW5hbE9iailcblxuICByZXR1cm4gdHJ1ZVxufSIscmVwbGFjZUdldHRlcldpdGhQcm94eToiKG9iaiwgcHJvcE5hbWUsIGhhbmRsZXIpID0+IHtcbiAgY29uc3QgZm4gPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwgcHJvcE5hbWUpLmdldFxuICBjb25zdCBmblN0ciA9IGZuLnRvU3RyaW5nKCkgLy8gc3BlY2lhbCBnZXR0ZXIgZnVuY3Rpb24gc3RyaW5nXG4gIGNvbnN0IHByb3h5T2JqID0gbmV3IFByb3h5KGZuLCB1dGlscy5zdHJpcFByb3h5RnJvbUVycm9ycyhoYW5kbGVyKSlcblxuICB1dGlscy5yZXBsYWNlUHJvcGVydHkob2JqLCBwcm9wTmFtZSwgeyBnZXQ6IHByb3h5T2JqIH0pXG4gIHV0aWxzLnBhdGNoVG9TdHJpbmcocHJveHlPYmosIGZuU3RyKVxuXG4gIHJldHVybiB0cnVlXG59Iixtb2NrV2l0aFByb3h5OiIob2JqLCBwcm9wTmFtZSwgcHNldWRvVGFyZ2V0LCBoYW5kbGVyKSA9PiB7XG4gIGNvbnN0IHByb3h5T2JqID0gbmV3IFByb3h5KHBzZXVkb1RhcmdldCwgdXRpbHMuc3RyaXBQcm94eUZyb21FcnJvcnMoaGFuZGxlcikpXG5cbiAgdXRpbHMucmVwbGFjZVByb3BlcnR5KG9iaiwgcHJvcE5hbWUsIHsgdmFsdWU6IHByb3h5T2JqIH0pXG4gIHV0aWxzLnBhdGNoVG9TdHJpbmcocHJveHlPYmopXG5cbiAgcmV0dXJuIHRydWVcbn0iLGNyZWF0ZVByb3h5OiIocHNldWRvVGFyZ2V0LCBoYW5kbGVyKSA9PiB7XG4gIGNvbnN0IHByb3h5T2JqID0gbmV3IFByb3h5KHBzZXVkb1RhcmdldCwgdXRpbHMuc3RyaXBQcm94eUZyb21FcnJvcnMoaGFuZGxlcikpXG4gIHV0aWxzLnBhdGNoVG9TdHJpbmcocHJveHlPYmopXG5cbiAgcmV0dXJuIHByb3h5T2JqXG59IixzcGxpdE9ialBhdGg6Im9ialBhdGggPT4gKHtcbiAgLy8gUmVtb3ZlIGxhc3QgZG90IGVudHJ5IChwcm9wZXJ0eSkgPT0+IGBIVE1MTWVkaWFFbGVtZW50LnByb3RvdHlwZWBcbiAgb2JqTmFtZTogb2JqUGF0aC5zcGxpdCgnLicpLnNsaWNlKDAsIC0xKS5qb2luKCcuJyksXG4gIC8vIEV4dHJhY3QgbGFzdCBkb3QgZW50cnkgPT0+IGBjYW5QbGF5VHlwZWBcbiAgcHJvcE5hbWU6IG9ialBhdGguc3BsaXQoJy4nKS5zbGljZSgtMSlbMF1cbn0pIixyZXBsYWNlT2JqUGF0aFdpdGhQcm94eToiKG9ialBhdGgsIGhhbmRsZXIpID0+IHtcbiAgY29uc3QgeyBvYmpOYW1lLCBwcm9wTmFtZSB9ID0gdXRpbHMuc3BsaXRPYmpQYXRoKG9ialBhdGgpXG4gIGNvbnN0IG9iaiA9IGV2YWwob2JqTmFtZSkgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1ldmFsXG4gIHJldHVybiB1dGlscy5yZXBsYWNlV2l0aFByb3h5KG9iaiwgcHJvcE5hbWUsIGhhbmRsZXIpXG59IixleGVjUmVjdXJzaXZlbHk6IihvYmogPSB7fSwgdHlwZUZpbHRlciA9IFtdLCBmbikgPT4ge1xuICBmdW5jdGlvbiByZWN1cnNlKG9iaikge1xuICAgIGZvciAoY29uc3Qga2V5IGluIG9iaikge1xuICAgICAgaWYgKG9ialtrZXldID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29udGludWVcbiAgICAgIH1cbiAgICAgIGlmIChvYmpba2V5XSAmJiB0eXBlb2Ygb2JqW2tleV0gPT09ICdvYmplY3QnKSB7XG4gICAgICAgIHJlY3Vyc2Uob2JqW2tleV0pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAob2JqW2tleV0gJiYgdHlwZUZpbHRlci5pbmNsdWRlcyh0eXBlb2Ygb2JqW2tleV0pKSB7XG4gICAgICAgICAgZm4uY2FsbCh0aGlzLCBvYmpba2V5XSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICByZWN1cnNlKG9iailcbiAgcmV0dXJuIG9ialxufSIsc3RyaW5naWZ5Rm5zOiIoZm5PYmogPSB7IGhlbGxvOiAoKSA9PiAnd29ybGQnIH0pID0+IHtcbiAgLy8gT2JqZWN0LmZyb21FbnRyaWVzKCkgcG9ueWZpbGwgKGluIDYgbGluZXMpIC0gc3VwcG9ydGVkIG9ubHkgaW4gTm9kZSB2MTIrLCBtb2Rlcm4gYnJvd3NlcnMgYXJlIGZpbmVcbiAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2Zlcm9zcy9mcm9tZW50cmllc1xuICBmdW5jdGlvbiBmcm9tRW50cmllcyhpdGVyYWJsZSkge1xuICAgIHJldHVybiBbLi4uaXRlcmFibGVdLnJlZHVjZSgob2JqLCBba2V5LCB2YWxdKSA9PiB7XG4gICAgICBvYmpba2V5XSA9IHZhbFxuICAgICAgcmV0dXJuIG9ialxuICAgIH0sIHt9KVxuICB9XG4gIHJldHVybiAoT2JqZWN0LmZyb21FbnRyaWVzIHx8IGZyb21FbnRyaWVzKShcbiAgICBPYmplY3QuZW50cmllcyhmbk9iailcbiAgICAgIC5maWx0ZXIoKFtrZXksIHZhbHVlXSkgPT4gdHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKVxuICAgICAgLm1hcCgoW2tleSwgdmFsdWVdKSA9PiBba2V5LCB2YWx1ZS50b1N0cmluZygpXSkgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1ldmFsXG4gIClcbn0iLG1hdGVyaWFsaXplRm5zOiIoZm5TdHJPYmogPSB7IGhlbGxvOiBcIigpID0+ICd3b3JsZCdcIiB9KSA9PiB7XG4gIHJldHVybiBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgT2JqZWN0LmVudHJpZXMoZm5TdHJPYmopLm1hcCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICBpZiAodmFsdWUuc3RhcnRzV2l0aCgnZnVuY3Rpb24nKSkge1xuICAgICAgICAvLyBzb21lIHRyaWNrZXJ5IGlzIG5lZWRlZCB0byBtYWtlIG9sZHNjaG9vbCBmdW5jdGlvbnMgd29yayA6LSlcbiAgICAgICAgcmV0dXJuIFtrZXksIGV2YWwoYCgpID0+ICR7dmFsdWV9YCkoKV0gLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1ldmFsXG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBhcnJvdyBmdW5jdGlvbnMganVzdCB3b3JrXG4gICAgICAgIHJldHVybiBba2V5LCBldmFsKHZhbHVlKV0gLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1ldmFsXG4gICAgICB9XG4gICAgfSlcbiAgKVxufSIsbWFrZUhhbmRsZXI6IigpID0+ICh7XG4gIC8vIFVzZWQgYnkgc2ltcGxlIGBuYXZpZ2F0b3JgIGdldHRlciBldmFzaW9uc1xuICBnZXR0ZXJWYWx1ZTogdmFsdWUgPT4gKHtcbiAgICBhcHBseSh0YXJnZXQsIGN0eCwgYXJncykge1xuICAgICAgLy8gTGV0J3MgZmV0Y2ggdGhlIHZhbHVlIGZpcnN0LCB0byB0cmlnZ2VyIGFuZCBlc2NhbGF0ZSBwb3RlbnRpYWwgZXJyb3JzXG4gICAgICAvLyBJbGxlZ2FsIGludm9jYXRpb25zIGxpa2UgYG5hdmlnYXRvci5fX3Byb3RvX18udmVuZG9yYCB3aWxsIHRocm93IGhlcmVcbiAgICAgIHV0aWxzLmNhY2hlLlJlZmxlY3QuYXBwbHkoLi4uYXJndW1lbnRzKVxuICAgICAgcmV0dXJuIHZhbHVlXG4gICAgfVxuICB9KVxufSkifSxfbWFpbkZ1bmN0aW9uOiJ1dGlscyA9PiB7XG4gICAgICBpZiAoIXdpbmRvdy5jaHJvbWUpIHtcbiAgICAgICAgLy8gVXNlIHRoZSBleGFjdCBwcm9wZXJ0eSBkZXNjcmlwdG9yIGZvdW5kIGluIGhlYWRmdWwgQ2hyb21lXG4gICAgICAgIC8vIGZldGNoIGl0IHZpYSBgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih3aW5kb3csICdjaHJvbWUnKWBcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdywgJ2Nocm9tZScsIHtcbiAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UsIC8vIG5vdGUhXG4gICAgICAgICAgdmFsdWU6IHt9IC8vIFdlJ2xsIGV4dGVuZCB0aGF0IGxhdGVyXG4gICAgICAgIH0pXG4gICAgICB9XG5cbiAgICAgIC8vIFRoYXQgbWVhbnMgd2UncmUgcnVubmluZyBoZWFkZnVsIGFuZCBkb24ndCBuZWVkIHRvIG1vY2sgYW55dGhpbmdcbiAgICAgIGlmICgnY3NpJyBpbiB3aW5kb3cuY2hyb21lKSB7XG4gICAgICAgIHJldHVybiAvLyBOb3RoaW5nIHRvIGRvIGhlcmVcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgdGhhdCB0aGUgTmF2aWdhdGlvbiBUaW1pbmcgQVBJIHYxIGlzIGF2YWlsYWJsZSwgd2UgbmVlZCB0aGF0XG4gICAgICBpZiAoIXdpbmRvdy5wZXJmb3JtYW5jZSB8fCAhd2luZG93LnBlcmZvcm1hbmNlLnRpbWluZykge1xuICAgICAgICByZXR1cm5cbiAgICAgIH1cblxuICAgICAgY29uc3QgeyB0aW1pbmcgfSA9IHdpbmRvdy5wZXJmb3JtYW5jZVxuXG4gICAgICB3aW5kb3cuY2hyb21lLmNzaSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG9ubG9hZFQ6IHRpbWluZy5kb21Db250ZW50TG9hZGVkRXZlbnRFbmQsXG4gICAgICAgICAgc3RhcnRFOiB0aW1pbmcubmF2aWdhdGlvblN0YXJ0LFxuICAgICAgICAgIHBhZ2VUOiBEYXRlLm5vdygpIC0gdGltaW5nLm5hdmlnYXRpb25TdGFydCxcbiAgICAgICAgICB0cmFuOiAxNSAvLyBUcmFuc2l0aW9uIHR5cGUgb3Igc29tZXRoaW5nXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHV0aWxzLnBhdGNoVG9TdHJpbmcod2luZG93LmNocm9tZS5jc2kpXG4gICAgfSIsX2FyZ3M6W119KSwoKHtfdXRpbHNGbnM6X3V0aWxzRm5zLF9tYWluRnVuY3Rpb246X21haW5GdW5jdGlvbixfYXJnczpfYXJnc30pPT57Y29uc3QgdXRpbHM9T2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5lbnRyaWVzKF91dGlsc0ZucykubWFwKCgoW2tleSx2YWx1ZV0pPT5ba2V5LGV2YWwodmFsdWUpXSkpKTt1dGlscy5pbml0KCksZXZhbChfbWFpbkZ1bmN0aW9uKSh1dGlscywuLi5fYXJncyl9KSh7X3V0aWxzRm5zOntpbml0OiIoKSA9PiB7XG4gIHV0aWxzLnByZWxvYWRDYWNoZSgpXG59IixzdHJpcFByb3h5RnJvbUVycm9yczoiKGhhbmRsZXIgPSB7fSkgPT4ge1xuICBjb25zdCBuZXdIYW5kbGVyID0ge1xuICAgIHNldFByb3RvdHlwZU9mOiBmdW5jdGlvbiAodGFyZ2V0LCBwcm90bykge1xuICAgICAgaWYgKHByb3RvID09PSBudWxsKVxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY29udmVydCBvYmplY3QgdG8gcHJpbWl0aXZlIHZhbHVlJylcbiAgICAgIGlmIChPYmplY3QuZ2V0UHJvdG90eXBlT2YodGFyZ2V0KSA9PT0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHByb3RvKSkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdDeWNsaWMgX19wcm90b19fIHZhbHVlJylcbiAgICAgIH1cbiAgICAgIHJldHVybiBSZWZsZWN0LnNldFByb3RvdHlwZU9mKHRhcmdldCwgcHJvdG8pXG4gICAgfVxuICB9XG4gIC8vIFdlIHdyYXAgZWFjaCB0cmFwIGluIHRoZSBoYW5kbGVyIGluIGEgdHJ5L2NhdGNoIGFuZCBtb2RpZnkgdGhlIGVycm9yIHN0YWNrIGlmIHRoZXkgdGhyb3dcbiAgY29uc3QgdHJhcHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhoYW5kbGVyKVxuICB0cmFwcy5mb3JFYWNoKHRyYXAgPT4ge1xuICAgIG5ld0hhbmRsZXJbdHJhcF0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyBGb3J3YXJkIHRoZSBjYWxsIHRvIHRoZSBkZWZpbmVkIHByb3h5IGhhbmRsZXJcbiAgICAgICAgcmV0dXJuIGhhbmRsZXJbdHJhcF0uYXBwbHkodGhpcywgYXJndW1lbnRzIHx8IFtdKVxuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIC8vIFN0YWNrIHRyYWNlcyBkaWZmZXIgcGVyIGJyb3dzZXIsIHdlIG9ubHkgc3VwcG9ydCBjaHJvbWl1bSBiYXNlZCBvbmVzIGN1cnJlbnRseVxuICAgICAgICBpZiAoIWVyciB8fCAhZXJyLnN0YWNrIHx8ICFlcnIuc3RhY2suaW5jbHVkZXMoYGF0IGApKSB7XG4gICAgICAgICAgdGhyb3cgZXJyXG4gICAgICAgIH1cblxuICAgICAgICAvLyBXaGVuIHNvbWV0aGluZyB0aHJvd3Mgd2l0aGluIG9uZSBvZiBvdXIgdHJhcHMgdGhlIFByb3h5IHdpbGwgc2hvdyB1cCBpbiBlcnJvciBzdGFja3NcbiAgICAgICAgLy8gQW4gZWFybGllciBpbXBsZW1lbnRhdGlvbiBvZiB0aGlzIGNvZGUgd291bGQgc2ltcGx5IHN0cmlwIGxpbmVzIHdpdGggYSBibGFja2xpc3QsXG4gICAgICAgIC8vIGJ1dCBpdCBtYWtlcyBzZW5zZSB0byBiZSBtb3JlIHN1cmdpY2FsIGhlcmUgYW5kIG9ubHkgcmVtb3ZlIGxpbmVzIHJlbGF0ZWQgdG8gb3VyIFByb3h5LlxuICAgICAgICAvLyBXZSB0cnkgdG8gdXNlIGEga25vd24gXCJhbmNob3JcIiBsaW5lIGZvciB0aGF0IGFuZCBzdHJpcCBpdCB3aXRoIGV2ZXJ5dGhpbmcgYWJvdmUgaXQuXG4gICAgICAgIC8vIElmIHRoZSBhbmNob3IgbGluZSBjYW5ub3QgYmUgZm91bmQgZm9yIHNvbWUgcmVhc29uIHdlIGZhbGwgYmFjayB0byBvdXIgYmxhY2tsaXN0IGFwcHJvYWNoLlxuXG4gICAgICAgIGNvbnN0IHN0cmlwV2l0aEJsYWNrbGlzdCA9IChzdGFjaywgc3RyaXBGaXJzdExpbmUgPSB0cnVlKSA9PiB7XG4gICAgICAgICAgY29uc3QgYmxhY2tsaXN0ID0gW1xuICAgICAgICAgICAgYGF0IFJlZmxlY3QuJHt0cmFwfSBgLCAvLyBlLmcuIFJlZmxlY3QuZ2V0IG9yIFJlZmxlY3QuYXBwbHlcbiAgICAgICAgICAgIGBhdCBPYmplY3QuJHt0cmFwfSBgLCAvLyBlLmcuIE9iamVjdC5nZXQgb3IgT2JqZWN0LmFwcGx5XG4gICAgICAgICAgICBgYXQgT2JqZWN0Lm5ld0hhbmRsZXIuPGNvbXB1dGVkPiBbYXMgJHt0cmFwfV0gYCAvLyBjYXVzZWQgYnkgdGhpcyB2ZXJ5IHdyYXBwZXIgOi0pXG4gICAgICAgICAgXVxuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICBlcnIuc3RhY2tcbiAgICAgICAgICAgICAgLnNwbGl0KCdcXG4nKVxuICAgICAgICAgICAgICAvLyBBbHdheXMgcmVtb3ZlIHRoZSBmaXJzdCAoZmlsZSkgbGluZSBpbiB0aGUgc3RhY2sgKGd1YXJhbnRlZWQgdG8gYmUgb3VyIHByb3h5KVxuICAgICAgICAgICAgICAuZmlsdGVyKChsaW5lLCBpbmRleCkgPT4gIShpbmRleCA9PT0gMSAmJiBzdHJpcEZpcnN0TGluZSkpXG4gICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBsaW5lIHN0YXJ0cyB3aXRoIG9uZSBvZiBvdXIgYmxhY2tsaXN0ZWQgc3RyaW5nc1xuICAgICAgICAgICAgICAuZmlsdGVyKGxpbmUgPT4gIWJsYWNrbGlzdC5zb21lKGJsID0+IGxpbmUudHJpbSgpLnN0YXJ0c1dpdGgoYmwpKSlcbiAgICAgICAgICAgICAgLmpvaW4oJ1xcbicpXG4gICAgICAgICAgKVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc3RyaXBXaXRoQW5jaG9yID0gKHN0YWNrLCBhbmNob3IpID0+IHtcbiAgICAgICAgICBjb25zdCBzdGFja0FyciA9IHN0YWNrLnNwbGl0KCdcXG4nKVxuICAgICAgICAgIGFuY2hvciA9IGFuY2hvciB8fCBgYXQgT2JqZWN0Lm5ld0hhbmRsZXIuPGNvbXB1dGVkPiBbYXMgJHt0cmFwfV0gYCAvLyBLbm93biBmaXJzdCBQcm94eSBsaW5lIGluIGNocm9taXVtXG4gICAgICAgICAgY29uc3QgYW5jaG9ySW5kZXggPSBzdGFja0Fyci5maW5kSW5kZXgobGluZSA9PlxuICAgICAgICAgICAgbGluZS50cmltKCkuc3RhcnRzV2l0aChhbmNob3IpXG4gICAgICAgICAgKVxuICAgICAgICAgIGlmIChhbmNob3JJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZSAvLyA0MDQsIGFuY2hvciBub3QgZm91bmRcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gU3RyaXAgZXZlcnl0aGluZyBmcm9tIHRoZSB0b3AgdW50aWwgd2UgcmVhY2ggdGhlIGFuY2hvciBsaW5lXG4gICAgICAgICAgLy8gTm90ZTogV2UncmUga2VlcGluZyB0aGUgMXN0IGxpbmUgKHplcm8gaW5kZXgpIGFzIGl0J3MgdW5yZWxhdGVkIChlLmcuIGBUeXBlRXJyb3JgKVxuICAgICAgICAgIHN0YWNrQXJyLnNwbGljZSgxLCBhbmNob3JJbmRleClcbiAgICAgICAgICByZXR1cm4gc3RhY2tBcnIuam9pbignXFxuJylcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNwZWNpYWwgY2FzZXMgZHVlIHRvIG91ciBuZXN0ZWQgdG9TdHJpbmcgcHJveGllc1xuICAgICAgICBlcnIuc3RhY2sgPSBlcnIuc3RhY2sucmVwbGFjZShcbiAgICAgICAgICAnYXQgT2JqZWN0LnRvU3RyaW5nICgnLFxuICAgICAgICAgICdhdCBGdW5jdGlvbi50b1N0cmluZyAoJ1xuICAgICAgICApXG4gICAgICAgIGlmICgoZXJyLnN0YWNrIHx8ICcnKS5pbmNsdWRlcygnYXQgRnVuY3Rpb24udG9TdHJpbmcgKCcpKSB7XG4gICAgICAgICAgZXJyLnN0YWNrID0gc3RyaXBXaXRoQmxhY2tsaXN0KGVyci5zdGFjaywgZmFsc2UpXG4gICAgICAgICAgdGhyb3cgZXJyXG4gICAgICAgIH1cblxuICAgICAgICAvLyBUcnkgdXNpbmcgdGhlIGFuY2hvciBtZXRob2QsIGZhbGxiYWNrIHRvIGJsYWNrbGlzdCBpZiBuZWNlc3NhcnlcbiAgICAgICAgZXJyLnN0YWNrID0gc3RyaXBXaXRoQW5jaG9yKGVyci5zdGFjaykgfHwgc3RyaXBXaXRoQmxhY2tsaXN0KGVyci5zdGFjaylcblxuICAgICAgICB0aHJvdyBlcnIgLy8gUmUtdGhyb3cgb3VyIG5vdyBzYW5pdGl6ZWQgZXJyb3JcbiAgICAgIH1cbiAgICB9XG4gIH0pXG4gIHJldHVybiBuZXdIYW5kbGVyXG59IixzdHJpcEVycm9yV2l0aEFuY2hvcjoiKGVyciwgYW5jaG9yKSA9PiB7XG4gIGNvbnN0IHN0YWNrQXJyID0gZXJyLnN0YWNrLnNwbGl0KCdcXG4nKVxuICBjb25zdCBhbmNob3JJbmRleCA9IHN0YWNrQXJyLmZpbmRJbmRleChsaW5lID0+IGxpbmUudHJpbSgpLnN0YXJ0c1dpdGgoYW5jaG9yKSlcbiAgaWYgKGFuY2hvckluZGV4ID09PSAtMSkge1xuICAgIHJldHVybiBlcnIgLy8gNDA0LCBhbmNob3Igbm90IGZvdW5kXG4gIH1cbiAgLy8gU3RyaXAgZXZlcnl0aGluZyBmcm9tIHRoZSB0b3AgdW50aWwgd2UgcmVhY2ggdGhlIGFuY2hvciBsaW5lIChyZW1vdmUgYW5jaG9yIGxpbmUgYXMgd2VsbClcbiAgLy8gTm90ZTogV2UncmUga2VlcGluZyB0aGUgMXN0IGxpbmUgKHplcm8gaW5kZXgpIGFzIGl0J3MgdW5yZWxhdGVkIChlLmcuIGBUeXBlRXJyb3JgKVxuICBzdGFja0Fyci5zcGxpY2UoMSwgYW5jaG9ySW5kZXgpXG4gIGVyci5zdGFjayA9IHN0YWNrQXJyLmpvaW4oJ1xcbicpXG4gIHJldHVybiBlcnJcbn0iLHJlcGxhY2VQcm9wZXJ0eToiKG9iaiwgcHJvcE5hbWUsIGRlc2NyaXB0b3JPdmVycmlkZXMgPSB7fSkgPT4ge1xuICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwgcHJvcE5hbWUsIHtcbiAgICAvLyBDb3B5IG92ZXIgdGhlIGV4aXN0aW5nIGRlc2NyaXB0b3JzICh3cml0YWJsZSwgZW51bWVyYWJsZSwgY29uZmlndXJhYmxlLCBldGMpXG4gICAgLi4uKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBwcm9wTmFtZSkgfHwge30pLFxuICAgIC8vIEFkZCBvdXIgb3ZlcnJpZGVzIChlLmcuIHZhbHVlLCBnZXQoKSlcbiAgICAuLi5kZXNjcmlwdG9yT3ZlcnJpZGVzXG4gIH0pXG59IixwcmVsb2FkQ2FjaGU6IigpID0+IHtcbiAgaWYgKHV0aWxzLmNhY2hlKSB7XG4gICAgcmV0dXJuXG4gIH1cbiAgdXRpbHMuY2FjaGUgPSB7XG4gICAgLy8gVXNlZCBpbiBvdXIgcHJveGllc1xuICAgIFJlZmxlY3Q6IHtcbiAgICAgIGdldDogUmVmbGVjdC5nZXQuYmluZChSZWZsZWN0KSxcbiAgICAgIGFwcGx5OiBSZWZsZWN0LmFwcGx5LmJpbmQoUmVmbGVjdClcbiAgICB9LFxuICAgIC8vIFVzZWQgaW4gYG1ha2VOYXRpdmVTdHJpbmdgXG4gICAgbmF0aXZlVG9TdHJpbmdTdHI6IEZ1bmN0aW9uLnRvU3RyaW5nICsgJycgLy8gPT4gYGZ1bmN0aW9uIHRvU3RyaW5nKCkgeyBbbmF0aXZlIGNvZGVdIH1gXG4gIH1cbn0iLG1ha2VOYXRpdmVTdHJpbmc6IihuYW1lID0gJycpID0+IHtcbiAgcmV0dXJuIHV0aWxzLmNhY2hlLm5hdGl2ZVRvU3RyaW5nU3RyLnJlcGxhY2UoJ3RvU3RyaW5nJywgbmFtZSB8fCAnJylcbn0iLHBhdGNoVG9TdHJpbmc6IihvYmosIHN0ciA9ICcnKSA9PiB7XG4gIGNvbnN0IGhhbmRsZXIgPSB7XG4gICAgYXBwbHk6IGZ1bmN0aW9uICh0YXJnZXQsIGN0eCkge1xuICAgICAgLy8gVGhpcyBmaXhlcyBlLmcuIGBIVE1MTWVkaWFFbGVtZW50LnByb3RvdHlwZS5jYW5QbGF5VHlwZS50b1N0cmluZyArIFwiXCJgXG4gICAgICBpZiAoY3R4ID09PSBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHV0aWxzLm1ha2VOYXRpdmVTdHJpbmcoJ3RvU3RyaW5nJylcbiAgICAgIH1cbiAgICAgIC8vIGB0b1N0cmluZ2AgdGFyZ2V0ZWQgYXQgb3VyIHByb3hpZWQgT2JqZWN0IGRldGVjdGVkXG4gICAgICBpZiAoY3R4ID09PSBvYmopIHtcbiAgICAgICAgLy8gV2UgZWl0aGVyIHJldHVybiB0aGUgb3B0aW9uYWwgc3RyaW5nIHZlcmJhdGltIG9yIGRlcml2ZSB0aGUgbW9zdCBkZXNpcmVkIHJlc3VsdCBhdXRvbWF0aWNhbGx5XG4gICAgICAgIHJldHVybiBzdHIgfHwgdXRpbHMubWFrZU5hdGl2ZVN0cmluZyhvYmoubmFtZSlcbiAgICAgIH1cbiAgICAgIC8vIENoZWNrIGlmIHRoZSB0b1N0cmluZyBwcm90eXBlIG9mIHRoZSBjb250ZXh0IGlzIHRoZSBzYW1lIGFzIHRoZSBnbG9iYWwgcHJvdG90eXBlLFxuICAgICAgLy8gaWYgbm90IGluZGljYXRlcyB0aGF0IHdlIGFyZSBkb2luZyBhIGNoZWNrIGFjcm9zcyBkaWZmZXJlbnQgd2luZG93cy4sIGUuZy4gdGhlIGlmcmFtZVdpdGhkaXJlY3RgIHRlc3QgY2FzZVxuICAgICAgY29uc3QgaGFzU2FtZVByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKFxuICAgICAgICBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmdcbiAgICAgICkuaXNQcm90b3R5cGVPZihjdHgudG9TdHJpbmcpIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcHJvdG90eXBlLWJ1aWx0aW5zXG4gICAgICBpZiAoIWhhc1NhbWVQcm90bykge1xuICAgICAgICAvLyBQYXNzIHRoZSBjYWxsIG9uIHRvIHRoZSBsb2NhbCBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcgaW5zdGVhZFxuICAgICAgICByZXR1cm4gY3R4LnRvU3RyaW5nKClcbiAgICAgIH1cbiAgICAgIHJldHVybiB0YXJnZXQuY2FsbChjdHgpXG4gICAgfVxuICB9XG5cbiAgY29uc3QgdG9TdHJpbmdQcm94eSA9IG5ldyBQcm94eShcbiAgICBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcsXG4gICAgdXRpbHMuc3RyaXBQcm94eUZyb21FcnJvcnMoaGFuZGxlcilcbiAgKVxuICB1dGlscy5yZXBsYWNlUHJvcGVydHkoRnVuY3Rpb24ucHJvdG90eXBlLCAndG9TdHJpbmcnLCB7XG4gICAgdmFsdWU6IHRvU3RyaW5nUHJveHlcbiAgfSlcbn0iLHBhdGNoVG9TdHJpbmdOZXN0ZWQ6IihvYmogPSB7fSkgPT4ge1xuICByZXR1cm4gdXRpbHMuZXhlY1JlY3Vyc2l2ZWx5KG9iaiwgWydmdW5jdGlvbiddLCB1dGlscy5wYXRjaFRvU3RyaW5nKVxufSIscmVkaXJlY3RUb1N0cmluZzoiKHByb3h5T2JqLCBvcmlnaW5hbE9iaikgPT4ge1xuICBjb25zdCBoYW5kbGVyID0ge1xuICAgIGFwcGx5OiBmdW5jdGlvbiAodGFyZ2V0LCBjdHgpIHtcbiAgICAgIC8vIFRoaXMgZml4ZXMgZS5nLiBgSFRNTE1lZGlhRWxlbWVudC5wcm90b3R5cGUuY2FuUGxheVR5cGUudG9TdHJpbmcgKyBcIlwiYFxuICAgICAgaWYgKGN0eCA9PT0gRnVuY3Rpb24ucHJvdG90eXBlLnRvU3RyaW5nKSB7XG4gICAgICAgIHJldHVybiB1dGlscy5tYWtlTmF0aXZlU3RyaW5nKCd0b1N0cmluZycpXG4gICAgICB9XG5cbiAgICAgIC8vIGB0b1N0cmluZ2AgdGFyZ2V0ZWQgYXQgb3VyIHByb3hpZWQgT2JqZWN0IGRldGVjdGVkXG4gICAgICBpZiAoY3R4ID09PSBwcm94eU9iaikge1xuICAgICAgICBjb25zdCBmYWxsYmFjayA9ICgpID0+XG4gICAgICAgICAgb3JpZ2luYWxPYmogJiYgb3JpZ2luYWxPYmoubmFtZVxuICAgICAgICAgICAgPyB1dGlscy5tYWtlTmF0aXZlU3RyaW5nKG9yaWdpbmFsT2JqLm5hbWUpXG4gICAgICAgICAgICA6IHV0aWxzLm1ha2VOYXRpdmVTdHJpbmcocHJveHlPYmoubmFtZSlcblxuICAgICAgICAvLyBSZXR1cm4gdGhlIHRvU3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIG91ciBvcmlnaW5hbCBvYmplY3QgaWYgcG9zc2libGVcbiAgICAgICAgcmV0dXJuIG9yaWdpbmFsT2JqICsgJycgfHwgZmFsbGJhY2soKVxuICAgICAgfVxuXG4gICAgICBpZiAodHlwZW9mIGN0eCA9PT0gJ3VuZGVmaW5lZCcgfHwgY3R4ID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiB0YXJnZXQuY2FsbChjdHgpXG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIHRoZSB0b1N0cmluZyBwcm90eXBlIG9mIHRoZSBjb250ZXh0IGlzIHRoZSBzYW1lIGFzIHRoZSBnbG9iYWwgcHJvdG90eXBlLFxuICAgICAgLy8gaWYgbm90IGluZGljYXRlcyB0aGF0IHdlIGFyZSBkb2luZyBhIGNoZWNrIGFjcm9zcyBkaWZmZXJlbnQgd2luZG93cy4sIGUuZy4gdGhlIGlmcmFtZVdpdGhkaXJlY3RgIHRlc3QgY2FzZVxuICAgICAgY29uc3QgaGFzU2FtZVByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKFxuICAgICAgICBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmdcbiAgICAgICkuaXNQcm90b3R5cGVPZihjdHgudG9TdHJpbmcpIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcHJvdG90eXBlLWJ1aWx0aW5zXG4gICAgICBpZiAoIWhhc1NhbWVQcm90bykge1xuICAgICAgICAvLyBQYXNzIHRoZSBjYWxsIG9uIHRvIHRoZSBsb2NhbCBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcgaW5zdGVhZFxuICAgICAgICByZXR1cm4gY3R4LnRvU3RyaW5nKClcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRhcmdldC5jYWxsKGN0eClcbiAgICB9XG4gIH1cblxuICBjb25zdCB0b1N0cmluZ1Byb3h5ID0gbmV3IFByb3h5KFxuICAgIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZyxcbiAgICB1dGlscy5zdHJpcFByb3h5RnJvbUVycm9ycyhoYW5kbGVyKVxuICApXG4gIHV0aWxzLnJlcGxhY2VQcm9wZXJ0eShGdW5jdGlvbi5wcm90b3R5cGUsICd0b1N0cmluZycsIHtcbiAgICB2YWx1ZTogdG9TdHJpbmdQcm94eVxuICB9KVxufSIscmVwbGFjZVdpdGhQcm94eToiKG9iaiwgcHJvcE5hbWUsIGhhbmRsZXIpID0+IHtcbiAgY29uc3Qgb3JpZ2luYWxPYmogPSBvYmpbcHJvcE5hbWVdXG4gIGNvbnN0IHByb3h5T2JqID0gbmV3IFByb3h5KG9ialtwcm9wTmFtZV0sIHV0aWxzLnN0cmlwUHJveHlGcm9tRXJyb3JzKGhhbmRsZXIpKVxuXG4gIHV0aWxzLnJlcGxhY2VQcm9wZXJ0eShvYmosIHByb3BOYW1lLCB7IHZhbHVlOiBwcm94eU9iaiB9KVxuICB1dGlscy5yZWRpcmVjdFRvU3RyaW5nKHByb3h5T2JqLCBvcmlnaW5hbE9iailcblxuICByZXR1cm4gdHJ1ZVxufSIscmVwbGFjZUdldHRlcldpdGhQcm94eToiKG9iaiwgcHJvcE5hbWUsIGhhbmRsZXIpID0+IHtcbiAgY29uc3QgZm4gPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwgcHJvcE5hbWUpLmdldFxuICBjb25zdCBmblN0ciA9IGZuLnRvU3RyaW5nKCkgLy8gc3BlY2lhbCBnZXR0ZXIgZnVuY3Rpb24gc3RyaW5nXG4gIGNvbnN0IHByb3h5T2JqID0gbmV3IFByb3h5KGZuLCB1dGlscy5zdHJpcFByb3h5RnJvbUVycm9ycyhoYW5kbGVyKSlcblxuICB1dGlscy5yZXBsYWNlUHJvcGVydHkob2JqLCBwcm9wTmFtZSwgeyBnZXQ6IHByb3h5T2JqIH0pXG4gIHV0aWxzLnBhdGNoVG9TdHJpbmcocHJveHlPYmosIGZuU3RyKVxuXG4gIHJldHVybiB0cnVlXG59Iixtb2NrV2l0aFByb3h5OiIob2JqLCBwcm9wTmFtZSwgcHNldWRvVGFyZ2V0LCBoYW5kbGVyKSA9PiB7XG4gIGNvbnN0IHByb3h5T2JqID0gbmV3IFByb3h5KHBzZXVkb1RhcmdldCwgdXRpbHMuc3RyaXBQcm94eUZyb21FcnJvcnMoaGFuZGxlcikpXG5cbiAgdXRpbHMucmVwbGFjZVByb3BlcnR5KG9iaiwgcHJvcE5hbWUsIHsgdmFsdWU6IHByb3h5T2JqIH0pXG4gIHV0aWxzLnBhdGNoVG9TdHJpbmcocHJveHlPYmopXG5cbiAgcmV0dXJuIHRydWVcbn0iLGNyZWF0ZVByb3h5OiIocHNldWRvVGFyZ2V0LCBoYW5kbGVyKSA9PiB7XG4gIGNvbnN0IHByb3h5T2JqID0gbmV3IFByb3h5KHBzZXVkb1RhcmdldCwgdXRpbHMuc3RyaXBQcm94eUZyb21FcnJvcnMoaGFuZGxlcikpXG4gIHV0aWxzLnBhdGNoVG9TdHJpbmcocHJveHlPYmopXG5cbiAgcmV0dXJuIHByb3h5T2JqXG59IixzcGxpdE9ialBhdGg6Im9ialBhdGggPT4gKHtcbiAgLy8gUmVtb3ZlIGxhc3QgZG90IGVudHJ5IChwcm9wZXJ0eSkgPT0+IGBIVE1MTWVkaWFFbGVtZW50LnByb3RvdHlwZWBcbiAgb2JqTmFtZTogb2JqUGF0aC5zcGxpdCgnLicpLnNsaWNlKDAsIC0xKS5qb2luKCcuJyksXG4gIC8vIEV4dHJhY3QgbGFzdCBkb3QgZW50cnkgPT0+IGBjYW5QbGF5VHlwZWBcbiAgcHJvcE5hbWU6IG9ialBhdGguc3BsaXQoJy4nKS5zbGljZSgtMSlbMF1cbn0pIixyZXBsYWNlT2JqUGF0aFdpdGhQcm94eToiKG9ialBhdGgsIGhhbmRsZXIpID0+IHtcbiAgY29uc3QgeyBvYmpOYW1lLCBwcm9wTmFtZSB9ID0gdXRpbHMuc3BsaXRPYmpQYXRoKG9ialBhdGgpXG4gIGNvbnN0IG9iaiA9IGV2YWwob2JqTmFtZSkgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1ldmFsXG4gIHJldHVybiB1dGlscy5yZXBsYWNlV2l0aFByb3h5KG9iaiwgcHJvcE5hbWUsIGhhbmRsZXIpXG59IixleGVjUmVjdXJzaXZlbHk6IihvYmogPSB7fSwgdHlwZUZpbHRlciA9IFtdLCBmbikgPT4ge1xuICBmdW5jdGlvbiByZWN1cnNlKG9iaikge1xuICAgIGZvciAoY29uc3Qga2V5IGluIG9iaikge1xuICAgICAgaWYgKG9ialtrZXldID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29udGludWVcbiAgICAgIH1cbiAgICAgIGlmIChvYmpba2V5XSAmJiB0eXBlb2Ygb2JqW2tleV0gPT09ICdvYmplY3QnKSB7XG4gICAgICAgIHJlY3Vyc2Uob2JqW2tleV0pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAob2JqW2tleV0gJiYgdHlwZUZpbHRlci5pbmNsdWRlcyh0eXBlb2Ygb2JqW2tleV0pKSB7XG4gICAgICAgICAgZm4uY2FsbCh0aGlzLCBvYmpba2V5XSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICByZWN1cnNlKG9iailcbiAgcmV0dXJuIG9ialxufSIsc3RyaW5naWZ5Rm5zOiIoZm5PYmogPSB7IGhlbGxvOiAoKSA9PiAnd29ybGQnIH0pID0+IHtcbiAgLy8gT2JqZWN0LmZyb21FbnRyaWVzKCkgcG9ueWZpbGwgKGluIDYgbGluZXMpIC0gc3VwcG9ydGVkIG9ubHkgaW4gTm9kZSB2MTIrLCBtb2Rlcm4gYnJvd3NlcnMgYXJlIGZpbmVcbiAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2Zlcm9zcy9mcm9tZW50cmllc1xuICBmdW5jdGlvbiBmcm9tRW50cmllcyhpdGVyYWJsZSkge1xuICAgIHJldHVybiBbLi4uaXRlcmFibGVdLnJlZHVjZSgob2JqLCBba2V5LCB2YWxdKSA9PiB7XG4gICAgICBvYmpba2V5XSA9IHZhbFxuICAgICAgcmV0dXJuIG9ialxuICAgIH0sIHt9KVxuICB9XG4gIHJldHVybiAoT2JqZWN0LmZyb21FbnRyaWVzIHx8IGZyb21FbnRyaWVzKShcbiAgICBPYmplY3QuZW50cmllcyhmbk9iailcbiAgICAgIC5maWx0ZXIoKFtrZXksIHZhbHVlXSkgPT4gdHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKVxuICAgICAgLm1hcCgoW2tleSwgdmFsdWVdKSA9PiBba2V5LCB2YWx1ZS50b1N0cmluZygpXSkgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1ldmFsXG4gIClcbn0iLG1hdGVyaWFsaXplRm5zOiIoZm5TdHJPYmogPSB7IGhlbGxvOiBcIigpID0+ICd3b3JsZCdcIiB9KSA9PiB7XG4gIHJldHVybiBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgT2JqZWN0LmVudHJpZXMoZm5TdHJPYmopLm1hcCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICBpZiAodmFsdWUuc3RhcnRzV2l0aCgnZnVuY3Rpb24nKSkge1xuICAgICAgICAvLyBzb21lIHRyaWNrZXJ5IGlzIG5lZWRlZCB0byBtYWtlIG9sZHNjaG9vbCBmdW5jdGlvbnMgd29yayA6LSlcbiAgICAgICAgcmV0dXJuIFtrZXksIGV2YWwoYCgpID0+ICR7dmFsdWV9YCkoKV0gLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1ldmFsXG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBhcnJvdyBmdW5jdGlvbnMganVzdCB3b3JrXG4gICAgICAgIHJldHVybiBba2V5LCBldmFsKHZhbHVlKV0gLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1ldmFsXG4gICAgICB9XG4gICAgfSlcbiAgKVxufSIsbWFrZUhhbmRsZXI6IigpID0+ICh7XG4gIC8vIFVzZWQgYnkgc2ltcGxlIGBuYXZpZ2F0b3JgIGdldHRlciBldmFzaW9uc1xuICBnZXR0ZXJWYWx1ZTogdmFsdWUgPT4gKHtcbiAgICBhcHBseSh0YXJnZXQsIGN0eCwgYXJncykge1xuICAgICAgLy8gTGV0J3MgZmV0Y2ggdGhlIHZhbHVlIGZpcnN0LCB0byB0cmlnZ2VyIGFuZCBlc2NhbGF0ZSBwb3RlbnRpYWwgZXJyb3JzXG4gICAgICAvLyBJbGxlZ2FsIGludm9jYXRpb25zIGxpa2UgYG5hdmlnYXRvci5fX3Byb3RvX18udmVuZG9yYCB3aWxsIHRocm93IGhlcmVcbiAgICAgIHV0aWxzLmNhY2hlLlJlZmxlY3QuYXBwbHkoLi4uYXJndW1lbnRzKVxuICAgICAgcmV0dXJuIHZhbHVlXG4gICAgfVxuICB9KVxufSkifSxfbWFpbkZ1bmN0aW9uOiIodXRpbHMsIHsgb3B0cyB9KSA9PiB7XG4gICAgICAgIGlmICghd2luZG93LmNocm9tZSkge1xuICAgICAgICAgIC8vIFVzZSB0aGUgZXhhY3QgcHJvcGVydHkgZGVzY3JpcHRvciBmb3VuZCBpbiBoZWFkZnVsIENocm9tZVxuICAgICAgICAgIC8vIGZldGNoIGl0IHZpYSBgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih3aW5kb3csICdjaHJvbWUnKWBcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnY2hyb21lJywge1xuICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiBmYWxzZSwgLy8gbm90ZSFcbiAgICAgICAgICAgIHZhbHVlOiB7fSAvLyBXZSdsbCBleHRlbmQgdGhhdCBsYXRlclxuICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICAvLyBUaGF0IG1lYW5zIHdlJ3JlIHJ1bm5pbmcgaGVhZGZ1bCBhbmQgZG9uJ3QgbmVlZCB0byBtb2NrIGFueXRoaW5nXG4gICAgICAgIGlmICgnbG9hZFRpbWVzJyBpbiB3aW5kb3cuY2hyb21lKSB7XG4gICAgICAgICAgcmV0dXJuIC8vIE5vdGhpbmcgdG8gZG8gaGVyZVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgdGhhdCB0aGUgTmF2aWdhdGlvbiBUaW1pbmcgQVBJIHYxICsgdjIgaXMgYXZhaWxhYmxlLCB3ZSBuZWVkIHRoYXRcbiAgICAgICAgaWYgKFxuICAgICAgICAgICF3aW5kb3cucGVyZm9ybWFuY2UgfHxcbiAgICAgICAgICAhd2luZG93LnBlcmZvcm1hbmNlLnRpbWluZyB8fFxuICAgICAgICAgICF3aW5kb3cuUGVyZm9ybWFuY2VQYWludFRpbWluZ1xuICAgICAgICApIHtcbiAgICAgICAgICByZXR1cm5cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHsgcGVyZm9ybWFuY2UgfSA9IHdpbmRvd1xuXG4gICAgICAgIC8vIFNvbWUgc3R1ZmYgaXMgbm90IGF2YWlsYWJsZSBvbiBhYm91dDpibGFuayBhcyBpdCByZXF1aXJlcyBhIG5hdmlnYXRpb24gdG8gb2NjdXIsXG4gICAgICAgIC8vIGxldCdzIGhhcmRlbiB0aGUgY29kZSB0byBub3QgZmFpbCB0aGVuOlxuICAgICAgICBjb25zdCBudEVudHJ5RmFsbGJhY2sgPSB7XG4gICAgICAgICAgbmV4dEhvcFByb3RvY29sOiAnaDInLFxuICAgICAgICAgIHR5cGU6ICdvdGhlcidcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFRoZSBBUEkgZXhwb3NlcyBzb21lIGZ1bmt5IGluZm8gcmVnYXJkaW5nIHRoZSBjb25uZWN0aW9uXG4gICAgICAgIGNvbnN0IHByb3RvY29sSW5mbyA9IHtcbiAgICAgICAgICBnZXQgY29ubmVjdGlvbkluZm8oKSB7XG4gICAgICAgICAgICBjb25zdCBudEVudHJ5ID1cbiAgICAgICAgICAgICAgcGVyZm9ybWFuY2UuZ2V0RW50cmllc0J5VHlwZSgnbmF2aWdhdGlvbicpWzBdIHx8IG50RW50cnlGYWxsYmFja1xuICAgICAgICAgICAgcmV0dXJuIG50RW50cnkubmV4dEhvcFByb3RvY29sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBnZXQgbnBuTmVnb3RpYXRlZFByb3RvY29sKCkge1xuICAgICAgICAgICAgLy8gTlBOIGlzIGRlcHJlY2F0ZWQgaW4gZmF2b3Igb2YgQUxQTiwgYnV0IHRoaXMgaW1wbGVtZW50YXRpb24gcmV0dXJucyB0aGVcbiAgICAgICAgICAgIC8vIEhUVFAvMiBvciBIVFRQMitRVUlDLzM5IHJlcXVlc3RzIG5lZ290aWF0ZWQgdmlhIEFMUE4uXG4gICAgICAgICAgICBjb25zdCBudEVudHJ5ID1cbiAgICAgICAgICAgICAgcGVyZm9ybWFuY2UuZ2V0RW50cmllc0J5VHlwZSgnbmF2aWdhdGlvbicpWzBdIHx8IG50RW50cnlGYWxsYmFja1xuICAgICAgICAgICAgcmV0dXJuIFsnaDInLCAnaHEnXS5pbmNsdWRlcyhudEVudHJ5Lm5leHRIb3BQcm90b2NvbClcbiAgICAgICAgICAgICAgPyBudEVudHJ5Lm5leHRIb3BQcm90b2NvbFxuICAgICAgICAgICAgICA6ICd1bmtub3duJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZ2V0IG5hdmlnYXRpb25UeXBlKCkge1xuICAgICAgICAgICAgY29uc3QgbnRFbnRyeSA9XG4gICAgICAgICAgICAgIHBlcmZvcm1hbmNlLmdldEVudHJpZXNCeVR5cGUoJ25hdmlnYXRpb24nKVswXSB8fCBudEVudHJ5RmFsbGJhY2tcbiAgICAgICAgICAgIHJldHVybiBudEVudHJ5LnR5cGVcbiAgICAgICAgICB9LFxuICAgICAgICAgIGdldCB3YXNBbHRlcm5hdGVQcm90b2NvbEF2YWlsYWJsZSgpIHtcbiAgICAgICAgICAgIC8vIFRoZSBBbHRlcm5hdGUtUHJvdG9jb2wgaGVhZGVyIGlzIGRlcHJlY2F0ZWQgaW4gZmF2b3Igb2YgQWx0LVN2Y1xuICAgICAgICAgICAgLy8gKGh0dHBzOi8vd3d3Lm1ub3QubmV0L2Jsb2cvMjAxNi8wMy8wOS9hbHQtc3ZjKSwgc28gdGVjaG5pY2FsbHkgdGhpc1xuICAgICAgICAgICAgLy8gc2hvdWxkIGFsd2F5cyByZXR1cm4gZmFsc2UuXG4gICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgICB9LFxuICAgICAgICAgIGdldCB3YXNGZXRjaGVkVmlhU3BkeSgpIHtcbiAgICAgICAgICAgIC8vIFNQRFkgaXMgZGVwcmVjYXRlZCBpbiBmYXZvciBvZiBIVFRQLzIsIGJ1dCB0aGlzIGltcGxlbWVudGF0aW9uIHJldHVybnNcbiAgICAgICAgICAgIC8vIHRydWUgZm9yIEhUVFAvMiBvciBIVFRQMitRVUlDLzM5IGFzIHdlbGwuXG4gICAgICAgICAgICBjb25zdCBudEVudHJ5ID1cbiAgICAgICAgICAgICAgcGVyZm9ybWFuY2UuZ2V0RW50cmllc0J5VHlwZSgnbmF2aWdhdGlvbicpWzBdIHx8IG50RW50cnlGYWxsYmFja1xuICAgICAgICAgICAgcmV0dXJuIFsnaDInLCAnaHEnXS5pbmNsdWRlcyhudEVudHJ5Lm5leHRIb3BQcm90b2NvbClcbiAgICAgICAgICB9LFxuICAgICAgICAgIGdldCB3YXNOcG5OZWdvdGlhdGVkKCkge1xuICAgICAgICAgICAgLy8gTlBOIGlzIGRlcHJlY2F0ZWQgaW4gZmF2b3Igb2YgQUxQTiwgYnV0IHRoaXMgaW1wbGVtZW50YXRpb24gcmV0dXJucyB0cnVlXG4gICAgICAgICAgICAvLyBmb3IgSFRUUC8yIG9yIEhUVFAyK1FVSUMvMzkgcmVxdWVzdHMgbmVnb3RpYXRlZCB2aWEgQUxQTi5cbiAgICAgICAgICAgIGNvbnN0IG50RW50cnkgPVxuICAgICAgICAgICAgICBwZXJmb3JtYW5jZS5nZXRFbnRyaWVzQnlUeXBlKCduYXZpZ2F0aW9uJylbMF0gfHwgbnRFbnRyeUZhbGxiYWNrXG4gICAgICAgICAgICByZXR1cm4gWydoMicsICdocSddLmluY2x1ZGVzKG50RW50cnkubmV4dEhvcFByb3RvY29sKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHsgdGltaW5nIH0gPSB3aW5kb3cucGVyZm9ybWFuY2VcblxuICAgICAgICAvLyBUcnVuY2F0ZSBudW1iZXIgdG8gc3BlY2lmaWMgbnVtYmVyIG9mIGRlY2ltYWxzLCBtb3N0IG9mIHRoZSBgbG9hZFRpbWVzYCBzdHVmZiBoYXMgM1xuICAgICAgICBmdW5jdGlvbiB0b0ZpeGVkKG51bSwgZml4ZWQpIHtcbiAgICAgICAgICB2YXIgcmUgPSBuZXcgUmVnRXhwKCdeLT9cXFxcZCsoPzouXFxcXGR7MCwnICsgKGZpeGVkIHx8IC0xKSArICd9KT8nKVxuICAgICAgICAgIHJldHVybiBudW0udG9TdHJpbmcoKS5tYXRjaChyZSlbMF1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHRpbWluZ0luZm8gPSB7XG4gICAgICAgICAgZ2V0IGZpcnN0UGFpbnRBZnRlckxvYWRUaW1lKCkge1xuICAgICAgICAgICAgLy8gVGhpcyB3YXMgbmV2ZXIgYWN0dWFsbHkgaW1wbGVtZW50ZWQgYW5kIGFsd2F5cyByZXR1cm5zIDAuXG4gICAgICAgICAgICByZXR1cm4gMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZ2V0IHJlcXVlc3RUaW1lKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRpbWluZy5uYXZpZ2F0aW9uU3RhcnQgLyAxMDAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICBnZXQgc3RhcnRMb2FkVGltZSgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aW1pbmcubmF2aWdhdGlvblN0YXJ0IC8gMTAwMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZ2V0IGNvbW1pdExvYWRUaW1lKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRpbWluZy5yZXNwb25zZVN0YXJ0IC8gMTAwMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZ2V0IGZpbmlzaERvY3VtZW50TG9hZFRpbWUoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGltaW5nLmRvbUNvbnRlbnRMb2FkZWRFdmVudEVuZCAvIDEwMDBcbiAgICAgICAgICB9LFxuICAgICAgICAgIGdldCBmaW5pc2hMb2FkVGltZSgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aW1pbmcubG9hZEV2ZW50RW5kIC8gMTAwMFxuICAgICAgICAgIH0sXG4gICAgICAgICAgZ2V0IGZpcnN0UGFpbnRUaW1lKCkge1xuICAgICAgICAgICAgY29uc3QgZnBFbnRyeSA9IHBlcmZvcm1hbmNlLmdldEVudHJpZXNCeVR5cGUoJ3BhaW50JylbMF0gfHwge1xuICAgICAgICAgICAgICBzdGFydFRpbWU6IHRpbWluZy5sb2FkRXZlbnRFbmQgLyAxMDAwIC8vIEZhbGxiYWNrIGlmIG5vIG5hdmlnYXRpb24gb2NjdXJlZCAoYGFib3V0OmJsYW5rYClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0b0ZpeGVkKFxuICAgICAgICAgICAgICAoZnBFbnRyeS5zdGFydFRpbWUgKyBwZXJmb3JtYW5jZS50aW1lT3JpZ2luKSAvIDEwMDAsXG4gICAgICAgICAgICAgIDNcbiAgICAgICAgICAgIClcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB3aW5kb3cuY2hyb21lLmxvYWRUaW1lcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAuLi5wcm90b2NvbEluZm8sXG4gICAgICAgICAgICAuLi50aW1pbmdJbmZvXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHV0aWxzLnBhdGNoVG9TdHJpbmcod2luZG93LmNocm9tZS5sb2FkVGltZXMpXG4gICAgICB9IixfYXJnczpbe29wdHM6e319XX0pLCgoe191dGlsc0ZuczpfdXRpbHNGbnMsX21haW5GdW5jdGlvbjpfbWFpbkZ1bmN0aW9uLF9hcmdzOl9hcmdzfSk9Pntjb25zdCB1dGlscz1PYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmVudHJpZXMoX3V0aWxzRm5zKS5tYXAoKChba2V5LHZhbHVlXSk9PltrZXksZXZhbCh2YWx1ZSldKSkpO3V0aWxzLmluaXQoKSxldmFsKF9tYWluRnVuY3Rpb24pKHV0aWxzLC4uLl9hcmdzKX0pKHtfdXRpbHNGbnM6e2luaXQ6IigpID0+IHtcbiAgdXRpbHMucHJlbG9hZENhY2hlKClcbn0iLHN0cmlwUHJveHlGcm9tRXJyb3JzOiIoaGFuZGxlciA9IHt9KSA9PiB7XG4gIGNvbnN0IG5ld0hhbmRsZXIgPSB7XG4gICAgc2V0UHJvdG90eXBlT2Y6IGZ1bmN0aW9uICh0YXJnZXQsIHByb3RvKSB7XG4gICAgICBpZiAocHJvdG8gPT09IG51bGwpXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUnKVxuICAgICAgaWYgKE9iamVjdC5nZXRQcm90b3R5cGVPZih0YXJnZXQpID09PSBPYmplY3QuZ2V0UHJvdG90eXBlT2YocHJvdG8pKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0N5Y2xpYyBfX3Byb3RvX18gdmFsdWUnKVxuICAgICAgfVxuICAgICAgcmV0dXJuIFJlZmxlY3Quc2V0UHJvdG90eXBlT2YodGFyZ2V0LCBwcm90bylcbiAgICB9XG4gIH1cbiAgLy8gV2Ugd3JhcCBlYWNoIHRyYXAgaW4gdGhlIGhhbmRsZXIgaW4gYSB0cnkvY2F0Y2ggYW5kIG1vZGlmeSB0aGUgZXJyb3Igc3RhY2sgaWYgdGhleSB0aHJvd1xuICBjb25zdCB0cmFwcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGhhbmRsZXIpXG4gIHRyYXBzLmZvckVhY2godHJhcCA9PiB7XG4gICAgbmV3SGFuZGxlclt0cmFwXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIEZvcndhcmQgdGhlIGNhbGwgdG8gdGhlIGRlZmluZWQgcHJveHkgaGFuZGxlclxuICAgICAgICByZXR1cm4gaGFuZGxlclt0cmFwXS5hcHBseSh0aGlzLCBhcmd1bWVudHMgfHwgW10pXG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgLy8gU3RhY2sgdHJhY2VzIGRpZmZlciBwZXIgYnJvd3Nlciwgd2Ugb25seSBzdXBwb3J0IGNocm9taXVtIGJhc2VkIG9uZXMgY3VycmVudGx5XG4gICAgICAgIGlmICghZXJyIHx8ICFlcnIuc3RhY2sgfHwgIWVyci5zdGFjay5pbmNsdWRlcyhgYXQgYCkpIHtcbiAgICAgICAgICB0aHJvdyBlcnJcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFdoZW4gc29tZXRoaW5nIHRocm93cyB3aXRoaW4gb25lIG9mIG91ciB0cmFwcyB0aGUgUHJveHkgd2lsbCBzaG93IHVwIGluIGVycm9yIHN0YWNrc1xuICAgICAgICAvLyBBbiBlYXJsaWVyIGltcGxlbWVudGF0aW9uIG9mIHRoaXMgY29kZSB3b3VsZCBzaW1wbHkgc3RyaXAgbGluZXMgd2l0aCBhIGJsYWNrbGlzdCxcbiAgICAgICAgLy8gYnV0IGl0IG1ha2VzIHNlbnNlIHRvIGJlIG1vcmUgc3VyZ2ljYWwgaGVyZSBhbmQgb25seSByZW1vdmUgbGluZXMgcmVsYXRlZCB0byBvdXIgUHJveHkuXG4gICAgICAgIC8vIFdlIHRyeSB0byB1c2UgYSBrbm93biBcImFuY2hvclwiIGxpbmUgZm9yIHRoYXQgYW5kIHN0cmlwIGl0IHdpdGggZXZlcnl0aGluZyBhYm92ZSBpdC5cbiAgICAgICAgLy8gSWYgdGhlIGFuY2hvciBsaW5lIGNhbm5vdCBiZSBmb3VuZCBmb3Igc29tZSByZWFzb24gd2UgZmFsbCBiYWNrIHRvIG91ciBibGFja2xpc3QgYXBwcm9hY2guXG5cbiAgICAgICAgY29uc3Qgc3RyaXBXaXRoQmxhY2tsaXN0ID0gKHN0YWNrLCBzdHJpcEZpcnN0TGluZSA9IHRydWUpID0+IHtcbiAgICAgICAgICBjb25zdCBibGFja2xpc3QgPSBbXG4gICAgICAgICAgICBgYXQgUmVmbGVjdC4ke3RyYXB9IGAsIC8vIGUuZy4gUmVmbGVjdC5nZXQgb3IgUmVmbGVjdC5hcHBseVxuICAgICAgICAgICAgYGF0IE9iamVjdC4ke3RyYXB9IGAsIC8vIGUuZy4gT2JqZWN0LmdldCBvciBPYmplY3QuYXBwbHlcbiAgICAgICAgICAgIGBhdCBPYmplY3QubmV3SGFuZGxlci48Y29tcHV0ZWQ+IFthcyAke3RyYXB9XSBgIC8vIGNhdXNlZCBieSB0aGlzIHZlcnkgd3JhcHBlciA6LSlcbiAgICAgICAgICBdXG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIGVyci5zdGFja1xuICAgICAgICAgICAgICAuc3BsaXQoJ1xcbicpXG4gICAgICAgICAgICAgIC8vIEFsd2F5cyByZW1vdmUgdGhlIGZpcnN0IChmaWxlKSBsaW5lIGluIHRoZSBzdGFjayAoZ3VhcmFudGVlZCB0byBiZSBvdXIgcHJveHkpXG4gICAgICAgICAgICAgIC5maWx0ZXIoKGxpbmUsIGluZGV4KSA9PiAhKGluZGV4ID09PSAxICYmIHN0cmlwRmlyc3RMaW5lKSlcbiAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGxpbmUgc3RhcnRzIHdpdGggb25lIG9mIG91ciBibGFja2xpc3RlZCBzdHJpbmdzXG4gICAgICAgICAgICAgIC5maWx0ZXIobGluZSA9PiAhYmxhY2tsaXN0LnNvbWUoYmwgPT4gbGluZS50cmltKCkuc3RhcnRzV2l0aChibCkpKVxuICAgICAgICAgICAgICAuam9pbignXFxuJylcbiAgICAgICAgICApXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzdHJpcFdpdGhBbmNob3IgPSAoc3RhY2ssIGFuY2hvcikgPT4ge1xuICAgICAgICAgIGNvbnN0IHN0YWNrQXJyID0gc3RhY2suc3BsaXQoJ1xcbicpXG4gICAgICAgICAgYW5jaG9yID0gYW5jaG9yIHx8IGBhdCBPYmplY3QubmV3SGFuZGxlci48Y29tcHV0ZWQ+IFthcyAke3RyYXB9XSBgIC8vIEtub3duIGZpcnN0IFByb3h5IGxpbmUgaW4gY2hyb21pdW1cbiAgICAgICAgICBjb25zdCBhbmNob3JJbmRleCA9IHN0YWNrQXJyLmZpbmRJbmRleChsaW5lID0+XG4gICAgICAgICAgICBsaW5lLnRyaW0oKS5zdGFydHNXaXRoKGFuY2hvcilcbiAgICAgICAgICApXG4gICAgICAgICAgaWYgKGFuY2hvckluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlIC8vIDQwNCwgYW5jaG9yIG5vdCBmb3VuZFxuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBTdHJpcCBldmVyeXRoaW5nIGZyb20gdGhlIHRvcCB1bnRpbCB3ZSByZWFjaCB0aGUgYW5jaG9yIGxpbmVcbiAgICAgICAgICAvLyBOb3RlOiBXZSdyZSBrZWVwaW5nIHRoZSAxc3QgbGluZSAoemVybyBpbmRleCkgYXMgaXQncyB1bnJlbGF0ZWQgKGUuZy4gYFR5cGVFcnJvcmApXG4gICAgICAgICAgc3RhY2tBcnIuc3BsaWNlKDEsIGFuY2hvckluZGV4KVxuICAgICAgICAgIHJldHVybiBzdGFja0Fyci5qb2luKCdcXG4nKVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gU3BlY2lhbCBjYXNlcyBkdWUgdG8gb3VyIG5lc3RlZCB0b1N0cmluZyBwcm94aWVzXG4gICAgICAgIGVyci5zdGFjayA9IGVyci5zdGFjay5yZXBsYWNlKFxuICAgICAgICAgICdhdCBPYmplY3QudG9TdHJpbmcgKCcsXG4gICAgICAgICAgJ2F0IEZ1bmN0aW9uLnRvU3RyaW5nICgnXG4gICAgICAgIClcbiAgICAgICAgaWYgKChlcnIuc3RhY2sgfHwgJycpLmluY2x1ZGVzKCdhdCBGdW5jdGlvbi50b1N0cmluZyAoJykpIHtcbiAgICAgICAgICBlcnIuc3RhY2sgPSBzdHJpcFdpdGhCbGFja2xpc3QoZXJyLnN0YWNrLCBmYWxzZSlcbiAgICAgICAgICB0aHJvdyBlcnJcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFRyeSB1c2luZyB0aGUgYW5jaG9yIG1ldGhvZCwgZmFsbGJhY2sgdG8gYmxhY2tsaXN0IGlmIG5lY2Vzc2FyeVxuICAgICAgICBlcnIuc3RhY2sgPSBzdHJpcFdpdGhBbmNob3IoZXJyLnN0YWNrKSB8fCBzdHJpcFdpdGhCbGFja2xpc3QoZXJyLnN0YWNrKVxuXG4gICAgICAgIHRocm93IGVyciAvLyBSZS10aHJvdyBvdXIgbm93IHNhbml0aXplZCBlcnJvclxuICAgICAgfVxuICAgIH1cbiAgfSlcbiAgcmV0dXJuIG5ld0hhbmRsZXJcbn0iLHN0cmlwRXJyb3JXaXRoQW5jaG9yOiIoZXJyLCBhbmNob3IpID0+IHtcbiAgY29uc3Qgc3RhY2tBcnIgPSBlcnIuc3RhY2suc3BsaXQoJ1xcbicpXG4gIGNvbnN0IGFuY2hvckluZGV4ID0gc3RhY2tBcnIuZmluZEluZGV4KGxpbmUgPT4gbGluZS50cmltKCkuc3RhcnRzV2l0aChhbmNob3IpKVxuICBpZiAoYW5jaG9ySW5kZXggPT09IC0xKSB7XG4gICAgcmV0dXJuIGVyciAvLyA0MDQsIGFuY2hvciBub3QgZm91bmRcbiAgfVxuICAvLyBTdHJpcCBldmVyeXRoaW5nIGZyb20gdGhlIHRvcCB1bnRpbCB3ZSByZWFjaCB0aGUgYW5jaG9yIGxpbmUgKHJlbW92ZSBhbmNob3IgbGluZSBhcyB3ZWxsKVxuICAvLyBOb3RlOiBXZSdyZSBrZWVwaW5nIHRoZSAxc3QgbGluZSAoemVybyBpbmRleCkgYXMgaXQncyB1bnJlbGF0ZWQgKGUuZy4gYFR5cGVFcnJvcmApXG4gIHN0YWNrQXJyLnNwbGljZSgxLCBhbmNob3JJbmRleClcbiAgZXJyLnN0YWNrID0gc3RhY2tBcnIuam9pbignXFxuJylcbiAgcmV0dXJuIGVyclxufSIscmVwbGFjZVByb3BlcnR5OiIob2JqLCBwcm9wTmFtZSwgZGVzY3JpcHRvck92ZXJyaWRlcyA9IHt9KSA9PiB7XG4gIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBwcm9wTmFtZSwge1xuICAgIC8vIENvcHkgb3ZlciB0aGUgZXhpc3RpbmcgZGVzY3JpcHRvcnMgKHdyaXRhYmxlLCBlbnVtZXJhYmxlLCBjb25maWd1cmFibGUsIGV0YylcbiAgICAuLi4oT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIHByb3BOYW1lKSB8fCB7fSksXG4gICAgLy8gQWRkIG91ciBvdmVycmlkZXMgKGUuZy4gdmFsdWUsIGdldCgpKVxuICAgIC4uLmRlc2NyaXB0b3JPdmVycmlkZXNcbiAgfSlcbn0iLHByZWxvYWRDYWNoZToiKCkgPT4ge1xuICBpZiAodXRpbHMuY2FjaGUpIHtcbiAgICByZXR1cm5cbiAgfVxuICB1dGlscy5jYWNoZSA9IHtcbiAgICAvLyBVc2VkIGluIG91ciBwcm94aWVzXG4gICAgUmVmbGVjdDoge1xuICAgICAgZ2V0OiBSZWZsZWN0LmdldC5iaW5kKFJlZmxlY3QpLFxuICAgICAgYXBwbHk6IFJlZmxlY3QuYXBwbHkuYmluZChSZWZsZWN0KVxuICAgIH0sXG4gICAgLy8gVXNlZCBpbiBgbWFrZU5hdGl2ZVN0cmluZ2BcbiAgICBuYXRpdmVUb1N0cmluZ1N0cjogRnVuY3Rpb24udG9TdHJpbmcgKyAnJyAvLyA9PiBgZnVuY3Rpb24gdG9TdHJpbmcoKSB7IFtuYXRpdmUgY29kZV0gfWBcbiAgfVxufSIsbWFrZU5hdGl2ZVN0cmluZzoiKG5hbWUgPSAnJykgPT4ge1xuICByZXR1cm4gdXRpbHMuY2FjaGUubmF0aXZlVG9TdHJpbmdTdHIucmVwbGFjZSgndG9TdHJpbmcnLCBuYW1lIHx8ICcnKVxufSIscGF0Y2hUb1N0cmluZzoiKG9iaiwgc3RyID0gJycpID0+IHtcbiAgY29uc3QgaGFuZGxlciA9IHtcbiAgICBhcHBseTogZnVuY3Rpb24gKHRhcmdldCwgY3R4KSB7XG4gICAgICAvLyBUaGlzIGZpeGVzIGUuZy4gYEhUTUxNZWRpYUVsZW1lbnQucHJvdG90eXBlLmNhblBsYXlUeXBlLnRvU3RyaW5nICsgXCJcImBcbiAgICAgIGlmIChjdHggPT09IEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZykge1xuICAgICAgICByZXR1cm4gdXRpbHMubWFrZU5hdGl2ZVN0cmluZygndG9TdHJpbmcnKVxuICAgICAgfVxuICAgICAgLy8gYHRvU3RyaW5nYCB0YXJnZXRlZCBhdCBvdXIgcHJveGllZCBPYmplY3QgZGV0ZWN0ZWRcbiAgICAgIGlmIChjdHggPT09IG9iaikge1xuICAgICAgICAvLyBXZSBlaXRoZXIgcmV0dXJuIHRoZSBvcHRpb25hbCBzdHJpbmcgdmVyYmF0aW0gb3IgZGVyaXZlIHRoZSBtb3N0IGRlc2lyZWQgcmVzdWx0IGF1dG9tYXRpY2FsbHlcbiAgICAgICAgcmV0dXJuIHN0ciB8fCB1dGlscy5tYWtlTmF0aXZlU3RyaW5nKG9iai5uYW1lKVxuICAgICAgfVxuICAgICAgLy8gQ2hlY2sgaWYgdGhlIHRvU3RyaW5nIHByb3R5cGUgb2YgdGhlIGNvbnRleHQgaXMgdGhlIHNhbWUgYXMgdGhlIGdsb2JhbCBwcm90b3R5cGUsXG4gICAgICAvLyBpZiBub3QgaW5kaWNhdGVzIHRoYXQgd2UgYXJlIGRvaW5nIGEgY2hlY2sgYWNyb3NzIGRpZmZlcmVudCB3aW5kb3dzLiwgZS5nLiB0aGUgaWZyYW1lV2l0aGRpcmVjdGAgdGVzdCBjYXNlXG4gICAgICBjb25zdCBoYXNTYW1lUHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YoXG4gICAgICAgIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZ1xuICAgICAgKS5pc1Byb3RvdHlwZU9mKGN0eC50b1N0cmluZykgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1wcm90b3R5cGUtYnVpbHRpbnNcbiAgICAgIGlmICghaGFzU2FtZVByb3RvKSB7XG4gICAgICAgIC8vIFBhc3MgdGhlIGNhbGwgb24gdG8gdGhlIGxvY2FsIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZyBpbnN0ZWFkXG4gICAgICAgIHJldHVybiBjdHgudG9TdHJpbmcoKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRhcmdldC5jYWxsKGN0eClcbiAgICB9XG4gIH1cblxuICBjb25zdCB0b1N0cmluZ1Byb3h5ID0gbmV3IFByb3h5KFxuICAgIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZyxcbiAgICB1dGlscy5zdHJpcFByb3h5RnJvbUVycm9ycyhoYW5kbGVyKVxuICApXG4gIHV0aWxzLnJlcGxhY2VQcm9wZXJ0eShGdW5jdGlvbi5wcm90b3R5cGUsICd0b1N0cmluZycsIHtcbiAgICB2YWx1ZTogdG9TdHJpbmdQcm94eVxuICB9KVxufSIscGF0Y2hUb1N0cmluZ05lc3RlZDoiKG9iaiA9IHt9KSA9PiB7XG4gIHJldHVybiB1dGlscy5leGVjUmVjdXJzaXZlbHkob2JqLCBbJ2Z1bmN0aW9uJ10sIHV0aWxzLnBhdGNoVG9TdHJpbmcpXG59IixyZWRpcmVjdFRvU3RyaW5nOiIocHJveHlPYmosIG9yaWdpbmFsT2JqKSA9PiB7XG4gIGNvbnN0IGhhbmRsZXIgPSB7XG4gICAgYXBwbHk6IGZ1bmN0aW9uICh0YXJnZXQsIGN0eCkge1xuICAgICAgLy8gVGhpcyBmaXhlcyBlLmcuIGBIVE1MTWVkaWFFbGVtZW50LnByb3RvdHlwZS5jYW5QbGF5VHlwZS50b1N0cmluZyArIFwiXCJgXG4gICAgICBpZiAoY3R4ID09PSBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHV0aWxzLm1ha2VOYXRpdmVTdHJpbmcoJ3RvU3RyaW5nJylcbiAgICAgIH1cblxuICAgICAgLy8gYHRvU3RyaW5nYCB0YXJnZXRlZCBhdCBvdXIgcHJveGllZCBPYmplY3QgZGV0ZWN0ZWRcbiAgICAgIGlmIChjdHggPT09IHByb3h5T2JqKSB7XG4gICAgICAgIGNvbnN0IGZhbGxiYWNrID0gKCkgPT5cbiAgICAgICAgICBvcmlnaW5hbE9iaiAmJiBvcmlnaW5hbE9iai5uYW1lXG4gICAgICAgICAgICA/IHV0aWxzLm1ha2VOYXRpdmVTdHJpbmcob3JpZ2luYWxPYmoubmFtZSlcbiAgICAgICAgICAgIDogdXRpbHMubWFrZU5hdGl2ZVN0cmluZyhwcm94eU9iai5uYW1lKVxuXG4gICAgICAgIC8vIFJldHVybiB0aGUgdG9TdHJpbmcgcmVwcmVzZW50YXRpb24gb2Ygb3VyIG9yaWdpbmFsIG9iamVjdCBpZiBwb3NzaWJsZVxuICAgICAgICByZXR1cm4gb3JpZ2luYWxPYmogKyAnJyB8fCBmYWxsYmFjaygpXG4gICAgICB9XG5cbiAgICAgIGlmICh0eXBlb2YgY3R4ID09PSAndW5kZWZpbmVkJyB8fCBjdHggPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHRhcmdldC5jYWxsKGN0eClcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgdGhlIHRvU3RyaW5nIHByb3R5cGUgb2YgdGhlIGNvbnRleHQgaXMgdGhlIHNhbWUgYXMgdGhlIGdsb2JhbCBwcm90b3R5cGUsXG4gICAgICAvLyBpZiBub3QgaW5kaWNhdGVzIHRoYXQgd2UgYXJlIGRvaW5nIGEgY2hlY2sgYWNyb3NzIGRpZmZlcmVudCB3aW5kb3dzLiwgZS5nLiB0aGUgaWZyYW1lV2l0aGRpcmVjdGAgdGVzdCBjYXNlXG4gICAgICBjb25zdCBoYXNTYW1lUHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YoXG4gICAgICAgIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZ1xuICAgICAgKS5pc1Byb3RvdHlwZU9mKGN0eC50b1N0cmluZykgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1wcm90b3R5cGUtYnVpbHRpbnNcbiAgICAgIGlmICghaGFzU2FtZVByb3RvKSB7XG4gICAgICAgIC8vIFBhc3MgdGhlIGNhbGwgb24gdG8gdGhlIGxvY2FsIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZyBpbnN0ZWFkXG4gICAgICAgIHJldHVybiBjdHgudG9TdHJpbmcoKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGFyZ2V0LmNhbGwoY3R4KVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHRvU3RyaW5nUHJveHkgPSBuZXcgUHJveHkoXG4gICAgRnVuY3Rpb24ucHJvdG90eXBlLnRvU3RyaW5nLFxuICAgIHV0aWxzLnN0cmlwUHJveHlGcm9tRXJyb3JzKGhhbmRsZXIpXG4gIClcbiAgdXRpbHMucmVwbGFjZVByb3BlcnR5KEZ1bmN0aW9uLnByb3RvdHlwZSwgJ3RvU3RyaW5nJywge1xuICAgIHZhbHVlOiB0b1N0cmluZ1Byb3h5XG4gIH0pXG59IixyZXBsYWNlV2l0aFByb3h5OiIob2JqLCBwcm9wTmFtZSwgaGFuZGxlcikgPT4ge1xuICBjb25zdCBvcmlnaW5hbE9iaiA9IG9ialtwcm9wTmFtZV1cbiAgY29uc3QgcHJveHlPYmogPSBuZXcgUHJveHkob2JqW3Byb3BOYW1lXSwgdXRpbHMuc3RyaXBQcm94eUZyb21FcnJvcnMoaGFuZGxlcikpXG5cbiAgdXRpbHMucmVwbGFjZVByb3BlcnR5KG9iaiwgcHJvcE5hbWUsIHsgdmFsdWU6IHByb3h5T2JqIH0pXG4gIHV0aWxzLnJlZGlyZWN0VG9TdHJpbmcocHJveHlPYmosIG9yaWdpbmFsT2JqKVxuXG4gIHJldHVybiB0cnVlXG59IixyZXBsYWNlR2V0dGVyV2l0aFByb3h5OiIob2JqLCBwcm9wTmFtZSwgaGFuZGxlcikgPT4ge1xuICBjb25zdCBmbiA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBwcm9wTmFtZSkuZ2V0XG4gIGNvbnN0IGZuU3RyID0gZm4udG9TdHJpbmcoKSAvLyBzcGVjaWFsIGdldHRlciBmdW5jdGlvbiBzdHJpbmdcbiAgY29uc3QgcHJveHlPYmogPSBuZXcgUHJveHkoZm4sIHV0aWxzLnN0cmlwUHJveHlGcm9tRXJyb3JzKGhhbmRsZXIpKVxuXG4gIHV0aWxzLnJlcGxhY2VQcm9wZXJ0eShvYmosIHByb3BOYW1lLCB7IGdldDogcHJveHlPYmogfSlcbiAgdXRpbHMucGF0Y2hUb1N0cmluZyhwcm94eU9iaiwgZm5TdHIpXG5cbiAgcmV0dXJuIHRydWVcbn0iLG1vY2tXaXRoUHJveHk6IihvYmosIHByb3BOYW1lLCBwc2V1ZG9UYXJnZXQsIGhhbmRsZXIpID0+IHtcbiAgY29uc3QgcHJveHlPYmogPSBuZXcgUHJveHkocHNldWRvVGFyZ2V0LCB1dGlscy5zdHJpcFByb3h5RnJvbUVycm9ycyhoYW5kbGVyKSlcblxuICB1dGlscy5yZXBsYWNlUHJvcGVydHkob2JqLCBwcm9wTmFtZSwgeyB2YWx1ZTogcHJveHlPYmogfSlcbiAgdXRpbHMucGF0Y2hUb1N0cmluZyhwcm94eU9iailcblxuICByZXR1cm4gdHJ1ZVxufSIsY3JlYXRlUHJveHk6Iihwc2V1ZG9UYXJnZXQsIGhhbmRsZXIpID0+IHtcbiAgY29uc3QgcHJveHlPYmogPSBuZXcgUHJveHkocHNldWRvVGFyZ2V0LCB1dGlscy5zdHJpcFByb3h5RnJvbUVycm9ycyhoYW5kbGVyKSlcbiAgdXRpbHMucGF0Y2hUb1N0cmluZyhwcm94eU9iailcblxuICByZXR1cm4gcHJveHlPYmpcbn0iLHNwbGl0T2JqUGF0aDoib2JqUGF0aCA9PiAoe1xuICAvLyBSZW1vdmUgbGFzdCBkb3QgZW50cnkgKHByb3BlcnR5KSA9PT4gYEhUTUxNZWRpYUVsZW1lbnQucHJvdG90eXBlYFxuICBvYmpOYW1lOiBvYmpQYXRoLnNwbGl0KCcuJykuc2xpY2UoMCwgLTEpLmpvaW4oJy4nKSxcbiAgLy8gRXh0cmFjdCBsYXN0IGRvdCBlbnRyeSA9PT4gYGNhblBsYXlUeXBlYFxuICBwcm9wTmFtZTogb2JqUGF0aC5zcGxpdCgnLicpLnNsaWNlKC0xKVswXVxufSkiLHJlcGxhY2VPYmpQYXRoV2l0aFByb3h5OiIob2JqUGF0aCwgaGFuZGxlcikgPT4ge1xuICBjb25zdCB7IG9iak5hbWUsIHByb3BOYW1lIH0gPSB1dGlscy5zcGxpdE9ialBhdGgob2JqUGF0aClcbiAgY29uc3Qgb2JqID0gZXZhbChvYmpOYW1lKSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWV2YWxcbiAgcmV0dXJuIHV0aWxzLnJlcGxhY2VXaXRoUHJveHkob2JqLCBwcm9wTmFtZSwgaGFuZGxlcilcbn0iLGV4ZWNSZWN1cnNpdmVseToiKG9iaiA9IHt9LCB0eXBlRmlsdGVyID0gW10sIGZuKSA9PiB7XG4gIGZ1bmN0aW9uIHJlY3Vyc2Uob2JqKSB7XG4gICAgZm9yIChjb25zdCBrZXkgaW4gb2JqKSB7XG4gICAgICBpZiAob2JqW2tleV0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb250aW51ZVxuICAgICAgfVxuICAgICAgaWYgKG9ialtrZXldICYmIHR5cGVvZiBvYmpba2V5XSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgcmVjdXJzZShvYmpba2V5XSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChvYmpba2V5XSAmJiB0eXBlRmlsdGVyLmluY2x1ZGVzKHR5cGVvZiBvYmpba2V5XSkpIHtcbiAgICAgICAgICBmbi5jYWxsKHRoaXMsIG9ialtrZXldKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJlY3Vyc2Uob2JqKVxuICByZXR1cm4gb2JqXG59IixzdHJpbmdpZnlGbnM6Iihmbk9iaiA9IHsgaGVsbG86ICgpID0+ICd3b3JsZCcgfSkgPT4ge1xuICAvLyBPYmplY3QuZnJvbUVudHJpZXMoKSBwb255ZmlsbCAoaW4gNiBsaW5lcykgLSBzdXBwb3J0ZWQgb25seSBpbiBOb2RlIHYxMissIG1vZGVybiBicm93c2VycyBhcmUgZmluZVxuICAvLyBodHRwczovL2dpdGh1Yi5jb20vZmVyb3NzL2Zyb21lbnRyaWVzXG4gIGZ1bmN0aW9uIGZyb21FbnRyaWVzKGl0ZXJhYmxlKSB7XG4gICAgcmV0dXJuIFsuLi5pdGVyYWJsZV0ucmVkdWNlKChvYmosIFtrZXksIHZhbF0pID0+IHtcbiAgICAgIG9ialtrZXldID0gdmFsXG4gICAgICByZXR1cm4gb2JqXG4gICAgfSwge30pXG4gIH1cbiAgcmV0dXJuIChPYmplY3QuZnJvbUVudHJpZXMgfHwgZnJvbUVudHJpZXMpKFxuICAgIE9iamVjdC5lbnRyaWVzKGZuT2JqKVxuICAgICAgLmZpbHRlcigoW2tleSwgdmFsdWVdKSA9PiB0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpXG4gICAgICAubWFwKChba2V5LCB2YWx1ZV0pID0+IFtrZXksIHZhbHVlLnRvU3RyaW5nKCldKSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWV2YWxcbiAgKVxufSIsbWF0ZXJpYWxpemVGbnM6IihmblN0ck9iaiA9IHsgaGVsbG86IFwiKCkgPT4gJ3dvcmxkJ1wiIH0pID0+IHtcbiAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICBPYmplY3QuZW50cmllcyhmblN0ck9iaikubWFwKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgIGlmICh2YWx1ZS5zdGFydHNXaXRoKCdmdW5jdGlvbicpKSB7XG4gICAgICAgIC8vIHNvbWUgdHJpY2tlcnkgaXMgbmVlZGVkIHRvIG1ha2Ugb2xkc2Nob29sIGZ1bmN0aW9ucyB3b3JrIDotKVxuICAgICAgICByZXR1cm4gW2tleSwgZXZhbChgKCkgPT4gJHt2YWx1ZX1gKSgpXSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWV2YWxcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGFycm93IGZ1bmN0aW9ucyBqdXN0IHdvcmtcbiAgICAgICAgcmV0dXJuIFtrZXksIGV2YWwodmFsdWUpXSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWV2YWxcbiAgICAgIH1cbiAgICB9KVxuICApXG59IixtYWtlSGFuZGxlcjoiKCkgPT4gKHtcbiAgLy8gVXNlZCBieSBzaW1wbGUgYG5hdmlnYXRvcmAgZ2V0dGVyIGV2YXNpb25zXG4gIGdldHRlclZhbHVlOiB2YWx1ZSA9PiAoe1xuICAgIGFwcGx5KHRhcmdldCwgY3R4LCBhcmdzKSB7XG4gICAgICAvLyBMZXQncyBmZXRjaCB0aGUgdmFsdWUgZmlyc3QsIHRvIHRyaWdnZXIgYW5kIGVzY2FsYXRlIHBvdGVudGlhbCBlcnJvcnNcbiAgICAgIC8vIElsbGVnYWwgaW52b2NhdGlvbnMgbGlrZSBgbmF2aWdhdG9yLl9fcHJvdG9fXy52ZW5kb3JgIHdpbGwgdGhyb3cgaGVyZVxuICAgICAgdXRpbHMuY2FjaGUuUmVmbGVjdC5hcHBseSguLi5hcmd1bWVudHMpXG4gICAgICByZXR1cm4gdmFsdWVcbiAgICB9XG4gIH0pXG59KSJ9LF9tYWluRnVuY3Rpb246Iih1dGlscywgeyBvcHRzLCBTVEFUSUNfREFUQSB9KSA9PiB7XG4gICAgICAgIGlmICghd2luZG93LmNocm9tZSkge1xuICAgICAgICAgIC8vIFVzZSB0aGUgZXhhY3QgcHJvcGVydHkgZGVzY3JpcHRvciBmb3VuZCBpbiBoZWFkZnVsIENocm9tZVxuICAgICAgICAgIC8vIGZldGNoIGl0IHZpYSBgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih3aW5kb3csICdjaHJvbWUnKWBcbiAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnY2hyb21lJywge1xuICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiBmYWxzZSwgLy8gbm90ZSFcbiAgICAgICAgICAgIHZhbHVlOiB7fSAvLyBXZSdsbCBleHRlbmQgdGhhdCBsYXRlclxuICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICAvLyBUaGF0IG1lYW5zIHdlJ3JlIHJ1bm5pbmcgaGVhZGZ1bCBhbmQgZG9uJ3QgbmVlZCB0byBtb2NrIGFueXRoaW5nXG4gICAgICAgIGNvbnN0IGV4aXN0c0FscmVhZHkgPSAncnVudGltZScgaW4gd2luZG93LmNocm9tZVxuICAgICAgICAvLyBgY2hyb21lLnJ1bnRpbWVgIGlzIG9ubHkgZXhwb3NlZCBvbiBzZWN1cmUgb3JpZ2luc1xuICAgICAgICBjb25zdCBpc05vdFNlY3VyZSA9ICF3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wuc3RhcnRzV2l0aCgnaHR0cHMnKVxuICAgICAgICBpZiAoZXhpc3RzQWxyZWFkeSB8fCAoaXNOb3RTZWN1cmUgJiYgIW9wdHMucnVuT25JbnNlY3VyZU9yaWdpbnMpKSB7XG4gICAgICAgICAgcmV0dXJuIC8vIE5vdGhpbmcgdG8gZG8gaGVyZVxuICAgICAgICB9XG5cbiAgICAgICAgd2luZG93LmNocm9tZS5ydW50aW1lID0ge1xuICAgICAgICAgIC8vIFRoZXJlJ3MgYSBidW5jaCBvZiBzdGF0aWMgZGF0YSBpbiB0aGF0IHByb3BlcnR5IHdoaWNoIGRvZXNuJ3Qgc2VlbSB0byBjaGFuZ2UsXG4gICAgICAgICAgLy8gd2Ugc2hvdWxkIHBlcmlvZGljYWxseSBjaGVjayBmb3IgdXBkYXRlczogYEpTT04uc3RyaW5naWZ5KHdpbmRvdy5jaHJvbWUucnVudGltZSwgbnVsbCwgMilgXG4gICAgICAgICAgLi4uU1RBVElDX0RBVEEsXG4gICAgICAgICAgLy8gYGNocm9tZS5ydW50aW1lLmlkYCBpcyBleHRlbnNpb24gcmVsYXRlZCBhbmQgcmV0dXJucyB1bmRlZmluZWQgaW4gQ2hyb21lXG4gICAgICAgICAgZ2V0IGlkKCkge1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgICAgICAgIH0sXG4gICAgICAgICAgLy8gVGhlc2UgdHdvIHJlcXVpcmUgbW9yZSBzb3BoaXN0aWNhdGVkIG1vY2tzXG4gICAgICAgICAgY29ubmVjdDogbnVsbCxcbiAgICAgICAgICBzZW5kTWVzc2FnZTogbnVsbFxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbWFrZUN1c3RvbVJ1bnRpbWVFcnJvcnMgPSAocHJlYW1ibGUsIG1ldGhvZCwgZXh0ZW5zaW9uSWQpID0+ICh7XG4gICAgICAgICAgTm9NYXRjaGluZ1NpZ25hdHVyZTogbmV3IFR5cGVFcnJvcihcbiAgICAgICAgICAgIHByZWFtYmxlICsgYE5vIG1hdGNoaW5nIHNpZ25hdHVyZS5gXG4gICAgICAgICAgKSxcbiAgICAgICAgICBNdXN0U3BlY2lmeUV4dGVuc2lvbklEOiBuZXcgVHlwZUVycm9yKFxuICAgICAgICAgICAgcHJlYW1ibGUgK1xuICAgICAgICAgICAgICBgJHttZXRob2R9IGNhbGxlZCBmcm9tIGEgd2VicGFnZSBtdXN0IHNwZWNpZnkgYW4gRXh0ZW5zaW9uIElEIChzdHJpbmcpIGZvciBpdHMgZmlyc3QgYXJndW1lbnQuYFxuICAgICAgICAgICksXG4gICAgICAgICAgSW52YWxpZEV4dGVuc2lvbklEOiBuZXcgVHlwZUVycm9yKFxuICAgICAgICAgICAgcHJlYW1ibGUgKyBgSW52YWxpZCBleHRlbnNpb24gaWQ6ICcke2V4dGVuc2lvbklkfSdgXG4gICAgICAgICAgKVxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIFZhbGlkIEV4dGVuc2lvbiBJRHMgYXJlIDMyIGNoYXJhY3RlcnMgaW4gbGVuZ3RoIGFuZCB1c2UgdGhlIGxldHRlciBgYWAgdG8gYHBgOlxuICAgICAgICAvLyBodHRwczovL3NvdXJjZS5jaHJvbWl1bS5vcmcvY2hyb21pdW0vY2hyb21pdW0vc3JjLysvbWFzdGVyOmNvbXBvbmVudHMvY3J4X2ZpbGUvaWRfdXRpbC5jYztkcmM9MTRhMDU1Y2NiMTdlOGM4ZDVkNDM3ZmUwODBmYWJhNGM2ZjA3YmVhYztsPTkwXG4gICAgICAgIGNvbnN0IGlzVmFsaWRFeHRlbnNpb25JRCA9IHN0ciA9PlxuICAgICAgICAgIHN0ci5sZW5ndGggPT09IDMyICYmIHN0ci50b0xvd2VyQ2FzZSgpLm1hdGNoKC9eW2EtcF0rJC8pXG5cbiAgICAgICAgLyoqIE1vY2sgYGNocm9tZS5ydW50aW1lLnNlbmRNZXNzYWdlYCAqL1xuICAgICAgICBjb25zdCBzZW5kTWVzc2FnZUhhbmRsZXIgPSB7XG4gICAgICAgICAgYXBwbHk6IGZ1bmN0aW9uKHRhcmdldCwgY3R4LCBhcmdzKSB7XG4gICAgICAgICAgICBjb25zdCBbZXh0ZW5zaW9uSWQsIG9wdGlvbnMsIHJlc3BvbnNlQ2FsbGJhY2tdID0gYXJncyB8fCBbXVxuXG4gICAgICAgICAgICAvLyBEZWZpbmUgY3VzdG9tIGVycm9yc1xuICAgICAgICAgICAgY29uc3QgZXJyb3JQcmVhbWJsZSA9IGBFcnJvciBpbiBpbnZvY2F0aW9uIG9mIHJ1bnRpbWUuc2VuZE1lc3NhZ2Uob3B0aW9uYWwgc3RyaW5nIGV4dGVuc2lvbklkLCBhbnkgbWVzc2FnZSwgb3B0aW9uYWwgb2JqZWN0IG9wdGlvbnMsIG9wdGlvbmFsIGZ1bmN0aW9uIHJlc3BvbnNlQ2FsbGJhY2spOiBgXG4gICAgICAgICAgICBjb25zdCBFcnJvcnMgPSBtYWtlQ3VzdG9tUnVudGltZUVycm9ycyhcbiAgICAgICAgICAgICAgZXJyb3JQcmVhbWJsZSxcbiAgICAgICAgICAgICAgYGNocm9tZS5ydW50aW1lLnNlbmRNZXNzYWdlKClgLFxuICAgICAgICAgICAgICBleHRlbnNpb25JZFxuICAgICAgICAgICAgKVxuXG4gICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgY2FsbCBzaWduYXR1cmUgbG9va3Mgb2tcbiAgICAgICAgICAgIGNvbnN0IG5vQXJndW1lbnRzID0gYXJncy5sZW5ndGggPT09IDBcbiAgICAgICAgICAgIGNvbnN0IHRvb01hbnlBcmd1bWVudHMgPSBhcmdzLmxlbmd0aCA+IDRcbiAgICAgICAgICAgIGNvbnN0IGluY29ycmVjdE9wdGlvbnMgPSBvcHRpb25zICYmIHR5cGVvZiBvcHRpb25zICE9PSAnb2JqZWN0J1xuICAgICAgICAgICAgY29uc3QgaW5jb3JyZWN0UmVzcG9uc2VDYWxsYmFjayA9XG4gICAgICAgICAgICAgIHJlc3BvbnNlQ2FsbGJhY2sgJiYgdHlwZW9mIHJlc3BvbnNlQ2FsbGJhY2sgIT09ICdmdW5jdGlvbidcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgbm9Bcmd1bWVudHMgfHxcbiAgICAgICAgICAgICAgdG9vTWFueUFyZ3VtZW50cyB8fFxuICAgICAgICAgICAgICBpbmNvcnJlY3RPcHRpb25zIHx8XG4gICAgICAgICAgICAgIGluY29ycmVjdFJlc3BvbnNlQ2FsbGJhY2tcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICB0aHJvdyBFcnJvcnMuTm9NYXRjaGluZ1NpZ25hdHVyZVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBBdCBsZWFzdCAyIGFyZ3VtZW50cyBhcmUgcmVxdWlyZWQgYmVmb3JlIHdlIGV2ZW4gdmFsaWRhdGUgdGhlIGV4dGVuc2lvbiBJRFxuICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoIDwgMikge1xuICAgICAgICAgICAgICB0aHJvdyBFcnJvcnMuTXVzdFNwZWNpZnlFeHRlbnNpb25JRFxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBOb3cgbGV0J3MgbWFrZSBzdXJlIHdlIGdvdCBhIHN0cmluZyBhcyBleHRlbnNpb24gSURcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZXh0ZW5zaW9uSWQgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgIHRocm93IEVycm9ycy5Ob01hdGNoaW5nU2lnbmF0dXJlXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghaXNWYWxpZEV4dGVuc2lvbklEKGV4dGVuc2lvbklkKSkge1xuICAgICAgICAgICAgICB0aHJvdyBFcnJvcnMuSW52YWxpZEV4dGVuc2lvbklEXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQgLy8gTm9ybWFsIGJlaGF2aW9yXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHV0aWxzLm1vY2tXaXRoUHJveHkoXG4gICAgICAgICAgd2luZG93LmNocm9tZS5ydW50aW1lLFxuICAgICAgICAgICdzZW5kTWVzc2FnZScsXG4gICAgICAgICAgZnVuY3Rpb24gc2VuZE1lc3NhZ2UoKSB7fSxcbiAgICAgICAgICBzZW5kTWVzc2FnZUhhbmRsZXJcbiAgICAgICAgKVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBNb2NrIGBjaHJvbWUucnVudGltZS5jb25uZWN0YFxuICAgICAgICAgKlxuICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmNocm9tZS5jb20vYXBwcy9ydW50aW1lI21ldGhvZC1jb25uZWN0XG4gICAgICAgICAqL1xuICAgICAgICBjb25zdCBjb25uZWN0SGFuZGxlciA9IHtcbiAgICAgICAgICBhcHBseTogZnVuY3Rpb24odGFyZ2V0LCBjdHgsIGFyZ3MpIHtcbiAgICAgICAgICAgIGNvbnN0IFtleHRlbnNpb25JZCwgY29ubmVjdEluZm9dID0gYXJncyB8fCBbXVxuXG4gICAgICAgICAgICAvLyBEZWZpbmUgY3VzdG9tIGVycm9yc1xuICAgICAgICAgICAgY29uc3QgZXJyb3JQcmVhbWJsZSA9IGBFcnJvciBpbiBpbnZvY2F0aW9uIG9mIHJ1bnRpbWUuY29ubmVjdChvcHRpb25hbCBzdHJpbmcgZXh0ZW5zaW9uSWQsIG9wdGlvbmFsIG9iamVjdCBjb25uZWN0SW5mbyk6IGBcbiAgICAgICAgICAgIGNvbnN0IEVycm9ycyA9IG1ha2VDdXN0b21SdW50aW1lRXJyb3JzKFxuICAgICAgICAgICAgICBlcnJvclByZWFtYmxlLFxuICAgICAgICAgICAgICBgY2hyb21lLnJ1bnRpbWUuY29ubmVjdCgpYCxcbiAgICAgICAgICAgICAgZXh0ZW5zaW9uSWRcbiAgICAgICAgICAgIClcblxuICAgICAgICAgICAgLy8gQmVoYXZpb3IgZGlmZmVycyBhIGJpdCBmcm9tIHNlbmRNZXNzYWdlOlxuICAgICAgICAgICAgY29uc3Qgbm9Bcmd1bWVudHMgPSBhcmdzLmxlbmd0aCA9PT0gMFxuICAgICAgICAgICAgY29uc3QgZW1wdHlTdHJpbmdBcmd1bWVudCA9IGFyZ3MubGVuZ3RoID09PSAxICYmIGV4dGVuc2lvbklkID09PSAnJ1xuICAgICAgICAgICAgaWYgKG5vQXJndW1lbnRzIHx8IGVtcHR5U3RyaW5nQXJndW1lbnQpIHtcbiAgICAgICAgICAgICAgdGhyb3cgRXJyb3JzLk11c3RTcGVjaWZ5RXh0ZW5zaW9uSURcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgdG9vTWFueUFyZ3VtZW50cyA9IGFyZ3MubGVuZ3RoID4gMlxuICAgICAgICAgICAgY29uc3QgaW5jb3JyZWN0Q29ubmVjdEluZm9UeXBlID1cbiAgICAgICAgICAgICAgY29ubmVjdEluZm8gJiYgdHlwZW9mIGNvbm5lY3RJbmZvICE9PSAnb2JqZWN0J1xuXG4gICAgICAgICAgICBpZiAodG9vTWFueUFyZ3VtZW50cyB8fCBpbmNvcnJlY3RDb25uZWN0SW5mb1R5cGUpIHtcbiAgICAgICAgICAgICAgdGhyb3cgRXJyb3JzLk5vTWF0Y2hpbmdTaWduYXR1cmVcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgZXh0ZW5zaW9uSWRJc1N0cmluZyA9IHR5cGVvZiBleHRlbnNpb25JZCA9PT0gJ3N0cmluZydcbiAgICAgICAgICAgIGlmIChleHRlbnNpb25JZElzU3RyaW5nICYmIGV4dGVuc2lvbklkID09PSAnJykge1xuICAgICAgICAgICAgICB0aHJvdyBFcnJvcnMuTXVzdFNwZWNpZnlFeHRlbnNpb25JRFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGV4dGVuc2lvbklkSXNTdHJpbmcgJiYgIWlzVmFsaWRFeHRlbnNpb25JRChleHRlbnNpb25JZCkpIHtcbiAgICAgICAgICAgICAgdGhyb3cgRXJyb3JzLkludmFsaWRFeHRlbnNpb25JRFxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBUaGVyZSdzIGFub3RoZXIgZWRnZS1jYXNlIGhlcmU6IGV4dGVuc2lvbklkIGlzIG9wdGlvbmFsIHNvIHdlIG1pZ2h0IGZpbmQgYSBjb25uZWN0SW5mbyBvYmplY3QgYXMgZmlyc3QgcGFyYW0sIHdoaWNoIHdlIG5lZWQgdG8gdmFsaWRhdGVcbiAgICAgICAgICAgIGNvbnN0IHZhbGlkYXRlQ29ubmVjdEluZm8gPSBjaSA9PiB7XG4gICAgICAgICAgICAgIC8vIE1vcmUgdGhhbiBhIGZpcnN0IHBhcmFtIGNvbm5lY3RJbmZvIGFzIGJlZW4gcHJvdmlkZWRcbiAgICAgICAgICAgICAgaWYgKGFyZ3MubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgIHRocm93IEVycm9ycy5Ob01hdGNoaW5nU2lnbmF0dXJlXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgLy8gQW4gZW1wdHkgY29ubmVjdEluZm8gaGFzIGJlZW4gcHJvdmlkZWRcbiAgICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKGNpKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcnMuTXVzdFNwZWNpZnlFeHRlbnNpb25JRFxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIC8vIExvb3Agb3ZlciBhbGwgY29ubmVjdEluZm8gcHJvcHMgYW4gY2hlY2sgdGhlbVxuICAgICAgICAgICAgICBPYmplY3QuZW50cmllcyhjaSkuZm9yRWFjaCgoW2ssIHZdKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgaXNFeHBlY3RlZCA9IFsnbmFtZScsICdpbmNsdWRlVGxzQ2hhbm5lbElkJ10uaW5jbHVkZXMoaylcbiAgICAgICAgICAgICAgICBpZiAoIWlzRXhwZWN0ZWQpIHtcbiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXG4gICAgICAgICAgICAgICAgICAgIGVycm9yUHJlYW1ibGUgKyBgVW5leHBlY3RlZCBwcm9wZXJ0eTogJyR7a30nLmBcbiAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgTWlzbWF0Y2hFcnJvciA9IChwcm9wTmFtZSwgZXhwZWN0ZWQsIGZvdW5kKSA9PlxuICAgICAgICAgICAgICAgICAgVHlwZUVycm9yKFxuICAgICAgICAgICAgICAgICAgICBlcnJvclByZWFtYmxlICtcbiAgICAgICAgICAgICAgICAgICAgICBgRXJyb3IgYXQgcHJvcGVydHkgJyR7cHJvcE5hbWV9JzogSW52YWxpZCB0eXBlOiBleHBlY3RlZCAke2V4cGVjdGVkfSwgZm91bmQgJHtmb3VuZH0uYFxuICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgIGlmIChrID09PSAnbmFtZScgJiYgdHlwZW9mIHYgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgICB0aHJvdyBNaXNtYXRjaEVycm9yKGssICdzdHJpbmcnLCB0eXBlb2YgdilcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGsgPT09ICdpbmNsdWRlVGxzQ2hhbm5lbElkJyAmJiB0eXBlb2YgdiAhPT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgICB0aHJvdyBNaXNtYXRjaEVycm9yKGssICdib29sZWFuJywgdHlwZW9mIHYpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBleHRlbnNpb25JZCA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgdmFsaWRhdGVDb25uZWN0SW5mbyhleHRlbnNpb25JZClcbiAgICAgICAgICAgICAgdGhyb3cgRXJyb3JzLk11c3RTcGVjaWZ5RXh0ZW5zaW9uSURcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gVW5mb3J0dW5hdGVseSBldmVuIHdoZW4gdGhlIGNvbm5lY3QgZmFpbHMgQ2hyb21lIHdpbGwgcmV0dXJuIGFuIG9iamVjdCB3aXRoIG1ldGhvZHMgd2UgbmVlZCB0byBtb2NrIGFzIHdlbGxcbiAgICAgICAgICAgIHJldHVybiB1dGlscy5wYXRjaFRvU3RyaW5nTmVzdGVkKG1ha2VDb25uZWN0UmVzcG9uc2UoKSlcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdXRpbHMubW9ja1dpdGhQcm94eShcbiAgICAgICAgICB3aW5kb3cuY2hyb21lLnJ1bnRpbWUsXG4gICAgICAgICAgJ2Nvbm5lY3QnLFxuICAgICAgICAgIGZ1bmN0aW9uIGNvbm5lY3QoKSB7fSxcbiAgICAgICAgICBjb25uZWN0SGFuZGxlclxuICAgICAgICApXG5cbiAgICAgICAgZnVuY3Rpb24gbWFrZUNvbm5lY3RSZXNwb25zZSgpIHtcbiAgICAgICAgICBjb25zdCBvblNvbWV0aGluZyA9ICgpID0+ICh7XG4gICAgICAgICAgICBhZGRMaXN0ZW5lcjogZnVuY3Rpb24gYWRkTGlzdGVuZXIoKSB7fSxcbiAgICAgICAgICAgIGRpc3BhdGNoOiBmdW5jdGlvbiBkaXNwYXRjaCgpIHt9LFxuICAgICAgICAgICAgaGFzTGlzdGVuZXI6IGZ1bmN0aW9uIGhhc0xpc3RlbmVyKCkge30sXG4gICAgICAgICAgICBoYXNMaXN0ZW5lcnM6IGZ1bmN0aW9uIGhhc0xpc3RlbmVycygpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVtb3ZlTGlzdGVuZXI6IGZ1bmN0aW9uIHJlbW92ZUxpc3RlbmVyKCkge31cbiAgICAgICAgICB9KVxuXG4gICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB7XG4gICAgICAgICAgICBuYW1lOiAnJyxcbiAgICAgICAgICAgIHNlbmRlcjogdW5kZWZpbmVkLFxuICAgICAgICAgICAgZGlzY29ubmVjdDogZnVuY3Rpb24gZGlzY29ubmVjdCgpIHt9LFxuICAgICAgICAgICAgb25EaXNjb25uZWN0OiBvblNvbWV0aGluZygpLFxuICAgICAgICAgICAgb25NZXNzYWdlOiBvblNvbWV0aGluZygpLFxuICAgICAgICAgICAgcG9zdE1lc3NhZ2U6IGZ1bmN0aW9uIHBvc3RNZXNzYWdlKCkge1xuICAgICAgICAgICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGBJbnN1ZmZpY2llbnQgbnVtYmVyIG9mIGFyZ3VtZW50cy5gKVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQXR0ZW1wdGluZyB0byB1c2UgYSBkaXNjb25uZWN0ZWQgcG9ydCBvYmplY3RgKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2VcbiAgICAgICAgfVxuICAgICAgfSIsX2FyZ3M6W3tvcHRzOntydW5Pbkluc2VjdXJlT3JpZ2luczohMX0sU1RBVElDX0RBVEE6e09uSW5zdGFsbGVkUmVhc29uOntDSFJPTUVfVVBEQVRFOiJjaHJvbWVfdXBkYXRlIixJTlNUQUxMOiJpbnN0YWxsIixTSEFSRURfTU9EVUxFX1VQREFURToic2hhcmVkX21vZHVsZV91cGRhdGUiLFVQREFURToidXBkYXRlIn0sT25SZXN0YXJ0UmVxdWlyZWRSZWFzb246e0FQUF9VUERBVEU6ImFwcF91cGRhdGUiLE9TX1VQREFURToib3NfdXBkYXRlIixQRVJJT0RJQzoicGVyaW9kaWMifSxQbGF0Zm9ybUFyY2g6e0FSTToiYXJtIixBUk02NDoiYXJtNjQiLE1JUFM6Im1pcHMiLE1JUFM2NDoibWlwczY0IixYODZfMzI6Ing4Ni0zMiIsWDg2XzY0OiJ4ODYtNjQifSxQbGF0Zm9ybU5hY2xBcmNoOntBUk06ImFybSIsTUlQUzoibWlwcyIsTUlQUzY0OiJtaXBzNjQiLFg4Nl8zMjoieDg2LTMyIixYODZfNjQ6Ing4Ni02NCJ9LFBsYXRmb3JtT3M6e0FORFJPSUQ6ImFuZHJvaWQiLENST1M6ImNyb3MiLExJTlVYOiJsaW51eCIsTUFDOiJtYWMiLE9QRU5CU0Q6Im9wZW5ic2QiLFdJTjoid2luIn0sUmVxdWVzdFVwZGF0ZUNoZWNrU3RhdHVzOntOT19VUERBVEU6Im5vX3VwZGF0ZSIsVEhST1RUTEVEOiJ0aHJvdHRsZWQiLFVQREFURV9BVkFJTEFCTEU6InVwZGF0ZV9hdmFpbGFibGUifX19XX0pLCgoe191dGlsc0ZuczpfdXRpbHNGbnMsX21haW5GdW5jdGlvbjpfbWFpbkZ1bmN0aW9uLF9hcmdzOl9hcmdzfSk9Pntjb25zdCB1dGlscz1PYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmVudHJpZXMoX3V0aWxzRm5zKS5tYXAoKChba2V5LHZhbHVlXSk9PltrZXksZXZhbCh2YWx1ZSldKSkpO3V0aWxzLmluaXQoKSxldmFsKF9tYWluRnVuY3Rpb24pKHV0aWxzLC4uLl9hcmdzKX0pKHtfdXRpbHNGbnM6e2luaXQ6IigpID0+IHtcbiAgdXRpbHMucHJlbG9hZENhY2hlKClcbn0iLHN0cmlwUHJveHlGcm9tRXJyb3JzOiIoaGFuZGxlciA9IHt9KSA9PiB7XG4gIGNvbnN0IG5ld0hhbmRsZXIgPSB7XG4gICAgc2V0UHJvdG90eXBlT2Y6IGZ1bmN0aW9uICh0YXJnZXQsIHByb3RvKSB7XG4gICAgICBpZiAocHJvdG8gPT09IG51bGwpXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUnKVxuICAgICAgaWYgKE9iamVjdC5nZXRQcm90b3R5cGVPZih0YXJnZXQpID09PSBPYmplY3QuZ2V0UHJvdG90eXBlT2YocHJvdG8pKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0N5Y2xpYyBfX3Byb3RvX18gdmFsdWUnKVxuICAgICAgfVxuICAgICAgcmV0dXJuIFJlZmxlY3Quc2V0UHJvdG90eXBlT2YodGFyZ2V0LCBwcm90bylcbiAgICB9XG4gIH1cbiAgLy8gV2Ugd3JhcCBlYWNoIHRyYXAgaW4gdGhlIGhhbmRsZXIgaW4gYSB0cnkvY2F0Y2ggYW5kIG1vZGlmeSB0aGUgZXJyb3Igc3RhY2sgaWYgdGhleSB0aHJvd1xuICBjb25zdCB0cmFwcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGhhbmRsZXIpXG4gIHRyYXBzLmZvckVhY2godHJhcCA9PiB7XG4gICAgbmV3SGFuZGxlclt0cmFwXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIEZvcndhcmQgdGhlIGNhbGwgdG8gdGhlIGRlZmluZWQgcHJveHkgaGFuZGxlclxuICAgICAgICByZXR1cm4gaGFuZGxlclt0cmFwXS5hcHBseSh0aGlzLCBhcmd1bWVudHMgfHwgW10pXG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgLy8gU3RhY2sgdHJhY2VzIGRpZmZlciBwZXIgYnJvd3Nlciwgd2Ugb25seSBzdXBwb3J0IGNocm9taXVtIGJhc2VkIG9uZXMgY3VycmVudGx5XG4gICAgICAgIGlmICghZXJyIHx8ICFlcnIuc3RhY2sgfHwgIWVyci5zdGFjay5pbmNsdWRlcyhgYXQgYCkpIHtcbiAgICAgICAgICB0aHJvdyBlcnJcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFdoZW4gc29tZXRoaW5nIHRocm93cyB3aXRoaW4gb25lIG9mIG91ciB0cmFwcyB0aGUgUHJveHkgd2lsbCBzaG93IHVwIGluIGVycm9yIHN0YWNrc1xuICAgICAgICAvLyBBbiBlYXJsaWVyIGltcGxlbWVudGF0aW9uIG9mIHRoaXMgY29kZSB3b3VsZCBzaW1wbHkgc3RyaXAgbGluZXMgd2l0aCBhIGJsYWNrbGlzdCxcbiAgICAgICAgLy8gYnV0IGl0IG1ha2VzIHNlbnNlIHRvIGJlIG1vcmUgc3VyZ2ljYWwgaGVyZSBhbmQgb25seSByZW1vdmUgbGluZXMgcmVsYXRlZCB0byBvdXIgUHJveHkuXG4gICAgICAgIC8vIFdlIHRyeSB0byB1c2UgYSBrbm93biBcImFuY2hvclwiIGxpbmUgZm9yIHRoYXQgYW5kIHN0cmlwIGl0IHdpdGggZXZlcnl0aGluZyBhYm92ZSBpdC5cbiAgICAgICAgLy8gSWYgdGhlIGFuY2hvciBsaW5lIGNhbm5vdCBiZSBmb3VuZCBmb3Igc29tZSByZWFzb24gd2UgZmFsbCBiYWNrIHRvIG91ciBibGFja2xpc3QgYXBwcm9hY2guXG5cbiAgICAgICAgY29uc3Qgc3RyaXBXaXRoQmxhY2tsaXN0ID0gKHN0YWNrLCBzdHJpcEZpcnN0TGluZSA9IHRydWUpID0+IHtcbiAgICAgICAgICBjb25zdCBibGFja2xpc3QgPSBbXG4gICAgICAgICAgICBgYXQgUmVmbGVjdC4ke3RyYXB9IGAsIC8vIGUuZy4gUmVmbGVjdC5nZXQgb3IgUmVmbGVjdC5hcHBseVxuICAgICAgICAgICAgYGF0IE9iamVjdC4ke3RyYXB9IGAsIC8vIGUuZy4gT2JqZWN0LmdldCBvciBPYmplY3QuYXBwbHlcbiAgICAgICAgICAgIGBhdCBPYmplY3QubmV3SGFuZGxlci48Y29tcHV0ZWQ+IFthcyAke3RyYXB9XSBgIC8vIGNhdXNlZCBieSB0aGlzIHZlcnkgd3JhcHBlciA6LSlcbiAgICAgICAgICBdXG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIGVyci5zdGFja1xuICAgICAgICAgICAgICAuc3BsaXQoJ1xcbicpXG4gICAgICAgICAgICAgIC8vIEFsd2F5cyByZW1vdmUgdGhlIGZpcnN0IChmaWxlKSBsaW5lIGluIHRoZSBzdGFjayAoZ3VhcmFudGVlZCB0byBiZSBvdXIgcHJveHkpXG4gICAgICAgICAgICAgIC5maWx0ZXIoKGxpbmUsIGluZGV4KSA9PiAhKGluZGV4ID09PSAxICYmIHN0cmlwRmlyc3RMaW5lKSlcbiAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGxpbmUgc3RhcnRzIHdpdGggb25lIG9mIG91ciBibGFja2xpc3RlZCBzdHJpbmdzXG4gICAgICAgICAgICAgIC5maWx0ZXIobGluZSA9PiAhYmxhY2tsaXN0LnNvbWUoYmwgPT4gbGluZS50cmltKCkuc3RhcnRzV2l0aChibCkpKVxuICAgICAgICAgICAgICAuam9pbignXFxuJylcbiAgICAgICAgICApXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzdHJpcFdpdGhBbmNob3IgPSAoc3RhY2ssIGFuY2hvcikgPT4ge1xuICAgICAgICAgIGNvbnN0IHN0YWNrQXJyID0gc3RhY2suc3BsaXQoJ1xcbicpXG4gICAgICAgICAgYW5jaG9yID0gYW5jaG9yIHx8IGBhdCBPYmplY3QubmV3SGFuZGxlci48Y29tcHV0ZWQ+IFthcyAke3RyYXB9XSBgIC8vIEtub3duIGZpcnN0IFByb3h5IGxpbmUgaW4gY2hyb21pdW1cbiAgICAgICAgICBjb25zdCBhbmNob3JJbmRleCA9IHN0YWNrQXJyLmZpbmRJbmRleChsaW5lID0+XG4gICAgICAgICAgICBsaW5lLnRyaW0oKS5zdGFydHNXaXRoKGFuY2hvcilcbiAgICAgICAgICApXG4gICAgICAgICAgaWYgKGFuY2hvckluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlIC8vIDQwNCwgYW5jaG9yIG5vdCBmb3VuZFxuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBTdHJpcCBldmVyeXRoaW5nIGZyb20gdGhlIHRvcCB1bnRpbCB3ZSByZWFjaCB0aGUgYW5jaG9yIGxpbmVcbiAgICAgICAgICAvLyBOb3RlOiBXZSdyZSBrZWVwaW5nIHRoZSAxc3QgbGluZSAoemVybyBpbmRleCkgYXMgaXQncyB1bnJlbGF0ZWQgKGUuZy4gYFR5cGVFcnJvcmApXG4gICAgICAgICAgc3RhY2tBcnIuc3BsaWNlKDEsIGFuY2hvckluZGV4KVxuICAgICAgICAgIHJldHVybiBzdGFja0Fyci5qb2luKCdcXG4nKVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gU3BlY2lhbCBjYXNlcyBkdWUgdG8gb3VyIG5lc3RlZCB0b1N0cmluZyBwcm94aWVzXG4gICAgICAgIGVyci5zdGFjayA9IGVyci5zdGFjay5yZXBsYWNlKFxuICAgICAgICAgICdhdCBPYmplY3QudG9TdHJpbmcgKCcsXG4gICAgICAgICAgJ2F0IEZ1bmN0aW9uLnRvU3RyaW5nICgnXG4gICAgICAgIClcbiAgICAgICAgaWYgKChlcnIuc3RhY2sgfHwgJycpLmluY2x1ZGVzKCdhdCBGdW5jdGlvbi50b1N0cmluZyAoJykpIHtcbiAgICAgICAgICBlcnIuc3RhY2sgPSBzdHJpcFdpdGhCbGFja2xpc3QoZXJyLnN0YWNrLCBmYWxzZSlcbiAgICAgICAgICB0aHJvdyBlcnJcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFRyeSB1c2luZyB0aGUgYW5jaG9yIG1ldGhvZCwgZmFsbGJhY2sgdG8gYmxhY2tsaXN0IGlmIG5lY2Vzc2FyeVxuICAgICAgICBlcnIuc3RhY2sgPSBzdHJpcFdpdGhBbmNob3IoZXJyLnN0YWNrKSB8fCBzdHJpcFdpdGhCbGFja2xpc3QoZXJyLnN0YWNrKVxuXG4gICAgICAgIHRocm93IGVyciAvLyBSZS10aHJvdyBvdXIgbm93IHNhbml0aXplZCBlcnJvclxuICAgICAgfVxuICAgIH1cbiAgfSlcbiAgcmV0dXJuIG5ld0hhbmRsZXJcbn0iLHN0cmlwRXJyb3JXaXRoQW5jaG9yOiIoZXJyLCBhbmNob3IpID0+IHtcbiAgY29uc3Qgc3RhY2tBcnIgPSBlcnIuc3RhY2suc3BsaXQoJ1xcbicpXG4gIGNvbnN0IGFuY2hvckluZGV4ID0gc3RhY2tBcnIuZmluZEluZGV4KGxpbmUgPT4gbGluZS50cmltKCkuc3RhcnRzV2l0aChhbmNob3IpKVxuICBpZiAoYW5jaG9ySW5kZXggPT09IC0xKSB7XG4gICAgcmV0dXJuIGVyciAvLyA0MDQsIGFuY2hvciBub3QgZm91bmRcbiAgfVxuICAvLyBTdHJpcCBldmVyeXRoaW5nIGZyb20gdGhlIHRvcCB1bnRpbCB3ZSByZWFjaCB0aGUgYW5jaG9yIGxpbmUgKHJlbW92ZSBhbmNob3IgbGluZSBhcyB3ZWxsKVxuICAvLyBOb3RlOiBXZSdyZSBrZWVwaW5nIHRoZSAxc3QgbGluZSAoemVybyBpbmRleCkgYXMgaXQncyB1bnJlbGF0ZWQgKGUuZy4gYFR5cGVFcnJvcmApXG4gIHN0YWNrQXJyLnNwbGljZSgxLCBhbmNob3JJbmRleClcbiAgZXJyLnN0YWNrID0gc3RhY2tBcnIuam9pbignXFxuJylcbiAgcmV0dXJuIGVyclxufSIscmVwbGFjZVByb3BlcnR5OiIob2JqLCBwcm9wTmFtZSwgZGVzY3JpcHRvck92ZXJyaWRlcyA9IHt9KSA9PiB7XG4gIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBwcm9wTmFtZSwge1xuICAgIC8vIENvcHkgb3ZlciB0aGUgZXhpc3RpbmcgZGVzY3JpcHRvcnMgKHdyaXRhYmxlLCBlbnVtZXJhYmxlLCBjb25maWd1cmFibGUsIGV0YylcbiAgICAuLi4oT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIHByb3BOYW1lKSB8fCB7fSksXG4gICAgLy8gQWRkIG91ciBvdmVycmlkZXMgKGUuZy4gdmFsdWUsIGdldCgpKVxuICAgIC4uLmRlc2NyaXB0b3JPdmVycmlkZXNcbiAgfSlcbn0iLHByZWxvYWRDYWNoZToiKCkgPT4ge1xuICBpZiAodXRpbHMuY2FjaGUpIHtcbiAgICByZXR1cm5cbiAgfVxuICB1dGlscy5jYWNoZSA9IHtcbiAgICAvLyBVc2VkIGluIG91ciBwcm94aWVzXG4gICAgUmVmbGVjdDoge1xuICAgICAgZ2V0OiBSZWZsZWN0LmdldC5iaW5kKFJlZmxlY3QpLFxuICAgICAgYXBwbHk6IFJlZmxlY3QuYXBwbHkuYmluZChSZWZsZWN0KVxuICAgIH0sXG4gICAgLy8gVXNlZCBpbiBgbWFrZU5hdGl2ZVN0cmluZ2BcbiAgICBuYXRpdmVUb1N0cmluZ1N0cjogRnVuY3Rpb24udG9TdHJpbmcgKyAnJyAvLyA9PiBgZnVuY3Rpb24gdG9TdHJpbmcoKSB7IFtuYXRpdmUgY29kZV0gfWBcbiAgfVxufSIsbWFrZU5hdGl2ZVN0cmluZzoiKG5hbWUgPSAnJykgPT4ge1xuICByZXR1cm4gdXRpbHMuY2FjaGUubmF0aXZlVG9TdHJpbmdTdHIucmVwbGFjZSgndG9TdHJpbmcnLCBuYW1lIHx8ICcnKVxufSIscGF0Y2hUb1N0cmluZzoiKG9iaiwgc3RyID0gJycpID0+IHtcbiAgY29uc3QgaGFuZGxlciA9IHtcbiAgICBhcHBseTogZnVuY3Rpb24gKHRhcmdldCwgY3R4KSB7XG4gICAgICAvLyBUaGlzIGZpeGVzIGUuZy4gYEhUTUxNZWRpYUVsZW1lbnQucHJvdG90eXBlLmNhblBsYXlUeXBlLnRvU3RyaW5nICsgXCJcImBcbiAgICAgIGlmIChjdHggPT09IEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZykge1xuICAgICAgICByZXR1cm4gdXRpbHMubWFrZU5hdGl2ZVN0cmluZygndG9TdHJpbmcnKVxuICAgICAgfVxuICAgICAgLy8gYHRvU3RyaW5nYCB0YXJnZXRlZCBhdCBvdXIgcHJveGllZCBPYmplY3QgZGV0ZWN0ZWRcbiAgICAgIGlmIChjdHggPT09IG9iaikge1xuICAgICAgICAvLyBXZSBlaXRoZXIgcmV0dXJuIHRoZSBvcHRpb25hbCBzdHJpbmcgdmVyYmF0aW0gb3IgZGVyaXZlIHRoZSBtb3N0IGRlc2lyZWQgcmVzdWx0IGF1dG9tYXRpY2FsbHlcbiAgICAgICAgcmV0dXJuIHN0ciB8fCB1dGlscy5tYWtlTmF0aXZlU3RyaW5nKG9iai5uYW1lKVxuICAgICAgfVxuICAgICAgLy8gQ2hlY2sgaWYgdGhlIHRvU3RyaW5nIHByb3R5cGUgb2YgdGhlIGNvbnRleHQgaXMgdGhlIHNhbWUgYXMgdGhlIGdsb2JhbCBwcm90b3R5cGUsXG4gICAgICAvLyBpZiBub3QgaW5kaWNhdGVzIHRoYXQgd2UgYXJlIGRvaW5nIGEgY2hlY2sgYWNyb3NzIGRpZmZlcmVudCB3aW5kb3dzLiwgZS5nLiB0aGUgaWZyYW1lV2l0aGRpcmVjdGAgdGVzdCBjYXNlXG4gICAgICBjb25zdCBoYXNTYW1lUHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YoXG4gICAgICAgIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZ1xuICAgICAgKS5pc1Byb3RvdHlwZU9mKGN0eC50b1N0cmluZykgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1wcm90b3R5cGUtYnVpbHRpbnNcbiAgICAgIGlmICghaGFzU2FtZVByb3RvKSB7XG4gICAgICAgIC8vIFBhc3MgdGhlIGNhbGwgb24gdG8gdGhlIGxvY2FsIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZyBpbnN0ZWFkXG4gICAgICAgIHJldHVybiBjdHgudG9TdHJpbmcoKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRhcmdldC5jYWxsKGN0eClcbiAgICB9XG4gIH1cblxuICBjb25zdCB0b1N0cmluZ1Byb3h5ID0gbmV3IFByb3h5KFxuICAgIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZyxcbiAgICB1dGlscy5zdHJpcFByb3h5RnJvbUVycm9ycyhoYW5kbGVyKVxuICApXG4gIHV0aWxzLnJlcGxhY2VQcm9wZXJ0eShGdW5jdGlvbi5wcm90b3R5cGUsICd0b1N0cmluZycsIHtcbiAgICB2YWx1ZTogdG9TdHJpbmdQcm94eVxuICB9KVxufSIscGF0Y2hUb1N0cmluZ05lc3RlZDoiKG9iaiA9IHt9KSA9PiB7XG4gIHJldHVybiB1dGlscy5leGVjUmVjdXJzaXZlbHkob2JqLCBbJ2Z1bmN0aW9uJ10sIHV0aWxzLnBhdGNoVG9TdHJpbmcpXG59IixyZWRpcmVjdFRvU3RyaW5nOiIocHJveHlPYmosIG9yaWdpbmFsT2JqKSA9PiB7XG4gIGNvbnN0IGhhbmRsZXIgPSB7XG4gICAgYXBwbHk6IGZ1bmN0aW9uICh0YXJnZXQsIGN0eCkge1xuICAgICAgLy8gVGhpcyBmaXhlcyBlLmcuIGBIVE1MTWVkaWFFbGVtZW50LnByb3RvdHlwZS5jYW5QbGF5VHlwZS50b1N0cmluZyArIFwiXCJgXG4gICAgICBpZiAoY3R4ID09PSBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHV0aWxzLm1ha2VOYXRpdmVTdHJpbmcoJ3RvU3RyaW5nJylcbiAgICAgIH1cblxuICAgICAgLy8gYHRvU3RyaW5nYCB0YXJnZXRlZCBhdCBvdXIgcHJveGllZCBPYmplY3QgZGV0ZWN0ZWRcbiAgICAgIGlmIChjdHggPT09IHByb3h5T2JqKSB7XG4gICAgICAgIGNvbnN0IGZhbGxiYWNrID0gKCkgPT5cbiAgICAgICAgICBvcmlnaW5hbE9iaiAmJiBvcmlnaW5hbE9iai5uYW1lXG4gICAgICAgICAgICA/IHV0aWxzLm1ha2VOYXRpdmVTdHJpbmcob3JpZ2luYWxPYmoubmFtZSlcbiAgICAgICAgICAgIDogdXRpbHMubWFrZU5hdGl2ZVN0cmluZyhwcm94eU9iai5uYW1lKVxuXG4gICAgICAgIC8vIFJldHVybiB0aGUgdG9TdHJpbmcgcmVwcmVzZW50YXRpb24gb2Ygb3VyIG9yaWdpbmFsIG9iamVjdCBpZiBwb3NzaWJsZVxuICAgICAgICByZXR1cm4gb3JpZ2luYWxPYmogKyAnJyB8fCBmYWxsYmFjaygpXG4gICAgICB9XG5cbiAgICAgIGlmICh0eXBlb2YgY3R4ID09PSAndW5kZWZpbmVkJyB8fCBjdHggPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHRhcmdldC5jYWxsKGN0eClcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgdGhlIHRvU3RyaW5nIHByb3R5cGUgb2YgdGhlIGNvbnRleHQgaXMgdGhlIHNhbWUgYXMgdGhlIGdsb2JhbCBwcm90b3R5cGUsXG4gICAgICAvLyBpZiBub3QgaW5kaWNhdGVzIHRoYXQgd2UgYXJlIGRvaW5nIGEgY2hlY2sgYWNyb3NzIGRpZmZlcmVudCB3aW5kb3dzLiwgZS5nLiB0aGUgaWZyYW1lV2l0aGRpcmVjdGAgdGVzdCBjYXNlXG4gICAgICBjb25zdCBoYXNTYW1lUHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YoXG4gICAgICAgIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZ1xuICAgICAgKS5pc1Byb3RvdHlwZU9mKGN0eC50b1N0cmluZykgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1wcm90b3R5cGUtYnVpbHRpbnNcbiAgICAgIGlmICghaGFzU2FtZVByb3RvKSB7XG4gICAgICAgIC8vIFBhc3MgdGhlIGNhbGwgb24gdG8gdGhlIGxvY2FsIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZyBpbnN0ZWFkXG4gICAgICAgIHJldHVybiBjdHgudG9TdHJpbmcoKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGFyZ2V0LmNhbGwoY3R4KVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHRvU3RyaW5nUHJveHkgPSBuZXcgUHJveHkoXG4gICAgRnVuY3Rpb24ucHJvdG90eXBlLnRvU3RyaW5nLFxuICAgIHV0aWxzLnN0cmlwUHJveHlGcm9tRXJyb3JzKGhhbmRsZXIpXG4gIClcbiAgdXRpbHMucmVwbGFjZVByb3BlcnR5KEZ1bmN0aW9uLnByb3RvdHlwZSwgJ3RvU3RyaW5nJywge1xuICAgIHZhbHVlOiB0b1N0cmluZ1Byb3h5XG4gIH0pXG59IixyZXBsYWNlV2l0aFByb3h5OiIob2JqLCBwcm9wTmFtZSwgaGFuZGxlcikgPT4ge1xuICBjb25zdCBvcmlnaW5hbE9iaiA9IG9ialtwcm9wTmFtZV1cbiAgY29uc3QgcHJveHlPYmogPSBuZXcgUHJveHkob2JqW3Byb3BOYW1lXSwgdXRpbHMuc3RyaXBQcm94eUZyb21FcnJvcnMoaGFuZGxlcikpXG5cbiAgdXRpbHMucmVwbGFjZVByb3BlcnR5KG9iaiwgcHJvcE5hbWUsIHsgdmFsdWU6IHByb3h5T2JqIH0pXG4gIHV0aWxzLnJlZGlyZWN0VG9TdHJpbmcocHJveHlPYmosIG9yaWdpbmFsT2JqKVxuXG4gIHJldHVybiB0cnVlXG59IixyZXBsYWNlR2V0dGVyV2l0aFByb3h5OiIob2JqLCBwcm9wTmFtZSwgaGFuZGxlcikgPT4ge1xuICBjb25zdCBmbiA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBwcm9wTmFtZSkuZ2V0XG4gIGNvbnN0IGZuU3RyID0gZm4udG9TdHJpbmcoKSAvLyBzcGVjaWFsIGdldHRlciBmdW5jdGlvbiBzdHJpbmdcbiAgY29uc3QgcHJveHlPYmogPSBuZXcgUHJveHkoZm4sIHV0aWxzLnN0cmlwUHJveHlGcm9tRXJyb3JzKGhhbmRsZXIpKVxuXG4gIHV0aWxzLnJlcGxhY2VQcm9wZXJ0eShvYmosIHByb3BOYW1lLCB7IGdldDogcHJveHlPYmogfSlcbiAgdXRpbHMucGF0Y2hUb1N0cmluZyhwcm94eU9iaiwgZm5TdHIpXG5cbiAgcmV0dXJuIHRydWVcbn0iLG1vY2tXaXRoUHJveHk6IihvYmosIHByb3BOYW1lLCBwc2V1ZG9UYXJnZXQsIGhhbmRsZXIpID0+IHtcbiAgY29uc3QgcHJveHlPYmogPSBuZXcgUHJveHkocHNldWRvVGFyZ2V0LCB1dGlscy5zdHJpcFByb3h5RnJvbUVycm9ycyhoYW5kbGVyKSlcblxuICB1dGlscy5yZXBsYWNlUHJvcGVydHkob2JqLCBwcm9wTmFtZSwgeyB2YWx1ZTogcHJveHlPYmogfSlcbiAgdXRpbHMucGF0Y2hUb1N0cmluZyhwcm94eU9iailcblxuICByZXR1cm4gdHJ1ZVxufSIsY3JlYXRlUHJveHk6Iihwc2V1ZG9UYXJnZXQsIGhhbmRsZXIpID0+IHtcbiAgY29uc3QgcHJveHlPYmogPSBuZXcgUHJveHkocHNldWRvVGFyZ2V0LCB1dGlscy5zdHJpcFByb3h5RnJvbUVycm9ycyhoYW5kbGVyKSlcbiAgdXRpbHMucGF0Y2hUb1N0cmluZyhwcm94eU9iailcblxuICByZXR1cm4gcHJveHlPYmpcbn0iLHNwbGl0T2JqUGF0aDoib2JqUGF0aCA9PiAoe1xuICAvLyBSZW1vdmUgbGFzdCBkb3QgZW50cnkgKHByb3BlcnR5KSA9PT4gYEhUTUxNZWRpYUVsZW1lbnQucHJvdG90eXBlYFxuICBvYmpOYW1lOiBvYmpQYXRoLnNwbGl0KCcuJykuc2xpY2UoMCwgLTEpLmpvaW4oJy4nKSxcbiAgLy8gRXh0cmFjdCBsYXN0IGRvdCBlbnRyeSA9PT4gYGNhblBsYXlUeXBlYFxuICBwcm9wTmFtZTogb2JqUGF0aC5zcGxpdCgnLicpLnNsaWNlKC0xKVswXVxufSkiLHJlcGxhY2VPYmpQYXRoV2l0aFByb3h5OiIob2JqUGF0aCwgaGFuZGxlcikgPT4ge1xuICBjb25zdCB7IG9iak5hbWUsIHByb3BOYW1lIH0gPSB1dGlscy5zcGxpdE9ialBhdGgob2JqUGF0aClcbiAgY29uc3Qgb2JqID0gZXZhbChvYmpOYW1lKSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWV2YWxcbiAgcmV0dXJuIHV0aWxzLnJlcGxhY2VXaXRoUHJveHkob2JqLCBwcm9wTmFtZSwgaGFuZGxlcilcbn0iLGV4ZWNSZWN1cnNpdmVseToiKG9iaiA9IHt9LCB0eXBlRmlsdGVyID0gW10sIGZuKSA9PiB7XG4gIGZ1bmN0aW9uIHJlY3Vyc2Uob2JqKSB7XG4gICAgZm9yIChjb25zdCBrZXkgaW4gb2JqKSB7XG4gICAgICBpZiAob2JqW2tleV0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb250aW51ZVxuICAgICAgfVxuICAgICAgaWYgKG9ialtrZXldICYmIHR5cGVvZiBvYmpba2V5XSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgcmVjdXJzZShvYmpba2V5XSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChvYmpba2V5XSAmJiB0eXBlRmlsdGVyLmluY2x1ZGVzKHR5cGVvZiBvYmpba2V5XSkpIHtcbiAgICAgICAgICBmbi5jYWxsKHRoaXMsIG9ialtrZXldKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJlY3Vyc2Uob2JqKVxuICByZXR1cm4gb2JqXG59IixzdHJpbmdpZnlGbnM6Iihmbk9iaiA9IHsgaGVsbG86ICgpID0+ICd3b3JsZCcgfSkgPT4ge1xuICAvLyBPYmplY3QuZnJvbUVudHJpZXMoKSBwb255ZmlsbCAoaW4gNiBsaW5lcykgLSBzdXBwb3J0ZWQgb25seSBpbiBOb2RlIHYxMissIG1vZGVybiBicm93c2VycyBhcmUgZmluZVxuICAvLyBodHRwczovL2dpdGh1Yi5jb20vZmVyb3NzL2Zyb21lbnRyaWVzXG4gIGZ1bmN0aW9uIGZyb21FbnRyaWVzKGl0ZXJhYmxlKSB7XG4gICAgcmV0dXJuIFsuLi5pdGVyYWJsZV0ucmVkdWNlKChvYmosIFtrZXksIHZhbF0pID0+IHtcbiAgICAgIG9ialtrZXldID0gdmFsXG4gICAgICByZXR1cm4gb2JqXG4gICAgfSwge30pXG4gIH1cbiAgcmV0dXJuIChPYmplY3QuZnJvbUVudHJpZXMgfHwgZnJvbUVudHJpZXMpKFxuICAgIE9iamVjdC5lbnRyaWVzKGZuT2JqKVxuICAgICAgLmZpbHRlcigoW2tleSwgdmFsdWVdKSA9PiB0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpXG4gICAgICAubWFwKChba2V5LCB2YWx1ZV0pID0+IFtrZXksIHZhbHVlLnRvU3RyaW5nKCldKSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWV2YWxcbiAgKVxufSIsbWF0ZXJpYWxpemVGbnM6IihmblN0ck9iaiA9IHsgaGVsbG86IFwiKCkgPT4gJ3dvcmxkJ1wiIH0pID0+IHtcbiAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICBPYmplY3QuZW50cmllcyhmblN0ck9iaikubWFwKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgIGlmICh2YWx1ZS5zdGFydHNXaXRoKCdmdW5jdGlvbicpKSB7XG4gICAgICAgIC8vIHNvbWUgdHJpY2tlcnkgaXMgbmVlZGVkIHRvIG1ha2Ugb2xkc2Nob29sIGZ1bmN0aW9ucyB3b3JrIDotKVxuICAgICAgICByZXR1cm4gW2tleSwgZXZhbChgKCkgPT4gJHt2YWx1ZX1gKSgpXSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWV2YWxcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGFycm93IGZ1bmN0aW9ucyBqdXN0IHdvcmtcbiAgICAgICAgcmV0dXJuIFtrZXksIGV2YWwodmFsdWUpXSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWV2YWxcbiAgICAgIH1cbiAgICB9KVxuICApXG59IixtYWtlSGFuZGxlcjoiKCkgPT4gKHtcbiAgLy8gVXNlZCBieSBzaW1wbGUgYG5hdmlnYXRvcmAgZ2V0dGVyIGV2YXNpb25zXG4gIGdldHRlclZhbHVlOiB2YWx1ZSA9PiAoe1xuICAgIGFwcGx5KHRhcmdldCwgY3R4LCBhcmdzKSB7XG4gICAgICAvLyBMZXQncyBmZXRjaCB0aGUgdmFsdWUgZmlyc3QsIHRvIHRyaWdnZXIgYW5kIGVzY2FsYXRlIHBvdGVudGlhbCBlcnJvcnNcbiAgICAgIC8vIElsbGVnYWwgaW52b2NhdGlvbnMgbGlrZSBgbmF2aWdhdG9yLl9fcHJvdG9fXy52ZW5kb3JgIHdpbGwgdGhyb3cgaGVyZVxuICAgICAgdXRpbHMuY2FjaGUuUmVmbGVjdC5hcHBseSguLi5hcmd1bWVudHMpXG4gICAgICByZXR1cm4gdmFsdWVcbiAgICB9XG4gIH0pXG59KSJ9LF9tYWluRnVuY3Rpb246InV0aWxzID0+IHtcbiAgICAgIC8qKlxuICAgICAgICogSW5wdXQgbWlnaHQgbG9vayBmdW5reSwgd2UgbmVlZCB0byBub3JtYWxpemUgaXQgc28gZS5nLiB3aGl0ZXNwYWNlIGlzbid0IGFuIGlzc3VlIGZvciBvdXIgc3Bvb2ZpbmcuXG4gICAgICAgKlxuICAgICAgICogQGV4YW1wbGVcbiAgICAgICAqIHZpZGVvL3dlYm07IGNvZGVjcz1cInZwOCwgdm9yYmlzXCJcbiAgICAgICAqIHZpZGVvL21wNDsgY29kZWNzPVwiYXZjMS40MkUwMUVcIlxuICAgICAgICogYXVkaW8veC1tNGE7XG4gICAgICAgKiBhdWRpby9vZ2c7IGNvZGVjcz1cInZvcmJpc1wiXG4gICAgICAgKiBAcGFyYW0ge1N0cmluZ30gYXJnXG4gICAgICAgKi9cbiAgICAgIGNvbnN0IHBhcnNlSW5wdXQgPSBhcmcgPT4ge1xuICAgICAgICBjb25zdCBbbWltZSwgY29kZWNTdHJdID0gYXJnLnRyaW0oKS5zcGxpdCgnOycpXG4gICAgICAgIGxldCBjb2RlY3MgPSBbXVxuICAgICAgICBpZiAoY29kZWNTdHIgJiYgY29kZWNTdHIuaW5jbHVkZXMoJ2NvZGVjcz1cIicpKSB7XG4gICAgICAgICAgY29kZWNzID0gY29kZWNTdHJcbiAgICAgICAgICAgIC50cmltKClcbiAgICAgICAgICAgIC5yZXBsYWNlKGBjb2RlY3M9XCJgLCAnJylcbiAgICAgICAgICAgIC5yZXBsYWNlKGBcImAsICcnKVxuICAgICAgICAgICAgLnRyaW0oKVxuICAgICAgICAgICAgLnNwbGl0KCcsJylcbiAgICAgICAgICAgIC5maWx0ZXIoeCA9PiAhIXgpXG4gICAgICAgICAgICAubWFwKHggPT4geC50cmltKCkpXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtaW1lLFxuICAgICAgICAgIGNvZGVjU3RyLFxuICAgICAgICAgIGNvZGVjc1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGNhblBsYXlUeXBlID0ge1xuICAgICAgICAvLyBJbnRlcmNlcHQgY2VydGFpbiByZXF1ZXN0c1xuICAgICAgICBhcHBseTogZnVuY3Rpb24odGFyZ2V0LCBjdHgsIGFyZ3MpIHtcbiAgICAgICAgICBpZiAoIWFyZ3MgfHwgIWFyZ3MubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGFyZ2V0LmFwcGx5KGN0eCwgYXJncylcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgeyBtaW1lLCBjb2RlY3MgfSA9IHBhcnNlSW5wdXQoYXJnc1swXSlcbiAgICAgICAgICAvLyBUaGlzIHNwZWNpZmljIG1wNCBjb2RlYyBpcyBtaXNzaW5nIGluIENocm9taXVtXG4gICAgICAgICAgaWYgKG1pbWUgPT09ICd2aWRlby9tcDQnKSB7XG4gICAgICAgICAgICBpZiAoY29kZWNzLmluY2x1ZGVzKCdhdmMxLjQyRTAxRScpKSB7XG4gICAgICAgICAgICAgIHJldHVybiAncHJvYmFibHknXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIFRoaXMgbWltZXR5cGUgaXMgb25seSBzdXBwb3J0ZWQgaWYgbm8gY29kZWNzIGFyZSBzcGVjaWZpZWRcbiAgICAgICAgICBpZiAobWltZSA9PT0gJ2F1ZGlvL3gtbTRhJyAmJiAhY29kZWNzLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuICdtYXliZSdcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBUaGlzIG1pbWV0eXBlIGlzIG9ubHkgc3VwcG9ydGVkIGlmIG5vIGNvZGVjcyBhcmUgc3BlY2lmaWVkXG4gICAgICAgICAgaWYgKG1pbWUgPT09ICdhdWRpby9hYWMnICYmICFjb2RlY3MubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gJ3Byb2JhYmx5J1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBFdmVyeXRoaW5nIGVsc2UgYXMgdXN1YWxcbiAgICAgICAgICByZXR1cm4gdGFyZ2V0LmFwcGx5KGN0eCwgYXJncylcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvKiBnbG9iYWwgSFRNTE1lZGlhRWxlbWVudCAqL1xuICAgICAgdXRpbHMucmVwbGFjZVdpdGhQcm94eShcbiAgICAgICAgSFRNTE1lZGlhRWxlbWVudC5wcm90b3R5cGUsXG4gICAgICAgICdjYW5QbGF5VHlwZScsXG4gICAgICAgIGNhblBsYXlUeXBlXG4gICAgICApXG4gICAgfSIsX2FyZ3M6W119KSwoKHtfdXRpbHNGbnM6X3V0aWxzRm5zLF9tYWluRnVuY3Rpb246X21haW5GdW5jdGlvbixfYXJnczpfYXJnc30pPT57Y29uc3QgdXRpbHM9T2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5lbnRyaWVzKF91dGlsc0ZucykubWFwKCgoW2tleSx2YWx1ZV0pPT5ba2V5LGV2YWwodmFsdWUpXSkpKTt1dGlscy5pbml0KCksZXZhbChfbWFpbkZ1bmN0aW9uKSh1dGlscywuLi5fYXJncyl9KSh7X3V0aWxzRm5zOntpbml0OiIoKSA9PiB7XG4gIHV0aWxzLnByZWxvYWRDYWNoZSgpXG59IixzdHJpcFByb3h5RnJvbUVycm9yczoiKGhhbmRsZXIgPSB7fSkgPT4ge1xuICBjb25zdCBuZXdIYW5kbGVyID0ge1xuICAgIHNldFByb3RvdHlwZU9mOiBmdW5jdGlvbiAodGFyZ2V0LCBwcm90bykge1xuICAgICAgaWYgKHByb3RvID09PSBudWxsKVxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY29udmVydCBvYmplY3QgdG8gcHJpbWl0aXZlIHZhbHVlJylcbiAgICAgIGlmIChPYmplY3QuZ2V0UHJvdG90eXBlT2YodGFyZ2V0KSA9PT0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHByb3RvKSkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdDeWNsaWMgX19wcm90b19fIHZhbHVlJylcbiAgICAgIH1cbiAgICAgIHJldHVybiBSZWZsZWN0LnNldFByb3RvdHlwZU9mKHRhcmdldCwgcHJvdG8pXG4gICAgfVxuICB9XG4gIC8vIFdlIHdyYXAgZWFjaCB0cmFwIGluIHRoZSBoYW5kbGVyIGluIGEgdHJ5L2NhdGNoIGFuZCBtb2RpZnkgdGhlIGVycm9yIHN0YWNrIGlmIHRoZXkgdGhyb3dcbiAgY29uc3QgdHJhcHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhoYW5kbGVyKVxuICB0cmFwcy5mb3JFYWNoKHRyYXAgPT4ge1xuICAgIG5ld0hhbmRsZXJbdHJhcF0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyBGb3J3YXJkIHRoZSBjYWxsIHRvIHRoZSBkZWZpbmVkIHByb3h5IGhhbmRsZXJcbiAgICAgICAgcmV0dXJuIGhhbmRsZXJbdHJhcF0uYXBwbHkodGhpcywgYXJndW1lbnRzIHx8IFtdKVxuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIC8vIFN0YWNrIHRyYWNlcyBkaWZmZXIgcGVyIGJyb3dzZXIsIHdlIG9ubHkgc3VwcG9ydCBjaHJvbWl1bSBiYXNlZCBvbmVzIGN1cnJlbnRseVxuICAgICAgICBpZiAoIWVyciB8fCAhZXJyLnN0YWNrIHx8ICFlcnIuc3RhY2suaW5jbHVkZXMoYGF0IGApKSB7XG4gICAgICAgICAgdGhyb3cgZXJyXG4gICAgICAgIH1cblxuICAgICAgICAvLyBXaGVuIHNvbWV0aGluZyB0aHJvd3Mgd2l0aGluIG9uZSBvZiBvdXIgdHJhcHMgdGhlIFByb3h5IHdpbGwgc2hvdyB1cCBpbiBlcnJvciBzdGFja3NcbiAgICAgICAgLy8gQW4gZWFybGllciBpbXBsZW1lbnRhdGlvbiBvZiB0aGlzIGNvZGUgd291bGQgc2ltcGx5IHN0cmlwIGxpbmVzIHdpdGggYSBibGFja2xpc3QsXG4gICAgICAgIC8vIGJ1dCBpdCBtYWtlcyBzZW5zZSB0byBiZSBtb3JlIHN1cmdpY2FsIGhlcmUgYW5kIG9ubHkgcmVtb3ZlIGxpbmVzIHJlbGF0ZWQgdG8gb3VyIFByb3h5LlxuICAgICAgICAvLyBXZSB0cnkgdG8gdXNlIGEga25vd24gXCJhbmNob3JcIiBsaW5lIGZvciB0aGF0IGFuZCBzdHJpcCBpdCB3aXRoIGV2ZXJ5dGhpbmcgYWJvdmUgaXQuXG4gICAgICAgIC8vIElmIHRoZSBhbmNob3IgbGluZSBjYW5ub3QgYmUgZm91bmQgZm9yIHNvbWUgcmVhc29uIHdlIGZhbGwgYmFjayB0byBvdXIgYmxhY2tsaXN0IGFwcHJvYWNoLlxuXG4gICAgICAgIGNvbnN0IHN0cmlwV2l0aEJsYWNrbGlzdCA9IChzdGFjaywgc3RyaXBGaXJzdExpbmUgPSB0cnVlKSA9PiB7XG4gICAgICAgICAgY29uc3QgYmxhY2tsaXN0ID0gW1xuICAgICAgICAgICAgYGF0IFJlZmxlY3QuJHt0cmFwfSBgLCAvLyBlLmcuIFJlZmxlY3QuZ2V0IG9yIFJlZmxlY3QuYXBwbHlcbiAgICAgICAgICAgIGBhdCBPYmplY3QuJHt0cmFwfSBgLCAvLyBlLmcuIE9iamVjdC5nZXQgb3IgT2JqZWN0LmFwcGx5XG4gICAgICAgICAgICBgYXQgT2JqZWN0Lm5ld0hhbmRsZXIuPGNvbXB1dGVkPiBbYXMgJHt0cmFwfV0gYCAvLyBjYXVzZWQgYnkgdGhpcyB2ZXJ5IHdyYXBwZXIgOi0pXG4gICAgICAgICAgXVxuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICBlcnIuc3RhY2tcbiAgICAgICAgICAgICAgLnNwbGl0KCdcXG4nKVxuICAgICAgICAgICAgICAvLyBBbHdheXMgcmVtb3ZlIHRoZSBmaXJzdCAoZmlsZSkgbGluZSBpbiB0aGUgc3RhY2sgKGd1YXJhbnRlZWQgdG8gYmUgb3VyIHByb3h5KVxuICAgICAgICAgICAgICAuZmlsdGVyKChsaW5lLCBpbmRleCkgPT4gIShpbmRleCA9PT0gMSAmJiBzdHJpcEZpcnN0TGluZSkpXG4gICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBsaW5lIHN0YXJ0cyB3aXRoIG9uZSBvZiBvdXIgYmxhY2tsaXN0ZWQgc3RyaW5nc1xuICAgICAgICAgICAgICAuZmlsdGVyKGxpbmUgPT4gIWJsYWNrbGlzdC5zb21lKGJsID0+IGxpbmUudHJpbSgpLnN0YXJ0c1dpdGgoYmwpKSlcbiAgICAgICAgICAgICAgLmpvaW4oJ1xcbicpXG4gICAgICAgICAgKVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc3RyaXBXaXRoQW5jaG9yID0gKHN0YWNrLCBhbmNob3IpID0+IHtcbiAgICAgICAgICBjb25zdCBzdGFja0FyciA9IHN0YWNrLnNwbGl0KCdcXG4nKVxuICAgICAgICAgIGFuY2hvciA9IGFuY2hvciB8fCBgYXQgT2JqZWN0Lm5ld0hhbmRsZXIuPGNvbXB1dGVkPiBbYXMgJHt0cmFwfV0gYCAvLyBLbm93biBmaXJzdCBQcm94eSBsaW5lIGluIGNocm9taXVtXG4gICAgICAgICAgY29uc3QgYW5jaG9ySW5kZXggPSBzdGFja0Fyci5maW5kSW5kZXgobGluZSA9PlxuICAgICAgICAgICAgbGluZS50cmltKCkuc3RhcnRzV2l0aChhbmNob3IpXG4gICAgICAgICAgKVxuICAgICAgICAgIGlmIChhbmNob3JJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZSAvLyA0MDQsIGFuY2hvciBub3QgZm91bmRcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gU3RyaXAgZXZlcnl0aGluZyBmcm9tIHRoZSB0b3AgdW50aWwgd2UgcmVhY2ggdGhlIGFuY2hvciBsaW5lXG4gICAgICAgICAgLy8gTm90ZTogV2UncmUga2VlcGluZyB0aGUgMXN0IGxpbmUgKHplcm8gaW5kZXgpIGFzIGl0J3MgdW5yZWxhdGVkIChlLmcuIGBUeXBlRXJyb3JgKVxuICAgICAgICAgIHN0YWNrQXJyLnNwbGljZSgxLCBhbmNob3JJbmRleClcbiAgICAgICAgICByZXR1cm4gc3RhY2tBcnIuam9pbignXFxuJylcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNwZWNpYWwgY2FzZXMgZHVlIHRvIG91ciBuZXN0ZWQgdG9TdHJpbmcgcHJveGllc1xuICAgICAgICBlcnIuc3RhY2sgPSBlcnIuc3RhY2sucmVwbGFjZShcbiAgICAgICAgICAnYXQgT2JqZWN0LnRvU3RyaW5nICgnLFxuICAgICAgICAgICdhdCBGdW5jdGlvbi50b1N0cmluZyAoJ1xuICAgICAgICApXG4gICAgICAgIGlmICgoZXJyLnN0YWNrIHx8ICcnKS5pbmNsdWRlcygnYXQgRnVuY3Rpb24udG9TdHJpbmcgKCcpKSB7XG4gICAgICAgICAgZXJyLnN0YWNrID0gc3RyaXBXaXRoQmxhY2tsaXN0KGVyci5zdGFjaywgZmFsc2UpXG4gICAgICAgICAgdGhyb3cgZXJyXG4gICAgICAgIH1cblxuICAgICAgICAvLyBUcnkgdXNpbmcgdGhlIGFuY2hvciBtZXRob2QsIGZhbGxiYWNrIHRvIGJsYWNrbGlzdCBpZiBuZWNlc3NhcnlcbiAgICAgICAgZXJyLnN0YWNrID0gc3RyaXBXaXRoQW5jaG9yKGVyci5zdGFjaykgfHwgc3RyaXBXaXRoQmxhY2tsaXN0KGVyci5zdGFjaylcblxuICAgICAgICB0aHJvdyBlcnIgLy8gUmUtdGhyb3cgb3VyIG5vdyBzYW5pdGl6ZWQgZXJyb3JcbiAgICAgIH1cbiAgICB9XG4gIH0pXG4gIHJldHVybiBuZXdIYW5kbGVyXG59IixzdHJpcEVycm9yV2l0aEFuY2hvcjoiKGVyciwgYW5jaG9yKSA9PiB7XG4gIGNvbnN0IHN0YWNrQXJyID0gZXJyLnN0YWNrLnNwbGl0KCdcXG4nKVxuICBjb25zdCBhbmNob3JJbmRleCA9IHN0YWNrQXJyLmZpbmRJbmRleChsaW5lID0+IGxpbmUudHJpbSgpLnN0YXJ0c1dpdGgoYW5jaG9yKSlcbiAgaWYgKGFuY2hvckluZGV4ID09PSAtMSkge1xuICAgIHJldHVybiBlcnIgLy8gNDA0LCBhbmNob3Igbm90IGZvdW5kXG4gIH1cbiAgLy8gU3RyaXAgZXZlcnl0aGluZyBmcm9tIHRoZSB0b3AgdW50aWwgd2UgcmVhY2ggdGhlIGFuY2hvciBsaW5lIChyZW1vdmUgYW5jaG9yIGxpbmUgYXMgd2VsbClcbiAgLy8gTm90ZTogV2UncmUga2VlcGluZyB0aGUgMXN0IGxpbmUgKHplcm8gaW5kZXgpIGFzIGl0J3MgdW5yZWxhdGVkIChlLmcuIGBUeXBlRXJyb3JgKVxuICBzdGFja0Fyci5zcGxpY2UoMSwgYW5jaG9ySW5kZXgpXG4gIGVyci5zdGFjayA9IHN0YWNrQXJyLmpvaW4oJ1xcbicpXG4gIHJldHVybiBlcnJcbn0iLHJlcGxhY2VQcm9wZXJ0eToiKG9iaiwgcHJvcE5hbWUsIGRlc2NyaXB0b3JPdmVycmlkZXMgPSB7fSkgPT4ge1xuICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwgcHJvcE5hbWUsIHtcbiAgICAvLyBDb3B5IG92ZXIgdGhlIGV4aXN0aW5nIGRlc2NyaXB0b3JzICh3cml0YWJsZSwgZW51bWVyYWJsZSwgY29uZmlndXJhYmxlLCBldGMpXG4gICAgLi4uKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBwcm9wTmFtZSkgfHwge30pLFxuICAgIC8vIEFkZCBvdXIgb3ZlcnJpZGVzIChlLmcuIHZhbHVlLCBnZXQoKSlcbiAgICAuLi5kZXNjcmlwdG9yT3ZlcnJpZGVzXG4gIH0pXG59IixwcmVsb2FkQ2FjaGU6IigpID0+IHtcbiAgaWYgKHV0aWxzLmNhY2hlKSB7XG4gICAgcmV0dXJuXG4gIH1cbiAgdXRpbHMuY2FjaGUgPSB7XG4gICAgLy8gVXNlZCBpbiBvdXIgcHJveGllc1xuICAgIFJlZmxlY3Q6IHtcbiAgICAgIGdldDogUmVmbGVjdC5nZXQuYmluZChSZWZsZWN0KSxcbiAgICAgIGFwcGx5OiBSZWZsZWN0LmFwcGx5LmJpbmQoUmVmbGVjdClcbiAgICB9LFxuICAgIC8vIFVzZWQgaW4gYG1ha2VOYXRpdmVTdHJpbmdgXG4gICAgbmF0aXZlVG9TdHJpbmdTdHI6IEZ1bmN0aW9uLnRvU3RyaW5nICsgJycgLy8gPT4gYGZ1bmN0aW9uIHRvU3RyaW5nKCkgeyBbbmF0aXZlIGNvZGVdIH1gXG4gIH1cbn0iLG1ha2VOYXRpdmVTdHJpbmc6IihuYW1lID0gJycpID0+IHtcbiAgcmV0dXJuIHV0aWxzLmNhY2hlLm5hdGl2ZVRvU3RyaW5nU3RyLnJlcGxhY2UoJ3RvU3RyaW5nJywgbmFtZSB8fCAnJylcbn0iLHBhdGNoVG9TdHJpbmc6IihvYmosIHN0ciA9ICcnKSA9PiB7XG4gIGNvbnN0IGhhbmRsZXIgPSB7XG4gICAgYXBwbHk6IGZ1bmN0aW9uICh0YXJnZXQsIGN0eCkge1xuICAgICAgLy8gVGhpcyBmaXhlcyBlLmcuIGBIVE1MTWVkaWFFbGVtZW50LnByb3RvdHlwZS5jYW5QbGF5VHlwZS50b1N0cmluZyArIFwiXCJgXG4gICAgICBpZiAoY3R4ID09PSBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHV0aWxzLm1ha2VOYXRpdmVTdHJpbmcoJ3RvU3RyaW5nJylcbiAgICAgIH1cbiAgICAgIC8vIGB0b1N0cmluZ2AgdGFyZ2V0ZWQgYXQgb3VyIHByb3hpZWQgT2JqZWN0IGRldGVjdGVkXG4gICAgICBpZiAoY3R4ID09PSBvYmopIHtcbiAgICAgICAgLy8gV2UgZWl0aGVyIHJldHVybiB0aGUgb3B0aW9uYWwgc3RyaW5nIHZlcmJhdGltIG9yIGRlcml2ZSB0aGUgbW9zdCBkZXNpcmVkIHJlc3VsdCBhdXRvbWF0aWNhbGx5XG4gICAgICAgIHJldHVybiBzdHIgfHwgdXRpbHMubWFrZU5hdGl2ZVN0cmluZyhvYmoubmFtZSlcbiAgICAgIH1cbiAgICAgIC8vIENoZWNrIGlmIHRoZSB0b1N0cmluZyBwcm90eXBlIG9mIHRoZSBjb250ZXh0IGlzIHRoZSBzYW1lIGFzIHRoZSBnbG9iYWwgcHJvdG90eXBlLFxuICAgICAgLy8gaWYgbm90IGluZGljYXRlcyB0aGF0IHdlIGFyZSBkb2luZyBhIGNoZWNrIGFjcm9zcyBkaWZmZXJlbnQgd2luZG93cy4sIGUuZy4gdGhlIGlmcmFtZVdpdGhkaXJlY3RgIHRlc3QgY2FzZVxuICAgICAgY29uc3QgaGFzU2FtZVByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKFxuICAgICAgICBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmdcbiAgICAgICkuaXNQcm90b3R5cGVPZihjdHgudG9TdHJpbmcpIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcHJvdG90eXBlLWJ1aWx0aW5zXG4gICAgICBpZiAoIWhhc1NhbWVQcm90bykge1xuICAgICAgICAvLyBQYXNzIHRoZSBjYWxsIG9uIHRvIHRoZSBsb2NhbCBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcgaW5zdGVhZFxuICAgICAgICByZXR1cm4gY3R4LnRvU3RyaW5nKClcbiAgICAgIH1cbiAgICAgIHJldHVybiB0YXJnZXQuY2FsbChjdHgpXG4gICAgfVxuICB9XG5cbiAgY29uc3QgdG9TdHJpbmdQcm94eSA9IG5ldyBQcm94eShcbiAgICBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcsXG4gICAgdXRpbHMuc3RyaXBQcm94eUZyb21FcnJvcnMoaGFuZGxlcilcbiAgKVxuICB1dGlscy5yZXBsYWNlUHJvcGVydHkoRnVuY3Rpb24ucHJvdG90eXBlLCAndG9TdHJpbmcnLCB7XG4gICAgdmFsdWU6IHRvU3RyaW5nUHJveHlcbiAgfSlcbn0iLHBhdGNoVG9TdHJpbmdOZXN0ZWQ6IihvYmogPSB7fSkgPT4ge1xuICByZXR1cm4gdXRpbHMuZXhlY1JlY3Vyc2l2ZWx5KG9iaiwgWydmdW5jdGlvbiddLCB1dGlscy5wYXRjaFRvU3RyaW5nKVxufSIscmVkaXJlY3RUb1N0cmluZzoiKHByb3h5T2JqLCBvcmlnaW5hbE9iaikgPT4ge1xuICBjb25zdCBoYW5kbGVyID0ge1xuICAgIGFwcGx5OiBmdW5jdGlvbiAodGFyZ2V0LCBjdHgpIHtcbiAgICAgIC8vIFRoaXMgZml4ZXMgZS5nLiBgSFRNTE1lZGlhRWxlbWVudC5wcm90b3R5cGUuY2FuUGxheVR5cGUudG9TdHJpbmcgKyBcIlwiYFxuICAgICAgaWYgKGN0eCA9PT0gRnVuY3Rpb24ucHJvdG90eXBlLnRvU3RyaW5nKSB7XG4gICAgICAgIHJldHVybiB1dGlscy5tYWtlTmF0aXZlU3RyaW5nKCd0b1N0cmluZycpXG4gICAgICB9XG5cbiAgICAgIC8vIGB0b1N0cmluZ2AgdGFyZ2V0ZWQgYXQgb3VyIHByb3hpZWQgT2JqZWN0IGRldGVjdGVkXG4gICAgICBpZiAoY3R4ID09PSBwcm94eU9iaikge1xuICAgICAgICBjb25zdCBmYWxsYmFjayA9ICgpID0+XG4gICAgICAgICAgb3JpZ2luYWxPYmogJiYgb3JpZ2luYWxPYmoubmFtZVxuICAgICAgICAgICAgPyB1dGlscy5tYWtlTmF0aXZlU3RyaW5nKG9yaWdpbmFsT2JqLm5hbWUpXG4gICAgICAgICAgICA6IHV0aWxzLm1ha2VOYXRpdmVTdHJpbmcocHJveHlPYmoubmFtZSlcblxuICAgICAgICAvLyBSZXR1cm4gdGhlIHRvU3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIG91ciBvcmlnaW5hbCBvYmplY3QgaWYgcG9zc2libGVcbiAgICAgICAgcmV0dXJuIG9yaWdpbmFsT2JqICsgJycgfHwgZmFsbGJhY2soKVxuICAgICAgfVxuXG4gICAgICBpZiAodHlwZW9mIGN0eCA9PT0gJ3VuZGVmaW5lZCcgfHwgY3R4ID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiB0YXJnZXQuY2FsbChjdHgpXG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIHRoZSB0b1N0cmluZyBwcm90eXBlIG9mIHRoZSBjb250ZXh0IGlzIHRoZSBzYW1lIGFzIHRoZSBnbG9iYWwgcHJvdG90eXBlLFxuICAgICAgLy8gaWYgbm90IGluZGljYXRlcyB0aGF0IHdlIGFyZSBkb2luZyBhIGNoZWNrIGFjcm9zcyBkaWZmZXJlbnQgd2luZG93cy4sIGUuZy4gdGhlIGlmcmFtZVdpdGhkaXJlY3RgIHRlc3QgY2FzZVxuICAgICAgY29uc3QgaGFzU2FtZVByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKFxuICAgICAgICBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmdcbiAgICAgICkuaXNQcm90b3R5cGVPZihjdHgudG9TdHJpbmcpIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcHJvdG90eXBlLWJ1aWx0aW5zXG4gICAgICBpZiAoIWhhc1NhbWVQcm90bykge1xuICAgICAgICAvLyBQYXNzIHRoZSBjYWxsIG9uIHRvIHRoZSBsb2NhbCBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcgaW5zdGVhZFxuICAgICAgICByZXR1cm4gY3R4LnRvU3RyaW5nKClcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRhcmdldC5jYWxsKGN0eClcbiAgICB9XG4gIH1cblxuICBjb25zdCB0b1N0cmluZ1Byb3h5ID0gbmV3IFByb3h5KFxuICAgIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZyxcbiAgICB1dGlscy5zdHJpcFByb3h5RnJvbUVycm9ycyhoYW5kbGVyKVxuICApXG4gIHV0aWxzLnJlcGxhY2VQcm9wZXJ0eShGdW5jdGlvbi5wcm90b3R5cGUsICd0b1N0cmluZycsIHtcbiAgICB2YWx1ZTogdG9TdHJpbmdQcm94eVxuICB9KVxufSIscmVwbGFjZVdpdGhQcm94eToiKG9iaiwgcHJvcE5hbWUsIGhhbmRsZXIpID0+IHtcbiAgY29uc3Qgb3JpZ2luYWxPYmogPSBvYmpbcHJvcE5hbWVdXG4gIGNvbnN0IHByb3h5T2JqID0gbmV3IFByb3h5KG9ialtwcm9wTmFtZV0sIHV0aWxzLnN0cmlwUHJveHlGcm9tRXJyb3JzKGhhbmRsZXIpKVxuXG4gIHV0aWxzLnJlcGxhY2VQcm9wZXJ0eShvYmosIHByb3BOYW1lLCB7IHZhbHVlOiBwcm94eU9iaiB9KVxuICB1dGlscy5yZWRpcmVjdFRvU3RyaW5nKHByb3h5T2JqLCBvcmlnaW5hbE9iailcblxuICByZXR1cm4gdHJ1ZVxufSIscmVwbGFjZUdldHRlcldpdGhQcm94eToiKG9iaiwgcHJvcE5hbWUsIGhhbmRsZXIpID0+IHtcbiAgY29uc3QgZm4gPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwgcHJvcE5hbWUpLmdldFxuICBjb25zdCBmblN0ciA9IGZuLnRvU3RyaW5nKCkgLy8gc3BlY2lhbCBnZXR0ZXIgZnVuY3Rpb24gc3RyaW5nXG4gIGNvbnN0IHByb3h5T2JqID0gbmV3IFByb3h5KGZuLCB1dGlscy5zdHJpcFByb3h5RnJvbUVycm9ycyhoYW5kbGVyKSlcblxuICB1dGlscy5yZXBsYWNlUHJvcGVydHkob2JqLCBwcm9wTmFtZSwgeyBnZXQ6IHByb3h5T2JqIH0pXG4gIHV0aWxzLnBhdGNoVG9TdHJpbmcocHJveHlPYmosIGZuU3RyKVxuXG4gIHJldHVybiB0cnVlXG59Iixtb2NrV2l0aFByb3h5OiIob2JqLCBwcm9wTmFtZSwgcHNldWRvVGFyZ2V0LCBoYW5kbGVyKSA9PiB7XG4gIGNvbnN0IHByb3h5T2JqID0gbmV3IFByb3h5KHBzZXVkb1RhcmdldCwgdXRpbHMuc3RyaXBQcm94eUZyb21FcnJvcnMoaGFuZGxlcikpXG5cbiAgdXRpbHMucmVwbGFjZVByb3BlcnR5KG9iaiwgcHJvcE5hbWUsIHsgdmFsdWU6IHByb3h5T2JqIH0pXG4gIHV0aWxzLnBhdGNoVG9TdHJpbmcocHJveHlPYmopXG5cbiAgcmV0dXJuIHRydWVcbn0iLGNyZWF0ZVByb3h5OiIocHNldWRvVGFyZ2V0LCBoYW5kbGVyKSA9PiB7XG4gIGNvbnN0IHByb3h5T2JqID0gbmV3IFByb3h5KHBzZXVkb1RhcmdldCwgdXRpbHMuc3RyaXBQcm94eUZyb21FcnJvcnMoaGFuZGxlcikpXG4gIHV0aWxzLnBhdGNoVG9TdHJpbmcocHJveHlPYmopXG5cbiAgcmV0dXJuIHByb3h5T2JqXG59IixzcGxpdE9ialBhdGg6Im9ialBhdGggPT4gKHtcbiAgLy8gUmVtb3ZlIGxhc3QgZG90IGVudHJ5IChwcm9wZXJ0eSkgPT0+IGBIVE1MTWVkaWFFbGVtZW50LnByb3RvdHlwZWBcbiAgb2JqTmFtZTogb2JqUGF0aC5zcGxpdCgnLicpLnNsaWNlKDAsIC0xKS5qb2luKCcuJyksXG4gIC8vIEV4dHJhY3QgbGFzdCBkb3QgZW50cnkgPT0+IGBjYW5QbGF5VHlwZWBcbiAgcHJvcE5hbWU6IG9ialBhdGguc3BsaXQoJy4nKS5zbGljZSgtMSlbMF1cbn0pIixyZXBsYWNlT2JqUGF0aFdpdGhQcm94eToiKG9ialBhdGgsIGhhbmRsZXIpID0+IHtcbiAgY29uc3QgeyBvYmpOYW1lLCBwcm9wTmFtZSB9ID0gdXRpbHMuc3BsaXRPYmpQYXRoKG9ialBhdGgpXG4gIGNvbnN0IG9iaiA9IGV2YWwob2JqTmFtZSkgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1ldmFsXG4gIHJldHVybiB1dGlscy5yZXBsYWNlV2l0aFByb3h5KG9iaiwgcHJvcE5hbWUsIGhhbmRsZXIpXG59IixleGVjUmVjdXJzaXZlbHk6IihvYmogPSB7fSwgdHlwZUZpbHRlciA9IFtdLCBmbikgPT4ge1xuICBmdW5jdGlvbiByZWN1cnNlKG9iaikge1xuICAgIGZvciAoY29uc3Qga2V5IGluIG9iaikge1xuICAgICAgaWYgKG9ialtrZXldID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29udGludWVcbiAgICAgIH1cbiAgICAgIGlmIChvYmpba2V5XSAmJiB0eXBlb2Ygb2JqW2tleV0gPT09ICdvYmplY3QnKSB7XG4gICAgICAgIHJlY3Vyc2Uob2JqW2tleV0pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAob2JqW2tleV0gJiYgdHlwZUZpbHRlci5pbmNsdWRlcyh0eXBlb2Ygb2JqW2tleV0pKSB7XG4gICAgICAgICAgZm4uY2FsbCh0aGlzLCBvYmpba2V5XSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICByZWN1cnNlKG9iailcbiAgcmV0dXJuIG9ialxufSIsc3RyaW5naWZ5Rm5zOiIoZm5PYmogPSB7IGhlbGxvOiAoKSA9PiAnd29ybGQnIH0pID0+IHtcbiAgLy8gT2JqZWN0LmZyb21FbnRyaWVzKCkgcG9ueWZpbGwgKGluIDYgbGluZXMpIC0gc3VwcG9ydGVkIG9ubHkgaW4gTm9kZSB2MTIrLCBtb2Rlcm4gYnJvd3NlcnMgYXJlIGZpbmVcbiAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2Zlcm9zcy9mcm9tZW50cmllc1xuICBmdW5jdGlvbiBmcm9tRW50cmllcyhpdGVyYWJsZSkge1xuICAgIHJldHVybiBbLi4uaXRlcmFibGVdLnJlZHVjZSgob2JqLCBba2V5LCB2YWxdKSA9PiB7XG4gICAgICBvYmpba2V5XSA9IHZhbFxuICAgICAgcmV0dXJuIG9ialxuICAgIH0sIHt9KVxuICB9XG4gIHJldHVybiAoT2JqZWN0LmZyb21FbnRyaWVzIHx8IGZyb21FbnRyaWVzKShcbiAgICBPYmplY3QuZW50cmllcyhmbk9iailcbiAgICAgIC5maWx0ZXIoKFtrZXksIHZhbHVlXSkgPT4gdHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKVxuICAgICAgLm1hcCgoW2tleSwgdmFsdWVdKSA9PiBba2V5LCB2YWx1ZS50b1N0cmluZygpXSkgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1ldmFsXG4gIClcbn0iLG1hdGVyaWFsaXplRm5zOiIoZm5TdHJPYmogPSB7IGhlbGxvOiBcIigpID0+ICd3b3JsZCdcIiB9KSA9PiB7XG4gIHJldHVybiBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgT2JqZWN0LmVudHJpZXMoZm5TdHJPYmopLm1hcCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICBpZiAodmFsdWUuc3RhcnRzV2l0aCgnZnVuY3Rpb24nKSkge1xuICAgICAgICAvLyBzb21lIHRyaWNrZXJ5IGlzIG5lZWRlZCB0byBtYWtlIG9sZHNjaG9vbCBmdW5jdGlvbnMgd29yayA6LSlcbiAgICAgICAgcmV0dXJuIFtrZXksIGV2YWwoYCgpID0+ICR7dmFsdWV9YCkoKV0gLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1ldmFsXG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBhcnJvdyBmdW5jdGlvbnMganVzdCB3b3JrXG4gICAgICAgIHJldHVybiBba2V5LCBldmFsKHZhbHVlKV0gLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1ldmFsXG4gICAgICB9XG4gICAgfSlcbiAgKVxufSIsbWFrZUhhbmRsZXI6IigpID0+ICh7XG4gIC8vIFVzZWQgYnkgc2ltcGxlIGBuYXZpZ2F0b3JgIGdldHRlciBldmFzaW9uc1xuICBnZXR0ZXJWYWx1ZTogdmFsdWUgPT4gKHtcbiAgICBhcHBseSh0YXJnZXQsIGN0eCwgYXJncykge1xuICAgICAgLy8gTGV0J3MgZmV0Y2ggdGhlIHZhbHVlIGZpcnN0LCB0byB0cmlnZ2VyIGFuZCBlc2NhbGF0ZSBwb3RlbnRpYWwgZXJyb3JzXG4gICAgICAvLyBJbGxlZ2FsIGludm9jYXRpb25zIGxpa2UgYG5hdmlnYXRvci5fX3Byb3RvX18udmVuZG9yYCB3aWxsIHRocm93IGhlcmVcbiAgICAgIHV0aWxzLmNhY2hlLlJlZmxlY3QuYXBwbHkoLi4uYXJndW1lbnRzKVxuICAgICAgcmV0dXJuIHZhbHVlXG4gICAgfVxuICB9KVxufSkifSxfbWFpbkZ1bmN0aW9uOiIodXRpbHMsIHsgb3B0cyB9KSA9PiB7XG4gICAgICAgIHV0aWxzLnJlcGxhY2VHZXR0ZXJXaXRoUHJveHkoXG4gICAgICAgICAgT2JqZWN0LmdldFByb3RvdHlwZU9mKG5hdmlnYXRvciksXG4gICAgICAgICAgJ2hhcmR3YXJlQ29uY3VycmVuY3knLFxuICAgICAgICAgIHV0aWxzLm1ha2VIYW5kbGVyKCkuZ2V0dGVyVmFsdWUob3B0cy5oYXJkd2FyZUNvbmN1cnJlbmN5KVxuICAgICAgICApXG4gICAgICB9IixfYXJnczpbe29wdHM6e2hhcmR3YXJlQ29uY3VycmVuY3k6NH19XX0pLCgoe191dGlsc0ZuczpfdXRpbHNGbnMsX21haW5GdW5jdGlvbjpfbWFpbkZ1bmN0aW9uLF9hcmdzOl9hcmdzfSk9Pntjb25zdCB1dGlscz1PYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmVudHJpZXMoX3V0aWxzRm5zKS5tYXAoKChba2V5LHZhbHVlXSk9PltrZXksZXZhbCh2YWx1ZSldKSkpO3V0aWxzLmluaXQoKSxldmFsKF9tYWluRnVuY3Rpb24pKHV0aWxzLC4uLl9hcmdzKX0pKHtfdXRpbHNGbnM6e2luaXQ6IigpID0+IHtcbiAgdXRpbHMucHJlbG9hZENhY2hlKClcbn0iLHN0cmlwUHJveHlGcm9tRXJyb3JzOiIoaGFuZGxlciA9IHt9KSA9PiB7XG4gIGNvbnN0IG5ld0hhbmRsZXIgPSB7XG4gICAgc2V0UHJvdG90eXBlT2Y6IGZ1bmN0aW9uICh0YXJnZXQsIHByb3RvKSB7XG4gICAgICBpZiAocHJvdG8gPT09IG51bGwpXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUnKVxuICAgICAgaWYgKE9iamVjdC5nZXRQcm90b3R5cGVPZih0YXJnZXQpID09PSBPYmplY3QuZ2V0UHJvdG90eXBlT2YocHJvdG8pKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0N5Y2xpYyBfX3Byb3RvX18gdmFsdWUnKVxuICAgICAgfVxuICAgICAgcmV0dXJuIFJlZmxlY3Quc2V0UHJvdG90eXBlT2YodGFyZ2V0LCBwcm90bylcbiAgICB9XG4gIH1cbiAgLy8gV2Ugd3JhcCBlYWNoIHRyYXAgaW4gdGhlIGhhbmRsZXIgaW4gYSB0cnkvY2F0Y2ggYW5kIG1vZGlmeSB0aGUgZXJyb3Igc3RhY2sgaWYgdGhleSB0aHJvd1xuICBjb25zdCB0cmFwcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGhhbmRsZXIpXG4gIHRyYXBzLmZvckVhY2godHJhcCA9PiB7XG4gICAgbmV3SGFuZGxlclt0cmFwXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIEZvcndhcmQgdGhlIGNhbGwgdG8gdGhlIGRlZmluZWQgcHJveHkgaGFuZGxlclxuICAgICAgICByZXR1cm4gaGFuZGxlclt0cmFwXS5hcHBseSh0aGlzLCBhcmd1bWVudHMgfHwgW10pXG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgLy8gU3RhY2sgdHJhY2VzIGRpZmZlciBwZXIgYnJvd3Nlciwgd2Ugb25seSBzdXBwb3J0IGNocm9taXVtIGJhc2VkIG9uZXMgY3VycmVudGx5XG4gICAgICAgIGlmICghZXJyIHx8ICFlcnIuc3RhY2sgfHwgIWVyci5zdGFjay5pbmNsdWRlcyhgYXQgYCkpIHtcbiAgICAgICAgICB0aHJvdyBlcnJcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFdoZW4gc29tZXRoaW5nIHRocm93cyB3aXRoaW4gb25lIG9mIG91ciB0cmFwcyB0aGUgUHJveHkgd2lsbCBzaG93IHVwIGluIGVycm9yIHN0YWNrc1xuICAgICAgICAvLyBBbiBlYXJsaWVyIGltcGxlbWVudGF0aW9uIG9mIHRoaXMgY29kZSB3b3VsZCBzaW1wbHkgc3RyaXAgbGluZXMgd2l0aCBhIGJsYWNrbGlzdCxcbiAgICAgICAgLy8gYnV0IGl0IG1ha2VzIHNlbnNlIHRvIGJlIG1vcmUgc3VyZ2ljYWwgaGVyZSBhbmQgb25seSByZW1vdmUgbGluZXMgcmVsYXRlZCB0byBvdXIgUHJveHkuXG4gICAgICAgIC8vIFdlIHRyeSB0byB1c2UgYSBrbm93biBcImFuY2hvclwiIGxpbmUgZm9yIHRoYXQgYW5kIHN0cmlwIGl0IHdpdGggZXZlcnl0aGluZyBhYm92ZSBpdC5cbiAgICAgICAgLy8gSWYgdGhlIGFuY2hvciBsaW5lIGNhbm5vdCBiZSBmb3VuZCBmb3Igc29tZSByZWFzb24gd2UgZmFsbCBiYWNrIHRvIG91ciBibGFja2xpc3QgYXBwcm9hY2guXG5cbiAgICAgICAgY29uc3Qgc3RyaXBXaXRoQmxhY2tsaXN0ID0gKHN0YWNrLCBzdHJpcEZpcnN0TGluZSA9IHRydWUpID0+IHtcbiAgICAgICAgICBjb25zdCBibGFja2xpc3QgPSBbXG4gICAgICAgICAgICBgYXQgUmVmbGVjdC4ke3RyYXB9IGAsIC8vIGUuZy4gUmVmbGVjdC5nZXQgb3IgUmVmbGVjdC5hcHBseVxuICAgICAgICAgICAgYGF0IE9iamVjdC4ke3RyYXB9IGAsIC8vIGUuZy4gT2JqZWN0LmdldCBvciBPYmplY3QuYXBwbHlcbiAgICAgICAgICAgIGBhdCBPYmplY3QubmV3SGFuZGxlci48Y29tcHV0ZWQ+IFthcyAke3RyYXB9XSBgIC8vIGNhdXNlZCBieSB0aGlzIHZlcnkgd3JhcHBlciA6LSlcbiAgICAgICAgICBdXG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIGVyci5zdGFja1xuICAgICAgICAgICAgICAuc3BsaXQoJ1xcbicpXG4gICAgICAgICAgICAgIC8vIEFsd2F5cyByZW1vdmUgdGhlIGZpcnN0IChmaWxlKSBsaW5lIGluIHRoZSBzdGFjayAoZ3VhcmFudGVlZCB0byBiZSBvdXIgcHJveHkpXG4gICAgICAgICAgICAgIC5maWx0ZXIoKGxpbmUsIGluZGV4KSA9PiAhKGluZGV4ID09PSAxICYmIHN0cmlwRmlyc3RMaW5lKSlcbiAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGxpbmUgc3RhcnRzIHdpdGggb25lIG9mIG91ciBibGFja2xpc3RlZCBzdHJpbmdzXG4gICAgICAgICAgICAgIC5maWx0ZXIobGluZSA9PiAhYmxhY2tsaXN0LnNvbWUoYmwgPT4gbGluZS50cmltKCkuc3RhcnRzV2l0aChibCkpKVxuICAgICAgICAgICAgICAuam9pbignXFxuJylcbiAgICAgICAgICApXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzdHJpcFdpdGhBbmNob3IgPSAoc3RhY2ssIGFuY2hvcikgPT4ge1xuICAgICAgICAgIGNvbnN0IHN0YWNrQXJyID0gc3RhY2suc3BsaXQoJ1xcbicpXG4gICAgICAgICAgYW5jaG9yID0gYW5jaG9yIHx8IGBhdCBPYmplY3QubmV3SGFuZGxlci48Y29tcHV0ZWQ+IFthcyAke3RyYXB9XSBgIC8vIEtub3duIGZpcnN0IFByb3h5IGxpbmUgaW4gY2hyb21pdW1cbiAgICAgICAgICBjb25zdCBhbmNob3JJbmRleCA9IHN0YWNrQXJyLmZpbmRJbmRleChsaW5lID0+XG4gICAgICAgICAgICBsaW5lLnRyaW0oKS5zdGFydHNXaXRoKGFuY2hvcilcbiAgICAgICAgICApXG4gICAgICAgICAgaWYgKGFuY2hvckluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlIC8vIDQwNCwgYW5jaG9yIG5vdCBmb3VuZFxuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBTdHJpcCBldmVyeXRoaW5nIGZyb20gdGhlIHRvcCB1bnRpbCB3ZSByZWFjaCB0aGUgYW5jaG9yIGxpbmVcbiAgICAgICAgICAvLyBOb3RlOiBXZSdyZSBrZWVwaW5nIHRoZSAxc3QgbGluZSAoemVybyBpbmRleCkgYXMgaXQncyB1bnJlbGF0ZWQgKGUuZy4gYFR5cGVFcnJvcmApXG4gICAgICAgICAgc3RhY2tBcnIuc3BsaWNlKDEsIGFuY2hvckluZGV4KVxuICAgICAgICAgIHJldHVybiBzdGFja0Fyci5qb2luKCdcXG4nKVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gU3BlY2lhbCBjYXNlcyBkdWUgdG8gb3VyIG5lc3RlZCB0b1N0cmluZyBwcm94aWVzXG4gICAgICAgIGVyci5zdGFjayA9IGVyci5zdGFjay5yZXBsYWNlKFxuICAgICAgICAgICdhdCBPYmplY3QudG9TdHJpbmcgKCcsXG4gICAgICAgICAgJ2F0IEZ1bmN0aW9uLnRvU3RyaW5nICgnXG4gICAgICAgIClcbiAgICAgICAgaWYgKChlcnIuc3RhY2sgfHwgJycpLmluY2x1ZGVzKCdhdCBGdW5jdGlvbi50b1N0cmluZyAoJykpIHtcbiAgICAgICAgICBlcnIuc3RhY2sgPSBzdHJpcFdpdGhCbGFja2xpc3QoZXJyLnN0YWNrLCBmYWxzZSlcbiAgICAgICAgICB0aHJvdyBlcnJcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFRyeSB1c2luZyB0aGUgYW5jaG9yIG1ldGhvZCwgZmFsbGJhY2sgdG8gYmxhY2tsaXN0IGlmIG5lY2Vzc2FyeVxuICAgICAgICBlcnIuc3RhY2sgPSBzdHJpcFdpdGhBbmNob3IoZXJyLnN0YWNrKSB8fCBzdHJpcFdpdGhCbGFja2xpc3QoZXJyLnN0YWNrKVxuXG4gICAgICAgIHRocm93IGVyciAvLyBSZS10aHJvdyBvdXIgbm93IHNhbml0aXplZCBlcnJvclxuICAgICAgfVxuICAgIH1cbiAgfSlcbiAgcmV0dXJuIG5ld0hhbmRsZXJcbn0iLHN0cmlwRXJyb3JXaXRoQW5jaG9yOiIoZXJyLCBhbmNob3IpID0+IHtcbiAgY29uc3Qgc3RhY2tBcnIgPSBlcnIuc3RhY2suc3BsaXQoJ1xcbicpXG4gIGNvbnN0IGFuY2hvckluZGV4ID0gc3RhY2tBcnIuZmluZEluZGV4KGxpbmUgPT4gbGluZS50cmltKCkuc3RhcnRzV2l0aChhbmNob3IpKVxuICBpZiAoYW5jaG9ySW5kZXggPT09IC0xKSB7XG4gICAgcmV0dXJuIGVyciAvLyA0MDQsIGFuY2hvciBub3QgZm91bmRcbiAgfVxuICAvLyBTdHJpcCBldmVyeXRoaW5nIGZyb20gdGhlIHRvcCB1bnRpbCB3ZSByZWFjaCB0aGUgYW5jaG9yIGxpbmUgKHJlbW92ZSBhbmNob3IgbGluZSBhcyB3ZWxsKVxuICAvLyBOb3RlOiBXZSdyZSBrZWVwaW5nIHRoZSAxc3QgbGluZSAoemVybyBpbmRleCkgYXMgaXQncyB1bnJlbGF0ZWQgKGUuZy4gYFR5cGVFcnJvcmApXG4gIHN0YWNrQXJyLnNwbGljZSgxLCBhbmNob3JJbmRleClcbiAgZXJyLnN0YWNrID0gc3RhY2tBcnIuam9pbignXFxuJylcbiAgcmV0dXJuIGVyclxufSIscmVwbGFjZVByb3BlcnR5OiIob2JqLCBwcm9wTmFtZSwgZGVzY3JpcHRvck92ZXJyaWRlcyA9IHt9KSA9PiB7XG4gIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBwcm9wTmFtZSwge1xuICAgIC8vIENvcHkgb3ZlciB0aGUgZXhpc3RpbmcgZGVzY3JpcHRvcnMgKHdyaXRhYmxlLCBlbnVtZXJhYmxlLCBjb25maWd1cmFibGUsIGV0YylcbiAgICAuLi4oT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIHByb3BOYW1lKSB8fCB7fSksXG4gICAgLy8gQWRkIG91ciBvdmVycmlkZXMgKGUuZy4gdmFsdWUsIGdldCgpKVxuICAgIC4uLmRlc2NyaXB0b3JPdmVycmlkZXNcbiAgfSlcbn0iLHByZWxvYWRDYWNoZToiKCkgPT4ge1xuICBpZiAodXRpbHMuY2FjaGUpIHtcbiAgICByZXR1cm5cbiAgfVxuICB1dGlscy5jYWNoZSA9IHtcbiAgICAvLyBVc2VkIGluIG91ciBwcm94aWVzXG4gICAgUmVmbGVjdDoge1xuICAgICAgZ2V0OiBSZWZsZWN0LmdldC5iaW5kKFJlZmxlY3QpLFxuICAgICAgYXBwbHk6IFJlZmxlY3QuYXBwbHkuYmluZChSZWZsZWN0KVxuICAgIH0sXG4gICAgLy8gVXNlZCBpbiBgbWFrZU5hdGl2ZVN0cmluZ2BcbiAgICBuYXRpdmVUb1N0cmluZ1N0cjogRnVuY3Rpb24udG9TdHJpbmcgKyAnJyAvLyA9PiBgZnVuY3Rpb24gdG9TdHJpbmcoKSB7IFtuYXRpdmUgY29kZV0gfWBcbiAgfVxufSIsbWFrZU5hdGl2ZVN0cmluZzoiKG5hbWUgPSAnJykgPT4ge1xuICByZXR1cm4gdXRpbHMuY2FjaGUubmF0aXZlVG9TdHJpbmdTdHIucmVwbGFjZSgndG9TdHJpbmcnLCBuYW1lIHx8ICcnKVxufSIscGF0Y2hUb1N0cmluZzoiKG9iaiwgc3RyID0gJycpID0+IHtcbiAgY29uc3QgaGFuZGxlciA9IHtcbiAgICBhcHBseTogZnVuY3Rpb24gKHRhcmdldCwgY3R4KSB7XG4gICAgICAvLyBUaGlzIGZpeGVzIGUuZy4gYEhUTUxNZWRpYUVsZW1lbnQucHJvdG90eXBlLmNhblBsYXlUeXBlLnRvU3RyaW5nICsgXCJcImBcbiAgICAgIGlmIChjdHggPT09IEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZykge1xuICAgICAgICByZXR1cm4gdXRpbHMubWFrZU5hdGl2ZVN0cmluZygndG9TdHJpbmcnKVxuICAgICAgfVxuICAgICAgLy8gYHRvU3RyaW5nYCB0YXJnZXRlZCBhdCBvdXIgcHJveGllZCBPYmplY3QgZGV0ZWN0ZWRcbiAgICAgIGlmIChjdHggPT09IG9iaikge1xuICAgICAgICAvLyBXZSBlaXRoZXIgcmV0dXJuIHRoZSBvcHRpb25hbCBzdHJpbmcgdmVyYmF0aW0gb3IgZGVyaXZlIHRoZSBtb3N0IGRlc2lyZWQgcmVzdWx0IGF1dG9tYXRpY2FsbHlcbiAgICAgICAgcmV0dXJuIHN0ciB8fCB1dGlscy5tYWtlTmF0aXZlU3RyaW5nKG9iai5uYW1lKVxuICAgICAgfVxuICAgICAgLy8gQ2hlY2sgaWYgdGhlIHRvU3RyaW5nIHByb3R5cGUgb2YgdGhlIGNvbnRleHQgaXMgdGhlIHNhbWUgYXMgdGhlIGdsb2JhbCBwcm90b3R5cGUsXG4gICAgICAvLyBpZiBub3QgaW5kaWNhdGVzIHRoYXQgd2UgYXJlIGRvaW5nIGEgY2hlY2sgYWNyb3NzIGRpZmZlcmVudCB3aW5kb3dzLiwgZS5nLiB0aGUgaWZyYW1lV2l0aGRpcmVjdGAgdGVzdCBjYXNlXG4gICAgICBjb25zdCBoYXNTYW1lUHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YoXG4gICAgICAgIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZ1xuICAgICAgKS5pc1Byb3RvdHlwZU9mKGN0eC50b1N0cmluZykgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1wcm90b3R5cGUtYnVpbHRpbnNcbiAgICAgIGlmICghaGFzU2FtZVByb3RvKSB7XG4gICAgICAgIC8vIFBhc3MgdGhlIGNhbGwgb24gdG8gdGhlIGxvY2FsIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZyBpbnN0ZWFkXG4gICAgICAgIHJldHVybiBjdHgudG9TdHJpbmcoKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRhcmdldC5jYWxsKGN0eClcbiAgICB9XG4gIH1cblxuICBjb25zdCB0b1N0cmluZ1Byb3h5ID0gbmV3IFByb3h5KFxuICAgIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZyxcbiAgICB1dGlscy5zdHJpcFByb3h5RnJvbUVycm9ycyhoYW5kbGVyKVxuICApXG4gIHV0aWxzLnJlcGxhY2VQcm9wZXJ0eShGdW5jdGlvbi5wcm90b3R5cGUsICd0b1N0cmluZycsIHtcbiAgICB2YWx1ZTogdG9TdHJpbmdQcm94eVxuICB9KVxufSIscGF0Y2hUb1N0cmluZ05lc3RlZDoiKG9iaiA9IHt9KSA9PiB7XG4gIHJldHVybiB1dGlscy5leGVjUmVjdXJzaXZlbHkob2JqLCBbJ2Z1bmN0aW9uJ10sIHV0aWxzLnBhdGNoVG9TdHJpbmcpXG59IixyZWRpcmVjdFRvU3RyaW5nOiIocHJveHlPYmosIG9yaWdpbmFsT2JqKSA9PiB7XG4gIGNvbnN0IGhhbmRsZXIgPSB7XG4gICAgYXBwbHk6IGZ1bmN0aW9uICh0YXJnZXQsIGN0eCkge1xuICAgICAgLy8gVGhpcyBmaXhlcyBlLmcuIGBIVE1MTWVkaWFFbGVtZW50LnByb3RvdHlwZS5jYW5QbGF5VHlwZS50b1N0cmluZyArIFwiXCJgXG4gICAgICBpZiAoY3R4ID09PSBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHV0aWxzLm1ha2VOYXRpdmVTdHJpbmcoJ3RvU3RyaW5nJylcbiAgICAgIH1cblxuICAgICAgLy8gYHRvU3RyaW5nYCB0YXJnZXRlZCBhdCBvdXIgcHJveGllZCBPYmplY3QgZGV0ZWN0ZWRcbiAgICAgIGlmIChjdHggPT09IHByb3h5T2JqKSB7XG4gICAgICAgIGNvbnN0IGZhbGxiYWNrID0gKCkgPT5cbiAgICAgICAgICBvcmlnaW5hbE9iaiAmJiBvcmlnaW5hbE9iai5uYW1lXG4gICAgICAgICAgICA/IHV0aWxzLm1ha2VOYXRpdmVTdHJpbmcob3JpZ2luYWxPYmoubmFtZSlcbiAgICAgICAgICAgIDogdXRpbHMubWFrZU5hdGl2ZVN0cmluZyhwcm94eU9iai5uYW1lKVxuXG4gICAgICAgIC8vIFJldHVybiB0aGUgdG9TdHJpbmcgcmVwcmVzZW50YXRpb24gb2Ygb3VyIG9yaWdpbmFsIG9iamVjdCBpZiBwb3NzaWJsZVxuICAgICAgICByZXR1cm4gb3JpZ2luYWxPYmogKyAnJyB8fCBmYWxsYmFjaygpXG4gICAgICB9XG5cbiAgICAgIGlmICh0eXBlb2YgY3R4ID09PSAndW5kZWZpbmVkJyB8fCBjdHggPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHRhcmdldC5jYWxsKGN0eClcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgdGhlIHRvU3RyaW5nIHByb3R5cGUgb2YgdGhlIGNvbnRleHQgaXMgdGhlIHNhbWUgYXMgdGhlIGdsb2JhbCBwcm90b3R5cGUsXG4gICAgICAvLyBpZiBub3QgaW5kaWNhdGVzIHRoYXQgd2UgYXJlIGRvaW5nIGEgY2hlY2sgYWNyb3NzIGRpZmZlcmVudCB3aW5kb3dzLiwgZS5nLiB0aGUgaWZyYW1lV2l0aGRpcmVjdGAgdGVzdCBjYXNlXG4gICAgICBjb25zdCBoYXNTYW1lUHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YoXG4gICAgICAgIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZ1xuICAgICAgKS5pc1Byb3RvdHlwZU9mKGN0eC50b1N0cmluZykgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1wcm90b3R5cGUtYnVpbHRpbnNcbiAgICAgIGlmICghaGFzU2FtZVByb3RvKSB7XG4gICAgICAgIC8vIFBhc3MgdGhlIGNhbGwgb24gdG8gdGhlIGxvY2FsIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZyBpbnN0ZWFkXG4gICAgICAgIHJldHVybiBjdHgudG9TdHJpbmcoKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGFyZ2V0LmNhbGwoY3R4KVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHRvU3RyaW5nUHJveHkgPSBuZXcgUHJveHkoXG4gICAgRnVuY3Rpb24ucHJvdG90eXBlLnRvU3RyaW5nLFxuICAgIHV0aWxzLnN0cmlwUHJveHlGcm9tRXJyb3JzKGhhbmRsZXIpXG4gIClcbiAgdXRpbHMucmVwbGFjZVByb3BlcnR5KEZ1bmN0aW9uLnByb3RvdHlwZSwgJ3RvU3RyaW5nJywge1xuICAgIHZhbHVlOiB0b1N0cmluZ1Byb3h5XG4gIH0pXG59IixyZXBsYWNlV2l0aFByb3h5OiIob2JqLCBwcm9wTmFtZSwgaGFuZGxlcikgPT4ge1xuICBjb25zdCBvcmlnaW5hbE9iaiA9IG9ialtwcm9wTmFtZV1cbiAgY29uc3QgcHJveHlPYmogPSBuZXcgUHJveHkob2JqW3Byb3BOYW1lXSwgdXRpbHMuc3RyaXBQcm94eUZyb21FcnJvcnMoaGFuZGxlcikpXG5cbiAgdXRpbHMucmVwbGFjZVByb3BlcnR5KG9iaiwgcHJvcE5hbWUsIHsgdmFsdWU6IHByb3h5T2JqIH0pXG4gIHV0aWxzLnJlZGlyZWN0VG9TdHJpbmcocHJveHlPYmosIG9yaWdpbmFsT2JqKVxuXG4gIHJldHVybiB0cnVlXG59IixyZXBsYWNlR2V0dGVyV2l0aFByb3h5OiIob2JqLCBwcm9wTmFtZSwgaGFuZGxlcikgPT4ge1xuICBjb25zdCBmbiA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBwcm9wTmFtZSkuZ2V0XG4gIGNvbnN0IGZuU3RyID0gZm4udG9TdHJpbmcoKSAvLyBzcGVjaWFsIGdldHRlciBmdW5jdGlvbiBzdHJpbmdcbiAgY29uc3QgcHJveHlPYmogPSBuZXcgUHJveHkoZm4sIHV0aWxzLnN0cmlwUHJveHlGcm9tRXJyb3JzKGhhbmRsZXIpKVxuXG4gIHV0aWxzLnJlcGxhY2VQcm9wZXJ0eShvYmosIHByb3BOYW1lLCB7IGdldDogcHJveHlPYmogfSlcbiAgdXRpbHMucGF0Y2hUb1N0cmluZyhwcm94eU9iaiwgZm5TdHIpXG5cbiAgcmV0dXJuIHRydWVcbn0iLG1vY2tXaXRoUHJveHk6IihvYmosIHByb3BOYW1lLCBwc2V1ZG9UYXJnZXQsIGhhbmRsZXIpID0+IHtcbiAgY29uc3QgcHJveHlPYmogPSBuZXcgUHJveHkocHNldWRvVGFyZ2V0LCB1dGlscy5zdHJpcFByb3h5RnJvbUVycm9ycyhoYW5kbGVyKSlcblxuICB1dGlscy5yZXBsYWNlUHJvcGVydHkob2JqLCBwcm9wTmFtZSwgeyB2YWx1ZTogcHJveHlPYmogfSlcbiAgdXRpbHMucGF0Y2hUb1N0cmluZyhwcm94eU9iailcblxuICByZXR1cm4gdHJ1ZVxufSIsY3JlYXRlUHJveHk6Iihwc2V1ZG9UYXJnZXQsIGhhbmRsZXIpID0+IHtcbiAgY29uc3QgcHJveHlPYmogPSBuZXcgUHJveHkocHNldWRvVGFyZ2V0LCB1dGlscy5zdHJpcFByb3h5RnJvbUVycm9ycyhoYW5kbGVyKSlcbiAgdXRpbHMucGF0Y2hUb1N0cmluZyhwcm94eU9iailcblxuICByZXR1cm4gcHJveHlPYmpcbn0iLHNwbGl0T2JqUGF0aDoib2JqUGF0aCA9PiAoe1xuICAvLyBSZW1vdmUgbGFzdCBkb3QgZW50cnkgKHByb3BlcnR5KSA9PT4gYEhUTUxNZWRpYUVsZW1lbnQucHJvdG90eXBlYFxuICBvYmpOYW1lOiBvYmpQYXRoLnNwbGl0KCcuJykuc2xpY2UoMCwgLTEpLmpvaW4oJy4nKSxcbiAgLy8gRXh0cmFjdCBsYXN0IGRvdCBlbnRyeSA9PT4gYGNhblBsYXlUeXBlYFxuICBwcm9wTmFtZTogb2JqUGF0aC5zcGxpdCgnLicpLnNsaWNlKC0xKVswXVxufSkiLHJlcGxhY2VPYmpQYXRoV2l0aFByb3h5OiIob2JqUGF0aCwgaGFuZGxlcikgPT4ge1xuICBjb25zdCB7IG9iak5hbWUsIHByb3BOYW1lIH0gPSB1dGlscy5zcGxpdE9ialBhdGgob2JqUGF0aClcbiAgY29uc3Qgb2JqID0gZXZhbChvYmpOYW1lKSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWV2YWxcbiAgcmV0dXJuIHV0aWxzLnJlcGxhY2VXaXRoUHJveHkob2JqLCBwcm9wTmFtZSwgaGFuZGxlcilcbn0iLGV4ZWNSZWN1cnNpdmVseToiKG9iaiA9IHt9LCB0eXBlRmlsdGVyID0gW10sIGZuKSA9PiB7XG4gIGZ1bmN0aW9uIHJlY3Vyc2Uob2JqKSB7XG4gICAgZm9yIChjb25zdCBrZXkgaW4gb2JqKSB7XG4gICAgICBpZiAob2JqW2tleV0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb250aW51ZVxuICAgICAgfVxuICAgICAgaWYgKG9ialtrZXldICYmIHR5cGVvZiBvYmpba2V5XSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgcmVjdXJzZShvYmpba2V5XSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChvYmpba2V5XSAmJiB0eXBlRmlsdGVyLmluY2x1ZGVzKHR5cGVvZiBvYmpba2V5XSkpIHtcbiAgICAgICAgICBmbi5jYWxsKHRoaXMsIG9ialtrZXldKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJlY3Vyc2Uob2JqKVxuICByZXR1cm4gb2JqXG59IixzdHJpbmdpZnlGbnM6Iihmbk9iaiA9IHsgaGVsbG86ICgpID0+ICd3b3JsZCcgfSkgPT4ge1xuICAvLyBPYmplY3QuZnJvbUVudHJpZXMoKSBwb255ZmlsbCAoaW4gNiBsaW5lcykgLSBzdXBwb3J0ZWQgb25seSBpbiBOb2RlIHYxMissIG1vZGVybiBicm93c2VycyBhcmUgZmluZVxuICAvLyBodHRwczovL2dpdGh1Yi5jb20vZmVyb3NzL2Zyb21lbnRyaWVzXG4gIGZ1bmN0aW9uIGZyb21FbnRyaWVzKGl0ZXJhYmxlKSB7XG4gICAgcmV0dXJuIFsuLi5pdGVyYWJsZV0ucmVkdWNlKChvYmosIFtrZXksIHZhbF0pID0+IHtcbiAgICAgIG9ialtrZXldID0gdmFsXG4gICAgICByZXR1cm4gb2JqXG4gICAgfSwge30pXG4gIH1cbiAgcmV0dXJuIChPYmplY3QuZnJvbUVudHJpZXMgfHwgZnJvbUVudHJpZXMpKFxuICAgIE9iamVjdC5lbnRyaWVzKGZuT2JqKVxuICAgICAgLmZpbHRlcigoW2tleSwgdmFsdWVdKSA9PiB0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpXG4gICAgICAubWFwKChba2V5LCB2YWx1ZV0pID0+IFtrZXksIHZhbHVlLnRvU3RyaW5nKCldKSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWV2YWxcbiAgKVxufSIsbWF0ZXJpYWxpemVGbnM6IihmblN0ck9iaiA9IHsgaGVsbG86IFwiKCkgPT4gJ3dvcmxkJ1wiIH0pID0+IHtcbiAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICBPYmplY3QuZW50cmllcyhmblN0ck9iaikubWFwKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgIGlmICh2YWx1ZS5zdGFydHNXaXRoKCdmdW5jdGlvbicpKSB7XG4gICAgICAgIC8vIHNvbWUgdHJpY2tlcnkgaXMgbmVlZGVkIHRvIG1ha2Ugb2xkc2Nob29sIGZ1bmN0aW9ucyB3b3JrIDotKVxuICAgICAgICByZXR1cm4gW2tleSwgZXZhbChgKCkgPT4gJHt2YWx1ZX1gKSgpXSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWV2YWxcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGFycm93IGZ1bmN0aW9ucyBqdXN0IHdvcmtcbiAgICAgICAgcmV0dXJuIFtrZXksIGV2YWwodmFsdWUpXSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWV2YWxcbiAgICAgIH1cbiAgICB9KVxuICApXG59IixtYWtlSGFuZGxlcjoiKCkgPT4gKHtcbiAgLy8gVXNlZCBieSBzaW1wbGUgYG5hdmlnYXRvcmAgZ2V0dGVyIGV2YXNpb25zXG4gIGdldHRlclZhbHVlOiB2YWx1ZSA9PiAoe1xuICAgIGFwcGx5KHRhcmdldCwgY3R4LCBhcmdzKSB7XG4gICAgICAvLyBMZXQncyBmZXRjaCB0aGUgdmFsdWUgZmlyc3QsIHRvIHRyaWdnZXIgYW5kIGVzY2FsYXRlIHBvdGVudGlhbCBlcnJvcnNcbiAgICAgIC8vIElsbGVnYWwgaW52b2NhdGlvbnMgbGlrZSBgbmF2aWdhdG9yLl9fcHJvdG9fXy52ZW5kb3JgIHdpbGwgdGhyb3cgaGVyZVxuICAgICAgdXRpbHMuY2FjaGUuUmVmbGVjdC5hcHBseSguLi5hcmd1bWVudHMpXG4gICAgICByZXR1cm4gdmFsdWVcbiAgICB9XG4gIH0pXG59KSJ9LF9tYWluRnVuY3Rpb246Iih1dGlscywgeyBvcHRzIH0pID0+IHtcbiAgICAgICAgY29uc3QgbGFuZ3VhZ2VzID0gb3B0cy5sYW5ndWFnZXMubGVuZ3RoXG4gICAgICAgICAgPyBvcHRzLmxhbmd1YWdlc1xuICAgICAgICAgIDogWydlbi1VUycsICdlbiddXG4gICAgICAgIHV0aWxzLnJlcGxhY2VHZXR0ZXJXaXRoUHJveHkoXG4gICAgICAgICAgT2JqZWN0LmdldFByb3RvdHlwZU9mKG5hdmlnYXRvciksXG4gICAgICAgICAgJ2xhbmd1YWdlcycsXG4gICAgICAgICAgdXRpbHMubWFrZUhhbmRsZXIoKS5nZXR0ZXJWYWx1ZShPYmplY3QuZnJlZXplKFsuLi5sYW5ndWFnZXNdKSlcbiAgICAgICAgKVxuICAgICAgfSIsX2FyZ3M6W3tvcHRzOntsYW5ndWFnZXM6W119fV19KSwoKHtfdXRpbHNGbnM6X3V0aWxzRm5zLF9tYWluRnVuY3Rpb246X21haW5GdW5jdGlvbixfYXJnczpfYXJnc30pPT57Y29uc3QgdXRpbHM9T2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5lbnRyaWVzKF91dGlsc0ZucykubWFwKCgoW2tleSx2YWx1ZV0pPT5ba2V5LGV2YWwodmFsdWUpXSkpKTt1dGlscy5pbml0KCksZXZhbChfbWFpbkZ1bmN0aW9uKSh1dGlscywuLi5fYXJncyl9KSh7X3V0aWxzRm5zOntpbml0OiIoKSA9PiB7XG4gIHV0aWxzLnByZWxvYWRDYWNoZSgpXG59IixzdHJpcFByb3h5RnJvbUVycm9yczoiKGhhbmRsZXIgPSB7fSkgPT4ge1xuICBjb25zdCBuZXdIYW5kbGVyID0ge1xuICAgIHNldFByb3RvdHlwZU9mOiBmdW5jdGlvbiAodGFyZ2V0LCBwcm90bykge1xuICAgICAgaWYgKHByb3RvID09PSBudWxsKVxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY29udmVydCBvYmplY3QgdG8gcHJpbWl0aXZlIHZhbHVlJylcbiAgICAgIGlmIChPYmplY3QuZ2V0UHJvdG90eXBlT2YodGFyZ2V0KSA9PT0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHByb3RvKSkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdDeWNsaWMgX19wcm90b19fIHZhbHVlJylcbiAgICAgIH1cbiAgICAgIHJldHVybiBSZWZsZWN0LnNldFByb3RvdHlwZU9mKHRhcmdldCwgcHJvdG8pXG4gICAgfVxuICB9XG4gIC8vIFdlIHdyYXAgZWFjaCB0cmFwIGluIHRoZSBoYW5kbGVyIGluIGEgdHJ5L2NhdGNoIGFuZCBtb2RpZnkgdGhlIGVycm9yIHN0YWNrIGlmIHRoZXkgdGhyb3dcbiAgY29uc3QgdHJhcHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhoYW5kbGVyKVxuICB0cmFwcy5mb3JFYWNoKHRyYXAgPT4ge1xuICAgIG5ld0hhbmRsZXJbdHJhcF0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyBGb3J3YXJkIHRoZSBjYWxsIHRvIHRoZSBkZWZpbmVkIHByb3h5IGhhbmRsZXJcbiAgICAgICAgcmV0dXJuIGhhbmRsZXJbdHJhcF0uYXBwbHkodGhpcywgYXJndW1lbnRzIHx8IFtdKVxuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIC8vIFN0YWNrIHRyYWNlcyBkaWZmZXIgcGVyIGJyb3dzZXIsIHdlIG9ubHkgc3VwcG9ydCBjaHJvbWl1bSBiYXNlZCBvbmVzIGN1cnJlbnRseVxuICAgICAgICBpZiAoIWVyciB8fCAhZXJyLnN0YWNrIHx8ICFlcnIuc3RhY2suaW5jbHVkZXMoYGF0IGApKSB7XG4gICAgICAgICAgdGhyb3cgZXJyXG4gICAgICAgIH1cblxuICAgICAgICAvLyBXaGVuIHNvbWV0aGluZyB0aHJvd3Mgd2l0aGluIG9uZSBvZiBvdXIgdHJhcHMgdGhlIFByb3h5IHdpbGwgc2hvdyB1cCBpbiBlcnJvciBzdGFja3NcbiAgICAgICAgLy8gQW4gZWFybGllciBpbXBsZW1lbnRhdGlvbiBvZiB0aGlzIGNvZGUgd291bGQgc2ltcGx5IHN0cmlwIGxpbmVzIHdpdGggYSBibGFja2xpc3QsXG4gICAgICAgIC8vIGJ1dCBpdCBtYWtlcyBzZW5zZSB0byBiZSBtb3JlIHN1cmdpY2FsIGhlcmUgYW5kIG9ubHkgcmVtb3ZlIGxpbmVzIHJlbGF0ZWQgdG8gb3VyIFByb3h5LlxuICAgICAgICAvLyBXZSB0cnkgdG8gdXNlIGEga25vd24gXCJhbmNob3JcIiBsaW5lIGZvciB0aGF0IGFuZCBzdHJpcCBpdCB3aXRoIGV2ZXJ5dGhpbmcgYWJvdmUgaXQuXG4gICAgICAgIC8vIElmIHRoZSBhbmNob3IgbGluZSBjYW5ub3QgYmUgZm91bmQgZm9yIHNvbWUgcmVhc29uIHdlIGZhbGwgYmFjayB0byBvdXIgYmxhY2tsaXN0IGFwcHJvYWNoLlxuXG4gICAgICAgIGNvbnN0IHN0cmlwV2l0aEJsYWNrbGlzdCA9IChzdGFjaywgc3RyaXBGaXJzdExpbmUgPSB0cnVlKSA9PiB7XG4gICAgICAgICAgY29uc3QgYmxhY2tsaXN0ID0gW1xuICAgICAgICAgICAgYGF0IFJlZmxlY3QuJHt0cmFwfSBgLCAvLyBlLmcuIFJlZmxlY3QuZ2V0IG9yIFJlZmxlY3QuYXBwbHlcbiAgICAgICAgICAgIGBhdCBPYmplY3QuJHt0cmFwfSBgLCAvLyBlLmcuIE9iamVjdC5nZXQgb3IgT2JqZWN0LmFwcGx5XG4gICAgICAgICAgICBgYXQgT2JqZWN0Lm5ld0hhbmRsZXIuPGNvbXB1dGVkPiBbYXMgJHt0cmFwfV0gYCAvLyBjYXVzZWQgYnkgdGhpcyB2ZXJ5IHdyYXBwZXIgOi0pXG4gICAgICAgICAgXVxuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICBlcnIuc3RhY2tcbiAgICAgICAgICAgICAgLnNwbGl0KCdcXG4nKVxuICAgICAgICAgICAgICAvLyBBbHdheXMgcmVtb3ZlIHRoZSBmaXJzdCAoZmlsZSkgbGluZSBpbiB0aGUgc3RhY2sgKGd1YXJhbnRlZWQgdG8gYmUgb3VyIHByb3h5KVxuICAgICAgICAgICAgICAuZmlsdGVyKChsaW5lLCBpbmRleCkgPT4gIShpbmRleCA9PT0gMSAmJiBzdHJpcEZpcnN0TGluZSkpXG4gICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBsaW5lIHN0YXJ0cyB3aXRoIG9uZSBvZiBvdXIgYmxhY2tsaXN0ZWQgc3RyaW5nc1xuICAgICAgICAgICAgICAuZmlsdGVyKGxpbmUgPT4gIWJsYWNrbGlzdC5zb21lKGJsID0+IGxpbmUudHJpbSgpLnN0YXJ0c1dpdGgoYmwpKSlcbiAgICAgICAgICAgICAgLmpvaW4oJ1xcbicpXG4gICAgICAgICAgKVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc3RyaXBXaXRoQW5jaG9yID0gKHN0YWNrLCBhbmNob3IpID0+IHtcbiAgICAgICAgICBjb25zdCBzdGFja0FyciA9IHN0YWNrLnNwbGl0KCdcXG4nKVxuICAgICAgICAgIGFuY2hvciA9IGFuY2hvciB8fCBgYXQgT2JqZWN0Lm5ld0hhbmRsZXIuPGNvbXB1dGVkPiBbYXMgJHt0cmFwfV0gYCAvLyBLbm93biBmaXJzdCBQcm94eSBsaW5lIGluIGNocm9taXVtXG4gICAgICAgICAgY29uc3QgYW5jaG9ySW5kZXggPSBzdGFja0Fyci5maW5kSW5kZXgobGluZSA9PlxuICAgICAgICAgICAgbGluZS50cmltKCkuc3RhcnRzV2l0aChhbmNob3IpXG4gICAgICAgICAgKVxuICAgICAgICAgIGlmIChhbmNob3JJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZSAvLyA0MDQsIGFuY2hvciBub3QgZm91bmRcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gU3RyaXAgZXZlcnl0aGluZyBmcm9tIHRoZSB0b3AgdW50aWwgd2UgcmVhY2ggdGhlIGFuY2hvciBsaW5lXG4gICAgICAgICAgLy8gTm90ZTogV2UncmUga2VlcGluZyB0aGUgMXN0IGxpbmUgKHplcm8gaW5kZXgpIGFzIGl0J3MgdW5yZWxhdGVkIChlLmcuIGBUeXBlRXJyb3JgKVxuICAgICAgICAgIHN0YWNrQXJyLnNwbGljZSgxLCBhbmNob3JJbmRleClcbiAgICAgICAgICByZXR1cm4gc3RhY2tBcnIuam9pbignXFxuJylcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNwZWNpYWwgY2FzZXMgZHVlIHRvIG91ciBuZXN0ZWQgdG9TdHJpbmcgcHJveGllc1xuICAgICAgICBlcnIuc3RhY2sgPSBlcnIuc3RhY2sucmVwbGFjZShcbiAgICAgICAgICAnYXQgT2JqZWN0LnRvU3RyaW5nICgnLFxuICAgICAgICAgICdhdCBGdW5jdGlvbi50b1N0cmluZyAoJ1xuICAgICAgICApXG4gICAgICAgIGlmICgoZXJyLnN0YWNrIHx8ICcnKS5pbmNsdWRlcygnYXQgRnVuY3Rpb24udG9TdHJpbmcgKCcpKSB7XG4gICAgICAgICAgZXJyLnN0YWNrID0gc3RyaXBXaXRoQmxhY2tsaXN0KGVyci5zdGFjaywgZmFsc2UpXG4gICAgICAgICAgdGhyb3cgZXJyXG4gICAgICAgIH1cblxuICAgICAgICAvLyBUcnkgdXNpbmcgdGhlIGFuY2hvciBtZXRob2QsIGZhbGxiYWNrIHRvIGJsYWNrbGlzdCBpZiBuZWNlc3NhcnlcbiAgICAgICAgZXJyLnN0YWNrID0gc3RyaXBXaXRoQW5jaG9yKGVyci5zdGFjaykgfHwgc3RyaXBXaXRoQmxhY2tsaXN0KGVyci5zdGFjaylcblxuICAgICAgICB0aHJvdyBlcnIgLy8gUmUtdGhyb3cgb3VyIG5vdyBzYW5pdGl6ZWQgZXJyb3JcbiAgICAgIH1cbiAgICB9XG4gIH0pXG4gIHJldHVybiBuZXdIYW5kbGVyXG59IixzdHJpcEVycm9yV2l0aEFuY2hvcjoiKGVyciwgYW5jaG9yKSA9PiB7XG4gIGNvbnN0IHN0YWNrQXJyID0gZXJyLnN0YWNrLnNwbGl0KCdcXG4nKVxuICBjb25zdCBhbmNob3JJbmRleCA9IHN0YWNrQXJyLmZpbmRJbmRleChsaW5lID0+IGxpbmUudHJpbSgpLnN0YXJ0c1dpdGgoYW5jaG9yKSlcbiAgaWYgKGFuY2hvckluZGV4ID09PSAtMSkge1xuICAgIHJldHVybiBlcnIgLy8gNDA0LCBhbmNob3Igbm90IGZvdW5kXG4gIH1cbiAgLy8gU3RyaXAgZXZlcnl0aGluZyBmcm9tIHRoZSB0b3AgdW50aWwgd2UgcmVhY2ggdGhlIGFuY2hvciBsaW5lIChyZW1vdmUgYW5jaG9yIGxpbmUgYXMgd2VsbClcbiAgLy8gTm90ZTogV2UncmUga2VlcGluZyB0aGUgMXN0IGxpbmUgKHplcm8gaW5kZXgpIGFzIGl0J3MgdW5yZWxhdGVkIChlLmcuIGBUeXBlRXJyb3JgKVxuICBzdGFja0Fyci5zcGxpY2UoMSwgYW5jaG9ySW5kZXgpXG4gIGVyci5zdGFjayA9IHN0YWNrQXJyLmpvaW4oJ1xcbicpXG4gIHJldHVybiBlcnJcbn0iLHJlcGxhY2VQcm9wZXJ0eToiKG9iaiwgcHJvcE5hbWUsIGRlc2NyaXB0b3JPdmVycmlkZXMgPSB7fSkgPT4ge1xuICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwgcHJvcE5hbWUsIHtcbiAgICAvLyBDb3B5IG92ZXIgdGhlIGV4aXN0aW5nIGRlc2NyaXB0b3JzICh3cml0YWJsZSwgZW51bWVyYWJsZSwgY29uZmlndXJhYmxlLCBldGMpXG4gICAgLi4uKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBwcm9wTmFtZSkgfHwge30pLFxuICAgIC8vIEFkZCBvdXIgb3ZlcnJpZGVzIChlLmcuIHZhbHVlLCBnZXQoKSlcbiAgICAuLi5kZXNjcmlwdG9yT3ZlcnJpZGVzXG4gIH0pXG59IixwcmVsb2FkQ2FjaGU6IigpID0+IHtcbiAgaWYgKHV0aWxzLmNhY2hlKSB7XG4gICAgcmV0dXJuXG4gIH1cbiAgdXRpbHMuY2FjaGUgPSB7XG4gICAgLy8gVXNlZCBpbiBvdXIgcHJveGllc1xuICAgIFJlZmxlY3Q6IHtcbiAgICAgIGdldDogUmVmbGVjdC5nZXQuYmluZChSZWZsZWN0KSxcbiAgICAgIGFwcGx5OiBSZWZsZWN0LmFwcGx5LmJpbmQoUmVmbGVjdClcbiAgICB9LFxuICAgIC8vIFVzZWQgaW4gYG1ha2VOYXRpdmVTdHJpbmdgXG4gICAgbmF0aXZlVG9TdHJpbmdTdHI6IEZ1bmN0aW9uLnRvU3RyaW5nICsgJycgLy8gPT4gYGZ1bmN0aW9uIHRvU3RyaW5nKCkgeyBbbmF0aXZlIGNvZGVdIH1gXG4gIH1cbn0iLG1ha2VOYXRpdmVTdHJpbmc6IihuYW1lID0gJycpID0+IHtcbiAgcmV0dXJuIHV0aWxzLmNhY2hlLm5hdGl2ZVRvU3RyaW5nU3RyLnJlcGxhY2UoJ3RvU3RyaW5nJywgbmFtZSB8fCAnJylcbn0iLHBhdGNoVG9TdHJpbmc6IihvYmosIHN0ciA9ICcnKSA9PiB7XG4gIGNvbnN0IGhhbmRsZXIgPSB7XG4gICAgYXBwbHk6IGZ1bmN0aW9uICh0YXJnZXQsIGN0eCkge1xuICAgICAgLy8gVGhpcyBmaXhlcyBlLmcuIGBIVE1MTWVkaWFFbGVtZW50LnByb3RvdHlwZS5jYW5QbGF5VHlwZS50b1N0cmluZyArIFwiXCJgXG4gICAgICBpZiAoY3R4ID09PSBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHV0aWxzLm1ha2VOYXRpdmVTdHJpbmcoJ3RvU3RyaW5nJylcbiAgICAgIH1cbiAgICAgIC8vIGB0b1N0cmluZ2AgdGFyZ2V0ZWQgYXQgb3VyIHByb3hpZWQgT2JqZWN0IGRldGVjdGVkXG4gICAgICBpZiAoY3R4ID09PSBvYmopIHtcbiAgICAgICAgLy8gV2UgZWl0aGVyIHJldHVybiB0aGUgb3B0aW9uYWwgc3RyaW5nIHZlcmJhdGltIG9yIGRlcml2ZSB0aGUgbW9zdCBkZXNpcmVkIHJlc3VsdCBhdXRvbWF0aWNhbGx5XG4gICAgICAgIHJldHVybiBzdHIgfHwgdXRpbHMubWFrZU5hdGl2ZVN0cmluZyhvYmoubmFtZSlcbiAgICAgIH1cbiAgICAgIC8vIENoZWNrIGlmIHRoZSB0b1N0cmluZyBwcm90eXBlIG9mIHRoZSBjb250ZXh0IGlzIHRoZSBzYW1lIGFzIHRoZSBnbG9iYWwgcHJvdG90eXBlLFxuICAgICAgLy8gaWYgbm90IGluZGljYXRlcyB0aGF0IHdlIGFyZSBkb2luZyBhIGNoZWNrIGFjcm9zcyBkaWZmZXJlbnQgd2luZG93cy4sIGUuZy4gdGhlIGlmcmFtZVdpdGhkaXJlY3RgIHRlc3QgY2FzZVxuICAgICAgY29uc3QgaGFzU2FtZVByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKFxuICAgICAgICBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmdcbiAgICAgICkuaXNQcm90b3R5cGVPZihjdHgudG9TdHJpbmcpIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcHJvdG90eXBlLWJ1aWx0aW5zXG4gICAgICBpZiAoIWhhc1NhbWVQcm90bykge1xuICAgICAgICAvLyBQYXNzIHRoZSBjYWxsIG9uIHRvIHRoZSBsb2NhbCBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcgaW5zdGVhZFxuICAgICAgICByZXR1cm4gY3R4LnRvU3RyaW5nKClcbiAgICAgIH1cbiAgICAgIHJldHVybiB0YXJnZXQuY2FsbChjdHgpXG4gICAgfVxuICB9XG5cbiAgY29uc3QgdG9TdHJpbmdQcm94eSA9IG5ldyBQcm94eShcbiAgICBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcsXG4gICAgdXRpbHMuc3RyaXBQcm94eUZyb21FcnJvcnMoaGFuZGxlcilcbiAgKVxuICB1dGlscy5yZXBsYWNlUHJvcGVydHkoRnVuY3Rpb24ucHJvdG90eXBlLCAndG9TdHJpbmcnLCB7XG4gICAgdmFsdWU6IHRvU3RyaW5nUHJveHlcbiAgfSlcbn0iLHBhdGNoVG9TdHJpbmdOZXN0ZWQ6IihvYmogPSB7fSkgPT4ge1xuICByZXR1cm4gdXRpbHMuZXhlY1JlY3Vyc2l2ZWx5KG9iaiwgWydmdW5jdGlvbiddLCB1dGlscy5wYXRjaFRvU3RyaW5nKVxufSIscmVkaXJlY3RUb1N0cmluZzoiKHByb3h5T2JqLCBvcmlnaW5hbE9iaikgPT4ge1xuICBjb25zdCBoYW5kbGVyID0ge1xuICAgIGFwcGx5OiBmdW5jdGlvbiAodGFyZ2V0LCBjdHgpIHtcbiAgICAgIC8vIFRoaXMgZml4ZXMgZS5nLiBgSFRNTE1lZGlhRWxlbWVudC5wcm90b3R5cGUuY2FuUGxheVR5cGUudG9TdHJpbmcgKyBcIlwiYFxuICAgICAgaWYgKGN0eCA9PT0gRnVuY3Rpb24ucHJvdG90eXBlLnRvU3RyaW5nKSB7XG4gICAgICAgIHJldHVybiB1dGlscy5tYWtlTmF0aXZlU3RyaW5nKCd0b1N0cmluZycpXG4gICAgICB9XG5cbiAgICAgIC8vIGB0b1N0cmluZ2AgdGFyZ2V0ZWQgYXQgb3VyIHByb3hpZWQgT2JqZWN0IGRldGVjdGVkXG4gICAgICBpZiAoY3R4ID09PSBwcm94eU9iaikge1xuICAgICAgICBjb25zdCBmYWxsYmFjayA9ICgpID0+XG4gICAgICAgICAgb3JpZ2luYWxPYmogJiYgb3JpZ2luYWxPYmoubmFtZVxuICAgICAgICAgICAgPyB1dGlscy5tYWtlTmF0aXZlU3RyaW5nKG9yaWdpbmFsT2JqLm5hbWUpXG4gICAgICAgICAgICA6IHV0aWxzLm1ha2VOYXRpdmVTdHJpbmcocHJveHlPYmoubmFtZSlcblxuICAgICAgICAvLyBSZXR1cm4gdGhlIHRvU3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIG91ciBvcmlnaW5hbCBvYmplY3QgaWYgcG9zc2libGVcbiAgICAgICAgcmV0dXJuIG9yaWdpbmFsT2JqICsgJycgfHwgZmFsbGJhY2soKVxuICAgICAgfVxuXG4gICAgICBpZiAodHlwZW9mIGN0eCA9PT0gJ3VuZGVmaW5lZCcgfHwgY3R4ID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiB0YXJnZXQuY2FsbChjdHgpXG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIHRoZSB0b1N0cmluZyBwcm90eXBlIG9mIHRoZSBjb250ZXh0IGlzIHRoZSBzYW1lIGFzIHRoZSBnbG9iYWwgcHJvdG90eXBlLFxuICAgICAgLy8gaWYgbm90IGluZGljYXRlcyB0aGF0IHdlIGFyZSBkb2luZyBhIGNoZWNrIGFjcm9zcyBkaWZmZXJlbnQgd2luZG93cy4sIGUuZy4gdGhlIGlmcmFtZVdpdGhkaXJlY3RgIHRlc3QgY2FzZVxuICAgICAgY29uc3QgaGFzU2FtZVByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKFxuICAgICAgICBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmdcbiAgICAgICkuaXNQcm90b3R5cGVPZihjdHgudG9TdHJpbmcpIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcHJvdG90eXBlLWJ1aWx0aW5zXG4gICAgICBpZiAoIWhhc1NhbWVQcm90bykge1xuICAgICAgICAvLyBQYXNzIHRoZSBjYWxsIG9uIHRvIHRoZSBsb2NhbCBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcgaW5zdGVhZFxuICAgICAgICByZXR1cm4gY3R4LnRvU3RyaW5nKClcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRhcmdldC5jYWxsKGN0eClcbiAgICB9XG4gIH1cblxuICBjb25zdCB0b1N0cmluZ1Byb3h5ID0gbmV3IFByb3h5KFxuICAgIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZyxcbiAgICB1dGlscy5zdHJpcFByb3h5RnJvbUVycm9ycyhoYW5kbGVyKVxuICApXG4gIHV0aWxzLnJlcGxhY2VQcm9wZXJ0eShGdW5jdGlvbi5wcm90b3R5cGUsICd0b1N0cmluZycsIHtcbiAgICB2YWx1ZTogdG9TdHJpbmdQcm94eVxuICB9KVxufSIscmVwbGFjZVdpdGhQcm94eToiKG9iaiwgcHJvcE5hbWUsIGhhbmRsZXIpID0+IHtcbiAgY29uc3Qgb3JpZ2luYWxPYmogPSBvYmpbcHJvcE5hbWVdXG4gIGNvbnN0IHByb3h5T2JqID0gbmV3IFByb3h5KG9ialtwcm9wTmFtZV0sIHV0aWxzLnN0cmlwUHJveHlGcm9tRXJyb3JzKGhhbmRsZXIpKVxuXG4gIHV0aWxzLnJlcGxhY2VQcm9wZXJ0eShvYmosIHByb3BOYW1lLCB7IHZhbHVlOiBwcm94eU9iaiB9KVxuICB1dGlscy5yZWRpcmVjdFRvU3RyaW5nKHByb3h5T2JqLCBvcmlnaW5hbE9iailcblxuICByZXR1cm4gdHJ1ZVxufSIscmVwbGFjZUdldHRlcldpdGhQcm94eToiKG9iaiwgcHJvcE5hbWUsIGhhbmRsZXIpID0+IHtcbiAgY29uc3QgZm4gPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwgcHJvcE5hbWUpLmdldFxuICBjb25zdCBmblN0ciA9IGZuLnRvU3RyaW5nKCkgLy8gc3BlY2lhbCBnZXR0ZXIgZnVuY3Rpb24gc3RyaW5nXG4gIGNvbnN0IHByb3h5T2JqID0gbmV3IFByb3h5KGZuLCB1dGlscy5zdHJpcFByb3h5RnJvbUVycm9ycyhoYW5kbGVyKSlcblxuICB1dGlscy5yZXBsYWNlUHJvcGVydHkob2JqLCBwcm9wTmFtZSwgeyBnZXQ6IHByb3h5T2JqIH0pXG4gIHV0aWxzLnBhdGNoVG9TdHJpbmcocHJveHlPYmosIGZuU3RyKVxuXG4gIHJldHVybiB0cnVlXG59Iixtb2NrV2l0aFByb3h5OiIob2JqLCBwcm9wTmFtZSwgcHNldWRvVGFyZ2V0LCBoYW5kbGVyKSA9PiB7XG4gIGNvbnN0IHByb3h5T2JqID0gbmV3IFByb3h5KHBzZXVkb1RhcmdldCwgdXRpbHMuc3RyaXBQcm94eUZyb21FcnJvcnMoaGFuZGxlcikpXG5cbiAgdXRpbHMucmVwbGFjZVByb3BlcnR5KG9iaiwgcHJvcE5hbWUsIHsgdmFsdWU6IHByb3h5T2JqIH0pXG4gIHV0aWxzLnBhdGNoVG9TdHJpbmcocHJveHlPYmopXG5cbiAgcmV0dXJuIHRydWVcbn0iLGNyZWF0ZVByb3h5OiIocHNldWRvVGFyZ2V0LCBoYW5kbGVyKSA9PiB7XG4gIGNvbnN0IHByb3h5T2JqID0gbmV3IFByb3h5KHBzZXVkb1RhcmdldCwgdXRpbHMuc3RyaXBQcm94eUZyb21FcnJvcnMoaGFuZGxlcikpXG4gIHV0aWxzLnBhdGNoVG9TdHJpbmcocHJveHlPYmopXG5cbiAgcmV0dXJuIHByb3h5T2JqXG59IixzcGxpdE9ialBhdGg6Im9ialBhdGggPT4gKHtcbiAgLy8gUmVtb3ZlIGxhc3QgZG90IGVudHJ5IChwcm9wZXJ0eSkgPT0+IGBIVE1MTWVkaWFFbGVtZW50LnByb3RvdHlwZWBcbiAgb2JqTmFtZTogb2JqUGF0aC5zcGxpdCgnLicpLnNsaWNlKDAsIC0xKS5qb2luKCcuJyksXG4gIC8vIEV4dHJhY3QgbGFzdCBkb3QgZW50cnkgPT0+IGBjYW5QbGF5VHlwZWBcbiAgcHJvcE5hbWU6IG9ialBhdGguc3BsaXQoJy4nKS5zbGljZSgtMSlbMF1cbn0pIixyZXBsYWNlT2JqUGF0aFdpdGhQcm94eToiKG9ialBhdGgsIGhhbmRsZXIpID0+IHtcbiAgY29uc3QgeyBvYmpOYW1lLCBwcm9wTmFtZSB9ID0gdXRpbHMuc3BsaXRPYmpQYXRoKG9ialBhdGgpXG4gIGNvbnN0IG9iaiA9IGV2YWwob2JqTmFtZSkgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1ldmFsXG4gIHJldHVybiB1dGlscy5yZXBsYWNlV2l0aFByb3h5KG9iaiwgcHJvcE5hbWUsIGhhbmRsZXIpXG59IixleGVjUmVjdXJzaXZlbHk6IihvYmogPSB7fSwgdHlwZUZpbHRlciA9IFtdLCBmbikgPT4ge1xuICBmdW5jdGlvbiByZWN1cnNlKG9iaikge1xuICAgIGZvciAoY29uc3Qga2V5IGluIG9iaikge1xuICAgICAgaWYgKG9ialtrZXldID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29udGludWVcbiAgICAgIH1cbiAgICAgIGlmIChvYmpba2V5XSAmJiB0eXBlb2Ygb2JqW2tleV0gPT09ICdvYmplY3QnKSB7XG4gICAgICAgIHJlY3Vyc2Uob2JqW2tleV0pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAob2JqW2tleV0gJiYgdHlwZUZpbHRlci5pbmNsdWRlcyh0eXBlb2Ygb2JqW2tleV0pKSB7XG4gICAgICAgICAgZm4uY2FsbCh0aGlzLCBvYmpba2V5XSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICByZWN1cnNlKG9iailcbiAgcmV0dXJuIG9ialxufSIsc3RyaW5naWZ5Rm5zOiIoZm5PYmogPSB7IGhlbGxvOiAoKSA9PiAnd29ybGQnIH0pID0+IHtcbiAgLy8gT2JqZWN0LmZyb21FbnRyaWVzKCkgcG9ueWZpbGwgKGluIDYgbGluZXMpIC0gc3VwcG9ydGVkIG9ubHkgaW4gTm9kZSB2MTIrLCBtb2Rlcm4gYnJvd3NlcnMgYXJlIGZpbmVcbiAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2Zlcm9zcy9mcm9tZW50cmllc1xuICBmdW5jdGlvbiBmcm9tRW50cmllcyhpdGVyYWJsZSkge1xuICAgIHJldHVybiBbLi4uaXRlcmFibGVdLnJlZHVjZSgob2JqLCBba2V5LCB2YWxdKSA9PiB7XG4gICAgICBvYmpba2V5XSA9IHZhbFxuICAgICAgcmV0dXJuIG9ialxuICAgIH0sIHt9KVxuICB9XG4gIHJldHVybiAoT2JqZWN0LmZyb21FbnRyaWVzIHx8IGZyb21FbnRyaWVzKShcbiAgICBPYmplY3QuZW50cmllcyhmbk9iailcbiAgICAgIC5maWx0ZXIoKFtrZXksIHZhbHVlXSkgPT4gdHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKVxuICAgICAgLm1hcCgoW2tleSwgdmFsdWVdKSA9PiBba2V5LCB2YWx1ZS50b1N0cmluZygpXSkgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1ldmFsXG4gIClcbn0iLG1hdGVyaWFsaXplRm5zOiIoZm5TdHJPYmogPSB7IGhlbGxvOiBcIigpID0+ICd3b3JsZCdcIiB9KSA9PiB7XG4gIHJldHVybiBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgT2JqZWN0LmVudHJpZXMoZm5TdHJPYmopLm1hcCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICBpZiAodmFsdWUuc3RhcnRzV2l0aCgnZnVuY3Rpb24nKSkge1xuICAgICAgICAvLyBzb21lIHRyaWNrZXJ5IGlzIG5lZWRlZCB0byBtYWtlIG9sZHNjaG9vbCBmdW5jdGlvbnMgd29yayA6LSlcbiAgICAgICAgcmV0dXJuIFtrZXksIGV2YWwoYCgpID0+ICR7dmFsdWV9YCkoKV0gLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1ldmFsXG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBhcnJvdyBmdW5jdGlvbnMganVzdCB3b3JrXG4gICAgICAgIHJldHVybiBba2V5LCBldmFsKHZhbHVlKV0gLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1ldmFsXG4gICAgICB9XG4gICAgfSlcbiAgKVxufSIsbWFrZUhhbmRsZXI6IigpID0+ICh7XG4gIC8vIFVzZWQgYnkgc2ltcGxlIGBuYXZpZ2F0b3JgIGdldHRlciBldmFzaW9uc1xuICBnZXR0ZXJWYWx1ZTogdmFsdWUgPT4gKHtcbiAgICBhcHBseSh0YXJnZXQsIGN0eCwgYXJncykge1xuICAgICAgLy8gTGV0J3MgZmV0Y2ggdGhlIHZhbHVlIGZpcnN0LCB0byB0cmlnZ2VyIGFuZCBlc2NhbGF0ZSBwb3RlbnRpYWwgZXJyb3JzXG4gICAgICAvLyBJbGxlZ2FsIGludm9jYXRpb25zIGxpa2UgYG5hdmlnYXRvci5fX3Byb3RvX18udmVuZG9yYCB3aWxsIHRocm93IGhlcmVcbiAgICAgIHV0aWxzLmNhY2hlLlJlZmxlY3QuYXBwbHkoLi4uYXJndW1lbnRzKVxuICAgICAgcmV0dXJuIHZhbHVlXG4gICAgfVxuICB9KVxufSkifSxfbWFpbkZ1bmN0aW9uOiIodXRpbHMsIG9wdHMpID0+IHtcbiAgICAgIGNvbnN0IGlzU2VjdXJlID0gZG9jdW1lbnQubG9jYXRpb24ucHJvdG9jb2wuc3RhcnRzV2l0aCgnaHR0cHMnKVxuXG4gICAgICAvLyBJbiBoZWFkZnVsIG9uIHNlY3VyZSBvcmlnaW5zIHRoZSBwZXJtaXNzaW9uIHNob3VsZCBiZSBcImRlZmF1bHRcIiwgbm90IFwiZGVuaWVkXCJcbiAgICAgIGlmIChpc1NlY3VyZSkge1xuICAgICAgICB1dGlscy5yZXBsYWNlR2V0dGVyV2l0aFByb3h5KE5vdGlmaWNhdGlvbiwgJ3Blcm1pc3Npb24nLCB7XG4gICAgICAgICAgYXBwbHkoKSB7XG4gICAgICAgICAgICByZXR1cm4gJ2RlZmF1bHQnXG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgfVxuXG4gICAgICAvLyBBbm90aGVyIHdlaXJkIGJlaGF2aW9yOlxuICAgICAgLy8gT24gaW5zZWN1cmUgb3JpZ2lucyBpbiBoZWFkZnVsIHRoZSBzdGF0ZSBpcyBcImRlbmllZFwiLFxuICAgICAgLy8gd2hlcmVhcyBpbiBoZWFkbGVzcyBpdCdzIFwicHJvbXB0XCJcbiAgICAgIGlmICghaXNTZWN1cmUpIHtcbiAgICAgICAgY29uc3QgaGFuZGxlciA9IHtcbiAgICAgICAgICBhcHBseSh0YXJnZXQsIGN0eCwgYXJncykge1xuICAgICAgICAgICAgY29uc3QgcGFyYW0gPSAoYXJncyB8fCBbXSlbMF1cblxuICAgICAgICAgICAgY29uc3QgaXNOb3RpZmljYXRpb25zID1cbiAgICAgICAgICAgICAgcGFyYW0gJiYgcGFyYW0ubmFtZSAmJiBwYXJhbS5uYW1lID09PSAnbm90aWZpY2F0aW9ucydcbiAgICAgICAgICAgIGlmICghaXNOb3RpZmljYXRpb25zKSB7XG4gICAgICAgICAgICAgIHJldHVybiB1dGlscy5jYWNoZS5SZWZsZWN0LmFwcGx5KC4uLmFyZ3VtZW50cylcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShcbiAgICAgICAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgIHN0YXRlOiAnZGVuaWVkJyxcbiAgICAgICAgICAgICAgICAgIG9uY2hhbmdlOiBudWxsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBQZXJtaXNzaW9uU3RhdHVzLnByb3RvdHlwZVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIE5vdGU6IERvbid0IHVzZSBgT2JqZWN0LmdldFByb3RvdHlwZU9mYCBoZXJlXG4gICAgICAgIHV0aWxzLnJlcGxhY2VXaXRoUHJveHkoUGVybWlzc2lvbnMucHJvdG90eXBlLCAncXVlcnknLCBoYW5kbGVyKVxuICAgICAgfVxuICAgIH0iLF9hcmdzOlt7fV19KSwoKHtfdXRpbHNGbnM6X3V0aWxzRm5zLF9tYWluRnVuY3Rpb246X21haW5GdW5jdGlvbixfYXJnczpfYXJnc30pPT57Y29uc3QgdXRpbHM9T2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5lbnRyaWVzKF91dGlsc0ZucykubWFwKCgoW2tleSx2YWx1ZV0pPT5ba2V5LGV2YWwodmFsdWUpXSkpKTt1dGlscy5pbml0KCksZXZhbChfbWFpbkZ1bmN0aW9uKSh1dGlscywuLi5fYXJncyl9KSh7X3V0aWxzRm5zOntpbml0OiIoKSA9PiB7XG4gIHV0aWxzLnByZWxvYWRDYWNoZSgpXG59IixzdHJpcFByb3h5RnJvbUVycm9yczoiKGhhbmRsZXIgPSB7fSkgPT4ge1xuICBjb25zdCBuZXdIYW5kbGVyID0ge1xuICAgIHNldFByb3RvdHlwZU9mOiBmdW5jdGlvbiAodGFyZ2V0LCBwcm90bykge1xuICAgICAgaWYgKHByb3RvID09PSBudWxsKVxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY29udmVydCBvYmplY3QgdG8gcHJpbWl0aXZlIHZhbHVlJylcbiAgICAgIGlmIChPYmplY3QuZ2V0UHJvdG90eXBlT2YodGFyZ2V0KSA9PT0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHByb3RvKSkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdDeWNsaWMgX19wcm90b19fIHZhbHVlJylcbiAgICAgIH1cbiAgICAgIHJldHVybiBSZWZsZWN0LnNldFByb3RvdHlwZU9mKHRhcmdldCwgcHJvdG8pXG4gICAgfVxuICB9XG4gIC8vIFdlIHdyYXAgZWFjaCB0cmFwIGluIHRoZSBoYW5kbGVyIGluIGEgdHJ5L2NhdGNoIGFuZCBtb2RpZnkgdGhlIGVycm9yIHN0YWNrIGlmIHRoZXkgdGhyb3dcbiAgY29uc3QgdHJhcHMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhoYW5kbGVyKVxuICB0cmFwcy5mb3JFYWNoKHRyYXAgPT4ge1xuICAgIG5ld0hhbmRsZXJbdHJhcF0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyBGb3J3YXJkIHRoZSBjYWxsIHRvIHRoZSBkZWZpbmVkIHByb3h5IGhhbmRsZXJcbiAgICAgICAgcmV0dXJuIGhhbmRsZXJbdHJhcF0uYXBwbHkodGhpcywgYXJndW1lbnRzIHx8IFtdKVxuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIC8vIFN0YWNrIHRyYWNlcyBkaWZmZXIgcGVyIGJyb3dzZXIsIHdlIG9ubHkgc3VwcG9ydCBjaHJvbWl1bSBiYXNlZCBvbmVzIGN1cnJlbnRseVxuICAgICAgICBpZiAoIWVyciB8fCAhZXJyLnN0YWNrIHx8ICFlcnIuc3RhY2suaW5jbHVkZXMoYGF0IGApKSB7XG4gICAgICAgICAgdGhyb3cgZXJyXG4gICAgICAgIH1cblxuICAgICAgICAvLyBXaGVuIHNvbWV0aGluZyB0aHJvd3Mgd2l0aGluIG9uZSBvZiBvdXIgdHJhcHMgdGhlIFByb3h5IHdpbGwgc2hvdyB1cCBpbiBlcnJvciBzdGFja3NcbiAgICAgICAgLy8gQW4gZWFybGllciBpbXBsZW1lbnRhdGlvbiBvZiB0aGlzIGNvZGUgd291bGQgc2ltcGx5IHN0cmlwIGxpbmVzIHdpdGggYSBibGFja2xpc3QsXG4gICAgICAgIC8vIGJ1dCBpdCBtYWtlcyBzZW5zZSB0byBiZSBtb3JlIHN1cmdpY2FsIGhlcmUgYW5kIG9ubHkgcmVtb3ZlIGxpbmVzIHJlbGF0ZWQgdG8gb3VyIFByb3h5LlxuICAgICAgICAvLyBXZSB0cnkgdG8gdXNlIGEga25vd24gXCJhbmNob3JcIiBsaW5lIGZvciB0aGF0IGFuZCBzdHJpcCBpdCB3aXRoIGV2ZXJ5dGhpbmcgYWJvdmUgaXQuXG4gICAgICAgIC8vIElmIHRoZSBhbmNob3IgbGluZSBjYW5ub3QgYmUgZm91bmQgZm9yIHNvbWUgcmVhc29uIHdlIGZhbGwgYmFjayB0byBvdXIgYmxhY2tsaXN0IGFwcHJvYWNoLlxuXG4gICAgICAgIGNvbnN0IHN0cmlwV2l0aEJsYWNrbGlzdCA9IChzdGFjaywgc3RyaXBGaXJzdExpbmUgPSB0cnVlKSA9PiB7XG4gICAgICAgICAgY29uc3QgYmxhY2tsaXN0ID0gW1xuICAgICAgICAgICAgYGF0IFJlZmxlY3QuJHt0cmFwfSBgLCAvLyBlLmcuIFJlZmxlY3QuZ2V0IG9yIFJlZmxlY3QuYXBwbHlcbiAgICAgICAgICAgIGBhdCBPYmplY3QuJHt0cmFwfSBgLCAvLyBlLmcuIE9iamVjdC5nZXQgb3IgT2JqZWN0LmFwcGx5XG4gICAgICAgICAgICBgYXQgT2JqZWN0Lm5ld0hhbmRsZXIuPGNvbXB1dGVkPiBbYXMgJHt0cmFwfV0gYCAvLyBjYXVzZWQgYnkgdGhpcyB2ZXJ5IHdyYXBwZXIgOi0pXG4gICAgICAgICAgXVxuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICBlcnIuc3RhY2tcbiAgICAgICAgICAgICAgLnNwbGl0KCdcXG4nKVxuICAgICAgICAgICAgICAvLyBBbHdheXMgcmVtb3ZlIHRoZSBmaXJzdCAoZmlsZSkgbGluZSBpbiB0aGUgc3RhY2sgKGd1YXJhbnRlZWQgdG8gYmUgb3VyIHByb3h5KVxuICAgICAgICAgICAgICAuZmlsdGVyKChsaW5lLCBpbmRleCkgPT4gIShpbmRleCA9PT0gMSAmJiBzdHJpcEZpcnN0TGluZSkpXG4gICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBsaW5lIHN0YXJ0cyB3aXRoIG9uZSBvZiBvdXIgYmxhY2tsaXN0ZWQgc3RyaW5nc1xuICAgICAgICAgICAgICAuZmlsdGVyKGxpbmUgPT4gIWJsYWNrbGlzdC5zb21lKGJsID0+IGxpbmUudHJpbSgpLnN0YXJ0c1dpdGgoYmwpKSlcbiAgICAgICAgICAgICAgLmpvaW4oJ1xcbicpXG4gICAgICAgICAgKVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc3RyaXBXaXRoQW5jaG9yID0gKHN0YWNrLCBhbmNob3IpID0+IHtcbiAgICAgICAgICBjb25zdCBzdGFja0FyciA9IHN0YWNrLnNwbGl0KCdcXG4nKVxuICAgICAgICAgIGFuY2hvciA9IGFuY2hvciB8fCBgYXQgT2JqZWN0Lm5ld0hhbmRsZXIuPGNvbXB1dGVkPiBbYXMgJHt0cmFwfV0gYCAvLyBLbm93biBmaXJzdCBQcm94eSBsaW5lIGluIGNocm9taXVtXG4gICAgICAgICAgY29uc3QgYW5jaG9ySW5kZXggPSBzdGFja0Fyci5maW5kSW5kZXgobGluZSA9PlxuICAgICAgICAgICAgbGluZS50cmltKCkuc3RhcnRzV2l0aChhbmNob3IpXG4gICAgICAgICAgKVxuICAgICAgICAgIGlmIChhbmNob3JJbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZSAvLyA0MDQsIGFuY2hvciBub3QgZm91bmRcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gU3RyaXAgZXZlcnl0aGluZyBmcm9tIHRoZSB0b3AgdW50aWwgd2UgcmVhY2ggdGhlIGFuY2hvciBsaW5lXG4gICAgICAgICAgLy8gTm90ZTogV2UncmUga2VlcGluZyB0aGUgMXN0IGxpbmUgKHplcm8gaW5kZXgpIGFzIGl0J3MgdW5yZWxhdGVkIChlLmcuIGBUeXBlRXJyb3JgKVxuICAgICAgICAgIHN0YWNrQXJyLnNwbGljZSgxLCBhbmNob3JJbmRleClcbiAgICAgICAgICByZXR1cm4gc3RhY2tBcnIuam9pbignXFxuJylcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNwZWNpYWwgY2FzZXMgZHVlIHRvIG91ciBuZXN0ZWQgdG9TdHJpbmcgcHJveGllc1xuICAgICAgICBlcnIuc3RhY2sgPSBlcnIuc3RhY2sucmVwbGFjZShcbiAgICAgICAgICAnYXQgT2JqZWN0LnRvU3RyaW5nICgnLFxuICAgICAgICAgICdhdCBGdW5jdGlvbi50b1N0cmluZyAoJ1xuICAgICAgICApXG4gICAgICAgIGlmICgoZXJyLnN0YWNrIHx8ICcnKS5pbmNsdWRlcygnYXQgRnVuY3Rpb24udG9TdHJpbmcgKCcpKSB7XG4gICAgICAgICAgZXJyLnN0YWNrID0gc3RyaXBXaXRoQmxhY2tsaXN0KGVyci5zdGFjaywgZmFsc2UpXG4gICAgICAgICAgdGhyb3cgZXJyXG4gICAgICAgIH1cblxuICAgICAgICAvLyBUcnkgdXNpbmcgdGhlIGFuY2hvciBtZXRob2QsIGZhbGxiYWNrIHRvIGJsYWNrbGlzdCBpZiBuZWNlc3NhcnlcbiAgICAgICAgZXJyLnN0YWNrID0gc3RyaXBXaXRoQW5jaG9yKGVyci5zdGFjaykgfHwgc3RyaXBXaXRoQmxhY2tsaXN0KGVyci5zdGFjaylcblxuICAgICAgICB0aHJvdyBlcnIgLy8gUmUtdGhyb3cgb3VyIG5vdyBzYW5pdGl6ZWQgZXJyb3JcbiAgICAgIH1cbiAgICB9XG4gIH0pXG4gIHJldHVybiBuZXdIYW5kbGVyXG59IixzdHJpcEVycm9yV2l0aEFuY2hvcjoiKGVyciwgYW5jaG9yKSA9PiB7XG4gIGNvbnN0IHN0YWNrQXJyID0gZXJyLnN0YWNrLnNwbGl0KCdcXG4nKVxuICBjb25zdCBhbmNob3JJbmRleCA9IHN0YWNrQXJyLmZpbmRJbmRleChsaW5lID0+IGxpbmUudHJpbSgpLnN0YXJ0c1dpdGgoYW5jaG9yKSlcbiAgaWYgKGFuY2hvckluZGV4ID09PSAtMSkge1xuICAgIHJldHVybiBlcnIgLy8gNDA0LCBhbmNob3Igbm90IGZvdW5kXG4gIH1cbiAgLy8gU3RyaXAgZXZlcnl0aGluZyBmcm9tIHRoZSB0b3AgdW50aWwgd2UgcmVhY2ggdGhlIGFuY2hvciBsaW5lIChyZW1vdmUgYW5jaG9yIGxpbmUgYXMgd2VsbClcbiAgLy8gTm90ZTogV2UncmUga2VlcGluZyB0aGUgMXN0IGxpbmUgKHplcm8gaW5kZXgpIGFzIGl0J3MgdW5yZWxhdGVkIChlLmcuIGBUeXBlRXJyb3JgKVxuICBzdGFja0Fyci5zcGxpY2UoMSwgYW5jaG9ySW5kZXgpXG4gIGVyci5zdGFjayA9IHN0YWNrQXJyLmpvaW4oJ1xcbicpXG4gIHJldHVybiBlcnJcbn0iLHJlcGxhY2VQcm9wZXJ0eToiKG9iaiwgcHJvcE5hbWUsIGRlc2NyaXB0b3JPdmVycmlkZXMgPSB7fSkgPT4ge1xuICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwgcHJvcE5hbWUsIHtcbiAgICAvLyBDb3B5IG92ZXIgdGhlIGV4aXN0aW5nIGRlc2NyaXB0b3JzICh3cml0YWJsZSwgZW51bWVyYWJsZSwgY29uZmlndXJhYmxlLCBldGMpXG4gICAgLi4uKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBwcm9wTmFtZSkgfHwge30pLFxuICAgIC8vIEFkZCBvdXIgb3ZlcnJpZGVzIChlLmcuIHZhbHVlLCBnZXQoKSlcbiAgICAuLi5kZXNjcmlwdG9yT3ZlcnJpZGVzXG4gIH0pXG59IixwcmVsb2FkQ2FjaGU6IigpID0+IHtcbiAgaWYgKHV0aWxzLmNhY2hlKSB7XG4gICAgcmV0dXJuXG4gIH1cbiAgdXRpbHMuY2FjaGUgPSB7XG4gICAgLy8gVXNlZCBpbiBvdXIgcHJveGllc1xuICAgIFJlZmxlY3Q6IHtcbiAgICAgIGdldDogUmVmbGVjdC5nZXQuYmluZChSZWZsZWN0KSxcbiAgICAgIGFwcGx5OiBSZWZsZWN0LmFwcGx5LmJpbmQoUmVmbGVjdClcbiAgICB9LFxuICAgIC8vIFVzZWQgaW4gYG1ha2VOYXRpdmVTdHJpbmdgXG4gICAgbmF0aXZlVG9TdHJpbmdTdHI6IEZ1bmN0aW9uLnRvU3RyaW5nICsgJycgLy8gPT4gYGZ1bmN0aW9uIHRvU3RyaW5nKCkgeyBbbmF0aXZlIGNvZGVdIH1gXG4gIH1cbn0iLG1ha2VOYXRpdmVTdHJpbmc6IihuYW1lID0gJycpID0+IHtcbiAgcmV0dXJuIHV0aWxzLmNhY2hlLm5hdGl2ZVRvU3RyaW5nU3RyLnJlcGxhY2UoJ3RvU3RyaW5nJywgbmFtZSB8fCAnJylcbn0iLHBhdGNoVG9TdHJpbmc6IihvYmosIHN0ciA9ICcnKSA9PiB7XG4gIGNvbnN0IGhhbmRsZXIgPSB7XG4gICAgYXBwbHk6IGZ1bmN0aW9uICh0YXJnZXQsIGN0eCkge1xuICAgICAgLy8gVGhpcyBmaXhlcyBlLmcuIGBIVE1MTWVkaWFFbGVtZW50LnByb3RvdHlwZS5jYW5QbGF5VHlwZS50b1N0cmluZyArIFwiXCJgXG4gICAgICBpZiAoY3R4ID09PSBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHV0aWxzLm1ha2VOYXRpdmVTdHJpbmcoJ3RvU3RyaW5nJylcbiAgICAgIH1cbiAgICAgIC8vIGB0b1N0cmluZ2AgdGFyZ2V0ZWQgYXQgb3VyIHByb3hpZWQgT2JqZWN0IGRldGVjdGVkXG4gICAgICBpZiAoY3R4ID09PSBvYmopIHtcbiAgICAgICAgLy8gV2UgZWl0aGVyIHJldHVybiB0aGUgb3B0aW9uYWwgc3RyaW5nIHZlcmJhdGltIG9yIGRlcml2ZSB0aGUgbW9zdCBkZXNpcmVkIHJlc3VsdCBhdXRvbWF0aWNhbGx5XG4gICAgICAgIHJldHVybiBzdHIgfHwgdXRpbHMubWFrZU5hdGl2ZVN0cmluZyhvYmoubmFtZSlcbiAgICAgIH1cbiAgICAgIC8vIENoZWNrIGlmIHRoZSB0b1N0cmluZyBwcm90eXBlIG9mIHRoZSBjb250ZXh0IGlzIHRoZSBzYW1lIGFzIHRoZSBnbG9iYWwgcHJvdG90eXBlLFxuICAgICAgLy8gaWYgbm90IGluZGljYXRlcyB0aGF0IHdlIGFyZSBkb2luZyBhIGNoZWNrIGFjcm9zcyBkaWZmZXJlbnQgd2luZG93cy4sIGUuZy4gdGhlIGlmcmFtZVdpdGhkaXJlY3RgIHRlc3QgY2FzZVxuICAgICAgY29uc3QgaGFzU2FtZVByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKFxuICAgICAgICBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmdcbiAgICAgICkuaXNQcm90b3R5cGVPZihjdHgudG9TdHJpbmcpIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcHJvdG90eXBlLWJ1aWx0aW5zXG4gICAgICBpZiAoIWhhc1NhbWVQcm90bykge1xuICAgICAgICAvLyBQYXNzIHRoZSBjYWxsIG9uIHRvIHRoZSBsb2NhbCBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcgaW5zdGVhZFxuICAgICAgICByZXR1cm4gY3R4LnRvU3RyaW5nKClcbiAgICAgIH1cbiAgICAgIHJldHVybiB0YXJnZXQuY2FsbChjdHgpXG4gICAgfVxuICB9XG5cbiAgY29uc3QgdG9TdHJpbmdQcm94eSA9IG5ldyBQcm94eShcbiAgICBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcsXG4gICAgdXRpbHMuc3RyaXBQcm94eUZyb21FcnJvcnMoaGFuZGxlcilcbiAgKVxuICB1dGlscy5yZXBsYWNlUHJvcGVydHkoRnVuY3Rpb24ucHJvdG90eXBlLCAndG9TdHJpbmcnLCB7XG4gICAgdmFsdWU6IHRvU3RyaW5nUHJveHlcbiAgfSlcbn0iLHBhdGNoVG9TdHJpbmdOZXN0ZWQ6IihvYmogPSB7fSkgPT4ge1xuICByZXR1cm4gdXRpbHMuZXhlY1JlY3Vyc2l2ZWx5KG9iaiwgWydmdW5jdGlvbiddLCB1dGlscy5wYXRjaFRvU3RyaW5nKVxufSIscmVkaXJlY3RUb1N0cmluZzoiKHByb3h5T2JqLCBvcmlnaW5hbE9iaikgPT4ge1xuICBjb25zdCBoYW5kbGVyID0ge1xuICAgIGFwcGx5OiBmdW5jdGlvbiAodGFyZ2V0LCBjdHgpIHtcbiAgICAgIC8vIFRoaXMgZml4ZXMgZS5nLiBgSFRNTE1lZGlhRWxlbWVudC5wcm90b3R5cGUuY2FuUGxheVR5cGUudG9TdHJpbmcgKyBcIlwiYFxuICAgICAgaWYgKGN0eCA9PT0gRnVuY3Rpb24ucHJvdG90eXBlLnRvU3RyaW5nKSB7XG4gICAgICAgIHJldHVybiB1dGlscy5tYWtlTmF0aXZlU3RyaW5nKCd0b1N0cmluZycpXG4gICAgICB9XG5cbiAgICAgIC8vIGB0b1N0cmluZ2AgdGFyZ2V0ZWQgYXQgb3VyIHByb3hpZWQgT2JqZWN0IGRldGVjdGVkXG4gICAgICBpZiAoY3R4ID09PSBwcm94eU9iaikge1xuICAgICAgICBjb25zdCBmYWxsYmFjayA9ICgpID0+XG4gICAgICAgICAgb3JpZ2luYWxPYmogJiYgb3JpZ2luYWxPYmoubmFtZVxuICAgICAgICAgICAgPyB1dGlscy5tYWtlTmF0aXZlU3RyaW5nKG9yaWdpbmFsT2JqLm5hbWUpXG4gICAgICAgICAgICA6IHV0aWxzLm1ha2VOYXRpdmVTdHJpbmcocHJveHlPYmoubmFtZSlcblxuICAgICAgICAvLyBSZXR1cm4gdGhlIHRvU3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIG91ciBvcmlnaW5hbCBvYmplY3QgaWYgcG9zc2libGVcbiAgICAgICAgcmV0dXJuIG9yaWdpbmFsT2JqICsgJycgfHwgZmFsbGJhY2soKVxuICAgICAgfVxuXG4gICAgICBpZiAodHlwZW9mIGN0eCA9PT0gJ3VuZGVmaW5lZCcgfHwgY3R4ID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiB0YXJnZXQuY2FsbChjdHgpXG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIHRoZSB0b1N0cmluZyBwcm90eXBlIG9mIHRoZSBjb250ZXh0IGlzIHRoZSBzYW1lIGFzIHRoZSBnbG9iYWwgcHJvdG90eXBlLFxuICAgICAgLy8gaWYgbm90IGluZGljYXRlcyB0aGF0IHdlIGFyZSBkb2luZyBhIGNoZWNrIGFjcm9zcyBkaWZmZXJlbnQgd2luZG93cy4sIGUuZy4gdGhlIGlmcmFtZVdpdGhkaXJlY3RgIHRlc3QgY2FzZVxuICAgICAgY29uc3QgaGFzU2FtZVByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKFxuICAgICAgICBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmdcbiAgICAgICkuaXNQcm90b3R5cGVPZihjdHgudG9TdHJpbmcpIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tcHJvdG90eXBlLWJ1aWx0aW5zXG4gICAgICBpZiAoIWhhc1NhbWVQcm90bykge1xuICAgICAgICAvLyBQYXNzIHRoZSBjYWxsIG9uIHRvIHRoZSBsb2NhbCBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcgaW5zdGVhZFxuICAgICAgICByZXR1cm4gY3R4LnRvU3RyaW5nKClcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRhcmdldC5jYWxsKGN0eClcbiAgICB9XG4gIH1cblxuICBjb25zdCB0b1N0cmluZ1Byb3h5ID0gbmV3IFByb3h5KFxuICAgIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZyxcbiAgICB1dGlscy5zdHJpcFByb3h5RnJvbUVycm9ycyhoYW5kbGVyKVxuICApXG4gIHV0aWxzLnJlcGxhY2VQcm9wZXJ0eShGdW5jdGlvbi5wcm90b3R5cGUsICd0b1N0cmluZycsIHtcbiAgICB2YWx1ZTogdG9TdHJpbmdQcm94eVxuICB9KVxufSIscmVwbGFjZVdpdGhQcm94eToiKG9iaiwgcHJvcE5hbWUsIGhhbmRsZXIpID0+IHtcbiAgY29uc3Qgb3JpZ2luYWxPYmogPSBvYmpbcHJvcE5hbWVdXG4gIGNvbnN0IHByb3h5T2JqID0gbmV3IFByb3h5KG9ialtwcm9wTmFtZV0sIHV0aWxzLnN0cmlwUHJveHlGcm9tRXJyb3JzKGhhbmRsZXIpKVxuXG4gIHV0aWxzLnJlcGxhY2VQcm9wZXJ0eShvYmosIHByb3BOYW1lLCB7IHZhbHVlOiBwcm94eU9iaiB9KVxuICB1dGlscy5yZWRpcmVjdFRvU3RyaW5nKHByb3h5T2JqLCBvcmlnaW5hbE9iailcblxuICByZXR1cm4gdHJ1ZVxufSIscmVwbGFjZUdldHRlcldpdGhQcm94eToiKG9iaiwgcHJvcE5hbWUsIGhhbmRsZXIpID0+IHtcbiAgY29uc3QgZm4gPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwgcHJvcE5hbWUpLmdldFxuICBjb25zdCBmblN0ciA9IGZuLnRvU3RyaW5nKCkgLy8gc3BlY2lhbCBnZXR0ZXIgZnVuY3Rpb24gc3RyaW5nXG4gIGNvbnN0IHByb3h5T2JqID0gbmV3IFByb3h5KGZuLCB1dGlscy5zdHJpcFByb3h5RnJvbUVycm9ycyhoYW5kbGVyKSlcblxuICB1dGlscy5yZXBsYWNlUHJvcGVydHkob2JqLCBwcm9wTmFtZSwgeyBnZXQ6IHByb3h5T2JqIH0pXG4gIHV0aWxzLnBhdGNoVG9TdHJpbmcocHJveHlPYmosIGZuU3RyKVxuXG4gIHJldHVybiB0cnVlXG59Iixtb2NrV2l0aFByb3h5OiIob2JqLCBwcm9wTmFtZSwgcHNldWRvVGFyZ2V0LCBoYW5kbGVyKSA9PiB7XG4gIGNvbnN0IHByb3h5T2JqID0gbmV3IFByb3h5KHBzZXVkb1RhcmdldCwgdXRpbHMuc3RyaXBQcm94eUZyb21FcnJvcnMoaGFuZGxlcikpXG5cbiAgdXRpbHMucmVwbGFjZVByb3BlcnR5KG9iaiwgcHJvcE5hbWUsIHsgdmFsdWU6IHByb3h5T2JqIH0pXG4gIHV0aWxzLnBhdGNoVG9TdHJpbmcocHJveHlPYmopXG5cbiAgcmV0dXJuIHRydWVcbn0iLGNyZWF0ZVByb3h5OiIocHNldWRvVGFyZ2V0LCBoYW5kbGVyKSA9PiB7XG4gIGNvbnN0IHByb3h5T2JqID0gbmV3IFByb3h5KHBzZXVkb1RhcmdldCwgdXRpbHMuc3RyaXBQcm94eUZyb21FcnJvcnMoaGFuZGxlcikpXG4gIHV0aWxzLnBhdGNoVG9TdHJpbmcocHJveHlPYmopXG5cbiAgcmV0dXJuIHByb3h5T2JqXG59IixzcGxpdE9ialBhdGg6Im9ialBhdGggPT4gKHtcbiAgLy8gUmVtb3ZlIGxhc3QgZG90IGVudHJ5IChwcm9wZXJ0eSkgPT0+IGBIVE1MTWVkaWFFbGVtZW50LnByb3RvdHlwZWBcbiAgb2JqTmFtZTogb2JqUGF0aC5zcGxpdCgnLicpLnNsaWNlKDAsIC0xKS5qb2luKCcuJyksXG4gIC8vIEV4dHJhY3QgbGFzdCBkb3QgZW50cnkgPT0+IGBjYW5QbGF5VHlwZWBcbiAgcHJvcE5hbWU6IG9ialBhdGguc3BsaXQoJy4nKS5zbGljZSgtMSlbMF1cbn0pIixyZXBsYWNlT2JqUGF0aFdpdGhQcm94eToiKG9ialBhdGgsIGhhbmRsZXIpID0+IHtcbiAgY29uc3QgeyBvYmpOYW1lLCBwcm9wTmFtZSB9ID0gdXRpbHMuc3BsaXRPYmpQYXRoKG9ialBhdGgpXG4gIGNvbnN0IG9iaiA9IGV2YWwob2JqTmFtZSkgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1ldmFsXG4gIHJldHVybiB1dGlscy5yZXBsYWNlV2l0aFByb3h5KG9iaiwgcHJvcE5hbWUsIGhhbmRsZXIpXG59IixleGVjUmVjdXJzaXZlbHk6IihvYmogPSB7fSwgdHlwZUZpbHRlciA9IFtdLCBmbikgPT4ge1xuICBmdW5jdGlvbiByZWN1cnNlKG9iaikge1xuICAgIGZvciAoY29uc3Qga2V5IGluIG9iaikge1xuICAgICAgaWYgKG9ialtrZXldID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29udGludWVcbiAgICAgIH1cbiAgICAgIGlmIChvYmpba2V5XSAmJiB0eXBlb2Ygb2JqW2tleV0gPT09ICdvYmplY3QnKSB7XG4gICAgICAgIHJlY3Vyc2Uob2JqW2tleV0pXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAob2JqW2tleV0gJiYgdHlwZUZpbHRlci5pbmNsdWRlcyh0eXBlb2Ygb2JqW2tleV0pKSB7XG4gICAgICAgICAgZm4uY2FsbCh0aGlzLCBvYmpba2V5XSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICByZWN1cnNlKG9iailcbiAgcmV0dXJuIG9ialxufSIsc3RyaW5naWZ5Rm5zOiIoZm5PYmogPSB7IGhlbGxvOiAoKSA9PiAnd29ybGQnIH0pID0+IHtcbiAgLy8gT2JqZWN0LmZyb21FbnRyaWVzKCkgcG9ueWZpbGwgKGluIDYgbGluZXMpIC0gc3VwcG9ydGVkIG9ubHkgaW4gTm9kZSB2MTIrLCBtb2Rlcm4gYnJvd3NlcnMgYXJlIGZpbmVcbiAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2Zlcm9zcy9mcm9tZW50cmllc1xuICBmdW5jdGlvbiBmcm9tRW50cmllcyhpdGVyYWJsZSkge1xuICAgIHJldHVybiBbLi4uaXRlcmFibGVdLnJlZHVjZSgob2JqLCBba2V5LCB2YWxdKSA9PiB7XG4gICAgICBvYmpba2V5XSA9IHZhbFxuICAgICAgcmV0dXJuIG9ialxuICAgIH0sIHt9KVxuICB9XG4gIHJldHVybiAoT2JqZWN0LmZyb21FbnRyaWVzIHx8IGZyb21FbnRyaWVzKShcbiAgICBPYmplY3QuZW50cmllcyhmbk9iailcbiAgICAgIC5maWx0ZXIoKFtrZXksIHZhbHVlXSkgPT4gdHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKVxuICAgICAgLm1hcCgoW2tleSwgdmFsdWVdKSA9PiBba2V5LCB2YWx1ZS50b1N0cmluZygpXSkgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1ldmFsXG4gIClcbn0iLG1hdGVyaWFsaXplRm5zOiIoZm5TdHJPYmogPSB7IGhlbGxvOiBcIigpID0+ICd3b3JsZCdcIiB9KSA9PiB7XG4gIHJldHVybiBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgT2JqZWN0LmVudHJpZXMoZm5TdHJPYmopLm1hcCgoW2tleSwgdmFsdWVdKSA9PiB7XG4gICAgICBpZiAodmFsdWUuc3RhcnRzV2l0aCgnZnVuY3Rpb24nKSkge1xuICAgICAgICAvLyBzb21lIHRyaWNrZXJ5IGlzIG5lZWRlZCB0byBtYWtlIG9sZHNjaG9vbCBmdW5jdGlvbnMgd29yayA6LSlcbiAgICAgICAgcmV0dXJuIFtrZXksIGV2YWwoYCgpID0+ICR7dmFsdWV9YCkoKV0gLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1ldmFsXG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBhcnJvdyBmdW5jdGlvbnMganVzdCB3b3JrXG4gICAgICAgIHJldHVybiBba2V5LCBldmFsKHZhbHVlKV0gLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1ldmFsXG4gICAgICB9XG4gICAgfSlcbiAgKVxufSIsbWFrZUhhbmRsZXI6IigpID0+ICh7XG4gIC8vIFVzZWQgYnkgc2ltcGxlIGBuYXZpZ2F0b3JgIGdldHRlciBldmFzaW9uc1xuICBnZXR0ZXJWYWx1ZTogdmFsdWUgPT4gKHtcbiAgICBhcHBseSh0YXJnZXQsIGN0eCwgYXJncykge1xuICAgICAgLy8gTGV0J3MgZmV0Y2ggdGhlIHZhbHVlIGZpcnN0LCB0byB0cmlnZ2VyIGFuZCBlc2NhbGF0ZSBwb3RlbnRpYWwgZXJyb3JzXG4gICAgICAvLyBJbGxlZ2FsIGludm9jYXRpb25zIGxpa2UgYG5hdmlnYXRvci5fX3Byb3RvX18udmVuZG9yYCB3aWxsIHRocm93IGhlcmVcbiAgICAgIHV0aWxzLmNhY2hlLlJlZmxlY3QuYXBwbHkoLi4uYXJndW1lbnRzKVxuICAgICAgcmV0dXJuIHZhbHVlXG4gICAgfVxuICB9KVxufSkifSxfbWFpbkZ1bmN0aW9uOiIodXRpbHMsIHsgZm5zLCBkYXRhIH0pID0+IHtcbiAgICAgICAgZm5zID0gdXRpbHMubWF0ZXJpYWxpemVGbnMoZm5zKVxuXG4gICAgICAgIC8vIFRoYXQgbWVhbnMgd2UncmUgcnVubmluZyBoZWFkZnVsXG4gICAgICAgIGNvbnN0IGhhc1BsdWdpbnMgPSAncGx1Z2lucycgaW4gbmF2aWdhdG9yICYmIG5hdmlnYXRvci5wbHVnaW5zLmxlbmd0aFxuICAgICAgICBpZiAoaGFzUGx1Z2lucykge1xuICAgICAgICAgIHJldHVybiAvLyBub3RoaW5nIHRvIGRvIGhlcmVcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG1pbWVUeXBlcyA9IGZucy5nZW5lcmF0ZU1pbWVUeXBlQXJyYXkodXRpbHMsIGZucykoZGF0YS5taW1lVHlwZXMpXG4gICAgICAgIGNvbnN0IHBsdWdpbnMgPSBmbnMuZ2VuZXJhdGVQbHVnaW5BcnJheSh1dGlscywgZm5zKShkYXRhLnBsdWdpbnMpXG5cbiAgICAgICAgLy8gUGx1Z2luIGFuZCBNaW1lVHlwZSBjcm9zcy1yZWZlcmVuY2UgZWFjaCBvdGhlciwgbGV0J3MgZG8gdGhhdCBub3dcbiAgICAgICAgLy8gTm90ZTogV2UncmUgbG9vcGluZyB0aHJvdWdoIGBkYXRhLnBsdWdpbnNgIGhlcmUsIG5vdCB0aGUgZ2VuZXJhdGVkIGBwbHVnaW5zYFxuICAgICAgICBmb3IgKGNvbnN0IHBsdWdpbkRhdGEgb2YgZGF0YS5wbHVnaW5zKSB7XG4gICAgICAgICAgcGx1Z2luRGF0YS5fX21pbWVUeXBlcy5mb3JFYWNoKCh0eXBlLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgcGx1Z2luc1twbHVnaW5EYXRhLm5hbWVdW2luZGV4XSA9IG1pbWVUeXBlc1t0eXBlXVxuXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocGx1Z2luc1twbHVnaW5EYXRhLm5hbWVdLCB0eXBlLCB7XG4gICAgICAgICAgICAgIHZhbHVlOiBtaW1lVHlwZXNbdHlwZV0sXG4gICAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZSxcbiAgICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsIC8vIE5vdCBlbnVtZXJhYmxlXG4gICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShtaW1lVHlwZXNbdHlwZV0sICdlbmFibGVkUGx1Z2luJywge1xuICAgICAgICAgICAgICB2YWx1ZTpcbiAgICAgICAgICAgICAgICB0eXBlID09PSAnYXBwbGljYXRpb24veC1wbmFjbCdcbiAgICAgICAgICAgICAgICAgID8gbWltZVR5cGVzWydhcHBsaWNhdGlvbi94LW5hY2wnXS5lbmFibGVkUGx1Z2luIC8vIHRoZXNlIHJlZmVyZW5jZSB0aGUgc2FtZSBwbHVnaW4sIHNvIHdlIG5lZWQgdG8gcmUtdXNlIHRoZSBQcm94eSBpbiBvcmRlciB0byBhdm9pZCBsZWFrc1xuICAgICAgICAgICAgICAgICAgOiBuZXcgUHJveHkocGx1Z2luc1twbHVnaW5EYXRhLm5hbWVdLCB7fSksIC8vIFByZXZlbnQgY2lyY3VsYXIgcmVmZXJlbmNlc1xuICAgICAgICAgICAgICB3cml0YWJsZTogZmFsc2UsXG4gICAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlLCAvLyBJbXBvcnRhbnQ6IGBKU09OLnN0cmluZ2lmeShuYXZpZ2F0b3IucGx1Z2lucylgXG4gICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9KVxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcGF0Y2hOYXZpZ2F0b3IgPSAobmFtZSwgdmFsdWUpID0+XG4gICAgICAgICAgdXRpbHMucmVwbGFjZVByb3BlcnR5KE9iamVjdC5nZXRQcm90b3R5cGVPZihuYXZpZ2F0b3IpLCBuYW1lLCB7XG4gICAgICAgICAgICBnZXQoKSB7XG4gICAgICAgICAgICAgIHJldHVybiB2YWx1ZVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG5cbiAgICAgICAgcGF0Y2hOYXZpZ2F0b3IoJ21pbWVUeXBlcycsIG1pbWVUeXBlcylcbiAgICAgICAgcGF0Y2hOYXZpZ2F0b3IoJ3BsdWdpbnMnLCBwbHVnaW5zKVxuXG4gICAgICAgIC8vIEFsbCBkb25lXG4gICAgICB9IixfYXJnczpbe2Zuczp7Z2VuZXJhdGVNaW1lVHlwZUFycmF5OiIodXRpbHMsIGZucykgPT4gbWltZVR5cGVzRGF0YSA9PiB7XG4gIHJldHVybiBmbnMuZ2VuZXJhdGVNYWdpY0FycmF5KHV0aWxzLCBmbnMpKFxuICAgIG1pbWVUeXBlc0RhdGEsXG4gICAgTWltZVR5cGVBcnJheS5wcm90b3R5cGUsXG4gICAgTWltZVR5cGUucHJvdG90eXBlLFxuICAgICd0eXBlJ1xuICApXG59IixnZW5lcmF0ZVBsdWdpbkFycmF5OiIodXRpbHMsIGZucykgPT4gcGx1Z2luc0RhdGEgPT4ge1xuICByZXR1cm4gZm5zLmdlbmVyYXRlTWFnaWNBcnJheSh1dGlscywgZm5zKShcbiAgICBwbHVnaW5zRGF0YSxcbiAgICBQbHVnaW5BcnJheS5wcm90b3R5cGUsXG4gICAgUGx1Z2luLnByb3RvdHlwZSxcbiAgICAnbmFtZSdcbiAgKVxufSIsZ2VuZXJhdGVNYWdpY0FycmF5OiIodXRpbHMsIGZucykgPT5cbiAgZnVuY3Rpb24oXG4gICAgZGF0YUFycmF5ID0gW10sXG4gICAgcHJvdG8gPSBNaW1lVHlwZUFycmF5LnByb3RvdHlwZSxcbiAgICBpdGVtUHJvdG8gPSBNaW1lVHlwZS5wcm90b3R5cGUsXG4gICAgaXRlbU1haW5Qcm9wID0gJ3R5cGUnXG4gICkge1xuICAgIC8vIFF1aWNrIGhlbHBlciB0byBzZXQgcHJvcHMgd2l0aCB0aGUgc2FtZSBkZXNjcmlwdG9ycyB2YW5pbGxhIGlzIHVzaW5nXG4gICAgY29uc3QgZGVmaW5lUHJvcCA9IChvYmosIHByb3AsIHZhbHVlKSA9PlxuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwgcHJvcCwge1xuICAgICAgICB2YWx1ZSxcbiAgICAgICAgd3JpdGFibGU6IGZhbHNlLFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSwgLy8gSW1wb3J0YW50IGZvciBtaW1lVHlwZXMgJiBwbHVnaW5zOiBgSlNPTi5zdHJpbmdpZnkobmF2aWdhdG9yLm1pbWVUeXBlcylgXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgICAgfSlcblxuICAgIC8vIExvb3Agb3ZlciBvdXIgZmFrZSBkYXRhIGFuZCBjb25zdHJ1Y3QgaXRlbXNcbiAgICBjb25zdCBtYWtlSXRlbSA9IGRhdGEgPT4ge1xuICAgICAgY29uc3QgaXRlbSA9IHt9XG4gICAgICBmb3IgKGNvbnN0IHByb3Agb2YgT2JqZWN0LmtleXMoZGF0YSkpIHtcbiAgICAgICAgaWYgKHByb3Auc3RhcnRzV2l0aCgnX18nKSkge1xuICAgICAgICAgIGNvbnRpbnVlXG4gICAgICAgIH1cbiAgICAgICAgZGVmaW5lUHJvcChpdGVtLCBwcm9wLCBkYXRhW3Byb3BdKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHBhdGNoSXRlbShpdGVtLCBkYXRhKVxuICAgIH1cblxuICAgIGNvbnN0IHBhdGNoSXRlbSA9IChpdGVtLCBkYXRhKSA9PiB7XG4gICAgICBsZXQgZGVzY3JpcHRvciA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKGl0ZW0pXG5cbiAgICAgIC8vIFNwZWNpYWwgY2FzZTogUGx1Z2lucyBoYXZlIGEgbWFnaWMgbGVuZ3RoIHByb3BlcnR5IHdoaWNoIGlzIG5vdCBlbnVtZXJhYmxlXG4gICAgICAvLyBlLmcuIGBuYXZpZ2F0b3IucGx1Z2luc1tpXS5sZW5ndGhgIHNob3VsZCBhbHdheXMgYmUgdGhlIGxlbmd0aCBvZiB0aGUgYXNzaWduZWQgbWltZVR5cGVzXG4gICAgICBpZiAoaXRlbVByb3RvID09PSBQbHVnaW4ucHJvdG90eXBlKSB7XG4gICAgICAgIGRlc2NyaXB0b3IgPSB7XG4gICAgICAgICAgLi4uZGVzY3JpcHRvcixcbiAgICAgICAgICBsZW5ndGg6IHtcbiAgICAgICAgICAgIHZhbHVlOiBkYXRhLl9fbWltZVR5cGVzLmxlbmd0aCxcbiAgICAgICAgICAgIHdyaXRhYmxlOiBmYWxzZSxcbiAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlIC8vIEltcG9ydGFudCB0byBiZSBhYmxlIHRvIHVzZSB0aGUgb3duS2V5cyB0cmFwIGluIGEgUHJveHkgdG8gc3RyaXAgYGxlbmd0aGBcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gV2UgbmVlZCB0byBzcG9vZiBhIHNwZWNpZmljIGBNaW1lVHlwZWAgb3IgYFBsdWdpbmAgb2JqZWN0XG4gICAgICBjb25zdCBvYmogPSBPYmplY3QuY3JlYXRlKGl0ZW1Qcm90bywgZGVzY3JpcHRvcilcblxuICAgICAgLy8gVmlydHVhbGx5IGFsbCBwcm9wZXJ0eSBrZXlzIGFyZSBub3QgZW51bWVyYWJsZSBpbiB2YW5pbGxhXG4gICAgICBjb25zdCBibGFja2xpc3QgPSBbLi4uT2JqZWN0LmtleXMoZGF0YSksICdsZW5ndGgnLCAnZW5hYmxlZFBsdWdpbiddXG4gICAgICByZXR1cm4gbmV3IFByb3h5KG9iaiwge1xuICAgICAgICBvd25LZXlzKHRhcmdldCkge1xuICAgICAgICAgIHJldHVybiBSZWZsZWN0Lm93bktleXModGFyZ2V0KS5maWx0ZXIoayA9PiAhYmxhY2tsaXN0LmluY2x1ZGVzKGspKVxuICAgICAgICB9LFxuICAgICAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBwcm9wKSB7XG4gICAgICAgICAgaWYgKGJsYWNrbGlzdC5pbmNsdWRlcyhwcm9wKSkge1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gUmVmbGVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBwcm9wKVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cblxuICAgIGNvbnN0IG1hZ2ljQXJyYXkgPSBbXVxuXG4gICAgLy8gTG9vcCB0aHJvdWdoIG91ciBmYWtlIGRhdGEgYW5kIHVzZSB0aGF0IHRvIGNyZWF0ZSBjb252aW5jaW5nIGVudGl0aWVzXG4gICAgZGF0YUFycmF5LmZvckVhY2goZGF0YSA9PiB7XG4gICAgICBtYWdpY0FycmF5LnB1c2gobWFrZUl0ZW0oZGF0YSkpXG4gICAgfSlcblxuICAgIC8vIEFkZCBkaXJlY3QgcHJvcGVydHkgYWNjZXNzICBiYXNlZCBvbiB0eXBlcyAoZS5nLiBgb2JqWydhcHBsaWNhdGlvbi9wZGYnXWApIGFmdGVyd2FyZHNcbiAgICBtYWdpY0FycmF5LmZvckVhY2goZW50cnkgPT4ge1xuICAgICAgZGVmaW5lUHJvcChtYWdpY0FycmF5LCBlbnRyeVtpdGVtTWFpblByb3BdLCBlbnRyeSlcbiAgICB9KVxuXG4gICAgLy8gVGhpcyBpcyB0aGUgYmVzdCB3YXkgdG8gZmFrZSB0aGUgdHlwZSB0byBtYWtlIHN1cmUgdGhpcyBpcyBmYWxzZTogYEFycmF5LmlzQXJyYXkobmF2aWdhdG9yLm1pbWVUeXBlcylgXG4gICAgY29uc3QgbWFnaWNBcnJheU9iaiA9IE9iamVjdC5jcmVhdGUocHJvdG8sIHtcbiAgICAgIC4uLk9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKG1hZ2ljQXJyYXkpLFxuXG4gICAgICAvLyBUaGVyZSdzIG9uZSB1Z2x5IHF1aXJrIHdlIHVuZm9ydHVuYXRlbHkgbmVlZCB0byB0YWtlIGNhcmUgb2Y6XG4gICAgICAvLyBUaGUgYE1pbWVUeXBlQXJyYXlgIHByb3RvdHlwZSBoYXMgYW4gZW51bWVyYWJsZSBgbGVuZ3RoYCBwcm9wZXJ0eSxcbiAgICAgIC8vIGJ1dCBoZWFkZnVsIENocm9tZSB3aWxsIHN0aWxsIHNraXAgaXQgd2hlbiBydW5uaW5nIGBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhuYXZpZ2F0b3IubWltZVR5cGVzKWAuXG4gICAgICAvLyBUbyBzdHJpcCBpdCB3ZSBuZWVkIHRvIG1ha2UgaXQgZmlyc3QgYGNvbmZpZ3VyYWJsZWAgYW5kIGNhbiB0aGVuIG92ZXJsYXkgYSBQcm94eSB3aXRoIGFuIGBvd25LZXlzYCB0cmFwLlxuICAgICAgbGVuZ3RoOiB7XG4gICAgICAgIHZhbHVlOiBtYWdpY0FycmF5Lmxlbmd0aCxcbiAgICAgICAgd3JpdGFibGU6IGZhbHNlLFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlIC8vIEltcG9ydGFudCB0byBiZSBhYmxlIHRvIHVzZSB0aGUgb3duS2V5cyB0cmFwIGluIGEgUHJveHkgdG8gc3RyaXAgYGxlbmd0aGBcbiAgICAgIH1cbiAgICB9KVxuXG4gICAgLy8gR2VuZXJhdGUgb3VyIGZ1bmN0aW9uYWwgZnVuY3Rpb24gbW9ja3MgOi0pXG4gICAgY29uc3QgZnVuY3Rpb25Nb2NrcyA9IGZucy5nZW5lcmF0ZUZ1bmN0aW9uTW9ja3ModXRpbHMpKFxuICAgICAgcHJvdG8sXG4gICAgICBpdGVtTWFpblByb3AsXG4gICAgICBtYWdpY0FycmF5XG4gICAgKVxuXG4gICAgLy8gV2UgbmVlZCB0byBvdmVybGF5IG91ciBjdXN0b20gb2JqZWN0IHdpdGggYSBKUyBQcm94eVxuICAgIGNvbnN0IG1hZ2ljQXJyYXlPYmpQcm94eSA9IG5ldyBQcm94eShtYWdpY0FycmF5T2JqLCB7XG4gICAgICBnZXQodGFyZ2V0LCBrZXkgPSAnJykge1xuICAgICAgICAvLyBSZWRpcmVjdCBmdW5jdGlvbiBjYWxscyB0byBvdXIgY3VzdG9tIHByb3hpZWQgdmVyc2lvbnMgbW9ja2luZyB0aGUgdmFuaWxsYSBiZWhhdmlvclxuICAgICAgICBpZiAoa2V5ID09PSAnaXRlbScpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb25Nb2Nrcy5pdGVtXG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleSA9PT0gJ25hbWVkSXRlbScpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb25Nb2Nrcy5uYW1lZEl0ZW1cbiAgICAgICAgfVxuICAgICAgICBpZiAocHJvdG8gPT09IFBsdWdpbkFycmF5LnByb3RvdHlwZSAmJiBrZXkgPT09ICdyZWZyZXNoJykge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbk1vY2tzLnJlZnJlc2hcbiAgICAgICAgfVxuICAgICAgICAvLyBFdmVyeXRoaW5nIGVsc2UgY2FuIHBhc3MgdGhyb3VnaCBhcyBub3JtYWxcbiAgICAgICAgcmV0dXJuIHV0aWxzLmNhY2hlLlJlZmxlY3QuZ2V0KC4uLmFyZ3VtZW50cylcbiAgICAgIH0sXG4gICAgICBvd25LZXlzKHRhcmdldCkge1xuICAgICAgICAvLyBUaGVyZSBhcmUgYSBjb3VwbGUgb2YgcXVpcmtzIHdoZXJlIHRoZSBvcmlnaW5hbCBwcm9wZXJ0eSBkZW1vbnN0cmF0ZXMgXCJtYWdpY2FsXCIgYmVoYXZpb3IgdGhhdCBtYWtlcyBubyBzZW5zZVxuICAgICAgICAvLyBUaGlzIGNhbiBiZSB3aXRuZXNzZWQgd2hlbiBjYWxsaW5nIGBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhuYXZpZ2F0b3IubWltZVR5cGVzKWAgYW5kIHRoZSBhYnNlbnNlIG9mIGBsZW5ndGhgXG4gICAgICAgIC8vIE15IGd1ZXNzIGlzIHRoYXQgaXQgaGFzIHRvIGRvIHdpdGggdGhlIHJlY2VudCBjaGFuZ2Ugb2Ygbm90IGFsbG93aW5nIGRhdGEgZW51bWVyYXRpb24gYW5kIHRoaXMgYmVpbmcgaW1wbGVtZW50ZWQgd2VpcmRseVxuICAgICAgICAvLyBGb3IgdGhhdCByZWFzb24gd2UganVzdCBjb21wbGV0ZWx5IGZha2UgdGhlIGF2YWlsYWJsZSBwcm9wZXJ0eSBuYW1lcyBiYXNlZCBvbiBvdXIgZGF0YSB0byBtYXRjaCB3aGF0IHJlZ3VsYXIgQ2hyb21lIGlzIGRvaW5nXG4gICAgICAgIC8vIFNwZWNpZmljIGlzc3VlcyB3aGVuIG5vdCBwYXRjaGluZyB0aGlzOiBgbGVuZ3RoYCBwcm9wZXJ0eSBpcyBhdmFpbGFibGUsIGRpcmVjdCBgdHlwZXNgIHByb3BzIChlLmcuIGBvYmpbJ2FwcGxpY2F0aW9uL3BkZiddYCkgYXJlIG1pc3NpbmdcbiAgICAgICAgY29uc3Qga2V5cyA9IFtdXG4gICAgICAgIGNvbnN0IHR5cGVQcm9wcyA9IG1hZ2ljQXJyYXkubWFwKG10ID0+IG10W2l0ZW1NYWluUHJvcF0pXG4gICAgICAgIHR5cGVQcm9wcy5mb3JFYWNoKChfLCBpKSA9PiBrZXlzLnB1c2goYCR7aX1gKSlcbiAgICAgICAgdHlwZVByb3BzLmZvckVhY2gocHJvcE5hbWUgPT4ga2V5cy5wdXNoKHByb3BOYW1lKSlcbiAgICAgICAgcmV0dXJuIGtleXNcbiAgICAgIH0sXG4gICAgICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBwcm9wKSB7XG4gICAgICAgIGlmIChwcm9wID09PSAnbGVuZ3RoJykge1xuICAgICAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUmVmbGVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBwcm9wKVxuICAgICAgfVxuICAgIH0pXG5cbiAgICByZXR1cm4gbWFnaWNBcnJheU9ialByb3h5XG4gIH0iLGdlbmVyYXRlRnVuY3Rpb25Nb2NrczoidXRpbHMgPT4gKFxuICBwcm90byxcbiAgaXRlbU1haW5Qcm9wLFxuICBkYXRhQXJyYXlcbikgPT4gKHtcbiAgLyoqIFJldHVybnMgdGhlIE1pbWVUeXBlIG9iamVjdCB3aXRoIHRoZSBzcGVjaWZpZWQgaW5kZXguICovXG4gIGl0ZW06IHV0aWxzLmNyZWF0ZVByb3h5KHByb3RvLml0ZW0sIHtcbiAgICBhcHBseSh0YXJnZXQsIGN0eCwgYXJncykge1xuICAgICAgaWYgKCFhcmdzLmxlbmd0aCkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFxuICAgICAgICAgIGBGYWlsZWQgdG8gZXhlY3V0ZSAnaXRlbScgb24gJyR7XG4gICAgICAgICAgICBwcm90b1tTeW1ib2wudG9TdHJpbmdUYWddXG4gICAgICAgICAgfSc6IDEgYXJndW1lbnQgcmVxdWlyZWQsIGJ1dCBvbmx5IDAgcHJlc2VudC5gXG4gICAgICAgIClcbiAgICAgIH1cbiAgICAgIC8vIFNwZWNpYWwgYmVoYXZpb3IgYWxlcnQ6XG4gICAgICAvLyAtIFZhbmlsbGEgdHJpZXMgdG8gY2FzdCBzdHJpbmdzIHRvIE51bWJlcnMgKG9ubHkgaW50ZWdlcnMhKSBhbmQgdXNlIHRoZW0gYXMgcHJvcGVydHkgaW5kZXggbG9va3VwXG4gICAgICAvLyAtIElmIGFueXRoaW5nIGVsc2UgdGhhbiBhbiBpbnRlZ2VyIChpbmNsdWRpbmcgYXMgc3RyaW5nKSBpcyBwcm92aWRlZCBpdCB3aWxsIHJldHVybiB0aGUgZmlyc3QgZW50cnlcbiAgICAgIGNvbnN0IGlzSW50ZWdlciA9IGFyZ3NbMF0gJiYgTnVtYmVyLmlzSW50ZWdlcihOdW1iZXIoYXJnc1swXSkpIC8vIENhc3QgcG90ZW50aWFsIHN0cmluZyB0byBudW1iZXIgZmlyc3QsIHRoZW4gY2hlY2sgZm9yIGludGVnZXJcbiAgICAgIC8vIE5vdGU6IFZhbmlsbGEgbmV2ZXIgcmV0dXJucyBgdW5kZWZpbmVkYFxuICAgICAgcmV0dXJuIChpc0ludGVnZXIgPyBkYXRhQXJyYXlbTnVtYmVyKGFyZ3NbMF0pXSA6IGRhdGFBcnJheVswXSkgfHwgbnVsbFxuICAgIH1cbiAgfSksXG4gIC8qKiBSZXR1cm5zIHRoZSBNaW1lVHlwZSBvYmplY3Qgd2l0aCB0aGUgc3BlY2lmaWVkIG5hbWUuICovXG4gIG5hbWVkSXRlbTogdXRpbHMuY3JlYXRlUHJveHkocHJvdG8ubmFtZWRJdGVtLCB7XG4gICAgYXBwbHkodGFyZ2V0LCBjdHgsIGFyZ3MpIHtcbiAgICAgIGlmICghYXJncy5sZW5ndGgpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcbiAgICAgICAgICBgRmFpbGVkIHRvIGV4ZWN1dGUgJ25hbWVkSXRlbScgb24gJyR7XG4gICAgICAgICAgICBwcm90b1tTeW1ib2wudG9TdHJpbmdUYWddXG4gICAgICAgICAgfSc6IDEgYXJndW1lbnQgcmVxdWlyZWQsIGJ1dCBvbmx5IDAgcHJlc2VudC5gXG4gICAgICAgIClcbiAgICAgIH1cbiAgICAgIHJldHVybiBkYXRhQXJyYXkuZmluZChtdCA9PiBtdFtpdGVtTWFpblByb3BdID09PSBhcmdzWzBdKSB8fCBudWxsIC8vIE5vdCBgdW5kZWZpbmVkYCFcbiAgICB9XG4gIH0pLFxuICAvKiogRG9lcyBub3RoaW5nIGFuZCBzaGFsbCByZXR1cm4gbm90aGluZyAqL1xuICByZWZyZXNoOiBwcm90by5yZWZyZXNoXG4gICAgPyB1dGlscy5jcmVhdGVQcm94eShwcm90by5yZWZyZXNoLCB7XG4gICAgICAgIGFwcGx5KHRhcmdldCwgY3R4LCBhcmdzKSB7XG4gICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgICAgICB9XG4gICAgICB9KVxuICAgIDogdW5kZWZpbmVkXG59KSJ9LGRhdGE6e21pbWVUeXBlczpbe3R5cGU6ImFwcGxpY2F0aW9uL3BkZiIsc3VmZml4ZXM6InBkZiIsZGVzY3JpcHRpb246IiIsX19wbHVnaW5OYW1lOiJDaHJvbWUgUERGIFZpZXdlciJ9LHt0eXBlOiJhcHBsaWNhdGlvbi94LWdvb2dsZS1jaHJvbWUtcGRmIixzdWZmaXhlczoicGRmIixkZXNjcmlwdGlvbjoiUG9ydGFibGUgRG9jdW1lbnQgRm9ybWF0IixfX3BsdWdpbk5hbWU6IkNocm9tZSBQREYgUGx1Z2luIn0se3R5cGU6ImFwcGxpY2F0aW9uL3gtbmFjbCIsc3VmZml4ZXM6IiIsZGVzY3JpcHRpb246Ik5hdGl2ZSBDbGllbnQgRXhlY3V0YWJsZSIsX19wbHVnaW5OYW1lOiJOYXRpdmUgQ2xpZW50In0se3R5cGU6ImFwcGxpY2F0aW9uL3gtcG5hY2wiLHN1ZmZpeGVzOiIiLGRlc2NyaXB0aW9uOiJQb3J0YWJsZSBOYXRpdmUgQ2xpZW50IEV4ZWN1dGFibGUiLF9fcGx1Z2luTmFtZToiTmF0aXZlIENsaWVudCJ9XSxwbHVnaW5zOlt7bmFtZToiQ2hyb21lIFBERiBQbHVnaW4iLGZpbGVuYW1lOiJpbnRlcm5hbC1wZGYtdmlld2VyIixkZXNjcmlwdGlvbjoiUG9ydGFibGUgRG9jdW1lbnQgRm9ybWF0IixfX21pbWVUeXBlczpbImFwcGxpY2F0aW9uL3gtZ29vZ2xlLWNocm9tZS1wZGYiXX0se25hbWU6IkNocm9tZSBQREYgVmlld2VyIixmaWxlbmFtZToibWhqZmJtZGdjZmpiYnBhZW9qb2ZvaG9lZmdpZWhqYWkiLGRlc2NyaXB0aW9uOiIiLF9fbWltZVR5cGVzOlsiYXBwbGljYXRpb24vcGRmIl19LHtuYW1lOiJOYXRpdmUgQ2xpZW50IixmaWxlbmFtZToiaW50ZXJuYWwtbmFjbC1wbHVnaW4iLGRlc2NyaXB0aW9uOiIiLF9fbWltZVR5cGVzOlsiYXBwbGljYXRpb24veC1uYWNsIiwiYXBwbGljYXRpb24veC1wbmFjbCJdfV19fV19KSwhMT09PW5hdmlnYXRvci53ZWJkcml2ZXJ8fHZvaWQgMD09PW5hdmlnYXRvci53ZWJkcml2ZXJ8fGRlbGV0ZSBPYmplY3QuZ2V0UHJvdG90eXBlT2YobmF2aWdhdG9yKS53ZWJkcml2ZXIsKCh7X3V0aWxzRm5zOl91dGlsc0ZucyxfbWFpbkZ1bmN0aW9uOl9tYWluRnVuY3Rpb24sX2FyZ3M6X2FyZ3N9KT0+e2NvbnN0IHV0aWxzPU9iamVjdC5mcm9tRW50cmllcyhPYmplY3QuZW50cmllcyhfdXRpbHNGbnMpLm1hcCgoKFtrZXksdmFsdWVdKT0+W2tleSxldmFsKHZhbHVlKV0pKSk7dXRpbHMuaW5pdCgpLGV2YWwoX21haW5GdW5jdGlvbikodXRpbHMsLi4uX2FyZ3MpfSkoe191dGlsc0Zuczp7aW5pdDoiKCkgPT4ge1xuICB1dGlscy5wcmVsb2FkQ2FjaGUoKVxufSIsc3RyaXBQcm94eUZyb21FcnJvcnM6IihoYW5kbGVyID0ge30pID0+IHtcbiAgY29uc3QgbmV3SGFuZGxlciA9IHtcbiAgICBzZXRQcm90b3R5cGVPZjogZnVuY3Rpb24gKHRhcmdldCwgcHJvdG8pIHtcbiAgICAgIGlmIChwcm90byA9PT0gbnVsbClcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignQ2Fubm90IGNvbnZlcnQgb2JqZWN0IHRvIHByaW1pdGl2ZSB2YWx1ZScpXG4gICAgICBpZiAoT2JqZWN0LmdldFByb3RvdHlwZU9mKHRhcmdldCkgPT09IE9iamVjdC5nZXRQcm90b3R5cGVPZihwcm90bykpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignQ3ljbGljIF9fcHJvdG9fXyB2YWx1ZScpXG4gICAgICB9XG4gICAgICByZXR1cm4gUmVmbGVjdC5zZXRQcm90b3R5cGVPZih0YXJnZXQsIHByb3RvKVxuICAgIH1cbiAgfVxuICAvLyBXZSB3cmFwIGVhY2ggdHJhcCBpbiB0aGUgaGFuZGxlciBpbiBhIHRyeS9jYXRjaCBhbmQgbW9kaWZ5IHRoZSBlcnJvciBzdGFjayBpZiB0aGV5IHRocm93XG4gIGNvbnN0IHRyYXBzID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoaGFuZGxlcilcbiAgdHJhcHMuZm9yRWFjaCh0cmFwID0+IHtcbiAgICBuZXdIYW5kbGVyW3RyYXBdID0gZnVuY3Rpb24gKCkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gRm9yd2FyZCB0aGUgY2FsbCB0byB0aGUgZGVmaW5lZCBwcm94eSBoYW5kbGVyXG4gICAgICAgIHJldHVybiBoYW5kbGVyW3RyYXBdLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyB8fCBbXSlcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAvLyBTdGFjayB0cmFjZXMgZGlmZmVyIHBlciBicm93c2VyLCB3ZSBvbmx5IHN1cHBvcnQgY2hyb21pdW0gYmFzZWQgb25lcyBjdXJyZW50bHlcbiAgICAgICAgaWYgKCFlcnIgfHwgIWVyci5zdGFjayB8fCAhZXJyLnN0YWNrLmluY2x1ZGVzKGBhdCBgKSkge1xuICAgICAgICAgIHRocm93IGVyclxuICAgICAgICB9XG5cbiAgICAgICAgLy8gV2hlbiBzb21ldGhpbmcgdGhyb3dzIHdpdGhpbiBvbmUgb2Ygb3VyIHRyYXBzIHRoZSBQcm94eSB3aWxsIHNob3cgdXAgaW4gZXJyb3Igc3RhY2tzXG4gICAgICAgIC8vIEFuIGVhcmxpZXIgaW1wbGVtZW50YXRpb24gb2YgdGhpcyBjb2RlIHdvdWxkIHNpbXBseSBzdHJpcCBsaW5lcyB3aXRoIGEgYmxhY2tsaXN0LFxuICAgICAgICAvLyBidXQgaXQgbWFrZXMgc2Vuc2UgdG8gYmUgbW9yZSBzdXJnaWNhbCBoZXJlIGFuZCBvbmx5IHJlbW92ZSBsaW5lcyByZWxhdGVkIHRvIG91ciBQcm94eS5cbiAgICAgICAgLy8gV2UgdHJ5IHRvIHVzZSBhIGtub3duIFwiYW5jaG9yXCIgbGluZSBmb3IgdGhhdCBhbmQgc3RyaXAgaXQgd2l0aCBldmVyeXRoaW5nIGFib3ZlIGl0LlxuICAgICAgICAvLyBJZiB0aGUgYW5jaG9yIGxpbmUgY2Fubm90IGJlIGZvdW5kIGZvciBzb21lIHJlYXNvbiB3ZSBmYWxsIGJhY2sgdG8gb3VyIGJsYWNrbGlzdCBhcHByb2FjaC5cblxuICAgICAgICBjb25zdCBzdHJpcFdpdGhCbGFja2xpc3QgPSAoc3RhY2ssIHN0cmlwRmlyc3RMaW5lID0gdHJ1ZSkgPT4ge1xuICAgICAgICAgIGNvbnN0IGJsYWNrbGlzdCA9IFtcbiAgICAgICAgICAgIGBhdCBSZWZsZWN0LiR7dHJhcH0gYCwgLy8gZS5nLiBSZWZsZWN0LmdldCBvciBSZWZsZWN0LmFwcGx5XG4gICAgICAgICAgICBgYXQgT2JqZWN0LiR7dHJhcH0gYCwgLy8gZS5nLiBPYmplY3QuZ2V0IG9yIE9iamVjdC5hcHBseVxuICAgICAgICAgICAgYGF0IE9iamVjdC5uZXdIYW5kbGVyLjxjb21wdXRlZD4gW2FzICR7dHJhcH1dIGAgLy8gY2F1c2VkIGJ5IHRoaXMgdmVyeSB3cmFwcGVyIDotKVxuICAgICAgICAgIF1cbiAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgZXJyLnN0YWNrXG4gICAgICAgICAgICAgIC5zcGxpdCgnXFxuJylcbiAgICAgICAgICAgICAgLy8gQWx3YXlzIHJlbW92ZSB0aGUgZmlyc3QgKGZpbGUpIGxpbmUgaW4gdGhlIHN0YWNrIChndWFyYW50ZWVkIHRvIGJlIG91ciBwcm94eSlcbiAgICAgICAgICAgICAgLmZpbHRlcigobGluZSwgaW5kZXgpID0+ICEoaW5kZXggPT09IDEgJiYgc3RyaXBGaXJzdExpbmUpKVxuICAgICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgbGluZSBzdGFydHMgd2l0aCBvbmUgb2Ygb3VyIGJsYWNrbGlzdGVkIHN0cmluZ3NcbiAgICAgICAgICAgICAgLmZpbHRlcihsaW5lID0+ICFibGFja2xpc3Quc29tZShibCA9PiBsaW5lLnRyaW0oKS5zdGFydHNXaXRoKGJsKSkpXG4gICAgICAgICAgICAgIC5qb2luKCdcXG4nKVxuICAgICAgICAgIClcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHN0cmlwV2l0aEFuY2hvciA9IChzdGFjaywgYW5jaG9yKSA9PiB7XG4gICAgICAgICAgY29uc3Qgc3RhY2tBcnIgPSBzdGFjay5zcGxpdCgnXFxuJylcbiAgICAgICAgICBhbmNob3IgPSBhbmNob3IgfHwgYGF0IE9iamVjdC5uZXdIYW5kbGVyLjxjb21wdXRlZD4gW2FzICR7dHJhcH1dIGAgLy8gS25vd24gZmlyc3QgUHJveHkgbGluZSBpbiBjaHJvbWl1bVxuICAgICAgICAgIGNvbnN0IGFuY2hvckluZGV4ID0gc3RhY2tBcnIuZmluZEluZGV4KGxpbmUgPT5cbiAgICAgICAgICAgIGxpbmUudHJpbSgpLnN0YXJ0c1dpdGgoYW5jaG9yKVxuICAgICAgICAgIClcbiAgICAgICAgICBpZiAoYW5jaG9ySW5kZXggPT09IC0xKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2UgLy8gNDA0LCBhbmNob3Igbm90IGZvdW5kXG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIFN0cmlwIGV2ZXJ5dGhpbmcgZnJvbSB0aGUgdG9wIHVudGlsIHdlIHJlYWNoIHRoZSBhbmNob3IgbGluZVxuICAgICAgICAgIC8vIE5vdGU6IFdlJ3JlIGtlZXBpbmcgdGhlIDFzdCBsaW5lICh6ZXJvIGluZGV4KSBhcyBpdCdzIHVucmVsYXRlZCAoZS5nLiBgVHlwZUVycm9yYClcbiAgICAgICAgICBzdGFja0Fyci5zcGxpY2UoMSwgYW5jaG9ySW5kZXgpXG4gICAgICAgICAgcmV0dXJuIHN0YWNrQXJyLmpvaW4oJ1xcbicpXG4gICAgICAgIH1cblxuICAgICAgICAvLyBTcGVjaWFsIGNhc2VzIGR1ZSB0byBvdXIgbmVzdGVkIHRvU3RyaW5nIHByb3hpZXNcbiAgICAgICAgZXJyLnN0YWNrID0gZXJyLnN0YWNrLnJlcGxhY2UoXG4gICAgICAgICAgJ2F0IE9iamVjdC50b1N0cmluZyAoJyxcbiAgICAgICAgICAnYXQgRnVuY3Rpb24udG9TdHJpbmcgKCdcbiAgICAgICAgKVxuICAgICAgICBpZiAoKGVyci5zdGFjayB8fCAnJykuaW5jbHVkZXMoJ2F0IEZ1bmN0aW9uLnRvU3RyaW5nICgnKSkge1xuICAgICAgICAgIGVyci5zdGFjayA9IHN0cmlwV2l0aEJsYWNrbGlzdChlcnIuc3RhY2ssIGZhbHNlKVxuICAgICAgICAgIHRocm93IGVyclxuICAgICAgICB9XG5cbiAgICAgICAgLy8gVHJ5IHVzaW5nIHRoZSBhbmNob3IgbWV0aG9kLCBmYWxsYmFjayB0byBibGFja2xpc3QgaWYgbmVjZXNzYXJ5XG4gICAgICAgIGVyci5zdGFjayA9IHN0cmlwV2l0aEFuY2hvcihlcnIuc3RhY2spIHx8IHN0cmlwV2l0aEJsYWNrbGlzdChlcnIuc3RhY2spXG5cbiAgICAgICAgdGhyb3cgZXJyIC8vIFJlLXRocm93IG91ciBub3cgc2FuaXRpemVkIGVycm9yXG4gICAgICB9XG4gICAgfVxuICB9KVxuICByZXR1cm4gbmV3SGFuZGxlclxufSIsc3RyaXBFcnJvcldpdGhBbmNob3I6IihlcnIsIGFuY2hvcikgPT4ge1xuICBjb25zdCBzdGFja0FyciA9IGVyci5zdGFjay5zcGxpdCgnXFxuJylcbiAgY29uc3QgYW5jaG9ySW5kZXggPSBzdGFja0Fyci5maW5kSW5kZXgobGluZSA9PiBsaW5lLnRyaW0oKS5zdGFydHNXaXRoKGFuY2hvcikpXG4gIGlmIChhbmNob3JJbmRleCA9PT0gLTEpIHtcbiAgICByZXR1cm4gZXJyIC8vIDQwNCwgYW5jaG9yIG5vdCBmb3VuZFxuICB9XG4gIC8vIFN0cmlwIGV2ZXJ5dGhpbmcgZnJvbSB0aGUgdG9wIHVudGlsIHdlIHJlYWNoIHRoZSBhbmNob3IgbGluZSAocmVtb3ZlIGFuY2hvciBsaW5lIGFzIHdlbGwpXG4gIC8vIE5vdGU6IFdlJ3JlIGtlZXBpbmcgdGhlIDFzdCBsaW5lICh6ZXJvIGluZGV4KSBhcyBpdCdzIHVucmVsYXRlZCAoZS5nLiBgVHlwZUVycm9yYClcbiAgc3RhY2tBcnIuc3BsaWNlKDEsIGFuY2hvckluZGV4KVxuICBlcnIuc3RhY2sgPSBzdGFja0Fyci5qb2luKCdcXG4nKVxuICByZXR1cm4gZXJyXG59IixyZXBsYWNlUHJvcGVydHk6IihvYmosIHByb3BOYW1lLCBkZXNjcmlwdG9yT3ZlcnJpZGVzID0ge30pID0+IHtcbiAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIHByb3BOYW1lLCB7XG4gICAgLy8gQ29weSBvdmVyIHRoZSBleGlzdGluZyBkZXNjcmlwdG9ycyAod3JpdGFibGUsIGVudW1lcmFibGUsIGNvbmZpZ3VyYWJsZSwgZXRjKVxuICAgIC4uLihPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwgcHJvcE5hbWUpIHx8IHt9KSxcbiAgICAvLyBBZGQgb3VyIG92ZXJyaWRlcyAoZS5nLiB2YWx1ZSwgZ2V0KCkpXG4gICAgLi4uZGVzY3JpcHRvck92ZXJyaWRlc1xuICB9KVxufSIscHJlbG9hZENhY2hlOiIoKSA9PiB7XG4gIGlmICh1dGlscy5jYWNoZSkge1xuICAgIHJldHVyblxuICB9XG4gIHV0aWxzLmNhY2hlID0ge1xuICAgIC8vIFVzZWQgaW4gb3VyIHByb3hpZXNcbiAgICBSZWZsZWN0OiB7XG4gICAgICBnZXQ6IFJlZmxlY3QuZ2V0LmJpbmQoUmVmbGVjdCksXG4gICAgICBhcHBseTogUmVmbGVjdC5hcHBseS5iaW5kKFJlZmxlY3QpXG4gICAgfSxcbiAgICAvLyBVc2VkIGluIGBtYWtlTmF0aXZlU3RyaW5nYFxuICAgIG5hdGl2ZVRvU3RyaW5nU3RyOiBGdW5jdGlvbi50b1N0cmluZyArICcnIC8vID0+IGBmdW5jdGlvbiB0b1N0cmluZygpIHsgW25hdGl2ZSBjb2RlXSB9YFxuICB9XG59IixtYWtlTmF0aXZlU3RyaW5nOiIobmFtZSA9ICcnKSA9PiB7XG4gIHJldHVybiB1dGlscy5jYWNoZS5uYXRpdmVUb1N0cmluZ1N0ci5yZXBsYWNlKCd0b1N0cmluZycsIG5hbWUgfHwgJycpXG59IixwYXRjaFRvU3RyaW5nOiIob2JqLCBzdHIgPSAnJykgPT4ge1xuICBjb25zdCBoYW5kbGVyID0ge1xuICAgIGFwcGx5OiBmdW5jdGlvbiAodGFyZ2V0LCBjdHgpIHtcbiAgICAgIC8vIFRoaXMgZml4ZXMgZS5nLiBgSFRNTE1lZGlhRWxlbWVudC5wcm90b3R5cGUuY2FuUGxheVR5cGUudG9TdHJpbmcgKyBcIlwiYFxuICAgICAgaWYgKGN0eCA9PT0gRnVuY3Rpb24ucHJvdG90eXBlLnRvU3RyaW5nKSB7XG4gICAgICAgIHJldHVybiB1dGlscy5tYWtlTmF0aXZlU3RyaW5nKCd0b1N0cmluZycpXG4gICAgICB9XG4gICAgICAvLyBgdG9TdHJpbmdgIHRhcmdldGVkIGF0IG91ciBwcm94aWVkIE9iamVjdCBkZXRlY3RlZFxuICAgICAgaWYgKGN0eCA9PT0gb2JqKSB7XG4gICAgICAgIC8vIFdlIGVpdGhlciByZXR1cm4gdGhlIG9wdGlvbmFsIHN0cmluZyB2ZXJiYXRpbSBvciBkZXJpdmUgdGhlIG1vc3QgZGVzaXJlZCByZXN1bHQgYXV0b21hdGljYWxseVxuICAgICAgICByZXR1cm4gc3RyIHx8IHV0aWxzLm1ha2VOYXRpdmVTdHJpbmcob2JqLm5hbWUpXG4gICAgICB9XG4gICAgICAvLyBDaGVjayBpZiB0aGUgdG9TdHJpbmcgcHJvdHlwZSBvZiB0aGUgY29udGV4dCBpcyB0aGUgc2FtZSBhcyB0aGUgZ2xvYmFsIHByb3RvdHlwZSxcbiAgICAgIC8vIGlmIG5vdCBpbmRpY2F0ZXMgdGhhdCB3ZSBhcmUgZG9pbmcgYSBjaGVjayBhY3Jvc3MgZGlmZmVyZW50IHdpbmRvd3MuLCBlLmcuIHRoZSBpZnJhbWVXaXRoZGlyZWN0YCB0ZXN0IGNhc2VcbiAgICAgIGNvbnN0IGhhc1NhbWVQcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihcbiAgICAgICAgRnVuY3Rpb24ucHJvdG90eXBlLnRvU3RyaW5nXG4gICAgICApLmlzUHJvdG90eXBlT2YoY3R4LnRvU3RyaW5nKSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXByb3RvdHlwZS1idWlsdGluc1xuICAgICAgaWYgKCFoYXNTYW1lUHJvdG8pIHtcbiAgICAgICAgLy8gUGFzcyB0aGUgY2FsbCBvbiB0byB0aGUgbG9jYWwgRnVuY3Rpb24ucHJvdG90eXBlLnRvU3RyaW5nIGluc3RlYWRcbiAgICAgICAgcmV0dXJuIGN0eC50b1N0cmluZygpXG4gICAgICB9XG4gICAgICByZXR1cm4gdGFyZ2V0LmNhbGwoY3R4KVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHRvU3RyaW5nUHJveHkgPSBuZXcgUHJveHkoXG4gICAgRnVuY3Rpb24ucHJvdG90eXBlLnRvU3RyaW5nLFxuICAgIHV0aWxzLnN0cmlwUHJveHlGcm9tRXJyb3JzKGhhbmRsZXIpXG4gIClcbiAgdXRpbHMucmVwbGFjZVByb3BlcnR5KEZ1bmN0aW9uLnByb3RvdHlwZSwgJ3RvU3RyaW5nJywge1xuICAgIHZhbHVlOiB0b1N0cmluZ1Byb3h5XG4gIH0pXG59IixwYXRjaFRvU3RyaW5nTmVzdGVkOiIob2JqID0ge30pID0+IHtcbiAgcmV0dXJuIHV0aWxzLmV4ZWNSZWN1cnNpdmVseShvYmosIFsnZnVuY3Rpb24nXSwgdXRpbHMucGF0Y2hUb1N0cmluZylcbn0iLHJlZGlyZWN0VG9TdHJpbmc6Iihwcm94eU9iaiwgb3JpZ2luYWxPYmopID0+IHtcbiAgY29uc3QgaGFuZGxlciA9IHtcbiAgICBhcHBseTogZnVuY3Rpb24gKHRhcmdldCwgY3R4KSB7XG4gICAgICAvLyBUaGlzIGZpeGVzIGUuZy4gYEhUTUxNZWRpYUVsZW1lbnQucHJvdG90eXBlLmNhblBsYXlUeXBlLnRvU3RyaW5nICsgXCJcImBcbiAgICAgIGlmIChjdHggPT09IEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZykge1xuICAgICAgICByZXR1cm4gdXRpbHMubWFrZU5hdGl2ZVN0cmluZygndG9TdHJpbmcnKVxuICAgICAgfVxuXG4gICAgICAvLyBgdG9TdHJpbmdgIHRhcmdldGVkIGF0IG91ciBwcm94aWVkIE9iamVjdCBkZXRlY3RlZFxuICAgICAgaWYgKGN0eCA9PT0gcHJveHlPYmopIHtcbiAgICAgICAgY29uc3QgZmFsbGJhY2sgPSAoKSA9PlxuICAgICAgICAgIG9yaWdpbmFsT2JqICYmIG9yaWdpbmFsT2JqLm5hbWVcbiAgICAgICAgICAgID8gdXRpbHMubWFrZU5hdGl2ZVN0cmluZyhvcmlnaW5hbE9iai5uYW1lKVxuICAgICAgICAgICAgOiB1dGlscy5tYWtlTmF0aXZlU3RyaW5nKHByb3h5T2JqLm5hbWUpXG5cbiAgICAgICAgLy8gUmV0dXJuIHRoZSB0b1N0cmluZyByZXByZXNlbnRhdGlvbiBvZiBvdXIgb3JpZ2luYWwgb2JqZWN0IGlmIHBvc3NpYmxlXG4gICAgICAgIHJldHVybiBvcmlnaW5hbE9iaiArICcnIHx8IGZhbGxiYWNrKClcbiAgICAgIH1cblxuICAgICAgaWYgKHR5cGVvZiBjdHggPT09ICd1bmRlZmluZWQnIHx8IGN0eCA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gdGFyZ2V0LmNhbGwoY3R4KVxuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiB0aGUgdG9TdHJpbmcgcHJvdHlwZSBvZiB0aGUgY29udGV4dCBpcyB0aGUgc2FtZSBhcyB0aGUgZ2xvYmFsIHByb3RvdHlwZSxcbiAgICAgIC8vIGlmIG5vdCBpbmRpY2F0ZXMgdGhhdCB3ZSBhcmUgZG9pbmcgYSBjaGVjayBhY3Jvc3MgZGlmZmVyZW50IHdpbmRvd3MuLCBlLmcuIHRoZSBpZnJhbWVXaXRoZGlyZWN0YCB0ZXN0IGNhc2VcbiAgICAgIGNvbnN0IGhhc1NhbWVQcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihcbiAgICAgICAgRnVuY3Rpb24ucHJvdG90eXBlLnRvU3RyaW5nXG4gICAgICApLmlzUHJvdG90eXBlT2YoY3R4LnRvU3RyaW5nKSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXByb3RvdHlwZS1idWlsdGluc1xuICAgICAgaWYgKCFoYXNTYW1lUHJvdG8pIHtcbiAgICAgICAgLy8gUGFzcyB0aGUgY2FsbCBvbiB0byB0aGUgbG9jYWwgRnVuY3Rpb24ucHJvdG90eXBlLnRvU3RyaW5nIGluc3RlYWRcbiAgICAgICAgcmV0dXJuIGN0eC50b1N0cmluZygpXG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0YXJnZXQuY2FsbChjdHgpXG4gICAgfVxuICB9XG5cbiAgY29uc3QgdG9TdHJpbmdQcm94eSA9IG5ldyBQcm94eShcbiAgICBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcsXG4gICAgdXRpbHMuc3RyaXBQcm94eUZyb21FcnJvcnMoaGFuZGxlcilcbiAgKVxuICB1dGlscy5yZXBsYWNlUHJvcGVydHkoRnVuY3Rpb24ucHJvdG90eXBlLCAndG9TdHJpbmcnLCB7XG4gICAgdmFsdWU6IHRvU3RyaW5nUHJveHlcbiAgfSlcbn0iLHJlcGxhY2VXaXRoUHJveHk6IihvYmosIHByb3BOYW1lLCBoYW5kbGVyKSA9PiB7XG4gIGNvbnN0IG9yaWdpbmFsT2JqID0gb2JqW3Byb3BOYW1lXVxuICBjb25zdCBwcm94eU9iaiA9IG5ldyBQcm94eShvYmpbcHJvcE5hbWVdLCB1dGlscy5zdHJpcFByb3h5RnJvbUVycm9ycyhoYW5kbGVyKSlcblxuICB1dGlscy5yZXBsYWNlUHJvcGVydHkob2JqLCBwcm9wTmFtZSwgeyB2YWx1ZTogcHJveHlPYmogfSlcbiAgdXRpbHMucmVkaXJlY3RUb1N0cmluZyhwcm94eU9iaiwgb3JpZ2luYWxPYmopXG5cbiAgcmV0dXJuIHRydWVcbn0iLHJlcGxhY2VHZXR0ZXJXaXRoUHJveHk6IihvYmosIHByb3BOYW1lLCBoYW5kbGVyKSA9PiB7XG4gIGNvbnN0IGZuID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIHByb3BOYW1lKS5nZXRcbiAgY29uc3QgZm5TdHIgPSBmbi50b1N0cmluZygpIC8vIHNwZWNpYWwgZ2V0dGVyIGZ1bmN0aW9uIHN0cmluZ1xuICBjb25zdCBwcm94eU9iaiA9IG5ldyBQcm94eShmbiwgdXRpbHMuc3RyaXBQcm94eUZyb21FcnJvcnMoaGFuZGxlcikpXG5cbiAgdXRpbHMucmVwbGFjZVByb3BlcnR5KG9iaiwgcHJvcE5hbWUsIHsgZ2V0OiBwcm94eU9iaiB9KVxuICB1dGlscy5wYXRjaFRvU3RyaW5nKHByb3h5T2JqLCBmblN0cilcblxuICByZXR1cm4gdHJ1ZVxufSIsbW9ja1dpdGhQcm94eToiKG9iaiwgcHJvcE5hbWUsIHBzZXVkb1RhcmdldCwgaGFuZGxlcikgPT4ge1xuICBjb25zdCBwcm94eU9iaiA9IG5ldyBQcm94eShwc2V1ZG9UYXJnZXQsIHV0aWxzLnN0cmlwUHJveHlGcm9tRXJyb3JzKGhhbmRsZXIpKVxuXG4gIHV0aWxzLnJlcGxhY2VQcm9wZXJ0eShvYmosIHByb3BOYW1lLCB7IHZhbHVlOiBwcm94eU9iaiB9KVxuICB1dGlscy5wYXRjaFRvU3RyaW5nKHByb3h5T2JqKVxuXG4gIHJldHVybiB0cnVlXG59IixjcmVhdGVQcm94eToiKHBzZXVkb1RhcmdldCwgaGFuZGxlcikgPT4ge1xuICBjb25zdCBwcm94eU9iaiA9IG5ldyBQcm94eShwc2V1ZG9UYXJnZXQsIHV0aWxzLnN0cmlwUHJveHlGcm9tRXJyb3JzKGhhbmRsZXIpKVxuICB1dGlscy5wYXRjaFRvU3RyaW5nKHByb3h5T2JqKVxuXG4gIHJldHVybiBwcm94eU9ialxufSIsc3BsaXRPYmpQYXRoOiJvYmpQYXRoID0+ICh7XG4gIC8vIFJlbW92ZSBsYXN0IGRvdCBlbnRyeSAocHJvcGVydHkpID09PiBgSFRNTE1lZGlhRWxlbWVudC5wcm90b3R5cGVgXG4gIG9iak5hbWU6IG9ialBhdGguc3BsaXQoJy4nKS5zbGljZSgwLCAtMSkuam9pbignLicpLFxuICAvLyBFeHRyYWN0IGxhc3QgZG90IGVudHJ5ID09PiBgY2FuUGxheVR5cGVgXG4gIHByb3BOYW1lOiBvYmpQYXRoLnNwbGl0KCcuJykuc2xpY2UoLTEpWzBdXG59KSIscmVwbGFjZU9ialBhdGhXaXRoUHJveHk6IihvYmpQYXRoLCBoYW5kbGVyKSA9PiB7XG4gIGNvbnN0IHsgb2JqTmFtZSwgcHJvcE5hbWUgfSA9IHV0aWxzLnNwbGl0T2JqUGF0aChvYmpQYXRoKVxuICBjb25zdCBvYmogPSBldmFsKG9iak5hbWUpIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tZXZhbFxuICByZXR1cm4gdXRpbHMucmVwbGFjZVdpdGhQcm94eShvYmosIHByb3BOYW1lLCBoYW5kbGVyKVxufSIsZXhlY1JlY3Vyc2l2ZWx5OiIob2JqID0ge30sIHR5cGVGaWx0ZXIgPSBbXSwgZm4pID0+IHtcbiAgZnVuY3Rpb24gcmVjdXJzZShvYmopIHtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBvYmopIHtcbiAgICAgIGlmIChvYmpba2V5XSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGNvbnRpbnVlXG4gICAgICB9XG4gICAgICBpZiAob2JqW2tleV0gJiYgdHlwZW9mIG9ialtrZXldID09PSAnb2JqZWN0Jykge1xuICAgICAgICByZWN1cnNlKG9ialtrZXldKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKG9ialtrZXldICYmIHR5cGVGaWx0ZXIuaW5jbHVkZXModHlwZW9mIG9ialtrZXldKSkge1xuICAgICAgICAgIGZuLmNhbGwodGhpcywgb2JqW2tleV0pXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmVjdXJzZShvYmopXG4gIHJldHVybiBvYmpcbn0iLHN0cmluZ2lmeUZuczoiKGZuT2JqID0geyBoZWxsbzogKCkgPT4gJ3dvcmxkJyB9KSA9PiB7XG4gIC8vIE9iamVjdC5mcm9tRW50cmllcygpIHBvbnlmaWxsIChpbiA2IGxpbmVzKSAtIHN1cHBvcnRlZCBvbmx5IGluIE5vZGUgdjEyKywgbW9kZXJuIGJyb3dzZXJzIGFyZSBmaW5lXG4gIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9mZXJvc3MvZnJvbWVudHJpZXNcbiAgZnVuY3Rpb24gZnJvbUVudHJpZXMoaXRlcmFibGUpIHtcbiAgICByZXR1cm4gWy4uLml0ZXJhYmxlXS5yZWR1Y2UoKG9iaiwgW2tleSwgdmFsXSkgPT4ge1xuICAgICAgb2JqW2tleV0gPSB2YWxcbiAgICAgIHJldHVybiBvYmpcbiAgICB9LCB7fSlcbiAgfVxuICByZXR1cm4gKE9iamVjdC5mcm9tRW50cmllcyB8fCBmcm9tRW50cmllcykoXG4gICAgT2JqZWN0LmVudHJpZXMoZm5PYmopXG4gICAgICAuZmlsdGVyKChba2V5LCB2YWx1ZV0pID0+IHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJylcbiAgICAgIC5tYXAoKFtrZXksIHZhbHVlXSkgPT4gW2tleSwgdmFsdWUudG9TdHJpbmcoKV0pIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tZXZhbFxuICApXG59IixtYXRlcmlhbGl6ZUZuczoiKGZuU3RyT2JqID0geyBoZWxsbzogXCIoKSA9PiAnd29ybGQnXCIgfSkgPT4ge1xuICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgIE9iamVjdC5lbnRyaWVzKGZuU3RyT2JqKS5tYXAoKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgaWYgKHZhbHVlLnN0YXJ0c1dpdGgoJ2Z1bmN0aW9uJykpIHtcbiAgICAgICAgLy8gc29tZSB0cmlja2VyeSBpcyBuZWVkZWQgdG8gbWFrZSBvbGRzY2hvb2wgZnVuY3Rpb25zIHdvcmsgOi0pXG4gICAgICAgIHJldHVybiBba2V5LCBldmFsKGAoKSA9PiAke3ZhbHVlfWApKCldIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tZXZhbFxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gYXJyb3cgZnVuY3Rpb25zIGp1c3Qgd29ya1xuICAgICAgICByZXR1cm4gW2tleSwgZXZhbCh2YWx1ZSldIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tZXZhbFxuICAgICAgfVxuICAgIH0pXG4gIClcbn0iLG1ha2VIYW5kbGVyOiIoKSA9PiAoe1xuICAvLyBVc2VkIGJ5IHNpbXBsZSBgbmF2aWdhdG9yYCBnZXR0ZXIgZXZhc2lvbnNcbiAgZ2V0dGVyVmFsdWU6IHZhbHVlID0+ICh7XG4gICAgYXBwbHkodGFyZ2V0LCBjdHgsIGFyZ3MpIHtcbiAgICAgIC8vIExldCdzIGZldGNoIHRoZSB2YWx1ZSBmaXJzdCwgdG8gdHJpZ2dlciBhbmQgZXNjYWxhdGUgcG90ZW50aWFsIGVycm9yc1xuICAgICAgLy8gSWxsZWdhbCBpbnZvY2F0aW9ucyBsaWtlIGBuYXZpZ2F0b3IuX19wcm90b19fLnZlbmRvcmAgd2lsbCB0aHJvdyBoZXJlXG4gICAgICB1dGlscy5jYWNoZS5SZWZsZWN0LmFwcGx5KC4uLmFyZ3VtZW50cylcbiAgICAgIHJldHVybiB2YWx1ZVxuICAgIH1cbiAgfSlcbn0pIn0sX21haW5GdW5jdGlvbjoiKHV0aWxzLCBvcHRzKSA9PiB7XG4gICAgICBjb25zdCBnZXRQYXJhbWV0ZXJQcm94eUhhbmRsZXIgPSB7XG4gICAgICAgIGFwcGx5OiBmdW5jdGlvbih0YXJnZXQsIGN0eCwgYXJncykge1xuICAgICAgICAgIGNvbnN0IHBhcmFtID0gKGFyZ3MgfHwgW10pWzBdXG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gdXRpbHMuY2FjaGUuUmVmbGVjdC5hcHBseSh0YXJnZXQsIGN0eCwgYXJncylcbiAgICAgICAgICAvLyBVTk1BU0tFRF9WRU5ET1JfV0VCR0xcbiAgICAgICAgICBpZiAocGFyYW0gPT09IDM3NDQ1KSB7XG4gICAgICAgICAgICByZXR1cm4gb3B0cy52ZW5kb3IgfHwgJ0ludGVsIEluYy4nIC8vIGRlZmF1bHQgaW4gaGVhZGxlc3M6IEdvb2dsZSBJbmMuXG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIFVOTUFTS0VEX1JFTkRFUkVSX1dFQkdMXG4gICAgICAgICAgaWYgKHBhcmFtID09PSAzNzQ0Nikge1xuICAgICAgICAgICAgcmV0dXJuIG9wdHMucmVuZGVyZXIgfHwgJ0ludGVsIElyaXMgT3BlbkdMIEVuZ2luZScgLy8gZGVmYXVsdCBpbiBoZWFkbGVzczogR29vZ2xlIFN3aWZ0U2hhZGVyXG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiByZXN1bHRcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBUaGVyZSdzIG1vcmUgdGhhbiBvbmUgV2ViR0wgcmVuZGVyaW5nIGNvbnRleHRcbiAgICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9XZWJHTDJSZW5kZXJpbmdDb250ZXh0I0Jyb3dzZXJfY29tcGF0aWJpbGl0eVxuICAgICAgLy8gVG8gZmluZCBvdXQgdGhlIG9yaWdpbmFsIHZhbHVlcyBoZXJlOiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhXZWJHTFJlbmRlcmluZ0NvbnRleHQucHJvdG90eXBlLmdldFBhcmFtZXRlcilcbiAgICAgIGNvbnN0IGFkZFByb3h5ID0gKG9iaiwgcHJvcE5hbWUpID0+IHtcbiAgICAgICAgdXRpbHMucmVwbGFjZVdpdGhQcm94eShvYmosIHByb3BOYW1lLCBnZXRQYXJhbWV0ZXJQcm94eUhhbmRsZXIpXG4gICAgICB9XG4gICAgICAvLyBGb3Igd2hhdGV2ZXIgd2VpcmQgcmVhc29uIGxvb3BzIGRvbid0IHBsYXkgbmljZSB3aXRoIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSwgaGVyZSdzIHRoZSBuZXh0IGJlc3QgdGhpbmc6XG4gICAgICBhZGRQcm94eShXZWJHTFJlbmRlcmluZ0NvbnRleHQucHJvdG90eXBlLCAnZ2V0UGFyYW1ldGVyJylcbiAgICAgIGFkZFByb3h5KFdlYkdMMlJlbmRlcmluZ0NvbnRleHQucHJvdG90eXBlLCAnZ2V0UGFyYW1ldGVyJylcbiAgICB9IixfYXJnczpbe31dfSksKCgpPT57dHJ5e2lmKHdpbmRvdy5vdXRlcldpZHRoJiZ3aW5kb3cub3V0ZXJIZWlnaHQpcmV0dXJuO2NvbnN0IG49ODU7d2luZG93Lm91dGVyV2lkdGg9d2luZG93LmlubmVyV2lkdGgsd2luZG93Lm91dGVySGVpZ2h0PXdpbmRvdy5pbm5lckhlaWdodCtufWNhdGNoKG4pe319KSgpLCgoe191dGlsc0ZuczpfdXRpbHNGbnMsX21haW5GdW5jdGlvbjpfbWFpbkZ1bmN0aW9uLF9hcmdzOl9hcmdzfSk9Pntjb25zdCB1dGlscz1PYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmVudHJpZXMoX3V0aWxzRm5zKS5tYXAoKChba2V5LHZhbHVlXSk9PltrZXksZXZhbCh2YWx1ZSldKSkpO3V0aWxzLmluaXQoKSxldmFsKF9tYWluRnVuY3Rpb24pKHV0aWxzLC4uLl9hcmdzKX0pKHtfdXRpbHNGbnM6e2luaXQ6IigpID0+IHtcbiAgdXRpbHMucHJlbG9hZENhY2hlKClcbn0iLHN0cmlwUHJveHlGcm9tRXJyb3JzOiIoaGFuZGxlciA9IHt9KSA9PiB7XG4gIGNvbnN0IG5ld0hhbmRsZXIgPSB7XG4gICAgc2V0UHJvdG90eXBlT2Y6IGZ1bmN0aW9uICh0YXJnZXQsIHByb3RvKSB7XG4gICAgICBpZiAocHJvdG8gPT09IG51bGwpXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0Nhbm5vdCBjb252ZXJ0IG9iamVjdCB0byBwcmltaXRpdmUgdmFsdWUnKVxuICAgICAgaWYgKE9iamVjdC5nZXRQcm90b3R5cGVPZih0YXJnZXQpID09PSBPYmplY3QuZ2V0UHJvdG90eXBlT2YocHJvdG8pKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0N5Y2xpYyBfX3Byb3RvX18gdmFsdWUnKVxuICAgICAgfVxuICAgICAgcmV0dXJuIFJlZmxlY3Quc2V0UHJvdG90eXBlT2YodGFyZ2V0LCBwcm90bylcbiAgICB9XG4gIH1cbiAgLy8gV2Ugd3JhcCBlYWNoIHRyYXAgaW4gdGhlIGhhbmRsZXIgaW4gYSB0cnkvY2F0Y2ggYW5kIG1vZGlmeSB0aGUgZXJyb3Igc3RhY2sgaWYgdGhleSB0aHJvd1xuICBjb25zdCB0cmFwcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGhhbmRsZXIpXG4gIHRyYXBzLmZvckVhY2godHJhcCA9PiB7XG4gICAgbmV3SGFuZGxlclt0cmFwXSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIEZvcndhcmQgdGhlIGNhbGwgdG8gdGhlIGRlZmluZWQgcHJveHkgaGFuZGxlclxuICAgICAgICByZXR1cm4gaGFuZGxlclt0cmFwXS5hcHBseSh0aGlzLCBhcmd1bWVudHMgfHwgW10pXG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgLy8gU3RhY2sgdHJhY2VzIGRpZmZlciBwZXIgYnJvd3Nlciwgd2Ugb25seSBzdXBwb3J0IGNocm9taXVtIGJhc2VkIG9uZXMgY3VycmVudGx5XG4gICAgICAgIGlmICghZXJyIHx8ICFlcnIuc3RhY2sgfHwgIWVyci5zdGFjay5pbmNsdWRlcyhgYXQgYCkpIHtcbiAgICAgICAgICB0aHJvdyBlcnJcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFdoZW4gc29tZXRoaW5nIHRocm93cyB3aXRoaW4gb25lIG9mIG91ciB0cmFwcyB0aGUgUHJveHkgd2lsbCBzaG93IHVwIGluIGVycm9yIHN0YWNrc1xuICAgICAgICAvLyBBbiBlYXJsaWVyIGltcGxlbWVudGF0aW9uIG9mIHRoaXMgY29kZSB3b3VsZCBzaW1wbHkgc3RyaXAgbGluZXMgd2l0aCBhIGJsYWNrbGlzdCxcbiAgICAgICAgLy8gYnV0IGl0IG1ha2VzIHNlbnNlIHRvIGJlIG1vcmUgc3VyZ2ljYWwgaGVyZSBhbmQgb25seSByZW1vdmUgbGluZXMgcmVsYXRlZCB0byBvdXIgUHJveHkuXG4gICAgICAgIC8vIFdlIHRyeSB0byB1c2UgYSBrbm93biBcImFuY2hvclwiIGxpbmUgZm9yIHRoYXQgYW5kIHN0cmlwIGl0IHdpdGggZXZlcnl0aGluZyBhYm92ZSBpdC5cbiAgICAgICAgLy8gSWYgdGhlIGFuY2hvciBsaW5lIGNhbm5vdCBiZSBmb3VuZCBmb3Igc29tZSByZWFzb24gd2UgZmFsbCBiYWNrIHRvIG91ciBibGFja2xpc3QgYXBwcm9hY2guXG5cbiAgICAgICAgY29uc3Qgc3RyaXBXaXRoQmxhY2tsaXN0ID0gKHN0YWNrLCBzdHJpcEZpcnN0TGluZSA9IHRydWUpID0+IHtcbiAgICAgICAgICBjb25zdCBibGFja2xpc3QgPSBbXG4gICAgICAgICAgICBgYXQgUmVmbGVjdC4ke3RyYXB9IGAsIC8vIGUuZy4gUmVmbGVjdC5nZXQgb3IgUmVmbGVjdC5hcHBseVxuICAgICAgICAgICAgYGF0IE9iamVjdC4ke3RyYXB9IGAsIC8vIGUuZy4gT2JqZWN0LmdldCBvciBPYmplY3QuYXBwbHlcbiAgICAgICAgICAgIGBhdCBPYmplY3QubmV3SGFuZGxlci48Y29tcHV0ZWQ+IFthcyAke3RyYXB9XSBgIC8vIGNhdXNlZCBieSB0aGlzIHZlcnkgd3JhcHBlciA6LSlcbiAgICAgICAgICBdXG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIGVyci5zdGFja1xuICAgICAgICAgICAgICAuc3BsaXQoJ1xcbicpXG4gICAgICAgICAgICAgIC8vIEFsd2F5cyByZW1vdmUgdGhlIGZpcnN0IChmaWxlKSBsaW5lIGluIHRoZSBzdGFjayAoZ3VhcmFudGVlZCB0byBiZSBvdXIgcHJveHkpXG4gICAgICAgICAgICAgIC5maWx0ZXIoKGxpbmUsIGluZGV4KSA9PiAhKGluZGV4ID09PSAxICYmIHN0cmlwRmlyc3RMaW5lKSlcbiAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGxpbmUgc3RhcnRzIHdpdGggb25lIG9mIG91ciBibGFja2xpc3RlZCBzdHJpbmdzXG4gICAgICAgICAgICAgIC5maWx0ZXIobGluZSA9PiAhYmxhY2tsaXN0LnNvbWUoYmwgPT4gbGluZS50cmltKCkuc3RhcnRzV2l0aChibCkpKVxuICAgICAgICAgICAgICAuam9pbignXFxuJylcbiAgICAgICAgICApXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzdHJpcFdpdGhBbmNob3IgPSAoc3RhY2ssIGFuY2hvcikgPT4ge1xuICAgICAgICAgIGNvbnN0IHN0YWNrQXJyID0gc3RhY2suc3BsaXQoJ1xcbicpXG4gICAgICAgICAgYW5jaG9yID0gYW5jaG9yIHx8IGBhdCBPYmplY3QubmV3SGFuZGxlci48Y29tcHV0ZWQ+IFthcyAke3RyYXB9XSBgIC8vIEtub3duIGZpcnN0IFByb3h5IGxpbmUgaW4gY2hyb21pdW1cbiAgICAgICAgICBjb25zdCBhbmNob3JJbmRleCA9IHN0YWNrQXJyLmZpbmRJbmRleChsaW5lID0+XG4gICAgICAgICAgICBsaW5lLnRyaW0oKS5zdGFydHNXaXRoKGFuY2hvcilcbiAgICAgICAgICApXG4gICAgICAgICAgaWYgKGFuY2hvckluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlIC8vIDQwNCwgYW5jaG9yIG5vdCBmb3VuZFxuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBTdHJpcCBldmVyeXRoaW5nIGZyb20gdGhlIHRvcCB1bnRpbCB3ZSByZWFjaCB0aGUgYW5jaG9yIGxpbmVcbiAgICAgICAgICAvLyBOb3RlOiBXZSdyZSBrZWVwaW5nIHRoZSAxc3QgbGluZSAoemVybyBpbmRleCkgYXMgaXQncyB1bnJlbGF0ZWQgKGUuZy4gYFR5cGVFcnJvcmApXG4gICAgICAgICAgc3RhY2tBcnIuc3BsaWNlKDEsIGFuY2hvckluZGV4KVxuICAgICAgICAgIHJldHVybiBzdGFja0Fyci5qb2luKCdcXG4nKVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gU3BlY2lhbCBjYXNlcyBkdWUgdG8gb3VyIG5lc3RlZCB0b1N0cmluZyBwcm94aWVzXG4gICAgICAgIGVyci5zdGFjayA9IGVyci5zdGFjay5yZXBsYWNlKFxuICAgICAgICAgICdhdCBPYmplY3QudG9TdHJpbmcgKCcsXG4gICAgICAgICAgJ2F0IEZ1bmN0aW9uLnRvU3RyaW5nICgnXG4gICAgICAgIClcbiAgICAgICAgaWYgKChlcnIuc3RhY2sgfHwgJycpLmluY2x1ZGVzKCdhdCBGdW5jdGlvbi50b1N0cmluZyAoJykpIHtcbiAgICAgICAgICBlcnIuc3RhY2sgPSBzdHJpcFdpdGhCbGFja2xpc3QoZXJyLnN0YWNrLCBmYWxzZSlcbiAgICAgICAgICB0aHJvdyBlcnJcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFRyeSB1c2luZyB0aGUgYW5jaG9yIG1ldGhvZCwgZmFsbGJhY2sgdG8gYmxhY2tsaXN0IGlmIG5lY2Vzc2FyeVxuICAgICAgICBlcnIuc3RhY2sgPSBzdHJpcFdpdGhBbmNob3IoZXJyLnN0YWNrKSB8fCBzdHJpcFdpdGhCbGFja2xpc3QoZXJyLnN0YWNrKVxuXG4gICAgICAgIHRocm93IGVyciAvLyBSZS10aHJvdyBvdXIgbm93IHNhbml0aXplZCBlcnJvclxuICAgICAgfVxuICAgIH1cbiAgfSlcbiAgcmV0dXJuIG5ld0hhbmRsZXJcbn0iLHN0cmlwRXJyb3JXaXRoQW5jaG9yOiIoZXJyLCBhbmNob3IpID0+IHtcbiAgY29uc3Qgc3RhY2tBcnIgPSBlcnIuc3RhY2suc3BsaXQoJ1xcbicpXG4gIGNvbnN0IGFuY2hvckluZGV4ID0gc3RhY2tBcnIuZmluZEluZGV4KGxpbmUgPT4gbGluZS50cmltKCkuc3RhcnRzV2l0aChhbmNob3IpKVxuICBpZiAoYW5jaG9ySW5kZXggPT09IC0xKSB7XG4gICAgcmV0dXJuIGVyciAvLyA0MDQsIGFuY2hvciBub3QgZm91bmRcbiAgfVxuICAvLyBTdHJpcCBldmVyeXRoaW5nIGZyb20gdGhlIHRvcCB1bnRpbCB3ZSByZWFjaCB0aGUgYW5jaG9yIGxpbmUgKHJlbW92ZSBhbmNob3IgbGluZSBhcyB3ZWxsKVxuICAvLyBOb3RlOiBXZSdyZSBrZWVwaW5nIHRoZSAxc3QgbGluZSAoemVybyBpbmRleCkgYXMgaXQncyB1bnJlbGF0ZWQgKGUuZy4gYFR5cGVFcnJvcmApXG4gIHN0YWNrQXJyLnNwbGljZSgxLCBhbmNob3JJbmRleClcbiAgZXJyLnN0YWNrID0gc3RhY2tBcnIuam9pbignXFxuJylcbiAgcmV0dXJuIGVyclxufSIscmVwbGFjZVByb3BlcnR5OiIob2JqLCBwcm9wTmFtZSwgZGVzY3JpcHRvck92ZXJyaWRlcyA9IHt9KSA9PiB7XG4gIHJldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBwcm9wTmFtZSwge1xuICAgIC8vIENvcHkgb3ZlciB0aGUgZXhpc3RpbmcgZGVzY3JpcHRvcnMgKHdyaXRhYmxlLCBlbnVtZXJhYmxlLCBjb25maWd1cmFibGUsIGV0YylcbiAgICAuLi4oT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIHByb3BOYW1lKSB8fCB7fSksXG4gICAgLy8gQWRkIG91ciBvdmVycmlkZXMgKGUuZy4gdmFsdWUsIGdldCgpKVxuICAgIC4uLmRlc2NyaXB0b3JPdmVycmlkZXNcbiAgfSlcbn0iLHByZWxvYWRDYWNoZToiKCkgPT4ge1xuICBpZiAodXRpbHMuY2FjaGUpIHtcbiAgICByZXR1cm5cbiAgfVxuICB1dGlscy5jYWNoZSA9IHtcbiAgICAvLyBVc2VkIGluIG91ciBwcm94aWVzXG4gICAgUmVmbGVjdDoge1xuICAgICAgZ2V0OiBSZWZsZWN0LmdldC5iaW5kKFJlZmxlY3QpLFxuICAgICAgYXBwbHk6IFJlZmxlY3QuYXBwbHkuYmluZChSZWZsZWN0KVxuICAgIH0sXG4gICAgLy8gVXNlZCBpbiBgbWFrZU5hdGl2ZVN0cmluZ2BcbiAgICBuYXRpdmVUb1N0cmluZ1N0cjogRnVuY3Rpb24udG9TdHJpbmcgKyAnJyAvLyA9PiBgZnVuY3Rpb24gdG9TdHJpbmcoKSB7IFtuYXRpdmUgY29kZV0gfWBcbiAgfVxufSIsbWFrZU5hdGl2ZVN0cmluZzoiKG5hbWUgPSAnJykgPT4ge1xuICByZXR1cm4gdXRpbHMuY2FjaGUubmF0aXZlVG9TdHJpbmdTdHIucmVwbGFjZSgndG9TdHJpbmcnLCBuYW1lIHx8ICcnKVxufSIscGF0Y2hUb1N0cmluZzoiKG9iaiwgc3RyID0gJycpID0+IHtcbiAgY29uc3QgaGFuZGxlciA9IHtcbiAgICBhcHBseTogZnVuY3Rpb24gKHRhcmdldCwgY3R4KSB7XG4gICAgICAvLyBUaGlzIGZpeGVzIGUuZy4gYEhUTUxNZWRpYUVsZW1lbnQucHJvdG90eXBlLmNhblBsYXlUeXBlLnRvU3RyaW5nICsgXCJcImBcbiAgICAgIGlmIChjdHggPT09IEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZykge1xuICAgICAgICByZXR1cm4gdXRpbHMubWFrZU5hdGl2ZVN0cmluZygndG9TdHJpbmcnKVxuICAgICAgfVxuICAgICAgLy8gYHRvU3RyaW5nYCB0YXJnZXRlZCBhdCBvdXIgcHJveGllZCBPYmplY3QgZGV0ZWN0ZWRcbiAgICAgIGlmIChjdHggPT09IG9iaikge1xuICAgICAgICAvLyBXZSBlaXRoZXIgcmV0dXJuIHRoZSBvcHRpb25hbCBzdHJpbmcgdmVyYmF0aW0gb3IgZGVyaXZlIHRoZSBtb3N0IGRlc2lyZWQgcmVzdWx0IGF1dG9tYXRpY2FsbHlcbiAgICAgICAgcmV0dXJuIHN0ciB8fCB1dGlscy5tYWtlTmF0aXZlU3RyaW5nKG9iai5uYW1lKVxuICAgICAgfVxuICAgICAgLy8gQ2hlY2sgaWYgdGhlIHRvU3RyaW5nIHByb3R5cGUgb2YgdGhlIGNvbnRleHQgaXMgdGhlIHNhbWUgYXMgdGhlIGdsb2JhbCBwcm90b3R5cGUsXG4gICAgICAvLyBpZiBub3QgaW5kaWNhdGVzIHRoYXQgd2UgYXJlIGRvaW5nIGEgY2hlY2sgYWNyb3NzIGRpZmZlcmVudCB3aW5kb3dzLiwgZS5nLiB0aGUgaWZyYW1lV2l0aGRpcmVjdGAgdGVzdCBjYXNlXG4gICAgICBjb25zdCBoYXNTYW1lUHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YoXG4gICAgICAgIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZ1xuICAgICAgKS5pc1Byb3RvdHlwZU9mKGN0eC50b1N0cmluZykgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1wcm90b3R5cGUtYnVpbHRpbnNcbiAgICAgIGlmICghaGFzU2FtZVByb3RvKSB7XG4gICAgICAgIC8vIFBhc3MgdGhlIGNhbGwgb24gdG8gdGhlIGxvY2FsIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZyBpbnN0ZWFkXG4gICAgICAgIHJldHVybiBjdHgudG9TdHJpbmcoKVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRhcmdldC5jYWxsKGN0eClcbiAgICB9XG4gIH1cblxuICBjb25zdCB0b1N0cmluZ1Byb3h5ID0gbmV3IFByb3h5KFxuICAgIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZyxcbiAgICB1dGlscy5zdHJpcFByb3h5RnJvbUVycm9ycyhoYW5kbGVyKVxuICApXG4gIHV0aWxzLnJlcGxhY2VQcm9wZXJ0eShGdW5jdGlvbi5wcm90b3R5cGUsICd0b1N0cmluZycsIHtcbiAgICB2YWx1ZTogdG9TdHJpbmdQcm94eVxuICB9KVxufSIscGF0Y2hUb1N0cmluZ05lc3RlZDoiKG9iaiA9IHt9KSA9PiB7XG4gIHJldHVybiB1dGlscy5leGVjUmVjdXJzaXZlbHkob2JqLCBbJ2Z1bmN0aW9uJ10sIHV0aWxzLnBhdGNoVG9TdHJpbmcpXG59IixyZWRpcmVjdFRvU3RyaW5nOiIocHJveHlPYmosIG9yaWdpbmFsT2JqKSA9PiB7XG4gIGNvbnN0IGhhbmRsZXIgPSB7XG4gICAgYXBwbHk6IGZ1bmN0aW9uICh0YXJnZXQsIGN0eCkge1xuICAgICAgLy8gVGhpcyBmaXhlcyBlLmcuIGBIVE1MTWVkaWFFbGVtZW50LnByb3RvdHlwZS5jYW5QbGF5VHlwZS50b1N0cmluZyArIFwiXCJgXG4gICAgICBpZiAoY3R4ID09PSBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHV0aWxzLm1ha2VOYXRpdmVTdHJpbmcoJ3RvU3RyaW5nJylcbiAgICAgIH1cblxuICAgICAgLy8gYHRvU3RyaW5nYCB0YXJnZXRlZCBhdCBvdXIgcHJveGllZCBPYmplY3QgZGV0ZWN0ZWRcbiAgICAgIGlmIChjdHggPT09IHByb3h5T2JqKSB7XG4gICAgICAgIGNvbnN0IGZhbGxiYWNrID0gKCkgPT5cbiAgICAgICAgICBvcmlnaW5hbE9iaiAmJiBvcmlnaW5hbE9iai5uYW1lXG4gICAgICAgICAgICA/IHV0aWxzLm1ha2VOYXRpdmVTdHJpbmcob3JpZ2luYWxPYmoubmFtZSlcbiAgICAgICAgICAgIDogdXRpbHMubWFrZU5hdGl2ZVN0cmluZyhwcm94eU9iai5uYW1lKVxuXG4gICAgICAgIC8vIFJldHVybiB0aGUgdG9TdHJpbmcgcmVwcmVzZW50YXRpb24gb2Ygb3VyIG9yaWdpbmFsIG9iamVjdCBpZiBwb3NzaWJsZVxuICAgICAgICByZXR1cm4gb3JpZ2luYWxPYmogKyAnJyB8fCBmYWxsYmFjaygpXG4gICAgICB9XG5cbiAgICAgIGlmICh0eXBlb2YgY3R4ID09PSAndW5kZWZpbmVkJyB8fCBjdHggPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHRhcmdldC5jYWxsKGN0eClcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgdGhlIHRvU3RyaW5nIHByb3R5cGUgb2YgdGhlIGNvbnRleHQgaXMgdGhlIHNhbWUgYXMgdGhlIGdsb2JhbCBwcm90b3R5cGUsXG4gICAgICAvLyBpZiBub3QgaW5kaWNhdGVzIHRoYXQgd2UgYXJlIGRvaW5nIGEgY2hlY2sgYWNyb3NzIGRpZmZlcmVudCB3aW5kb3dzLiwgZS5nLiB0aGUgaWZyYW1lV2l0aGRpcmVjdGAgdGVzdCBjYXNlXG4gICAgICBjb25zdCBoYXNTYW1lUHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YoXG4gICAgICAgIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZ1xuICAgICAgKS5pc1Byb3RvdHlwZU9mKGN0eC50b1N0cmluZykgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1wcm90b3R5cGUtYnVpbHRpbnNcbiAgICAgIGlmICghaGFzU2FtZVByb3RvKSB7XG4gICAgICAgIC8vIFBhc3MgdGhlIGNhbGwgb24gdG8gdGhlIGxvY2FsIEZ1bmN0aW9uLnByb3RvdHlwZS50b1N0cmluZyBpbnN0ZWFkXG4gICAgICAgIHJldHVybiBjdHgudG9TdHJpbmcoKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGFyZ2V0LmNhbGwoY3R4KVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHRvU3RyaW5nUHJveHkgPSBuZXcgUHJveHkoXG4gICAgRnVuY3Rpb24ucHJvdG90eXBlLnRvU3RyaW5nLFxuICAgIHV0aWxzLnN0cmlwUHJveHlGcm9tRXJyb3JzKGhhbmRsZXIpXG4gIClcbiAgdXRpbHMucmVwbGFjZVByb3BlcnR5KEZ1bmN0aW9uLnByb3RvdHlwZSwgJ3RvU3RyaW5nJywge1xuICAgIHZhbHVlOiB0b1N0cmluZ1Byb3h5XG4gIH0pXG59IixyZXBsYWNlV2l0aFByb3h5OiIob2JqLCBwcm9wTmFtZSwgaGFuZGxlcikgPT4ge1xuICBjb25zdCBvcmlnaW5hbE9iaiA9IG9ialtwcm9wTmFtZV1cbiAgY29uc3QgcHJveHlPYmogPSBuZXcgUHJveHkob2JqW3Byb3BOYW1lXSwgdXRpbHMuc3RyaXBQcm94eUZyb21FcnJvcnMoaGFuZGxlcikpXG5cbiAgdXRpbHMucmVwbGFjZVByb3BlcnR5KG9iaiwgcHJvcE5hbWUsIHsgdmFsdWU6IHByb3h5T2JqIH0pXG4gIHV0aWxzLnJlZGlyZWN0VG9TdHJpbmcocHJveHlPYmosIG9yaWdpbmFsT2JqKVxuXG4gIHJldHVybiB0cnVlXG59IixyZXBsYWNlR2V0dGVyV2l0aFByb3h5OiIob2JqLCBwcm9wTmFtZSwgaGFuZGxlcikgPT4ge1xuICBjb25zdCBmbiA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBwcm9wTmFtZSkuZ2V0XG4gIGNvbnN0IGZuU3RyID0gZm4udG9TdHJpbmcoKSAvLyBzcGVjaWFsIGdldHRlciBmdW5jdGlvbiBzdHJpbmdcbiAgY29uc3QgcHJveHlPYmogPSBuZXcgUHJveHkoZm4sIHV0aWxzLnN0cmlwUHJveHlGcm9tRXJyb3JzKGhhbmRsZXIpKVxuXG4gIHV0aWxzLnJlcGxhY2VQcm9wZXJ0eShvYmosIHByb3BOYW1lLCB7IGdldDogcHJveHlPYmogfSlcbiAgdXRpbHMucGF0Y2hUb1N0cmluZyhwcm94eU9iaiwgZm5TdHIpXG5cbiAgcmV0dXJuIHRydWVcbn0iLG1vY2tXaXRoUHJveHk6IihvYmosIHByb3BOYW1lLCBwc2V1ZG9UYXJnZXQsIGhhbmRsZXIpID0+IHtcbiAgY29uc3QgcHJveHlPYmogPSBuZXcgUHJveHkocHNldWRvVGFyZ2V0LCB1dGlscy5zdHJpcFByb3h5RnJvbUVycm9ycyhoYW5kbGVyKSlcblxuICB1dGlscy5yZXBsYWNlUHJvcGVydHkob2JqLCBwcm9wTmFtZSwgeyB2YWx1ZTogcHJveHlPYmogfSlcbiAgdXRpbHMucGF0Y2hUb1N0cmluZyhwcm94eU9iailcblxuICByZXR1cm4gdHJ1ZVxufSIsY3JlYXRlUHJveHk6Iihwc2V1ZG9UYXJnZXQsIGhhbmRsZXIpID0+IHtcbiAgY29uc3QgcHJveHlPYmogPSBuZXcgUHJveHkocHNldWRvVGFyZ2V0LCB1dGlscy5zdHJpcFByb3h5RnJvbUVycm9ycyhoYW5kbGVyKSlcbiAgdXRpbHMucGF0Y2hUb1N0cmluZyhwcm94eU9iailcblxuICByZXR1cm4gcHJveHlPYmpcbn0iLHNwbGl0T2JqUGF0aDoib2JqUGF0aCA9PiAoe1xuICAvLyBSZW1vdmUgbGFzdCBkb3QgZW50cnkgKHByb3BlcnR5KSA9PT4gYEhUTUxNZWRpYUVsZW1lbnQucHJvdG90eXBlYFxuICBvYmpOYW1lOiBvYmpQYXRoLnNwbGl0KCcuJykuc2xpY2UoMCwgLTEpLmpvaW4oJy4nKSxcbiAgLy8gRXh0cmFjdCBsYXN0IGRvdCBlbnRyeSA9PT4gYGNhblBsYXlUeXBlYFxuICBwcm9wTmFtZTogb2JqUGF0aC5zcGxpdCgnLicpLnNsaWNlKC0xKVswXVxufSkiLHJlcGxhY2VPYmpQYXRoV2l0aFByb3h5OiIob2JqUGF0aCwgaGFuZGxlcikgPT4ge1xuICBjb25zdCB7IG9iak5hbWUsIHByb3BOYW1lIH0gPSB1dGlscy5zcGxpdE9ialBhdGgob2JqUGF0aClcbiAgY29uc3Qgb2JqID0gZXZhbChvYmpOYW1lKSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWV2YWxcbiAgcmV0dXJuIHV0aWxzLnJlcGxhY2VXaXRoUHJveHkob2JqLCBwcm9wTmFtZSwgaGFuZGxlcilcbn0iLGV4ZWNSZWN1cnNpdmVseToiKG9iaiA9IHt9LCB0eXBlRmlsdGVyID0gW10sIGZuKSA9PiB7XG4gIGZ1bmN0aW9uIHJlY3Vyc2Uob2JqKSB7XG4gICAgZm9yIChjb25zdCBrZXkgaW4gb2JqKSB7XG4gICAgICBpZiAob2JqW2tleV0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb250aW51ZVxuICAgICAgfVxuICAgICAgaWYgKG9ialtrZXldICYmIHR5cGVvZiBvYmpba2V5XSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgcmVjdXJzZShvYmpba2V5XSlcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChvYmpba2V5XSAmJiB0eXBlRmlsdGVyLmluY2x1ZGVzKHR5cGVvZiBvYmpba2V5XSkpIHtcbiAgICAgICAgICBmbi5jYWxsKHRoaXMsIG9ialtrZXldKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJlY3Vyc2Uob2JqKVxuICByZXR1cm4gb2JqXG59IixzdHJpbmdpZnlGbnM6Iihmbk9iaiA9IHsgaGVsbG86ICgpID0+ICd3b3JsZCcgfSkgPT4ge1xuICAvLyBPYmplY3QuZnJvbUVudHJpZXMoKSBwb255ZmlsbCAoaW4gNiBsaW5lcykgLSBzdXBwb3J0ZWQgb25seSBpbiBOb2RlIHYxMissIG1vZGVybiBicm93c2VycyBhcmUgZmluZVxuICAvLyBodHRwczovL2dpdGh1Yi5jb20vZmVyb3NzL2Zyb21lbnRyaWVzXG4gIGZ1bmN0aW9uIGZyb21FbnRyaWVzKGl0ZXJhYmxlKSB7XG4gICAgcmV0dXJuIFsuLi5pdGVyYWJsZV0ucmVkdWNlKChvYmosIFtrZXksIHZhbF0pID0+IHtcbiAgICAgIG9ialtrZXldID0gdmFsXG4gICAgICByZXR1cm4gb2JqXG4gICAgfSwge30pXG4gIH1cbiAgcmV0dXJuIChPYmplY3QuZnJvbUVudHJpZXMgfHwgZnJvbUVudHJpZXMpKFxuICAgIE9iamVjdC5lbnRyaWVzKGZuT2JqKVxuICAgICAgLmZpbHRlcigoW2tleSwgdmFsdWVdKSA9PiB0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpXG4gICAgICAubWFwKChba2V5LCB2YWx1ZV0pID0+IFtrZXksIHZhbHVlLnRvU3RyaW5nKCldKSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWV2YWxcbiAgKVxufSIsbWF0ZXJpYWxpemVGbnM6IihmblN0ck9iaiA9IHsgaGVsbG86IFwiKCkgPT4gJ3dvcmxkJ1wiIH0pID0+IHtcbiAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhcbiAgICBPYmplY3QuZW50cmllcyhmblN0ck9iaikubWFwKChba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAgIGlmICh2YWx1ZS5zdGFydHNXaXRoKCdmdW5jdGlvbicpKSB7XG4gICAgICAgIC8vIHNvbWUgdHJpY2tlcnkgaXMgbmVlZGVkIHRvIG1ha2Ugb2xkc2Nob29sIGZ1bmN0aW9ucyB3b3JrIDotKVxuICAgICAgICByZXR1cm4gW2tleSwgZXZhbChgKCkgPT4gJHt2YWx1ZX1gKSgpXSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWV2YWxcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGFycm93IGZ1bmN0aW9ucyBqdXN0IHdvcmtcbiAgICAgICAgcmV0dXJuIFtrZXksIGV2YWwodmFsdWUpXSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWV2YWxcbiAgICAgIH1cbiAgICB9KVxuICApXG59IixtYWtlSGFuZGxlcjoiKCkgPT4gKHtcbiAgLy8gVXNlZCBieSBzaW1wbGUgYG5hdmlnYXRvcmAgZ2V0dGVyIGV2YXNpb25zXG4gIGdldHRlclZhbHVlOiB2YWx1ZSA9PiAoe1xuICAgIGFwcGx5KHRhcmdldCwgY3R4LCBhcmdzKSB7XG4gICAgICAvLyBMZXQncyBmZXRjaCB0aGUgdmFsdWUgZmlyc3QsIHRvIHRyaWdnZXIgYW5kIGVzY2FsYXRlIHBvdGVudGlhbCBlcnJvcnNcbiAgICAgIC8vIElsbGVnYWwgaW52b2NhdGlvbnMgbGlrZSBgbmF2aWdhdG9yLl9fcHJvdG9fXy52ZW5kb3JgIHdpbGwgdGhyb3cgaGVyZVxuICAgICAgdXRpbHMuY2FjaGUuUmVmbGVjdC5hcHBseSguLi5hcmd1bWVudHMpXG4gICAgICByZXR1cm4gdmFsdWVcbiAgICB9XG4gIH0pXG59KSJ9LF9tYWluRnVuY3Rpb246Iih1dGlscywgb3B0cykgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gQWRkcyBhIGNvbnRlbnRXaW5kb3cgcHJveHkgdG8gdGhlIHByb3ZpZGVkIGlmcmFtZSBlbGVtZW50XG4gICAgICAgIGNvbnN0IGFkZENvbnRlbnRXaW5kb3dQcm94eSA9IGlmcmFtZSA9PiB7XG4gICAgICAgICAgY29uc3QgY29udGVudFdpbmRvd1Byb3h5ID0ge1xuICAgICAgICAgICAgZ2V0KHRhcmdldCwga2V5KSB7XG4gICAgICAgICAgICAgIC8vIE5vdyB0byB0aGUgaW50ZXJlc3RpbmcgcGFydDpcbiAgICAgICAgICAgICAgLy8gV2UgYWN0dWFsbHkgbWFrZSB0aGlzIHRoaW5nIGJlaGF2ZSBsaWtlIGEgcmVndWxhciBpZnJhbWUgd2luZG93LFxuICAgICAgICAgICAgICAvLyBieSBpbnRlcmNlcHRpbmcgY2FsbHMgdG8gZS5nLiBgLnNlbGZgIGFuZCByZWRpcmVjdCBpdCB0byB0aGUgY29ycmVjdCB0aGluZy4gOilcbiAgICAgICAgICAgICAgLy8gVGhhdCBtYWtlcyBpdCBwb3NzaWJsZSBmb3IgdGhlc2UgYXNzZXJ0aW9ucyB0byBiZSBjb3JyZWN0OlxuICAgICAgICAgICAgICAvLyBpZnJhbWUuY29udGVudFdpbmRvdy5zZWxmID09PSB3aW5kb3cudG9wIC8vIG11c3QgYmUgZmFsc2VcbiAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ3NlbGYnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXNcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAvLyBpZnJhbWUuY29udGVudFdpbmRvdy5mcmFtZUVsZW1lbnQgPT09IGlmcmFtZSAvLyBtdXN0IGJlIHRydWVcbiAgICAgICAgICAgICAgaWYgKGtleSA9PT0gJ2ZyYW1lRWxlbWVudCcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaWZyYW1lXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgLy8gSW50ZXJjZXB0IGlmcmFtZS5jb250ZW50V2luZG93WzBdIHRvIGhpZGUgdGhlIHByb3BlcnR5IDAgYWRkZWQgYnkgdGhlIHByb3h5LlxuICAgICAgICAgICAgICBpZiAoa2V5ID09PSAnMCcpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gUmVmbGVjdC5nZXQodGFyZ2V0LCBrZXkpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKCFpZnJhbWUuY29udGVudFdpbmRvdykge1xuICAgICAgICAgICAgY29uc3QgcHJveHkgPSBuZXcgUHJveHkod2luZG93LCBjb250ZW50V2luZG93UHJveHkpXG4gICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaWZyYW1lLCAnY29udGVudFdpbmRvdycsIHtcbiAgICAgICAgICAgICAgZ2V0KCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBwcm94eVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBzZXQobmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3VmFsdWUgLy8gY29udGVudFdpbmRvdyBpcyBpbW11dGFibGVcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgY29uZmlndXJhYmxlOiBmYWxzZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBIYW5kbGVzIGlmcmFtZSBlbGVtZW50IGNyZWF0aW9uLCBhdWdtZW50cyBgc3JjZG9jYCBwcm9wZXJ0eSBzbyB3ZSBjYW4gaW50ZXJjZXB0IGZ1cnRoZXJcbiAgICAgICAgY29uc3QgaGFuZGxlSWZyYW1lQ3JlYXRpb24gPSAodGFyZ2V0LCB0aGlzQXJnLCBhcmdzKSA9PiB7XG4gICAgICAgICAgY29uc3QgaWZyYW1lID0gdGFyZ2V0LmFwcGx5KHRoaXNBcmcsIGFyZ3MpXG5cbiAgICAgICAgICAvLyBXZSBuZWVkIHRvIGtlZXAgdGhlIG9yaWdpbmFscyBhcm91bmRcbiAgICAgICAgICBjb25zdCBfaWZyYW1lID0gaWZyYW1lXG4gICAgICAgICAgY29uc3QgX3NyY2RvYyA9IF9pZnJhbWUuc3JjZG9jXG5cbiAgICAgICAgICAvLyBBZGQgaG9vayBmb3IgdGhlIHNyY2RvYyBwcm9wZXJ0eVxuICAgICAgICAgIC8vIFdlIG5lZWQgdG8gYmUgdmVyeSBzdXJnaWNhbCBoZXJlIHRvIG5vdCBicmVhayBvdGhlciBpZnJhbWVzIGJ5IGFjY2lkZW50XG4gICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGlmcmFtZSwgJ3NyY2RvYycsIHtcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgLy8gSW1wb3J0YW50LCBzbyB3ZSBjYW4gcmVzZXQgdGhpcyBsYXRlclxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIF9zcmNkb2NcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uKG5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgIGFkZENvbnRlbnRXaW5kb3dQcm94eSh0aGlzKVxuICAgICAgICAgICAgICAvLyBSZXNldCBwcm9wZXJ0eSwgdGhlIGhvb2sgaXMgb25seSBuZWVkZWQgb25jZVxuICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoaWZyYW1lLCAnc3JjZG9jJywge1xuICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgd3JpdGFibGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHZhbHVlOiBfc3JjZG9jXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIF9pZnJhbWUuc3JjZG9jID0gbmV3VmFsdWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICAgIHJldHVybiBpZnJhbWVcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFkZHMgYSBob29rIHRvIGludGVyY2VwdCBpZnJhbWUgY3JlYXRpb24gZXZlbnRzXG4gICAgICAgIGNvbnN0IGFkZElmcmFtZUNyZWF0aW9uU25pZmZlciA9ICgpID0+IHtcbiAgICAgICAgICAvKiBnbG9iYWwgZG9jdW1lbnQgKi9cbiAgICAgICAgICBjb25zdCBjcmVhdGVFbGVtZW50SGFuZGxlciA9IHtcbiAgICAgICAgICAgIC8vIE1ha2UgdG9TdHJpbmcoKSBuYXRpdmVcbiAgICAgICAgICAgIGdldCh0YXJnZXQsIGtleSkge1xuICAgICAgICAgICAgICByZXR1cm4gUmVmbGVjdC5nZXQodGFyZ2V0LCBrZXkpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYXBwbHk6IGZ1bmN0aW9uKHRhcmdldCwgdGhpc0FyZywgYXJncykge1xuICAgICAgICAgICAgICBjb25zdCBpc0lmcmFtZSA9XG4gICAgICAgICAgICAgICAgYXJncyAmJiBhcmdzLmxlbmd0aCAmJiBgJHthcmdzWzBdfWAudG9Mb3dlckNhc2UoKSA9PT0gJ2lmcmFtZSdcbiAgICAgICAgICAgICAgaWYgKCFpc0lmcmFtZSkge1xuICAgICAgICAgICAgICAgIC8vIEV2ZXJ5dGhpbmcgYXMgdXN1YWxcbiAgICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0LmFwcGx5KHRoaXNBcmcsIGFyZ3MpXG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZUlmcmFtZUNyZWF0aW9uKHRhcmdldCwgdGhpc0FyZywgYXJncylcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBBbGwgdGhpcyBqdXN0IGR1ZSB0byBpZnJhbWVzIHdpdGggc3JjZG9jIGJ1Z1xuICAgICAgICAgIHV0aWxzLnJlcGxhY2VXaXRoUHJveHkoXG4gICAgICAgICAgICBkb2N1bWVudCxcbiAgICAgICAgICAgICdjcmVhdGVFbGVtZW50JyxcbiAgICAgICAgICAgIGNyZWF0ZUVsZW1lbnRIYW5kbGVyXG4gICAgICAgICAgKVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gTGV0J3MgZ29cbiAgICAgICAgYWRkSWZyYW1lQ3JlYXRpb25TbmlmZmVyKClcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAvLyBjb25zb2xlLndhcm4oZXJyKVxuICAgICAgfVxuICAgIH0iLF9hcmdzOltdfSk7Cg==`);
